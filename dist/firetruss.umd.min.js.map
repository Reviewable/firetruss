{"version":3,"sources":["../src/angularCompatibility.js","../src/utils/paths.js","../src/Bridge.js","../src/utils/utils.js","../src/Connector.js","../src/utils/promises.js","../src/Modeler.js","../src/Tree.js","../src/utils/LruCache.js","../src/Reference.js","../src/utils/stats.js","../node_modules/performance-now/lib/performance-now.js","../src/Dispatcher.js","../src/KeyGenerator.js","../src/MetaTree.js","../src/Coupler.js","../src/Truss.js"],"names":["initAngular","const","module","window","angular","angularProxy","digest","bareDigest","watch","Error","defineModule","Truss","constant","debounceDigest","wait","debouncedDigest","_","debounce","vue","digestRequest","lastDigestRequest","digestInProgress","config","$provide","decorator","$delegate","$exceptionHandler","rootScope","$watch","bind","proto","Object","getPrototypeOf","angularDigest","$digest","original","call","last","_watchers","id","Infinity","noop","escapeKey","key","toString","replace","char","charCodeAt","unescapeKey","code","String","fromCharCode","parseInt","slice","escapeKeys","object","isObject","isExtensible","let","result","hasOwnProperty","value","escapedKey","escapedValue","clone","joinPath","segments","i","list","arguments","length","segment","isString","charAt","splice","push","join","splitPath","path","leaveSegmentsEscaped","pathSegments","get","split","map","set","makePathMatcher","pattern","matcher","pathMatchers","PathMatcher","size","maxNumPathMatchers","keys","errorFromJson","json","params","error","message","propertyName","e","extra","getUrlRoot","url","k","indexOf","isTrussEqual","a","b","isEqual","isTrussValueEqual","undefined","$truss","flattenRefs","refs","Handle","mapValues","wrapPromiseCallback","callback","Promise","resolve","apply","this","reject","promiseCancel","promise","cancel","promiseFinally","propagatePromiseProperty","originalThen","then","originalCatch","catch","onResolved","onRejected","derivedPromise","onFinally","computeValue","prop","propertyStats","$destroyed","$$touchThis","oldPropertyFrozen","currentPropertyFrozen","startTime","performanceNow","ErrorWrapper","runtime","numRecomputes","FrozenWrapper","wrapConnections","connections","descriptor","isFunction","fn","angularWatchSuppressed","freeze","isFrozen","isArray","checkUpdateHasOnlyDescendantsWithNoOverlap","rootPath","values","each","startsWith","absolutePath","allPaths","sortBy","otherPath","extractCommonPathPrefix","prefixSegments","firstMismatchIndex","maxIndex","Math","min","relativizePaths","offset","toFirebaseJson","Vue","data","active","forEach","method","LruCacheItem","touch","prototype","timestamp","Date","now","LruCache","maxSize","pruningSize","_items","create","_size","_maxSize","_pruningSize","ceil","has","Boolean","item","_prune","delete","itemsToPrune","toArray","take","variables","prefixMatch","endsWith","pathTemplate","match","test","_regex","RegExp","lastIndex","exec","bindings","MIN_WORKER_VERSION","Snapshot","ref","valueError","exists","writeSerial","_path","_value","_valueError","_exists","_writeSerial","prototypeAccessors","_checkValue","_key","Bridge","webWorker","_idCounter","_deferreds","_suspended","_servers","_callbacks","_log","_simulatedTokenGenerator","_maxSimulationDuration","_simulatedCallFilter","_inboundMessages","_outboundMessages","_flushMessageQueue","_port","port","_shared","seal","onmessage","_receive","addEventListener","_send","msg","setInterval","init","items","storage","localStorage","sessionStorage","getItem","response","workerVersion","version","minVersion","sufficient","suspend","suspended","_receiveMessages","debugPermissionDeniedErrors","simulatedTokenGenerator","maxSimulationDuration","callFilter","enableLogging","console","log","oneWay","this$1","deferred","sent","resolveSent","postMessage","event","concat","messages","bindExposedFunction","name","args","Array","probeError","toLowerCase","_simulateCall","securityTrace","permissionDeniedDetails","props","simulatedCalls","spec","newValue","auth","getAuth","simulationPromise","uid","token","all","securityTraces","every","trace","filter","timeoutPromise","setTimeout","race","updateLocalStorage","removeItem","setItem","trackServer","rootUrl","server","authListeners","authCallbackId","_registerCallback","_authCallback","callbackId","listener","onAuth","context","offAuth","authWithCustomToken","authToken","options","unauth","update","on","listenerKey","eventType","snapshotCallback","cancelCallback","handle","_onCallback","__callbackIds","off","idsToDeregister","_findAndRemoveCallbackId","i$1","list$1","_nullifyCallback","_deregisterCallback","snapshotJson","transaction","oldValue","relativeUpdates","snapshots","jsonSnapshot","onDisconnect","bounceConnection","predicate","EMPTY_ANNOTATIONS","tree","annotations","_tree","_annotations","$ref","_pathPrefix","parent","Reference","child","children","escapedKeys","arg","mapping","subPath","rest","subRef","subMapping","isEmpty","peek","truss","that","belongsTo","Query","super","_spec","_copyAndValidateSpec","queryTerms","encodeURIComponent","JSON","stringify","_string","prototypeAccessors$1","ready","isQueryReady","constraints","annotate","extend","by","some","clause","childPath","prototypeAccessors$2","isReferenceReady","getObject","query","obj","override","commit","updateFunction","StatItem","numUpdates","add","runtimePerRecompute","toLogParts","totals","toFixed","Stats","for","n","stats","stat","above","lines","widths","range","line","max","column","padLeft","SERVER_TIMESTAMP",".sv","getNanoSeconds","hrtime","loadTime","performance","exports","process","hr","getTime","Connector","scope","_scope","_connections","_method","_subConnectors","_disconnects","_angularUnwatches","_data","_vue","descriptors","destroy","_linkScopeProperties","_bindComputedConnection","_connect","$on","$id","ignored","at","_unlinkScopeProperties","unwatch","_disconnect","$destroy","dataProperties","configurable","enumerable","defineProperties","__ob__","dep","notify","connectionStats","getter","_computeConnection","_updateComputedConnection","angularWatch","immediate","newDescriptor","oldDescriptor","descriptorChanged","_updateConnections","updateFn","_updateRefValue","connectReference","_updateQueryValue","connectQuery","subScope","subRefs","subConnector","subReady","childKeys","childKey","contains","INTERCEPT_KEYS","EMPTY_ARRAY","SlowHandle","operation","delay","_operation","_delay","_callback","_fired","initiate","elapsed","_startTimestamp","_timeoutId","clearTimeout","Operation","type","target","operand","_type","_target","_operand","_ready","_running","_ended","_tries","_slowHandles","running","ended","tries","_error","onSlow","_setRunning","_setEnded","_markReady","ending","_clearReady","_incrementTries","Dispatcher","bridge","_bridge","intercept","interceptKey","callbacks","badCallbackKeys","difference","wrappedCallbacks","onBefore","_addCallback","onAfter","onError","onFailure","_removeCallbacks","stage","_getCallbacksKey","wrappedCallback","_removeCallback","pull","_getCallbacks","operationType","execute","executor","createOperation","begin","executeWithRetries","_retryOrEnd","end","markReady","clearReady","retry","results","retrying","_afterEnd","onFailureCallbacks","ALPHABET","KeyGenerator","_lastUniqueKeyTime","_lastRandomValues","generateUniqueKey","chars","prefix","floor","random","MetaTree","dispatcher","_rootUrl","_dispatcher","$root","connected","timeOffset","user","userid","nowAtInterval","intervalMillis","_authsInProgress","_handleAuthChange","_connectInfoProperty","root","$data","authenticate","rememberMe","unauthenticate","null","property","attribute","propertyUrl","snap","QueryHandler","coupler","_coupler","_query","_listeners","_keys","_url","_segments","_listening","attach","keysCallback","_listen","detach","findIndex","_handleSnapshot","_handleError","sync","_decoupleSegments","updatedKeys","_updateKeys","_applySnapshot","sort","_coupleSegments","hasKey","Node","operations","queryCount","listening","count","listen","skip","op","unlisten","_forAllDescendants","node","isTrunkCoupled","iteratee","collectCoupledDescendantPaths","paths","Coupler","applySnapshot","prunePath","_prunePath","queryHandlers","_nodeIndex","_root","_queryHandlers","queryHandler","couple","superseded","decouple","ancestors","findCoupledDescendantPaths","subscribe","unsubscribe","isSubtreeReady","extractChildSegment","childSegment","creatingObjectProperties","RESERVED_VALUE_PROPERTY_NAMES","$$$trussCheck","Value","$parent","$path","defineProperty","$refs","$key","lastIndexOf","$hidden","$empty","$keys","$values","$meta","meta","$now","$ready","$overridden","$newKey","newKey","$intercept","actionType","unintercept","uninterceptAndRemoveFinalizer","$$finalizers","$connect","connector","connect","originalDestroy","$peek","subjectFn","callbackFn","unwatchAndRemoveFinalizer","$when","expression","when","$nextTick","nextTick","$freezeComputedProperty","isBoolean","$set","$update","$override","$commit","depend","$$initializers","writable","Modeler","debug","_trie","Class","_debug","classes","rootAcceptable","isPlainObject","$trussMount","$$trussMount","uniq","_mountClass","_decorateTrie","_getMount","scaffold","$","_findMount","local","localDescendants","_augmentClass","computedProperties","constructor","getOwnPropertyNames","getOwnPropertyDescriptor","fullName","allVariables","mounts","mount","variable","placeholder","targetMount","pick","createObject","properties","_wrapProperties","keysUnsafe","hidden","_buildComputedPropertyDescriptor","valueKey","pendingPromise","writeAllowed","unwatchNow","compute","finalValue","watcher","destroyObject","$finalize","isPlaceholder","isLocal","_hasLocalProperties","forEachPlaceholderChild","checkVueObject","checkedObjects","top","includes","trussCode","Function","Transaction","_ref","_outcome","_values","currentValue","outcome","_setOutcome","abort","","Tree","_truss","_firebasePropertyEditAllowed","_localWrites","_localWriteTimestamp","_initialized","_modeler","VERSION","_integrateSnapshot","_createObject","_fixObject","_completeCreateObject","createdObjects","_plantPlaceholders","valueCallback","_checkHandle","_disconnectReference","_disconnected","_coupled","_disconnectQuery","numValues","_applyLocalWrite","pathPrefix","attemptTransaction","txn","snapshot","committed","numLocal","coupledDescendantPaths","descendantPath","subValue","_plantValue","_scaffoldAncestors","_destroyObject","remoteWrite","dropRight","ancestorPath","_setFirebaseProperty","objectCreated","escapedChildKey","lockedDescendantPaths","_avoidLocalWritePaths","_pruneAncestors","_pruneDescendants","localWritePath","targetPath","targetObject","targetKey","deleted","targetParentPath","ghostObjects","_holdsConcreteData","_deleteFirebaseProperty","coupledDescendantFound","valueLocked","shouldDelete","_getFirebasePropertyDescriptor","_overwriteFirebaseProperty","logging","workerFunctions","_keyGenerator","_metaTree","cleanup","callbackPromise","oldValueClone","usePreciseDefaults","precise","numCallbacks","deep","newValueClone","defaultsDeep","defaults","timeoutHandle","timeoutMessage","timeout","checkObjectsForRogueProperties","staticAccessors","computedPropertyStats","logComputedPropertyStats","connectWorker","Worker","SharedWorker","exposedFunctionNames","firebaseSdkVersion","worker","preExpose","functionName","debounceAngularDigest","FIREBASE_SDK_VERSION"],"mappings":"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","file":"firetruss.umd.min.js","sourcesContent":["/* globals window */\n\nimport _ from 'lodash';\nimport Vue from 'vue';\n\n\nconst vue = new Vue({data: {digestRequest: 0}});\nlet lastDigestRequest = 0, digestInProgress = false;\nconst bareDigest = function() {\n  if (vue.digestRequest > lastDigestRequest) return;\n  vue.digestRequest = lastDigestRequest + 1;\n};\n\nconst angularProxy = {\n  active: typeof window !== 'undefined' && window.angular\n};\n\nif (angularProxy.active) {\n  initAngular();\n} else {\n  ['digest', 'watch', 'defineModule', 'debounceDigest'].forEach(method => {\n    angularProxy[method] = noop;\n  });\n}\n\nfunction initAngular() {\n  const module = window.angular.module('firetruss', []);\n  angularProxy.digest = bareDigest;\n  angularProxy.watch = function() {throw new Error('Angular watch proxy not yet initialized');};\n  angularProxy.defineModule = function(Truss) {\n    module.constant('Truss', Truss);\n  };\n  angularProxy.debounceDigest = function(wait) {\n    if (wait) {\n      const debouncedDigest = _.debounce(bareDigest, wait);\n      angularProxy.digest = function() {\n        if (vue.digestRequest > lastDigestRequest) return;\n        if (digestInProgress) bareDigest(); else debouncedDigest();\n      };\n    } else {\n      angularProxy.digest = bareDigest;\n    }\n  };\n\n  module.config(['$provide', function($provide) {\n    $provide.decorator('$rootScope', ['$delegate', '$exceptionHandler',\n      function($delegate, $exceptionHandler) {\n        const rootScope = $delegate;\n        angularProxy.watch = rootScope.$watch.bind(rootScope);\n        const proto = Object.getPrototypeOf(rootScope);\n        const angularDigest = proto.$digest;\n        proto.$digest = bareDigest;\n        proto.$digest.original = angularDigest;\n        vue.$watch(() => vue.digestRequest, () => {\n          if (vue.digestRequest > lastDigestRequest) {\n            digestInProgress = true;\n            rootScope.$digest.original.call(rootScope);\n            lastDigestRequest = vue.digestRequest = vue.digestRequest + 1;\n          } else {\n            digestInProgress = false;\n          }\n        });\n        _.last(vue._watchers).id = Infinity;  // make sure watcher is scheduled last\n        return rootScope;\n      }\n    ]);\n  }]);\n}\n\nfunction noop() {}\n\nexport default angularProxy;\n","import LruCache from './LruCache.js';\nimport _ from 'lodash';\n\n\nconst pathSegments = new LruCache(1000);\nconst pathMatchers = {};\nconst maxNumPathMatchers = 1000;\n\n\nexport function escapeKey(key) {\n  if (!key) return key;\n  return key.toString().replace(/[\\\\\\.\\$\\#\\[\\]\\/]/g, function(char) {\n    return '\\\\' + char.charCodeAt(0).toString(16);\n  });\n}\n\nexport function unescapeKey(key) {\n  if (!key) return key;\n  return key.toString().replace(/\\\\[0-9a-f]{2}/gi, function(code) {\n    return String.fromCharCode(parseInt(code.slice(1), 16));\n  });\n}\n\nexport function escapeKeys(object) {\n  // isExtensible check avoids trying to escape references to Firetruss internals.\n  if (!(_.isObject(object) && Object.isExtensible(object))) return object;\n  let result = object;\n  for (const key in object) {\n    if (!object.hasOwnProperty(key)) continue;\n    const value = object[key];\n    const escapedKey = escapeKey(key);\n    const escapedValue = escapeKeys(value);\n    if (escapedKey !== key || escapedValue !== value) {\n      if (result === object) result = _.clone(object);\n      result[escapedKey] = escapedValue;\n      if (result[key] === value) delete result[key];\n    }\n  }\n  return result;\n}\n\nexport function joinPath() {\n  const segments = [];\n  for (let segment of arguments) {\n    if (!_.isString(segment)) segment = '' + segment;\n    if (segment.charAt(0) === '/') segments.splice(0, segments.length);\n    segments.push(segment);\n  }\n  if (segments[0] === '/') segments[0] = '';\n  return segments.join('/');\n}\n\nexport function splitPath(path, leaveSegmentsEscaped) {\n  const key = (leaveSegmentsEscaped ? 'esc:' : '') + path;\n  let segments = pathSegments.get(key);\n  if (!segments) {\n    segments = path.split('/');\n    if (!leaveSegmentsEscaped) segments = _.map(segments, unescapeKey);\n    pathSegments.set(key, segments);\n  }\n  return segments;\n}\n\n\nclass PathMatcher {\n  constructor(pattern) {\n    this.variables = [];\n    const prefixMatch = _.endsWith(pattern, '/$*');\n    if (prefixMatch) pattern = pattern.slice(0, -3);\n    const pathTemplate = pattern.replace(/\\/\\$[^\\/]*/g, match => {\n      if (match.length > 1) this.variables.push(match.slice(1));\n      return '\\u0001';\n    });\n    Object.freeze(this.variables);\n    if (/[.$#\\[\\]]|\\\\(?![0-9a-f][0-9a-f])/i.test(pathTemplate)) {\n      throw new Error('Path pattern has unescaped keys: ' + pattern);\n    }\n    this._regex = new RegExp(\n      '^' + pathTemplate.replace(/\\u0001/g, '/([^/]+)') + (prefixMatch ? '($|/)' : '$'));\n  }\n\n  match(path) {\n    this._regex.lastIndex = 0;\n    const match = this._regex.exec(path);\n    if (!match) return;\n    const bindings = {};\n    for (let i = 0; i < this.variables.length; i++) {\n      bindings[this.variables[i]] = unescapeKey(match[i + 1]);\n    }\n    return bindings;\n  }\n\n  test(path) {\n    return this._regex.test(path);\n  }\n\n  toString() {\n    return this._regex.toString();\n  }\n}\n\nexport function makePathMatcher(pattern) {\n  let matcher = pathMatchers[pattern];\n  if (!matcher) {\n    matcher = new PathMatcher(pattern);\n    // Minimal pseudo-LRU behavior, since we don't expect to actually fill up the cache.\n    if (_.size(pathMatchers) === maxNumPathMatchers) delete pathMatchers[_.keys(pathMatchers)[0]];\n    pathMatchers[pattern] = matcher;\n  }\n  return matcher;\n}\n","import {unescapeKey} from './utils/paths.js';\nimport _ from 'lodash';\n\n// jshint browser:true\n\nconst MIN_WORKER_VERSION = '0.4.0';\n\n\nclass Snapshot {\n  constructor({path, value, valueError, exists, writeSerial}) {\n    this._path = path;\n    this._value = value;\n    this._valueError = errorFromJson(valueError);\n    this._exists = value === undefined ? exists || false : value !== null;\n    this._writeSerial = writeSerial;\n  }\n\n  get path() {\n    return this._path;\n  }\n\n  get exists() {\n    return this._exists;\n  }\n\n  get value() {\n    this._checkValue();\n    return this._value;\n  }\n\n  get key() {\n    if (this._key === undefined) this._key = unescapeKey(this._path.replace(/.*\\//, ''));\n    return this._key;\n  }\n\n  get writeSerial() {\n    return this._writeSerial;\n  }\n\n  _checkValue() {\n    if (this._valueError) throw this._valueError;\n    if (this._value === undefined) throw new Error('Value omitted from snapshot');\n  }\n}\n\n\nexport default class Bridge {\n  constructor(webWorker) {\n    this._idCounter = 0;\n    this._deferreds = {};\n    this._suspended = false;\n    this._servers = {};\n    this._callbacks = {};\n    this._log = _.noop;\n    this._simulatedTokenGenerator = null;\n    this._maxSimulationDuration = 5000;\n    this._simulatedCallFilter = null;\n    this._inboundMessages = [];\n    this._outboundMessages = [];\n    this._flushMessageQueue = this._flushMessageQueue.bind(this);\n    this._port = webWorker.port || webWorker;\n    this._shared = !!webWorker.port;\n    Object.seal(this);\n    this._port.onmessage = this._receive.bind(this);\n    window.addEventListener('unload', () => {this._send({msg: 'destroy'});});\n    setInterval(() => {this._send({msg: 'ping'});}, 60 * 1000);\n  }\n\n  init(webWorker) {\n    const items = [];\n    try {\n      const storage = window.localStorage || window.sessionStorage;\n      if (!storage) return;\n      for (let i = 0; i < storage.length; i++) {\n        const key = storage.key(i);\n        items.push({key, value: storage.getItem(key)});\n      }\n    } catch (e) {\n      // Some browsers don't like us accessing local storage -- nothing we can do.\n    }\n    return this._send({msg: 'init', storage: items}).then(response => {\n      const workerVersion = response.version.match(/^(\\d+)\\.(\\d+)\\.(\\d+)(-.*)?$/);\n      if (workerVersion) {\n        const minVersion = MIN_WORKER_VERSION.match(/^(\\d+)\\.(\\d+)\\.(\\d+)(-.*)?$/);\n        // Major version must match precisely, minor and patch must be greater than or equal.\n        const sufficient = workerVersion[1] === minVersion[1] && (\n          workerVersion[2] > minVersion[2] ||\n          workerVersion[2] === minVersion[2] && workerVersion[3] >= minVersion[3]\n        );\n        if (!sufficient) return Promise.reject(new Error(\n          `Incompatible Firetruss worker version: ${response.version} ` +\n          `(${MIN_WORKER_VERSION} or better required)`\n        ));\n      }\n      return response;\n    });\n  }\n\n  suspend(suspended) {\n    if (suspended === undefined) suspended = true;\n    if (this._suspended === suspended) return;\n    this._suspended = suspended;\n    if (!suspended) {\n      this._receiveMessages(this._inboundMessages);\n      this._inboundMessages = [];\n      if (this._outboundMessages.length) Promise.resolve().then(this._flushMessageQueue);\n    }\n  }\n\n  debugPermissionDeniedErrors(simulatedTokenGenerator, maxSimulationDuration, callFilter) {\n    this._simulatedTokenGenerator = simulatedTokenGenerator;\n    if (maxSimulationDuration !== undefined) this._maxSimulationDuration = maxSimulationDuration;\n    this._simulatedCallFilter = callFilter || function() {return true;};\n  }\n\n  enableLogging(fn) {\n    if (fn) {\n      if (fn === true) fn = console.log.bind(console);\n      this._log = fn;\n    } else {\n      this._log = _.noop;\n    }\n  }\n\n  _send(message) {\n    message.id = ++this._idCounter;\n    let promise;\n    if (message.oneWay) {\n      promise = Promise.resolve();\n    } else {\n      promise = new Promise((resolve, reject) => {\n        this._deferreds[message.id] = {resolve, reject};\n      });\n      const deferred = this._deferreds[message.id];\n      deferred.promise = promise;\n      promise.sent = new Promise(resolve => {\n        deferred.resolveSent = resolve;\n      });\n      deferred.params = message;\n    }\n    if (!this._outboundMessages.length && !this._suspended) {\n      Promise.resolve().then(this._flushMessageQueue);\n    }\n    this._log('send:', message);\n    this._outboundMessages.push(message);\n    return promise;\n  }\n\n  _flushMessageQueue() {\n    this._port.postMessage(this._outboundMessages);\n    this._outboundMessages = [];\n  }\n\n  _receive(event) {\n    if (this._suspended) {\n      this._inboundMessages = this._inboundMessages.concat(event.data);\n    } else {\n      this._receiveMessages(event.data);\n    }\n  }\n\n  _receiveMessages(messages) {\n    for (const message of messages) {\n      this._log('recv:', message);\n      const fn = this[message.msg];\n      if (!_.isFunction(fn)) throw new Error('Unknown message: ' + message.msg);\n      fn.call(this, message);\n    }\n  }\n\n  bindExposedFunction(name) {\n    return (function() {\n      return this._send({msg: 'call', name, args: Array.prototype.slice.call(arguments)});\n    }).bind(this);\n  }\n\n  resolve(message) {\n    const deferred = this._deferreds[message.id];\n    if (!deferred) throw new Error('Received resolution to inexistent Firebase call');\n    delete this._deferreds[message.id];\n    deferred.resolve(message.result);\n  }\n\n  reject(message) {\n    const deferred = this._deferreds[message.id];\n    if (!deferred) throw new Error('Received rejection of inexistent Firebase call');\n    delete this._deferreds[message.id];\n    deferred.reject(errorFromJson(message.error, deferred.params));\n  }\n\n  probeError(error) {\n    const code = error.code || error.message;\n    if (error.params && code && code.toLowerCase() === 'permission_denied') {\n      return this._simulateCall(error.params).then(securityTrace => {\n        if (securityTrace) error.permissionDeniedDetails = securityTrace;\n      });\n    } else {\n      return Promise.resolve();\n    }\n  }\n\n  _simulateCall(props) {\n    if (!(this._simulatedTokenGenerator && this._maxSimulationDuration > 0)) {\n      return Promise.resolve();\n    }\n    let simulatedCalls = [];\n    switch (props.msg) {\n      case 'set':\n        simulatedCalls.push({method: 'set', url: props.url, args: [props.value]});\n        break;\n      case 'update':\n        simulatedCalls.push({method: 'update', url: props.url, args: [props.value]});\n        break;\n      case 'on':\n        simulatedCalls.push({method: 'once', url: props.url, spec: props.spec, args: ['value']});\n        break;\n      case 'transaction':\n        simulatedCalls.push({method: 'once', url: props.url, args: ['value']});\n        simulatedCalls.push({method: 'set', url: props.url, args: [props.newValue]});\n        break;\n    }\n    if (!simulatedCalls.length || !this._simulatedCallFilter(props.msg, props.url)) {\n      return Promise.resolve();\n    }\n    const auth = this.getAuth(getUrlRoot(props.url));\n    const simulationPromise = this._simulatedTokenGenerator(auth && auth.uid).then(token => {\n      return Promise.all(simulatedCalls.map(message => {\n        message.msg = 'simulate';\n        message.token = token;\n        return this._send(message);\n      }));\n    }).then(securityTraces => {\n      if (securityTraces.every(trace => trace === null)) {\n        return 'Unable to reproduce error in simulation';\n      }\n      return securityTraces.filter(trace => trace).join('\\n\\n');\n    }).catch(e => {\n      return 'Error running simulation: ' + e;\n    });\n    const timeoutPromise = new Promise(resolve => {\n      setTimeout(resolve.bind(null, 'Simulated call timed out'), this._maxSimulationDuration);\n    });\n    return Promise.race([simulationPromise, timeoutPromise]);\n  }\n\n  updateLocalStorage({items}) {\n    try {\n      const storage = window.localStorage || window.sessionStorage;\n      for (const item of items) {\n        if (item.value === null) {\n          storage.removeItem(item.key);\n        } else {\n          storage.setItem(item.key, item.value);\n        }\n      }\n    } catch (e) {\n      // If we're denied access, there's nothing we can do.\n    }\n  }\n\n  trackServer(rootUrl) {\n    if (this._servers.hasOwnProperty(rootUrl)) return;\n    const server = this._servers[rootUrl] = {authListeners: []};\n    const authCallbackId = this._registerCallback(this._authCallback.bind(this, server));\n    this._send({msg: 'onAuth', url: rootUrl, callbackId: authCallbackId});\n  }\n\n  _authCallback(server, auth) {\n    server.auth = auth;\n    for (const listener of server.authListeners) listener(auth);\n  }\n\n  onAuth(rootUrl, callback, context) {\n    const listener = callback.bind(context);\n    listener.callback = callback;\n    listener.context = context;\n    this._servers[rootUrl].authListeners.push(listener);\n    listener(this.getAuth(rootUrl));\n  }\n\n  offAuth(rootUrl, callback, context) {\n    const authListeners = this._servers[rootUrl].authListeners;\n    for (let i = 0; i < authListeners.length; i++) {\n      const listener = authListeners[i];\n      if (listener.callback === callback && listener.context === context) {\n        authListeners.splice(i, 1);\n        break;\n      }\n    }\n  }\n\n  getAuth(rootUrl) {\n    return this._servers[rootUrl].auth;\n  }\n\n  authWithCustomToken(url, authToken, options) {\n    return this._send({msg: 'authWithCustomToken', url, authToken, options});\n  }\n\n  unauth(url) {\n    return this._send({msg: 'unauth', url});\n  }\n\n  set(url, value, writeSerial) {return this._send({msg: 'set', url, value, writeSerial});}\n  update(url, value, writeSerial) {return this._send({msg: 'update', url, value, writeSerial});}\n\n  on(listenerKey, url, spec, eventType, snapshotCallback, cancelCallback, context, options) {\n    const handle = {\n      listenerKey, eventType, snapshotCallback, cancelCallback, context,\n      params: {msg: 'on', listenerKey, url, spec, eventType, options}\n    };\n    const callback = this._onCallback.bind(this, handle);\n    this._registerCallback(callback, handle);\n    // Keep multiple IDs to allow the same snapshotCallback to be reused.\n    snapshotCallback.__callbackIds = snapshotCallback.__callbackIds || [];\n    snapshotCallback.__callbackIds.push(handle.id);\n    this._send({\n      msg: 'on', listenerKey, url, spec, eventType, callbackId: handle.id, options\n    }).catch(error => {\n      callback(error);\n    });\n  }\n\n  off(listenerKey, url, spec, eventType, snapshotCallback, context) {\n    const idsToDeregister = [];\n    let callbackId;\n    if (snapshotCallback) {\n      callbackId = this._findAndRemoveCallbackId(\n        snapshotCallback,\n        handle =>\n          handle.listenerKey === listenerKey && handle.eventType === eventType &&\n          handle.context === context\n      );\n      if (!callbackId) return Promise.resolve();  // no-op, never registered or already deregistered\n      idsToDeregister.push(callbackId);\n    } else {\n      for (const id of Object.keys(this._callbacks)) {\n        const handle = this._callbacks[id];\n        if (handle.listenerKey === listenerKey && (!eventType || handle.eventType === eventType)) {\n          idsToDeregister.push(id);\n        }\n      }\n    }\n    // Nullify callbacks first, then deregister after off() is complete.  We don't want any\n    // callbacks in flight from the worker to be invoked while the off() is processing, but we don't\n    // want them to throw an exception either.\n    for (const id of idsToDeregister) this._nullifyCallback(id);\n    return this._send({msg: 'off', listenerKey, url, spec, eventType, callbackId}).then(() => {\n      for (const id of idsToDeregister) this._deregisterCallback(id);\n    });\n  }\n\n  _onCallback(handle, error, snapshotJson) {\n    if (error) {\n      this._deregisterCallback(handle.id);\n      const e = errorFromJson(error, handle.params);\n      if (handle.cancelCallback) {\n        handle.cancelCallback.call(handle.context, e);\n      } else {\n        console.error(e);\n      }\n    } else {\n      handle.snapshotCallback.call(handle.context, new Snapshot(snapshotJson));\n    }\n  }\n\n  transaction(url, oldValue, relativeUpdates, writeSerial) {\n    return this._send(\n      {msg: 'transaction', url, oldValue, relativeUpdates, writeSerial}\n    ).then(result => {\n      if (result.snapshots) {\n        result.snapshots = _.map(result.snapshots, jsonSnapshot => new Snapshot(jsonSnapshot));\n      }\n      return result;\n    });\n  }\n\n  onDisconnect(url, method, value) {\n    return this._send({msg: 'onDisconnect', url, method, value});\n  }\n\n  bounceConnection() {\n    return this._send({msg: 'bounceConnection'});\n  }\n\n  callback({id, args}) {\n    const handle = this._callbacks[id];\n    if (!handle) throw new Error('Unregistered callback: ' + id);\n    handle.callback.apply(null, args);\n  }\n\n  _registerCallback(callback, handle) {\n    handle = handle || {};\n    handle.callback = callback;\n    handle.id = `cb${++this._idCounter}`;\n    this._callbacks[handle.id] = handle;\n    return handle.id;\n  }\n\n  _nullifyCallback(id) {\n    this._callbacks[id].callback = noop;\n  }\n\n  _deregisterCallback(id) {\n    delete this._callbacks[id];\n  }\n\n  _findAndRemoveCallbackId(callback, predicate) {\n    if (!callback.__callbackIds) return;\n    let i = 0;\n    while (i < callback.__callbackIds.length) {\n      const id = callback.__callbackIds[i];\n      const handle = this._callbacks[id];\n      if (!handle) {\n        callback.__callbackIds.splice(i, 1);\n        continue;\n      }\n      if (predicate(handle)) {\n        callback.__callbackIds.splice(i, 1);\n        return id;\n      }\n      i += 1;\n    }\n  }\n}\n\n\nfunction noop() {}\n\nfunction errorFromJson(json, params) {\n  if (!json || json instanceof Error) return json;\n  const error = new Error(json.message);\n  error.params = params;\n  for (const propertyName in json) {\n    if (propertyName === 'message' || !json.hasOwnProperty(propertyName)) continue;\n    try {\n      error[propertyName] = json[propertyName];\n    } catch (e) {\n      e.extra = {propertyName};\n      throw e;\n    }\n  }\n  return error;\n}\n\nfunction getUrlRoot(url) {\n  const k = url.indexOf('/', 8);\n  return k >= 8 ? url.slice(0, k) : url;\n}\n","import _ from 'lodash';\n\n\nexport const SERVER_TIMESTAMP = Object.freeze({'.sv': 'timestamp'});\n\nexport function isTrussEqual(a, b) {\n  return _.isEqual(a, b, isTrussValueEqual);\n}\n\nfunction isTrussValueEqual(a, b) {\n  if (a === b || a === undefined || a === null || b === undefined || b === null ||\n      a.$truss || b.$truss) return a === b;\n  if (a.isEqual) return a.isEqual(b);\n}\n\n","import {Handle, Query, Reference} from './Reference.js';\nimport angular from './angularCompatibility.js';\nimport stats from './utils/stats.js';\nimport {isTrussEqual} from './utils/utils.js';\n\nimport _ from 'lodash';\nimport performanceNow from 'performance-now';\nimport Vue from 'vue';\n\n\nexport default class Connector {\n  constructor(scope, connections, tree, method, refs) {\n    Object.freeze(connections);\n    this._scope = scope;\n    this._connections = connections;\n    this._tree = tree;\n    this._method = method;\n\n    this._subConnectors = {};\n    this._disconnects = {};\n    this._angularUnwatches = undefined;\n    this._data = {};\n    this._vue = new Vue({data: {\n      descriptors: {},\n      refs: refs || {},\n      values: _.mapValues(connections, _.constant(undefined))\n    }});\n    this.destroy = this.destroy;  // allow instance-level overrides of destroy() method\n    Object.seal(this);\n\n    this._linkScopeProperties();\n\n    _.each(connections, (descriptor, key) => {\n      if (_.isFunction(descriptor)) {\n        this._bindComputedConnection(key, descriptor);\n      } else {\n        this._connect(key, descriptor);\n      }\n    });\n\n    if (angular.active && scope && scope.$on && scope.$id) {\n      scope.$on('$destroy', () => {this.destroy();});\n    }\n  }\n\n  get ready() {\n    return _.every(this._connections, (ignored, key) => {\n      const descriptor = this._vue.descriptors[key];\n      if (!descriptor) return false;\n      if (descriptor instanceof Handle) return descriptor.ready;\n      return this._subConnectors[key].ready;\n    });\n  }\n\n  get at() {\n    return this._vue.refs;\n  }\n\n  get data() {\n    return this._data;\n  }\n\n  destroy() {\n    this._unlinkScopeProperties();\n    _.each(this._angularUnwatches, unwatch => {unwatch();});\n    _.each(this._connections, (descriptor, key) => {this._disconnect(key);});\n    this._vue.$destroy();\n  }\n\n  _linkScopeProperties() {\n    const dataProperties = _.mapValues(this._connections, (descriptor, key) => ({\n      configurable: true, enumerable: false, get: () => this._vue.values[key]\n    }));\n    Object.defineProperties(this._data, dataProperties);\n    if (this._scope) {\n      for (const key in this._connections) {\n        if (key in this._scope) {\n          throw new Error(`Property already defined on connection target: ${key}`);\n        }\n      }\n      Object.defineProperties(this._scope, dataProperties);\n      if (this._scope.__ob__) this._scope.__ob__.dep.notify();\n    }\n  }\n\n  _unlinkScopeProperties() {\n    if (!this._scope) return;\n    _.each(this._connections, (descriptor, key) => {\n      delete this._scope[key];\n    });\n  }\n\n  _bindComputedConnection(key, fn) {\n    const connectionStats = stats.for(`connection.at.${key}`);\n    const getter = this._computeConnection.bind(this, fn, connectionStats);\n    const update = this._updateComputedConnection.bind(this, key, fn, connectionStats);\n    const angularWatch = angular.active && !fn.angularWatchSuppressed;\n    // Use this._vue.$watch instead of truss.watch here so that we can disable the immediate\n    // callback if we'll get one from Angular anyway.\n    this._vue.$watch(getter, update, {immediate: !angularWatch});\n    if (angularWatch) {\n      if (!this._angularUnwatches) this._angularUnwatches = [];\n      this._angularUnwatches.push(angular.watch(getter, update, true));\n    }\n  }\n\n  _computeConnection(fn, connectionStats) {\n    const startTime = performanceNow();\n    try {\n      return flattenRefs(fn.call(this._scope));\n    } finally {\n      connectionStats.runtime += performanceNow() - startTime;\n      connectionStats.numRecomputes += 1;\n    }\n  }\n\n  _updateComputedConnection(key, value, connectionStats) {\n    const newDescriptor = _.isFunction(value) ? value(this._scope) : value;\n    const oldDescriptor = this._vue.descriptors[key];\n    const descriptorChanged = !isTrussEqual(oldDescriptor, newDescriptor);\n    if (!descriptorChanged) return;\n    if (connectionStats && descriptorChanged) connectionStats.numUpdates += 1;\n    if (!newDescriptor) {\n      this._disconnect(key);\n      return;\n    }\n    if (newDescriptor instanceof Handle || !_.has(this._subConnectors, key)) {\n      this._disconnect(key);\n      this._connect(key, newDescriptor);\n    } else {\n      this._subConnectors[key]._updateConnections(newDescriptor);\n    }\n    Vue.set(this._vue.descriptors, key, newDescriptor);\n    angular.digest();\n  }\n\n  _updateConnections(connections) {\n    _.each(connections, (descriptor, key) => {\n      this._updateComputedConnection(key, descriptor);\n    });\n    _.each(this._connections, (descriptor, key) => {\n      if (!_.has(connections, key)) this._updateComputedConnection(key);\n    });\n    this._connections = connections;\n  }\n\n  _connect(key, descriptor) {\n    Vue.set(this._vue.descriptors, key, descriptor);\n    angular.digest();\n    if (!descriptor) return;\n    if (descriptor instanceof Reference) {\n      Vue.set(this._vue.refs, key, descriptor);\n      const updateFn = this._updateRefValue.bind(this, key);\n      this._disconnects[key] = this._tree.connectReference(descriptor, updateFn, this._method);\n    } else if (descriptor instanceof Query) {\n      Vue.set(this._vue.refs, key, descriptor);\n      const updateFn = this._updateQueryValue.bind(this, key);\n      this._disconnects[key] = this._tree.connectQuery(descriptor, updateFn, this._method);\n    } else {\n      const subScope = {}, subRefs = {};\n      Vue.set(this._vue.refs, key, subRefs);\n      const subConnector = this._subConnectors[key] =\n        new Connector(subScope, descriptor, this._tree, this._method, subRefs);\n      // Use a truss.watch here instead of this._vue.$watch so that the \"immediate\" execution\n      // actually takes place after we've captured the unwatch function, in case the subConnector\n      // is ready immediately.\n      const unwatch = this._disconnects[key] = this._tree.truss.watch(\n        () => subConnector.ready,\n        subReady => {\n          if (!subReady) return;\n          unwatch();\n          delete this._disconnects[key];\n          Vue.set(this._vue.values, key, subScope);\n          angular.digest();\n        }\n      );\n    }\n  }\n\n  _disconnect(key) {\n    Vue.delete(this._vue.refs, key);\n    this._updateRefValue(key, undefined);\n    if (_.has(this._subConnectors, key)) {\n      this._subConnectors[key].destroy();\n      delete this._subConnectors[key];\n    }\n    if (this._disconnects[key]) this._disconnects[key]();\n    delete this._disconnects[key];\n    Vue.delete(this._vue.descriptors, key);\n    angular.digest();\n  }\n\n  _updateRefValue(key, value) {\n    if (this._vue.values[key] !== value) {\n      Vue.set(this._vue.values, key, value);\n      angular.digest();\n    }\n  }\n\n  _updateQueryValue(key, childKeys) {\n    if (!this._vue.values[key]) {\n      Vue.set(this._vue.values, key, {});\n      angular.digest();\n    }\n    const subScope = this._vue.values[key];\n    for (const childKey in subScope) {\n      if (!subScope.hasOwnProperty(childKey)) continue;\n      if (!_.contains(childKeys, childKey)) {\n        Vue.delete(subScope, childKey);\n        angular.digest();\n      }\n    }\n    const object = this._tree.getObject(this._vue.descriptors[key].path);\n    for (const childKey of childKeys) {\n      if (subScope.hasOwnProperty(childKey)) continue;\n      Vue.set(subScope, childKey, object[childKey]);\n      angular.digest();\n    }\n  }\n\n}\n\nfunction flattenRefs(refs) {\n  if (!refs) return;\n  if (refs instanceof Handle) return refs.toString();\n  return _.mapValues(refs, flattenRefs);\n}\n\n","export function wrapPromiseCallback(callback) {\n  return function() {\n    try {\n      return Promise.resolve(callback.apply(this, arguments));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n}\n\nexport function promiseCancel(promise, cancel) {\n  promise = promiseFinally(promise, () => {cancel = null;});\n  promise.cancel = () => {\n    if (!cancel) return;\n    cancel();\n    cancel = null;\n  };\n  propagatePromiseProperty(promise, 'cancel');\n  return promise;\n}\n\nfunction propagatePromiseProperty(promise, propertyName) {\n  const originalThen = promise.then, originalCatch = promise.catch;\n  promise.then = (onResolved, onRejected) => {\n    const derivedPromise = originalThen.call(promise, onResolved, onRejected);\n    derivedPromise[propertyName] = promise[propertyName];\n    propagatePromiseProperty(derivedPromise, propertyName);\n    return derivedPromise;\n  };\n  promise.catch = onRejected => {\n    const derivedPromise = originalCatch.call(promise, onRejected);\n    derivedPromise[propertyName] = promise[propertyName];\n    propagatePromiseProperty(derivedPromise, propertyName);\n    return derivedPromise;\n  };\n  return promise;\n}\n\nexport function promiseFinally(promise, onFinally) {\n  if (!onFinally) return promise;\n  onFinally = wrapPromiseCallback(onFinally);\n  return promise.then(result => {\n    return onFinally().then(() => result);\n  }, error => {\n    return onFinally().then(() => Promise.reject(error));\n  });\n}\n","import {Reference, Handle} from './Reference.js';\nimport angular from './angularCompatibility.js';\nimport stats from './utils/stats.js';\nimport {makePathMatcher, joinPath, splitPath, escapeKey, unescapeKey} from './utils/paths.js';\nimport {isTrussEqual} from './utils/utils.js';\nimport {promiseFinally} from './utils/promises.js';\n\nimport _ from 'lodash';\nimport performanceNow from 'performance-now';\n\n// These are defined separately for each object so they're not included in Value below.\nconst RESERVED_VALUE_PROPERTY_NAMES = {$$$trussCheck: true, __ob__: true};\n\n// Holds properties that we're going to set on a model object that's being created right now as soon\n// as it's been created, but that we'd like to be accessible in the constructor.  The object\n// prototype's getters will pick those up until they get overridden in the instance.\nlet creatingObjectProperties;\n\nlet currentPropertyFrozen;\n\n\nclass Value {\n  get $parent() {return creatingObjectProperties.$parent.value;}\n  get $path() {return creatingObjectProperties.$path.value;}\n  get $truss() {\n    Object.defineProperty(this, '$truss', {value: this.$parent.$truss});\n    return this.$truss;\n  }\n  get $ref() {\n    Object.defineProperty(this, '$ref', {value: new Reference(this.$truss._tree, this.$path)});\n    return this.$ref;\n  }\n  get $refs() {return this.$ref;}\n  get $key() {\n    Object.defineProperty(\n      this, '$key', {value: unescapeKey(this.$path.slice(this.$path.lastIndexOf('/') + 1))});\n    return this.$key;\n  }\n  get $data() {return this;}\n  get $hidden() {return false;}\n  get $empty() {return _.isEmpty(this.$data);}\n  get $keys() {return _.keys(this.$data);}\n  get $values() {return _.values(this.$data);}\n  get $meta() {return this.$truss.meta;}\n  get $root() {return this.$truss.root;}  // access indirectly to leave dependency trace\n  get $now() {return this.$truss.now;}\n  get $ready() {return this.$ref.ready;}\n  get $overridden() {return false;}\n\n  $newKey() {return this.$truss.newKey();}\n\n  $intercept(actionType, callbacks) {\n    if (this.$destroyed) throw new Error('Object already destroyed');\n    const unintercept = this.$truss.intercept(actionType, callbacks);\n    const uninterceptAndRemoveFinalizer = () => {\n      unintercept();\n      _.pull(this.$$finalizers, uninterceptAndRemoveFinalizer);\n    };\n    this.$$finalizers.push(uninterceptAndRemoveFinalizer);\n    return uninterceptAndRemoveFinalizer;\n  }\n\n  $connect(scope, connections) {\n    if (this.$destroyed) throw new Error('Object already destroyed');\n    if (!connections) {\n      connections = scope;\n      scope = undefined;\n    }\n    const connector = this.$truss.connect(scope, wrapConnections(this, connections));\n    const originalDestroy = connector.destroy;\n    const destroy = () => {\n      _.pull(this.$$finalizers, destroy);\n      return originalDestroy.call(connector);\n    };\n    this.$$finalizers.push(destroy);\n    connector.destroy = destroy;\n    return connector;\n  }\n\n  $peek(target, callback) {\n    if (this.$destroyed) throw new Error('Object already destroyed');\n    const promise = promiseFinally(\n      this.$truss.peek(target, callback), () => {_.pull(this.$$finalizers, promise.cancel);}\n    );\n    this.$$finalizers.push(promise.cancel);\n    return promise;\n  }\n\n  $watch(subjectFn, callbackFn, options) {\n    if (this.$destroyed) throw new Error('Object already destroyed');\n    let unwatchAndRemoveFinalizer;\n\n    const unwatch = this.$truss.watch(() => {\n      this.$$touchThis();\n      return subjectFn.call(this);\n    }, callbackFn.bind(this), options);\n\n    unwatchAndRemoveFinalizer = () => {\n      unwatch();\n      _.pull(this.$$finalizers, unwatchAndRemoveFinalizer);\n    };\n    this.$$finalizers.push(unwatchAndRemoveFinalizer);\n    return unwatchAndRemoveFinalizer;\n  }\n\n  $when(expression, options) {\n    if (this.$destroyed) throw new Error('Object already destroyed');\n    const promise = this.$truss.when(() => {\n      this.$$touchThis();\n      return expression.call(this);\n    }, options);\n    promiseFinally(promise, () => {_.pull(this.$$finalizers, promise.cancel);});\n    this.$$finalizers.push(promise.cancel);\n    return promise;\n  }\n\n  $nextTick() {\n    if (this.$destroyed) throw new Error('Object already destroyed');\n    const promise = this.$truss.nextTick();\n    promiseFinally(promise, () => {_.pull(this.$$finalizers, promise.cancel);});\n    this.$$finalizers.push(promise.cancel);\n    return promise;\n  }\n\n  $freezeComputedProperty() {\n    if (!_.isBoolean(currentPropertyFrozen)) {\n      throw new Error('Cannot freeze a computed property outside of its getter function');\n    }\n    currentPropertyFrozen = true;\n  }\n\n  $set(value) {return this.$ref.set(value);}\n  $update(values) {return this.$ref.update(values);}\n  $override(values) {return this.$ref.override(values);}\n  $commit(options, updateFn) {return this.$ref.commit(options, updateFn);}\n\n  $$touchThis() {\n    // jshint expr:true\n    if (this.__ob__) {\n      this.__ob__.dep.depend();\n    } else if (this.$parent) {\n      (this.$parent.hasOwnProperty('$data') ? this.$parent.$data : this.$parent)[this.$key];\n    } else {\n      this.$root;\n    }\n    // jshint expr:false\n  }\n\n  get $$initializers() {\n    Object.defineProperty(this, '$$initializers', {\n      value: [], writable: false, enumerable: false, configurable: true});\n    return this.$$initializers;\n  }\n\n  get $$finalizers() {\n    Object.defineProperty(this, '$$finalizers', {\n      value: [], writable: false, enumerable: false, configurable: false});\n    return this.$$finalizers;\n  }\n\n  get $destroyed() {\n    return false;\n  }\n}\n\n\n_.each(Value.prototype, (prop, name) => {\n  Object.defineProperty(\n    Value.prototype, name, {value: prop, enumerable: false, configurable: false, writable: false});\n});\n\n\nclass ErrorWrapper {\n  constructor(error) {\n    this.error = error;\n  }\n}\n\n\nclass FrozenWrapper {\n  constructor(value) {\n    this.value = value;\n  }\n}\n\n\nexport default class Modeler {\n  constructor(debug) {\n    this._trie = {Class: Value};\n    this._debug = debug;\n    Object.freeze(this);\n  }\n\n  init(classes, rootAcceptable) {\n    if (_.isPlainObject(classes)) {\n      _.each(classes, (Class, path) => {\n        if (Class.$trussMount) return;\n        Class.$$trussMount = Class.$$trussMount || [];\n        Class.$$trussMount.push(path);\n      });\n      classes = _.values(classes);\n      _.each(classes, Class => {\n        if (!Class.$trussMount && Class.$$trussMount) {\n          Class.$trussMount = Class.$$trussMount;\n          delete Class.$$trussMount;\n        }\n      });\n    }\n    classes = _.uniq(classes);\n    _.each(classes, Class => this._mountClass(Class, rootAcceptable));\n    this._decorateTrie(this._trie);\n  }\n\n  destroy() {\n  }\n\n  _getMount(path, scaffold, predicate) {\n    const segments = splitPath(path, true);\n    let node;\n    for (const segment of segments) {\n      let child = segment ?\n        node.children && (node.children[segment] || !scaffold && node.children.$) : this._trie;\n      if (!child) {\n        if (!scaffold) return;\n        node.children = node.children || {};\n        child = node.children[segment] = {Class: Value};\n      }\n      node = child;\n      if (predicate && predicate(node)) break;\n    }\n    return node;\n  }\n\n  _findMount(predicate, node) {\n    if (!node) node = this._trie;\n    if (predicate(node)) return node;\n    for (const childKey of _.keys(node.children)) {\n      const result = this._findMount(predicate, node.children[childKey]);\n      if (result) return result;\n    }\n  }\n\n  _decorateTrie(node) {\n    _.each(node.children, child => {\n      this._decorateTrie(child);\n      if (child.local || child.localDescendants) node.localDescendants = true;\n    });\n  }\n\n  _augmentClass(Class) {\n    let computedProperties;\n    let proto = Class.prototype;\n    while (proto && proto.constructor !== Object) {\n      for (const name of Object.getOwnPropertyNames(proto)) {\n        const descriptor = Object.getOwnPropertyDescriptor(proto, name);\n        if (name.charAt(0) === '$') {\n          if (name === '$finalize') continue;\n          if (_.isEqual(descriptor, Object.getOwnPropertyDescriptor(Value.prototype, name))) {\n            continue;\n          }\n          throw new Error(`Property names starting with \"$\" are reserved: ${Class.name}.${name}`);\n        }\n        if (descriptor.set) {\n          throw new Error(`Computed properties must not have a setter: ${Class.name}.${name}`);\n        }\n        if (descriptor.get && !(computedProperties && computedProperties[name])) {\n          (computedProperties || (computedProperties = {}))[name] = {\n            name, fullName: `${proto.constructor.name}.${name}`, get: descriptor.get\n          };\n        }\n      }\n      proto = Object.getPrototypeOf(proto);\n    }\n    for (const name of Object.getOwnPropertyNames(Value.prototype)) {\n      if (name === 'constructor' || Class.prototype.hasOwnProperty(name)) continue;\n      Object.defineProperty(\n        Class.prototype, name, Object.getOwnPropertyDescriptor(Value.prototype, name));\n    }\n    return computedProperties;\n  }\n\n  _mountClass(Class, rootAcceptable) {\n    const computedProperties = this._augmentClass(Class);\n    const allVariables = [];\n    let mounts = Class.$trussMount;\n    if (!mounts) throw new Error(`Class ${Class.name} lacks a $trussMount static property`);\n    if (!_.isArray(mounts)) mounts = [mounts];\n    _.each(mounts, mount => {\n      if (_.isString(mount)) mount = {path: mount};\n      if (!rootAcceptable && mount.path === '/') {\n        throw new Error('Data root already accessed, too late to mount class');\n      }\n      const matcher = makePathMatcher(mount.path);\n      for (const variable of matcher.variables) {\n        if (variable === '$' || variable.charAt(1) === '$') {\n          throw new Error(`Invalid variable name: ${variable}`);\n        }\n        if (variable.charAt(0) === '$' && (\n            _.has(Value.prototype, variable) || RESERVED_VALUE_PROPERTY_NAMES[variable]\n        )) {\n          throw new Error(`Variable name conflicts with built-in property or method: ${variable}`);\n        }\n        allVariables.push(variable);\n      }\n      const escapedKey = mount.path.match(/\\/([^/]*)$/)[1];\n      if (escapedKey.charAt(0) === '$') {\n        if (mount.placeholder) {\n          throw new Error(\n            `Class ${Class.name} mounted at wildcard ${escapedKey} cannot be a placeholder`);\n        }\n      } else {\n        if (!_.has(mount, 'placeholder')) mount.placeholder = {};\n      }\n      const targetMount = this._getMount(mount.path.replace(/\\$[^/]*/g, '$'), true);\n      if (targetMount.matcher && (\n            targetMount.escapedKey === escapedKey ||\n            targetMount.escapedKey.charAt(0) === '$' && escapedKey.charAt(0) === '$')) {\n        throw new Error(\n          `Multiple classes mounted at ${mount.path}: ${targetMount.Class.name}, ${Class.name}`);\n      }\n      _.extend(\n        targetMount, {Class, matcher, computedProperties, escapedKey},\n        _.pick(mount, 'placeholder', 'local', 'keysUnsafe', 'hidden'));\n    });\n    _.each(allVariables, variable => {\n      if (!Class.prototype[variable]) {\n        Object.defineProperty(Class.prototype, variable, {get: function() {\n          return creatingObjectProperties ?\n            creatingObjectProperties[variable] && creatingObjectProperties[variable].value :\n            undefined;\n        }});\n      }\n    });\n  }\n\n  /**\n   * Creates a Truss object and sets all its basic properties: path segment variables, user-defined\n   * properties, and computed properties.  The latter two will be enumerable so that Vue will pick\n   * them up and make the reactive.\n   */\n  createObject(path, properties) {\n    const mount = this._getMount(path) || {Class: Value};\n    if (mount.matcher) {\n      const match = mount.matcher.match(path);\n      for (const variable in match) {\n        properties[variable] = {value: match[variable]};\n      }\n    }\n\n    creatingObjectProperties = properties;\n    const object = new mount.Class();\n    creatingObjectProperties = null;\n\n    if (angular.active) this._wrapProperties(object);\n\n    if (mount.keysUnsafe) {\n      properties.$data = {value: Object.create(null), configurable: true, enumerable: true};\n    }\n    if (mount.hidden) properties.$hidden = {value: true};\n    if (mount.computedProperties) {\n      _.each(mount.computedProperties, prop => {\n        properties[prop.name] = this._buildComputedPropertyDescriptor(object, prop);\n      });\n    }\n\n    return object;\n  }\n\n  _wrapProperties(object) {\n    _.each(object, (value, key) => {\n      const valueKey = '$_' + key;\n      Object.defineProperties(object, {\n        [valueKey]: {value, writable: true},\n        [key]: {\n          get: () => object[valueKey],\n          set: value => {object[valueKey] = value; angular.digest();},\n          enumerable: true, configurable: true\n        }\n      });\n    });\n  }\n\n  _buildComputedPropertyDescriptor(object, prop) {\n    const propertyStats = stats.for(prop.fullName);\n\n    let value, pendingPromise;\n    let writeAllowed = false;\n\n    object.$$initializers.push(vue => {\n      let unwatchNow = false;\n      const compute = computeValue.bind(object, prop, propertyStats);\n      if (this._debug) compute.toString = () => {return prop.fullName;};\n      let unwatch = () => {unwatchNow = true;};\n      unwatch = vue.$watch(compute, newValue => {\n        if (object.$destroyed) {\n          unwatch();\n          return;\n        }\n        if (pendingPromise) {\n          if (pendingPromise.cancel) pendingPromise.cancel();\n          pendingPromise = undefined;\n        }\n        if (_.isObject(newValue) && newValue.then) {\n          const promise = newValue.then(finalValue => {\n            if (promise === pendingPromise) update(finalValue);\n            // No need to angular.digest() here, since if we're running under Angular then we expect\n            // promises to be aliased to its $q service, which triggers digest itself.\n          }, error => {\n            if (promise === pendingPromise && update(new ErrorWrapper(error))) throw error;\n          });\n          pendingPromise = promise;\n        } else if (update(newValue)) {\n          angular.digest();\n          if (newValue instanceof ErrorWrapper) throw newValue.error;\n        }\n      }, {immediate: true});  // use immediate:true since watcher will run computeValue anyway\n      // Hack to change order of computed property watchers.  By flipping their ids to be negative,\n      // we ensure that they will settle before all other watchers, and also that children\n      // properties will settle before their parents since values are often aggregated upwards.\n      const watcher = _.last(vue._watchers);\n      watcher.id = -watcher.id;\n\n      function update(newValue) {\n        if (newValue instanceof FrozenWrapper) {\n          newValue = newValue.value;\n          unwatch();\n          _.pull(object.$$finalizers, unwatch);\n        }\n        if (isTrussEqual(value, newValue)) return;\n        // console.log('updating', object.$key, prop.fullName, 'from', value, 'to', newValue);\n        propertyStats.numUpdates += 1;\n        writeAllowed = true;\n        object[prop.name] = newValue;\n        writeAllowed = false;\n        // Freeze the computed value so it can't be accidentally modified by a third party.  Ideally\n        // we'd freeze it before setting it so that Vue wouldn't instrument the object recursively\n        // (since it can't change anyway), but we actually need the instrumentation in case a client\n        // tries to access an inexistent property off a computed pointer to an unfrozen value (e.g.,\n        // a $truss-ified object).  When instrumented, Vue will add a dependency on the unfrozen\n        // value in case the property is later added.  If uninstrumented, the dependency won't be\n        // added and we won't be notified.  And Vue only instruments extensible objects...\n        freeze(newValue);\n        return true;\n      }\n\n      if (unwatchNow) {\n        unwatch();\n      } else {\n        object.$$finalizers.push(unwatch);\n      }\n    });\n    return {\n      enumerable: true, configurable: true,\n      get: function() {\n        if (value instanceof ErrorWrapper) throw value.error;\n        return value;\n      },\n      set: function(newValue) {\n        if (!writeAllowed) throw new Error(`You cannot set a computed property: ${prop.name}`);\n        value = newValue;\n      }\n    };\n  }\n\n  destroyObject(object) {\n    if (_.has(object, '$$finalizers')) {\n      // Some destructors remove themselves from the array, so clone it before iterating.\n      for (const fn of _.clone(object.$$finalizers)) fn();\n    }\n    if (_.isFunction(object.$finalize)) object.$finalize();\n    Object.defineProperty(\n      object, '$destroyed', {value: true, enumerable: false, configurable: false});\n  }\n\n  isPlaceholder(path) {\n    const mount = this._getMount(path);\n    return mount && mount.placeholder;\n  }\n\n  isLocal(path, value) {\n    const mount = this._getMount(path, false, mount => mount.local);\n    if (mount && mount.local) return true;\n    if (this._hasLocalProperties(mount, value)) {\n      throw new Error('Write on a mix of local and remote tree paths.');\n    }\n    return false;\n  }\n\n  _hasLocalProperties(mount, value) {\n    if (!mount) return false;\n    if (mount.local) return true;\n    if (!mount.localDescendants || !_.isObject(value)) return false;\n    for (const key in value) {\n      const local =\n        this._hasLocalProperties(mount.children[escapeKey(key)] || mount.children.$, value[key]);\n      if (local) return true;\n    }\n    return false;\n  }\n\n  forEachPlaceholderChild(path, iteratee) {\n    const mount = this._getMount(path);\n    _.each(mount && mount.children, child => {\n      if (child.placeholder) iteratee(child.escapedKey, child.placeholder);\n    });\n  }\n\n  checkVueObject(object, path, checkedObjects) {\n    const top = !checkedObjects;\n    if (top) checkedObjects = [];\n    try {\n      for (const key of Object.getOwnPropertyNames(object)) {\n        if (RESERVED_VALUE_PROPERTY_NAMES[key] || Value.prototype.hasOwnProperty(key) ||\n            /^\\$_/.test(key)) continue;\n        // jshint loopfunc:true\n        const mount = this._findMount(mount => mount.Class === object.constructor);\n        // jshint loopfunc:false\n        if (mount && mount.matcher && _.includes(mount.matcher.variables, key)) continue;\n        if (!(Array.isArray(object) && (/\\d+/.test(key) || key === 'length'))) {\n          const descriptor = Object.getOwnPropertyDescriptor(object, key);\n          if ('value' in descriptor || !descriptor.get) {\n            throw new Error(\n              `Value at ${path}, contained in a Firetruss object, has a rogue property: ${key}`);\n          }\n          if (object.$truss && descriptor.enumerable) {\n            try {\n              object[key] = object[key];\n              throw new Error(\n                `Firetruss object at ${path} has an enumerable non-Firebase property: ${key}`);\n            } catch (e) {\n              if (e.trussCode !== 'firebase_overwrite') throw e;\n            }\n          }\n        }\n        const value = object[key];\n        if (_.isObject(value) && !value.$$$trussCheck && Object.isExtensible(value) &&\n            !(value instanceof Function || value instanceof Promise)) {\n          value.$$$trussCheck = true;\n          checkedObjects.push(value);\n          this.checkVueObject(value, joinPath(path, escapeKey(key)), checkedObjects);\n        }\n      }\n    } finally {\n      if (top) {\n        for (const item of checkedObjects) delete item.$$$trussCheck;\n      }\n    }\n  }\n}\n\n\nfunction computeValue(prop, propertyStats) {\n  // jshint validthis: true\n  if (this.$destroyed) return;\n  // Touch this object, since a failed access to a missing property doesn't get captured as a\n  // dependency.\n  this.$$touchThis();\n\n  const oldPropertyFrozen = currentPropertyFrozen;\n  currentPropertyFrozen = false;\n  const startTime = performanceNow();\n  let value;\n  try {\n    try {\n      value = prop.get.call(this);\n    } catch (e) {\n      value = new ErrorWrapper(e);\n    } finally {\n      propertyStats.runtime += performanceNow() - startTime;\n      propertyStats.numRecomputes += 1;\n    }\n    if (currentPropertyFrozen) value = new FrozenWrapper(value);\n    return value;\n  } finally {\n    currentPropertyFrozen = oldPropertyFrozen;\n  }\n  // jshint validthis: false\n}\n\nfunction wrapConnections(object, connections) {\n  if (!connections || connections instanceof Handle) return connections;\n  return _.mapValues(connections, descriptor => {\n    if (descriptor instanceof Handle) return descriptor;\n    if (_.isFunction(descriptor)) {\n      const fn = function() {\n        object.$$touchThis();\n        return wrapConnections(object, descriptor.call(this));\n      };\n      fn.angularWatchSuppressed = true;\n      return fn;\n    } else {\n      return wrapConnections(object, descriptor);\n    }\n  });\n}\n\nfunction freeze(object) {\n  if (object === null || object === undefined || !_.isObject(object) || Object.isFrozen(object) ||\n      object.$truss) return object;\n  object = Object.freeze(object);\n  if (_.isArray(object)) {\n    return _.map(object, value => freeze(value));\n  } else {\n    return _.mapValues(object, value => freeze(value));\n  }\n}\n","import angular from './angularCompatibility.js';\nimport Coupler from './Coupler.js';\nimport Modeler from './Modeler.js';\nimport {escapeKey, escapeKeys, unescapeKey, joinPath, splitPath} from './utils/paths.js';\nimport {wrapPromiseCallback} from './utils/promises.js';\nimport {SERVER_TIMESTAMP} from './utils/utils.js';\n\nimport _ from 'lodash';\nimport Vue from 'vue';\n\n\nclass Transaction {\n  constructor(ref) {\n    this._ref = ref;\n    this._outcome = undefined;\n    this._values = undefined;\n  }\n\n  get currentValue() {return this._ref.value;}\n  get outcome() {return this._outcome;}\n  get values() {return this._values;}\n\n  _setOutcome(value) {\n    if (this._outcome) throw new Error('Transaction already resolved with ' + this._outcome);\n    this._outcome = value;\n  }\n\n  abort() {\n    this._setOutcome('abort');\n  }\n\n  cancel() {\n    this._setOutcome('cancel');\n  }\n\n  set(value) {\n    if (value === undefined) throw new Error('Invalid argument: undefined');\n    this._setOutcome('set');\n    this._values = {'': value};\n  }\n\n  update(values) {\n    if (values === undefined) throw new Error('Invalid argument: undefined');\n    if (_.isEmpty(values)) return this.cancel();\n    this._setOutcome('update');\n    this._values = values;\n  }\n}\n\n\nexport default class Tree {\n  constructor(truss, rootUrl, bridge, dispatcher) {\n    this._truss = truss;\n    this._rootUrl = rootUrl;\n    this._bridge = bridge;\n    this._dispatcher = dispatcher;\n    this._firebasePropertyEditAllowed = false;\n    this._writeSerial = 0;\n    this._localWrites = {};\n    this._localWriteTimestamp = null;\n    this._initialized = false;\n    this._modeler = new Modeler(truss.constructor.VERSION === 'dev');\n    this._coupler = new Coupler(\n      rootUrl, bridge, dispatcher, this._integrateSnapshot.bind(this), this._prune.bind(this));\n    this._vue = new Vue({data: {$root: undefined}});\n    Object.seal(this);\n    // Call this.init(classes) to complete initialization; we need two phases so that truss can bind\n    // the tree into its own accessors prior to defining computed functions, which may try to\n    // access the tree root via truss.\n  }\n\n  get root() {\n    if (!this._vue.$data.$root) {\n      this._vue.$data.$root = this._createObject('/', '');\n      this._fixObject(this._vue.$data.$root);\n      this._completeCreateObject(this._vue.$data.$root);\n      angular.digest();\n    }\n    return this._vue.$data.$root;\n  }\n\n  get truss() {\n    return this._truss;\n  }\n\n  init(classes) {\n    if (this._initialized) {\n      throw new Error('Data objects already created, too late to mount classes');\n    }\n    this._initialized = true;\n    this._modeler.init(classes, !this._vue.$data.$root);\n    const createdObjects = [];\n    this._plantPlaceholders(this.root, '/', createdObjects);\n    for (const object of createdObjects) this._completeCreateObject(object);\n  }\n\n  destroy() {\n    this._coupler.destroy();\n    if (this._modeler) this._modeler.destroy();\n    this._vue.$destroy();\n  }\n\n  connectReference(ref, valueCallback, method) {\n    this._checkHandle(ref);\n    const operation = this._dispatcher.createOperation('read', method, ref);\n    let unwatch;\n    if (valueCallback) {\n      unwatch = this._vue.$watch(\n        this.getObject.bind(this, ref.path), valueCallback, {immediate: true});\n    }\n    operation._disconnect = this._disconnectReference.bind(this, ref, operation, unwatch);\n    this._dispatcher.begin(operation).then(() => {\n      if (operation.running && !operation._disconnected) {\n        this._coupler.couple(ref.path, operation);\n        operation._coupled = true;\n      }\n    }).catch(e => {});  // ignore exception, let onFailure handlers deal with it\n    return operation._disconnect;\n  }\n\n  _disconnectReference(ref, operation, unwatch, error) {\n    if (operation._disconnected) return;\n    operation._disconnected = true;\n    if (unwatch) unwatch();\n    if (operation._coupled) {\n      this._coupler.decouple(ref.path, operation);  // will call back to _prune if necessary\n      operation._coupled = false;\n    }\n    this._dispatcher.end(operation, error).catch(e => {});\n  }\n\n  isReferenceReady(ref) {\n    this._checkHandle(ref);\n    return this._coupler.isSubtreeReady(ref.path);\n  }\n\n  connectQuery(query, keysCallback, method) {\n    this._checkHandle(query);\n    const operation = this._dispatcher.createOperation('read', method, query);\n    operation._disconnect = this._disconnectQuery.bind(this, query, operation);\n    this._dispatcher.begin(operation).then(() => {\n      if (operation.running && !operation._disconnected) {\n        this._coupler.subscribe(query, operation, keysCallback);\n        operation._coupled = true;\n      }\n    }).catch(e => {});  // ignore exception, let onFailure handlers deal with it\n    return operation._disconnect;\n  }\n\n  _disconnectQuery(query, operation, error) {\n    if (operation._disconnected) return;\n    operation._disconnected = true;\n    if (operation._coupled) {\n      this._coupler.unsubscribe(query, operation);  // will call back to _prune if necessary\n      operation._coupled = false;\n    }\n    this._dispatcher.end(operation, error).catch(e => {});\n  }\n\n  isQueryReady(query) {\n    return this._coupler.isQueryReady(query);\n  }\n\n  _checkHandle(handle) {\n    if (!handle.belongsTo(this._truss)) {\n      throw new Error('Reference belongs to another Truss instance');\n    }\n  }\n\n  update(ref, method, values) {\n    values = _.mapValues(values, value => escapeKeys(value));\n    let numValues = _.size(values);\n    if (!numValues) return Promise.resolve();\n    if (method === 'update' || method === 'override') {\n      checkUpdateHasOnlyDescendantsWithNoOverlap(ref.path, values);\n    }\n    if (this._applyLocalWrite(values, method === 'override')) return Promise.resolve();\n    const pathPrefix = extractCommonPathPrefix(values);\n    relativizePaths(pathPrefix, values);\n    const url = this._rootUrl + pathPrefix;\n    const writeSerial = this._writeSerial;\n    const operand = numValues === 1 ? values[''] : values;\n    return this._dispatcher.execute('write', method, ref, operand, () => {\n      if (numValues === 1) {\n        return this._bridge.set(url, operand, writeSerial);\n      } else {\n        return this._bridge.update(url, operand, writeSerial);\n      }\n    });\n  }\n\n  commit(ref, updateFunction) {\n    let tries = 0;\n    updateFunction = wrapPromiseCallback(updateFunction);\n\n    const attemptTransaction = () => {\n      if (tries++ >= 25) {\n        return Promise.reject(new Error('Transaction needed too many retries, giving up'));\n      }\n      const txn = new Transaction(ref);\n      let oldValue;\n      // Ensure that Vue's watcher queue gets emptied and computed properties are up to date before\n      // running the updateFunction.\n      return Vue.nextTick().then(() => {\n        oldValue = toFirebaseJson(txn.currentValue);\n        return updateFunction(txn);\n      }).then(() => {\n        if (!_.isEqual(oldValue, toFirebaseJson(txn.currentValue))) return attemptTransaction();\n        if (txn.outcome === 'abort') return txn;  // early return to save time\n        const values = _.mapValues(txn.values, value => escapeKeys(value));\n        switch (txn.outcome) {\n          case 'cancel':\n            break;\n          case 'set':\n            if (this._applyLocalWrite({[ref.path]: values['']})) return Promise.resolve();\n            break;\n          case 'update':\n            checkUpdateHasOnlyDescendantsWithNoOverlap(ref.path, values);\n            if (this._applyLocalWrite(values)) return Promise.resolve();\n            relativizePaths(ref.path, values);\n            break;\n          default:\n            throw new Error('Invalid transaction outcome: ' + (txn.outcome || 'none'));\n        }\n        return this._bridge.transaction(\n          this._rootUrl + ref.path, oldValue, values, this._writeSerial\n        ).then(result => {\n          _.each(result.snapshots, snapshot => this._integrateSnapshot(snapshot));\n          return result.committed ? txn : attemptTransaction();\n        });\n      });\n    };\n\n    return this._truss.peek(ref, () => {\n      return this._dispatcher.execute('write', 'commit', ref, undefined, attemptTransaction);\n    });\n  }\n\n  _applyLocalWrite(values, override) {\n    // TODO: correctly apply local writes that impact queries.  Currently, a local write will update\n    // any objects currently selected by a query, but won't add or remove results.\n    this._writeSerial++;\n    this._localWriteTimestamp = this._truss.now;\n    const createdObjects = [];\n    let numLocal = 0;\n    _.each(values, (value, path) => {\n      const local = this._modeler.isLocal(path, value);\n      if (local) numLocal++;\n      const coupledDescendantPaths =\n        local ? {[path]: true} : this._coupler.findCoupledDescendantPaths(path);\n      if (_.isEmpty(coupledDescendantPaths)) return;\n      const offset = (path === '/' ? 0 : path.length) + 1;\n      for (const descendantPath in coupledDescendantPaths) {\n        const subPath = descendantPath.slice(offset);\n        let subValue = value;\n        if (subPath && value !== null && value !== undefined) {\n          for (const segment of splitPath(subPath)) {\n            subValue = subValue[segment];\n            if (subValue === undefined) break;\n          }\n        }\n        if (subValue === undefined || subValue === null) {\n          this._prune(descendantPath);\n        } else {\n          const key = _.last(splitPath(descendantPath));\n          this._plantValue(\n            descendantPath, key, subValue,\n            this._scaffoldAncestors(descendantPath, false, createdObjects), false, override, local,\n            createdObjects\n          );\n        }\n        if (!override && !local) this._localWrites[descendantPath] = this._writeSerial;\n      }\n    });\n    for (const object of createdObjects) this._completeCreateObject(object);\n    if (numLocal && numLocal < _.size(values)) {\n      throw new Error('Write on a mix of local and remote tree paths.');\n    }\n    return override || !!numLocal;\n  }\n\n  /**\n   * Creates a Truss object and sets all its basic properties: path segment variables, user-defined\n   * properties, and computed properties.  The latter two will be enumerable so that Vue will pick\n   * them up and make the reactive, so you should call _completeCreateObject once it's done so and\n   * before any Firebase properties are added.\n   */\n  _createObject(path, key, parent) {\n    if (!this._initialized && path !== '/') this.init();\n    let properties = {\n      // We want Vue to wrap this; we'll make it non-enumerable in _fixObject.\n      $parent: {value: parent, configurable: true, enumerable: true},\n      $path: {value: path}\n    };\n    if (path === '/') properties.$truss = {value: this._truss};\n\n    const object = this._modeler.createObject(path, properties);\n    Object.defineProperties(object, properties);\n    return object;\n  }\n\n  // To be called on the result of _createObject after it's been inserted into the _vue hierarchy\n  // and Vue has had a chance to initialize it.\n  _fixObject(object) {\n    for (const name of Object.getOwnPropertyNames(object)) {\n      const descriptor = Object.getOwnPropertyDescriptor(object, name);\n      if (descriptor.configurable && descriptor.enumerable) {\n        descriptor.enumerable = false;\n        if (_.startsWith(name, '$')) descriptor.configurable = false;\n        Object.defineProperty(object, name, descriptor);\n      }\n    }\n  }\n\n  // To be called on the result of _createObject after _fixObject, and after any additional Firebase\n  // properties have been set, to run initialiers.\n  _completeCreateObject(object) {\n    if (object.hasOwnProperty('$$initializers')) {\n      for (const fn of object.$$initializers) fn(this._vue);\n      delete object.$$initializers;\n    }\n  }\n\n  _destroyObject(object) {\n    if (!(object && object.$truss) || object.$destroyed) return;\n    this._modeler.destroyObject(object);\n    // Normally we'd only destroy enumerable children, which are the Firebase properties.  However,\n    // clients have the option of creating hidden placeholders, so we need to scan non-enumerable\n    // properties as well.  To distinguish such placeholders from the myriad other non-enumerable\n    // properties (that lead all over tree, e.g. $parent), we check that the property's parent is\n    // ourselves before destroying.\n    for (const key of Object.getOwnPropertyNames(object)) {\n      const child = object[key];\n      if (child && child.$parent === object) this._destroyObject(child);\n    }\n  }\n\n  _integrateSnapshot(snap) {\n    _.each(this._localWrites, (writeSerial, path) => {\n      if (snap.writeSerial >= writeSerial) delete this._localWrites[path];\n    });\n    if (snap.exists) {\n      const createdObjects = [];\n      const parent = this._scaffoldAncestors(snap.path, true, createdObjects);\n      if (parent) {\n        this._plantValue(\n          snap.path, snap.key, snap.value, parent, true, false, false, createdObjects);\n      }\n      for (const object of createdObjects) this._completeCreateObject(object);\n    } else {\n      this._prune(snap.path, null, true);\n    }\n  }\n\n  _scaffoldAncestors(path, remoteWrite, createdObjects) {\n    let object;\n    const segments = _.dropRight(splitPath(path, true));\n    let ancestorPath = '/';\n    _.each(segments, (segment, i) => {\n      const key = unescapeKey(segment);\n      let child = segment ? object.$data[key] : this.root;\n      if (segment) ancestorPath += (ancestorPath === '/' ? '' : '/') + segment;\n      if (child) {\n        if (remoteWrite && this._localWrites[ancestorPath]) return;\n      } else {\n        child = this._plantValue(\n          ancestorPath, key, {}, object, remoteWrite, false, false, createdObjects);\n        if (!child) return;\n      }\n      object = child;\n    });\n    return object;\n  }\n\n  _plantValue(path, key, value, parent, remoteWrite, override, local, createdObjects) {\n    if (remoteWrite && (value === null || value === undefined)) {\n      throw new Error(`Snapshot includes invalid value at ${path}: ${value}`);\n    }\n    if (remoteWrite && this._localWrites[path || '/']) return;\n    if (value === SERVER_TIMESTAMP) value = this._localWriteTimestamp;\n    let object = parent[key];\n    if (!_.isArray(value) && !(local ? _.isPlainObject(value) : _.isObject(value))) {\n      this._destroyObject(object);\n      this._setFirebaseProperty(parent, key, value);\n      return;\n    }\n    let objectCreated = false;\n    if (!_.isObject(object)) {\n      // Need to pre-set the property, so that if the child object attempts to watch any of its own\n      // properties while being created the $$touchThis method has something to add a dependency on\n      // as the object's own properties won't be made reactive until *after* it's been created.\n      this._setFirebaseProperty(parent, key, null);\n      object = this._createObject(path, key, parent);\n      this._setFirebaseProperty(parent, key, object, object.$hidden);\n      this._fixObject(object);\n      createdObjects.push(object);\n      objectCreated = true;\n    }\n    if (override) {\n      Object.defineProperty(object, '$overridden', {get: _.constant(true), configurable: true});\n    } else if (object.$overridden) {\n      delete object.$overridden;\n    }\n    _.each(value, (item, escapedChildKey) => {\n      this._plantValue(\n        joinPath(path, escapedChildKey), unescapeKey(escapedChildKey), item, object, remoteWrite,\n        override, local, createdObjects\n      );\n    });\n    if (objectCreated) {\n      this._plantPlaceholders(object, path, createdObjects);\n    } else {\n      _.each(object, (item, childKey) => {\n        const escapedChildKey = escapeKey(childKey);\n        if (!value.hasOwnProperty(escapedChildKey)) {\n          this._prune(joinPath(path, escapedChildKey), null, remoteWrite);\n        }\n      });\n    }\n    return object;\n  }\n\n  _plantPlaceholders(object, path, createdObjects) {\n    this._modeler.forEachPlaceholderChild(path, (escapedKey, placeholder) => {\n      const key = unescapeKey(escapedKey);\n      if (!object.hasOwnProperty(key)) {\n        this._plantValue(\n          joinPath(path, escapedKey), key, placeholder, object, false, false, false,\n          createdObjects);\n      }\n    });\n  }\n\n  _prune(path, lockedDescendantPaths, remoteWrite) {\n    lockedDescendantPaths = lockedDescendantPaths || {};\n    const object = this.getObject(path);\n    if (object === undefined) return;\n    if (remoteWrite && this._avoidLocalWritePaths(path, lockedDescendantPaths)) return;\n    if (!(_.isEmpty(lockedDescendantPaths) && this._pruneAncestors(path, object)) &&\n        _.isObject(object)) {\n      // The target object is a placeholder, and all ancestors are placeholders or otherwise needed\n      // as well, so we can't delete it.  Instead, dive into its descendants to delete what we can.\n      this._pruneDescendants(object, lockedDescendantPaths);\n    }\n  }\n\n  _avoidLocalWritePaths(path, lockedDescendantPaths) {\n    for (const localWritePath in this._localWrites) {\n      if (!this._localWrites.hasOwnProperty(localWritePath)) continue;\n      if (path === localWritePath || localWritePath === '/' ||\n          _.startsWith(path, localWritePath + '/')) return true;\n      if (path === '/' || _.startsWith(localWritePath, path + '/')) {\n        const segments = splitPath(localWritePath, true);\n        for (let i = segments.length; i > 0; i--) {\n          const subPath = segments.slice(0, i).join('/');\n          const active = i === segments.length;\n          if (lockedDescendantPaths[subPath] || lockedDescendantPaths[subPath] === active) break;\n          lockedDescendantPaths[subPath] = active;\n          if (subPath === path) break;\n        }\n      }\n    }\n  }\n\n  _pruneAncestors(targetPath, targetObject) {\n    // Destroy the child (unless it's a placeholder that's still needed) and any ancestors that\n    // are no longer needed to keep this child rooted, and have no other reason to exist.\n    let deleted = false;\n    let object = targetObject;\n    // The target object may be a primitive, in which case it won't have $path, $parent and $key\n    // properties.  In that case, use the target path to figure those out instead.  Note that all\n    // ancestors of the target object will necessarily not be primitives and will have those\n    // properties.\n    let targetKey;\n    const targetParentPath = targetPath.replace(/\\/[^/]+$/, match => {\n      targetKey = unescapeKey(match.slice(1));\n      return '';\n    });\n    while (object !== undefined && object !== this.root) {\n      const parent =\n        object && object.$parent || object === targetObject && this.getObject(targetParentPath);\n      if (!this._modeler.isPlaceholder(object && object.$path || targetPath)) {\n        const ghostObjects = deleted ? null : [targetObject];\n        if (!this._holdsConcreteData(object, ghostObjects)) {\n          deleted = true;\n          this._deleteFirebaseProperty(\n            parent, object && object.$key || object === targetObject && targetKey);\n        }\n      }\n      object = parent;\n    }\n    return deleted;\n  }\n\n  _holdsConcreteData(object, ghostObjects) {\n    if (object === undefined || object === null) return false;\n    if (ghostObjects && _.includes(ghostObjects, object)) return false;\n    if (!_.isObject(object) || !object.$truss) return true;\n    return _.some(object, value => this._holdsConcreteData(value, ghostObjects));\n  }\n\n  _pruneDescendants(object, lockedDescendantPaths) {\n    if (lockedDescendantPaths[object.$path]) return true;\n    if (object.$overridden) delete object.$overridden;\n    let coupledDescendantFound = false;\n    _.each(object, (value, key) => {\n      let shouldDelete = true;\n      let valueLocked;\n      if (lockedDescendantPaths[joinPath(object.$path, escapeKey(key))]) {\n        shouldDelete = false;\n        valueLocked = true;\n      } else if (value.$truss) {\n        const placeholder = this._modeler.isPlaceholder(value.$path);\n        if (placeholder || _.has(lockedDescendantPaths, value.$path)) {\n          valueLocked = this._pruneDescendants(value, lockedDescendantPaths);\n          shouldDelete = !placeholder && !valueLocked;\n        }\n      }\n      if (shouldDelete) this._deleteFirebaseProperty(object, key);\n      coupledDescendantFound = coupledDescendantFound || valueLocked;\n    });\n    return coupledDescendantFound;\n  }\n\n  getObject(path) {\n    const segments = splitPath(path);\n    let object;\n    for (const segment of segments) {\n      object = segment ? object[segment] : this.root;\n      if (object === undefined) return;\n    }\n    return object;\n  }\n\n  _getFirebasePropertyDescriptor(object, data, key) {\n    let descriptor = Object.getOwnPropertyDescriptor(data, key);\n    if (descriptor) {\n      if (!descriptor.enumerable) {\n        throw new Error(\n          `Key conflict between Firebase and instance or computed properties at ` +\n          `${object.$path}: ${key}`);\n      }\n      if (!descriptor.get || !descriptor.set) {\n        throw new Error(`Unbound property at ${object.$path}: ${key}`);\n      }\n    } else if (key in data) {\n      throw new Error(\n        `Key conflict between Firebase and inherited property at ${object.$path}: ${key}`);\n    }\n    return descriptor;\n  }\n\n  _setFirebaseProperty(object, key, value, hidden) {\n    const data = object.hasOwnProperty('$data') ? object.$data : object;\n    let descriptor = this._getFirebasePropertyDescriptor(object, data, key);\n    if (descriptor) {\n      if (hidden) {\n        // Redefine property as hidden after it's been created, since we usually don't know whether\n        // it should be hidden until too late.  This is a one-way deal -- you can't unhide a\n        // property later, but that's fine for our purposes.\n        Object.defineProperty(data, key, {\n          get: descriptor.get, set: descriptor.set, configurable: true, enumerable: false\n        });\n      }\n      if (data[key] === value) return;\n      this._firebasePropertyEditAllowed = true;\n      data[key] = value;\n      this._firebasePropertyEditAllowed = false;\n    } else {\n      Vue.set(data, key, value);\n      descriptor = Object.getOwnPropertyDescriptor(data, key);\n      Object.defineProperty(data, key, {\n        get: descriptor.get, set: this._overwriteFirebaseProperty.bind(this, descriptor, key),\n        configurable: true, enumerable: !hidden\n      });\n    }\n    angular.digest();\n  }\n\n  _overwriteFirebaseProperty(descriptor, key, newValue) {\n    if (!this._firebasePropertyEditAllowed) {\n      const e = new Error(`Firebase data cannot be mutated directly: ${key}`);\n      e.trussCode = 'firebase_overwrite';\n      throw e;\n    }\n    descriptor.set.call(this, newValue);\n  }\n\n  _deleteFirebaseProperty(object, key) {\n    const data = object.hasOwnProperty('$data') ? object.$data : object;\n    // Make sure it's actually a Firebase property.\n    this._getFirebasePropertyDescriptor(object, data, key);\n    this._destroyObject(data[key]);\n    Vue.delete(data, key);\n    angular.digest();\n  }\n\n  checkVueObject(object, path) {\n    this._modeler.checkVueObject(object, path);\n  }\n}\n\n\nexport function checkUpdateHasOnlyDescendantsWithNoOverlap(rootPath, values) {\n  // First, check all paths for correctness and absolutize them, since there could be a mix of\n  // absolute paths and relative keys.\n  _.each(_.keys(values), path => {\n    if (path.charAt(0) === '/') {\n      if (!(path === rootPath || rootPath === '/' ||\n            _.startsWith(path, rootPath + '/') && path.length > rootPath.length + 1)) {\n        throw new Error(`Update item is not a descendant of target ref: ${path}`);\n      }\n    } else {\n      if (path.indexOf('/') >= 0) {\n        throw new Error(`Update item deep path must be absolute, taken from a reference: ${path}`);\n      }\n      const absolutePath = joinPath(rootPath, escapeKey(path));\n      if (values.hasOwnProperty(absolutePath)) {\n        throw new Error(`Update items overlap: ${path} and ${absolutePath}`);\n      }\n      values[absolutePath] = values[path];\n      delete values[path];\n    }\n  });\n  // Then check for overlaps;\n  const allPaths = _(values).keys().map(path => joinPath(path, '')).sortBy('length').value();\n  _.each(values, (value, path) => {\n    for (const otherPath of allPaths) {\n      if (otherPath.length > path.length) break;\n      if (path !== otherPath && _.startsWith(path, otherPath)) {\n        throw new Error(`Update items overlap: ${otherPath} and ${path}`);\n      }\n    }\n  });\n}\n\nexport function extractCommonPathPrefix(values) {\n  let prefixSegments;\n  _.each(values, (value, path) => {\n    const segments = path === '/' ? [''] : splitPath(path, true);\n    if (prefixSegments) {\n      let firstMismatchIndex = 0;\n      const maxIndex = Math.min(prefixSegments.length, segments.length);\n      while (firstMismatchIndex < maxIndex &&\n             prefixSegments[firstMismatchIndex] === segments[firstMismatchIndex]) {\n        firstMismatchIndex++;\n      }\n      prefixSegments = prefixSegments.slice(0, firstMismatchIndex);\n      if (!prefixSegments.length) return false;\n    } else {\n      prefixSegments = segments;\n    }\n  });\n  return prefixSegments.length === 1 ? '/' : prefixSegments.join('/');\n}\n\nexport function relativizePaths(rootPath, values) {\n  const offset = rootPath === '/' ? 1 : rootPath.length + 1;\n  _.each(_.keys(values), path => {\n    values[path.slice(offset)] = values[path];\n    delete values[path];\n  });\n}\n\nexport function toFirebaseJson(object) {\n  if (!_.isObject(object)) return object;\n  const result = {};\n  for (const key in object) {\n    if (object.hasOwnProperty(key)) result[escapeKey(key)] = toFirebaseJson(object[key]);\n  }\n  return result;\n}\n\n","import _ from 'lodash';\n\n\nclass LruCacheItem {\n  constructor(key, value) {\n    this.key = key;\n    this.value = value;\n    this.touch();\n  }\n\n  touch() {\n    this.timestamp = Date.now();\n  }\n}\n\n\nexport default class LruCache {\n  constructor(maxSize, pruningSize) {\n    this._items = Object.create(null);\n    this._size = 0;\n    this._maxSize = maxSize;\n    this._pruningSize = pruningSize || Math.ceil(maxSize * 0.10);\n  }\n\n  has(key) {\n    return Boolean(this._items[key]);\n  }\n\n  get(key) {\n    const item = this._items[key];\n    if (!item) return;\n    item.touch();\n    return item.value;\n  }\n\n  set(key, value) {\n    const item = this._items[key];\n    if (item) {\n      item.value = value;\n    } else {\n      if (this._size >= this._maxSize) this._prune();\n      this._items[key] = new LruCacheItem(key, value);\n      this._size += 1;\n    }\n  }\n\n  delete(key) {\n    const item = this._items[key];\n    if (!item) return;\n    delete this._items[key];\n    this._size -= 1;\n  }\n\n  _prune() {\n    const itemsToPrune =\n      _(this._items).toArray().sortBy('timestamp').take(this._pruningSize).value();\n    for (const item of itemsToPrune) this.delete(item.key);\n  }\n}\n","import {escapeKey, unescapeKey, makePathMatcher} from './utils/paths.js';\n\nimport _ from 'lodash';\n\n\nconst EMPTY_ANNOTATIONS = {};\nObject.freeze(EMPTY_ANNOTATIONS);\n\n\nexport class Handle {\n  constructor(tree, path, annotations) {\n    this._tree = tree;\n    this._path = path.replace(/^\\/*/, '/').replace(/\\/$/, '') || '/';\n    if (annotations) {\n      this._annotations = annotations;\n      Object.freeze(annotations);\n    }\n  }\n\n  get $ref() {return this;}\n  get key() {\n    if (!this._key) this._key = unescapeKey(this._path.replace(/.*\\//, ''));\n    return this._key;\n  }\n  get path() {return this._path;}\n  get _pathPrefix() {return this._path === '/' ? '' : this._path;}\n  get parent() {\n    return new Reference(this._tree, this._path.replace(/\\/[^/]*$/, ''), this._annotations);\n  }\n\n  get annotations() {\n    return this._annotations || EMPTY_ANNOTATIONS;\n  }\n\n  child() {\n    if (!arguments.length) return this;\n    const segments = [];\n    for (const key of arguments) {\n      if (key === undefined || key === null) return;\n      segments.push(escapeKey(key));\n    }\n    return new Reference(\n      this._tree, `${this._pathPrefix}/${segments.join('/')}`,\n      this._annotations\n    );\n  }\n\n  children() {\n    if (!arguments.length) return this;\n    const escapedKeys = [];\n    for (let i = 0; i < arguments.length; i++) {\n      const arg = arguments[i];\n      if (_.isArray(arg)) {\n        const mapping = {};\n        const subPath = this._pathPrefix + (escapedKeys.length ? `/${escapedKeys.join('/')}` : '');\n        const rest = _.slice(arguments, i + 1);\n        for (const key of arg) {\n          const subRef =\n            new Reference(this._tree, `${subPath}/${escapeKey(key)}`, this._annotations);\n          const subMapping = subRef.children.apply(subRef, rest);\n          if (subMapping) mapping[key] = subMapping;\n        }\n        if (_.isEmpty(mapping)) return;\n        return mapping;\n      } else {\n        if (arg === undefined || arg === null) return;\n        escapedKeys.push(escapeKey(arg));\n      }\n    }\n    return new Reference(\n      this._tree, `${this._pathPrefix}/${escapedKeys.join('/')}`, this._annotations);\n  }\n\n  peek(callback) {\n    return this._tree.truss.peek(this, callback);\n  }\n\n  match(pattern) {\n    return makePathMatcher(pattern).match(this.path);\n  }\n\n  test(pattern) {\n    return makePathMatcher(pattern).test(this.path);\n  }\n\n  isEqual(that) {\n    if (!(that instanceof Handle)) return false;\n    return this._tree === that._tree && this.toString() === that.toString() &&\n      _.isEqual(this._annotations, that._annotations);\n  }\n\n  belongsTo(truss) {\n    return this._tree.truss === truss;\n  }\n}\n\n\nexport class Query extends Handle {\n  constructor(tree, path, spec, annotations) {\n    super(tree, path, annotations);\n    this._spec = this._copyAndValidateSpec(spec);\n    const queryTerms = _(this._spec)\n      .map((value, key) => `${key}=${encodeURIComponent(JSON.stringify(value))}`)\n      .sortBy()\n      .join('&');\n    this._string = `${this._path}?${queryTerms}`;\n    Object.freeze(this);\n  }\n\n  // Vue-bound\n  get ready() {\n    return this._tree.isQueryReady(this);\n  }\n\n  get constraints() {\n    return this._spec;\n  }\n\n  annotate(annotations) {\n    return new Query(\n      this._tree, this._path, this._spec, _.extend({}, this._annotations, annotations));\n  }\n\n  _copyAndValidateSpec(spec) {\n    if (!spec.by) throw new Error('Query needs \"by\" clause: ' + JSON.stringify(spec));\n    if (('at' in spec) + ('from' in spec) + ('to' in spec) > 1) {\n      throw new Error(\n        'Query must contain at most one of \"at\", \"from\", or \"to\" clauses: ' + JSON.stringify(spec));\n    }\n    if (('first' in spec) + ('last' in spec) > 1) {\n      throw new Error(\n        'Query must contain at most one of \"first\" or \"last\" clauses: ' + JSON.stringify(spec));\n    }\n    if (!_.some(['at', 'from', 'to', 'first', 'last'], clause => clause in spec)) {\n      throw new Error(\n        'Query must contain at least one of \"at\", \"from\", \"to\", \"first\", or \"last\" clauses: ' +\n        JSON.stringify(spec));\n    }\n    spec = _.clone(spec);\n    if (spec.by !== '$key' && spec.by !== '$value') {\n      if (!(spec.by instanceof Reference)) {\n        throw new Error('Query \"by\" value must be a reference: ' + spec.by);\n      }\n      let childPath = spec.by.toString();\n      if (!_.startsWith(childPath, this._path)) {\n        throw new Error(\n          'Query \"by\" value must be a descendant of target reference: ' + spec.by);\n      }\n      childPath = childPath.slice(this._path.length).replace(/^\\/?/, '');\n      if (childPath.indexOf('/') === -1) {\n        throw new Error(\n          'Query \"by\" value must not be a direct child of target reference: ' + spec.by);\n      }\n      spec.by = childPath.replace(/.*?\\//, '');\n    }\n    Object.freeze(spec);\n    return spec;\n  }\n\n\n  toString() {\n    return this._string;\n  }\n}\n\n\n// jshint latedef:false\nexport class Reference extends Handle {\n// jshint latedef:nofunc\n\n  constructor(tree, path, annotations) {\n    super(tree, path, annotations);\n    Object.freeze(this);\n  }\n\n  get ready() {return this._tree.isReferenceReady(this);}  // Vue-bound\n  get value() {return this._tree.getObject(this.path);}  // Vue-bound\n  toString() {return this._path;}\n\n  annotate(annotations) {\n    return new Reference(this._tree, this._path, _.extend({}, this._annotations, annotations));\n  }\n\n  query(spec) {\n    return new Query(this._tree, this._path, spec);\n  }\n\n  set(value) {\n    return this._tree.update(this, 'set', {[this.path]: value});\n  }\n\n  update(values) {\n    return this._tree.update(this, 'update', values);\n  }\n\n  override(value) {\n    return this._tree.update(this, 'override', {[this.path]: value});\n  }\n\n  commit(updateFunction) {\n    return this._tree.commit(this, updateFunction);\n  }\n}\n\nexport default Reference;\n","import _ from 'lodash';\n\n\nclass StatItem {\n  constructor(name) {\n    _.extend(this, {name, numRecomputes: 0, numUpdates: 0, runtime: 0});\n  }\n\n  add(item) {\n    this.runtime += item.runtime;\n    this.numUpdates += item.numUpdates;\n    this.numRecomputes += item.numRecomputes;\n  }\n\n  get runtimePerRecompute() {\n    return this.numRecomputes ? this.runtime / this.numRecomputes : 0;\n  }\n\n  toLogParts(totals) {\n    return [\n      `${this.name}:`, ` ${(this.runtime / 1000).toFixed(2)}s`,\n      `(${(this.runtime / totals.runtime * 100).toFixed(1)}%)`,\n      ` ${this.numUpdates} upd /`, `${this.numRecomputes} runs`,\n      `(${(this.numUpdates / this.numRecomputes * 100).toFixed(1)}%)`,\n      ` ${this.runtimePerRecompute.toFixed(2)}ms / run`\n    ];\n  }\n}\n\nclass Stats {\n  constructor() {\n    this._items = {};\n  }\n\n  for(name) {\n    if (!this._items[name]) this._items[name] = new StatItem(name);\n    return this._items[name];\n  }\n\n  get list() {\n    return _(this._items).values().sortBy(item => -item.runtime).value();\n  }\n\n  log(n = 10) {\n    let stats = this.list;\n    if (!stats.length) return;\n    const totals = new StatItem('=== Total');\n    _.each(stats, stat => {totals.add(stat);});\n    stats = _.take(stats, n);\n    const above = new StatItem('--- Above');\n    _.each(stats, stat => {above.add(stat);});\n    const lines = _.map(stats, item => item.toLogParts(totals));\n    lines.push(above.toLogParts(totals));\n    lines.push(totals.toLogParts(totals));\n    const widths = _.map(_.range(lines[0].length), i => _(lines).map(line => line[i].length).max());\n    _.each(lines, line => {\n      console.log(_.map(line, (column, i) => _.padLeft(column, widths[i])).join(' '));\n    });\n  }\n}\n\nexport default new Stats();\n","// Generated by CoffeeScript 1.7.1\n(function() {\n  var getNanoSeconds, hrtime, loadTime;\n\n  if ((typeof performance !== \"undefined\" && performance !== null) && performance.now) {\n    module.exports = function() {\n      return performance.now();\n    };\n  } else if ((typeof process !== \"undefined\" && process !== null) && process.hrtime) {\n    module.exports = function() {\n      return (getNanoSeconds() - loadTime) / 1e6;\n    };\n    hrtime = process.hrtime;\n    getNanoSeconds = function() {\n      var hr;\n      hr = hrtime();\n      return hr[0] * 1e9 + hr[1];\n    };\n    loadTime = getNanoSeconds();\n  } else if (Date.now) {\n    module.exports = function() {\n      return Date.now() - loadTime;\n    };\n    loadTime = Date.now();\n  } else {\n    module.exports = function() {\n      return new Date().getTime() - loadTime;\n    };\n    loadTime = new Date().getTime();\n  }\n\n}).call(this);\n","import _ from 'lodash';\nimport {wrapPromiseCallback} from './utils/promises.js';\n\n\nconst INTERCEPT_KEYS = [\n  'read', 'write', 'auth', 'set', 'update', 'commit', 'connect', 'peek', 'authenticate',\n  'unathenticate', 'certify', 'all'\n];\n\nconst EMPTY_ARRAY = [];\n\n\nclass SlowHandle {\n  constructor(operation, delay, callback) {\n    this._operation = operation;\n    this._delay = delay;\n    this._callback = callback;\n    this._fired = false;\n  }\n\n  initiate() {\n    this.cancel();\n    this._fired = false;\n    const elapsed = Date.now() - this._operation._startTimestamp;\n    this._timeoutId = setTimeout(() => {\n      this._fired = true;\n      this._callback(this._operation);\n    }, this._delay - elapsed);\n  }\n\n  cancel() {\n    if (this._fired) this._callback(this._operation);\n    if (this._timeoutId) clearTimeout(this._timeoutId);\n  }\n}\n\n\nclass Operation {\n  constructor(type, method, target, operand) {\n    this._type = type;\n    this._method = method;\n    this._target = target;\n    this._operand = operand;\n    this._ready = false;\n    this._running = false;\n    this._ended = false;\n    this._tries = 0;\n    this._startTimestamp = Date.now();\n    this._slowHandles = [];\n  }\n\n  get type() {return this._type;}\n  get method() {return this._method;}\n  get target() {return this._target;}\n  get operand() {return this._operand;}\n  get ready() {return this._ready;}\n  get running() {return this._running;}\n  get ended() {return this._ended;}\n  get tries() {return this._tries;}\n  get error() {return this._error;}\n\n  onSlow(delay, callback) {\n    const handle = new SlowHandle(this, delay, callback);\n    this._slowHandles.push(handle);\n    handle.initiate();\n  }\n\n  _setRunning(value) {\n    this._running = value;\n  }\n\n  _setEnded(value) {\n    this._ended = value;\n  }\n\n  _markReady(ending) {\n    this._ready = true;\n    if (!ending) this._tries = 0;\n    _.each(this._slowHandles, handle => handle.cancel());\n  }\n\n  _clearReady() {\n    this._ready = false;\n    this._startTimestamp = Date.now();\n    _.each(this._slowHandles, handle => handle.initiate());\n  }\n\n  _incrementTries() {\n    this._tries++;\n  }\n}\n\n\nexport default class Dispatcher {\n  constructor(bridge) {\n    this._bridge = bridge;\n    this._callbacks = {};\n    Object.freeze(this);\n  }\n\n  intercept(interceptKey, callbacks) {\n    if (!_.contains(INTERCEPT_KEYS, interceptKey)) {\n      throw new Error('Unknown intercept operation type: ' + interceptKey);\n    }\n    const badCallbackKeys =\n      _.difference(_.keys(callbacks), ['onBefore', 'onAfter', 'onError', 'onFailure']);\n    if (badCallbackKeys.length) {\n      throw new Error('Unknown intercept callback types: ' + badCallbackKeys.join(', '));\n    }\n    const wrappedCallbacks = {\n      onBefore: this._addCallback('onBefore', interceptKey, callbacks.onBefore),\n      onAfter: this._addCallback('onAfter', interceptKey, callbacks.onAfter),\n      onError: this._addCallback('onError', interceptKey, callbacks.onError),\n      onFailure: this._addCallback('onFailure', interceptKey, callbacks.onFailure)\n    };\n    return this._removeCallbacks.bind(this, interceptKey, wrappedCallbacks);\n  }\n\n  _addCallback(stage, interceptKey, callback) {\n    if (!callback) return;\n    const key = this._getCallbacksKey(stage, interceptKey);\n    const wrappedCallback = wrapPromiseCallback(callback);\n    (this._callbacks[key] || (this._callbacks[key] = [])).push(wrappedCallback);\n    return wrappedCallback;\n  }\n\n  _removeCallback(stage, interceptKey, wrappedCallback) {\n    if (!wrappedCallback) return;\n    const key = this._getCallbacksKey(stage, interceptKey);\n    if (this._callbacks[key]) _.pull(this._callbacks[key], wrappedCallback);\n  }\n\n  _removeCallbacks(interceptKey, wrappedCallbacks) {\n    _.each(wrappedCallbacks, (wrappedCallback, stage) => {\n      this._removeCallback(stage, interceptKey, wrappedCallback);\n    });\n  }\n\n  _getCallbacks(stage, operationType, method) {\n    return [].concat(\n      this._callbacks[this._getCallbacksKey(stage, method)] || EMPTY_ARRAY,\n      this._callbacks[this._getCallbacksKey(stage, operationType)] || EMPTY_ARRAY,\n      this._callbacks[this._getCallbacksKey(stage, 'all')] || EMPTY_ARRAY\n    );\n  }\n\n  _getCallbacksKey(stage, interceptKey) {\n    return `${stage}_${interceptKey}`;\n  }\n\n  execute(operationType, method, target, operand, executor) {\n    executor = wrapPromiseCallback(executor);\n    const operation = this.createOperation(operationType, method, target, operand);\n    return this.begin(operation).then(() => {\n      const executeWithRetries = () => {\n        return executor().catch(e => this._retryOrEnd(operation, e).then(executeWithRetries));\n      };\n      return executeWithRetries();\n    }).then(result => this.end(operation).then(() => result));\n  }\n\n  createOperation(operationType, method, target, operand) {\n    return new Operation(operationType, method, target, operand);\n  }\n\n  begin(operation) {\n    return Promise.all(_.map(\n      this._getCallbacks('onBefore', operation.type, operation.method),\n      onBefore => onBefore(operation)\n    )).then(() => {\n      if (!operation.ended) operation._setRunning(true);\n    }, e => this.end(operation, e));\n  }\n\n  markReady(operation) {\n    operation._markReady();\n  }\n\n  clearReady(operation) {\n    operation._clearReady();\n  }\n\n  retry(operation, error) {\n    operation._incrementTries();\n    operation._error = error;\n    return Promise.all(_.map(\n      this._getCallbacks('onError', operation.type, operation.method),\n      onError => onError(operation, error)\n    )).then(results => {\n      const retrying = _.some(results);\n      if (retrying) delete operation._error;\n      return retrying;\n    });\n  }\n\n  _retryOrEnd(operation, error) {\n    return this.retry(operation, error).then(result => {\n      if (!result) return this.end(operation, error);\n    }, e => this.end(operation, e));\n  }\n\n  end(operation, error) {\n    if (operation.ended) return;\n    operation._setRunning(false);\n    operation._setEnded(true);\n    if (error) operation._error = error;\n    return Promise.all(_.map(\n      this._getCallbacks('onAfter', operation.type, operation.method),\n      onAfter => onAfter(operation)\n    )).then(\n      () => this._afterEnd(operation),\n      e => {\n        operation._error = e;\n        return this._afterEnd(operation);\n      }\n    );\n  }\n\n  _afterEnd(operation) {\n    operation._markReady(true);\n    if (operation.error) {\n      const onFailureCallbacks = this._getCallbacks('onFailure', operation.type, operation.method);\n      return this._bridge.probeError(operation.error).then(() => {\n        if (onFailureCallbacks) {\n          setTimeout(() => {\n            _.each(onFailureCallbacks, onFailure => onFailure(operation));\n          }, 0);\n        }\n        return Promise.reject(operation.error);\n      });\n    }\n  }\n}\n\n","const ALPHABET = '-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz';\n\nexport default class KeyGenerator {\n  constructor() {\n    this._lastUniqueKeyTime = 0;\n    this._lastRandomValues = [];\n  }\n\n  generateUniqueKey(now) {\n    now = now || Date.now();\n    const chars = new Array(20);\n    let prefix = now;\n    for (let i = 7; i >= 0; i--) {\n      chars[i] = ALPHABET.charAt(prefix & 0x3f);\n      prefix = Math.floor(prefix / 64);\n    }\n    if (now === this._lastUniqueKeyTime) {\n      let i = 11;\n      while (i >= 0 && this._lastRandomValues[i] === 63) {\n        this._lastRandomValues[i] = 0;\n        i -= 1;\n      }\n      if (i === -1) {\n        throw new Error('Internal assertion failure: ran out of unique IDs for this millisecond');\n      }\n      this._lastRandomValues[i] += 1;\n    } else {\n      this._lastUniqueKeyTime = now;\n      for (let i = 0; i < 12; i++) {\n        // Make sure to leave some space for incrementing in the top nibble.\n        this._lastRandomValues[i] = Math.floor(Math.random() * (i ? 64 : 16));\n      }\n    }\n    for (let i = 0; i < 12; i++) {\n      chars[i + 8] = ALPHABET[this._lastRandomValues[i]];\n    }\n    return chars.join('');\n  }\n}\n","import angular from './angularCompatibility.js';\nimport Vue from 'vue';\nimport _ from 'lodash';\nimport Reference from './Reference.js';\nimport {promiseFinally} from './utils/promises.js';\n\n\nexport default class MetaTree {\n  constructor(rootUrl, tree, bridge, dispatcher) {\n    this._rootUrl = rootUrl;\n    this._tree = tree;\n    this._dispatcher = dispatcher;\n    this._bridge = bridge;\n    this._vue = new Vue({data: {$root: {\n      connected: undefined, timeOffset: 0, user: undefined, userid: undefined,\n      nowAtInterval(intervalMillis) {\n        const key = 'now' + intervalMillis;\n        if (!this.hasOwnProperty(key)) {\n          const update = () => {\n            this[key] = Date.now() + this.timeOffset;\n            angular.digest();\n          };\n          update();\n          setInterval(() => update, intervalMillis);\n        }\n        return this[key];\n      }\n    }}});\n\n    this._authsInProgress = {};\n\n    bridge.onAuth(rootUrl, this._handleAuthChange, this);\n\n    this._connectInfoProperty('serverTimeOffset', 'timeOffset');\n    this._connectInfoProperty('connected', 'connected');\n    Object.freeze(this);\n  }\n\n  get root() {\n    return this._vue.$data.$root;\n  }\n\n  destroy() {\n    this._bridge.offAuth(this._rootUrl, this._handleAuthChange, this);\n    this._vue.$destroy();\n  }\n\n  authenticate(token) {\n    this._authsInProgress[token] = true;\n    return promiseFinally(\n      this._dispatcher.execute(\n        'auth', 'authenticate', new Reference(this._tree, '/'), token, () => {\n          return this._bridge.authWithCustomToken(this._rootUrl, token, {rememberMe: true});\n        }\n      ),\n      () => {delete this._authsInProgress[token];}\n    );\n  }\n\n  unauthenticate() {\n    this._authsInProgress.null = true;\n    return promiseFinally(\n      this._dispatcher.execute(\n        'auth', 'unauthenticate', new Reference(this._tree, '/'), undefined, () => {\n          return this._bridge.unauth(this._rootUrl);\n        }\n      ),\n      () => {delete this._authsInProgress.null;}\n    );\n  }\n\n  _handleAuthChange(user) {\n    delete this._authsInProgress[user ? user.token : null];\n    if (!_.isEmpty(this._authsInProgress)) return;\n    this._dispatcher.execute('auth', 'certify', new Reference(this._tree, '/'), user, () => {\n      if (!_.isEmpty(this._authsInProgress)) return;\n      if (user) Object.freeze(user);\n      this.root.user = user;\n      this.root.userid = user && user.uid;\n      angular.digest();\n    });\n  }\n\n  _connectInfoProperty(property, attribute) {\n    const propertyUrl = `${this._rootUrl}/.info/${property}`;\n    this._bridge.on(propertyUrl, propertyUrl, null, 'value', snap => {\n      this.root[attribute] = snap.value;\n      angular.digest();\n    });\n  }\n}\n","import _ from 'lodash';\nimport Vue from 'vue';\nimport angular from './angularCompatibility.js';\nimport {splitPath} from './utils/paths.js';\n\n\nclass QueryHandler {\n  constructor(coupler, query) {\n    this._coupler = coupler;\n    this._query = query;\n    this._listeners = [];\n    this._keys = [];\n    this._url = this._coupler._rootUrl + query.path;\n    this._segments = splitPath(query.path, true);\n    this._listening = false;\n    this.ready = false;\n  }\n\n  attach(operation, keysCallback) {\n    this._listen();\n    this._listeners.push({operation, keysCallback});\n    if (keysCallback) keysCallback(this._keys);\n  }\n\n  detach(operation) {\n    const k = _.findIndex(this._listeners, {operation});\n    if (k >= 0) this._listeners.splice(k, 1);\n    return this._listeners.length;\n  }\n\n  _listen() {\n    if (this._listening) return;\n    this._coupler._bridge.on(\n      this._query.toString(), this._url, this._query.constraints, 'value',\n      this._handleSnapshot, this._handleError, this, {sync: true});\n    this._listening = true;\n  }\n\n  destroy() {\n    this._coupler._bridge.off(\n      this._query.toString(), this._url, this._query.constraints, 'value', this._handleSnapshot,\n      this);\n    this._listening = false;\n    this.ready = false;\n    angular.digest();\n    for (const key of this._keys) {\n      this._coupler._decoupleSegments(this._segments.concat(key));\n    }\n  }\n\n  _handleSnapshot(snap) {\n    // Order is important here: first couple any new subpaths so _handleSnapshot will update the\n    // tree, then tell the client to update its keys, pulling values from the tree.\n    if (!this._listeners.length || !this._listening) return;\n    const updatedKeys = this._updateKeys(snap);\n    this._coupler._applySnapshot(snap);\n    if (!this.ready) {\n      this.ready = true;\n      angular.digest();\n      for (const listener of this._listeners) {\n        this._coupler._dispatcher.markReady(listener.operation);\n      }\n    }\n    if (updatedKeys) {\n      for (const listener of this._listeners) {\n        if (listener.keysCallback) listener.keysCallback(updatedKeys);\n      }\n    }\n  }\n\n  _updateKeys(snap) {\n    let updatedKeys;\n    if (snap.path === this._query.path) {\n      updatedKeys = _.keys(snap.value);\n      updatedKeys.sort();\n      if (_.isEqual(this._keys, updatedKeys)) {\n        updatedKeys = null;\n      } else {\n        for (const key of _.difference(updatedKeys, this._keys)) {\n          this._coupler._coupleSegments(this._segments.concat(key));\n        }\n        for (const key of _.difference(this._keys, updatedKeys)) {\n          this._coupler._decoupleSegments(this._segments.concat(key));\n        }\n        this._keys = updatedKeys;\n      }\n    } else if (snap.path.replace(/\\/[^/]+/, '') === this._query.path) {\n      const hasKey = _.contains(this._keys, snap.key);\n      if (snap.value) {\n        if (!hasKey) {\n          this._coupler._coupleSegments(this._segments.concat(snap.key));\n          this._keys.push(snap.key);\n          this._keys.sort();\n          updatedKeys = this._keys;\n        }\n      } else {\n        if (hasKey) {\n          this._coupler._decoupleSegments(this._segments.concat(snap.key));\n          _.pull(this._keys, snap.key);\n          this._keys.sort();\n          updatedKeys = this._keys;\n        }\n      }\n    }\n    return updatedKeys;\n  }\n\n  _handleError(error) {\n    if (!this._listeners.length || !this._listening) return;\n    this._listening = false;\n    Promise.all(_.map(this._listeners, listener => {\n      this._coupler._dispatcher.clearReady(listener.operation);\n      return this._coupler._dispatcher.retry(listener.operation, error).catch(e => {\n        listener.operation._disconnect(e);\n        return false;\n      });\n    })).then(results => {\n      if (_.some(results)) {\n        if (this._listeners.length) this._listen();\n      } else {\n        for (const listener of this._listeners) listener.operation._disconnect(error);\n      }\n    });\n  }\n}\n\n\nclass Node {\n  constructor(coupler, path, parent) {\n    this._coupler = coupler;\n    this.path = path;\n    this.parent = parent;\n    this.url = this._coupler._rootUrl + path;\n    this.operations = [];\n    this.queryCount = 0;\n    this.listening = false;\n    this.ready = false;\n    this.children = {};\n  }\n\n  get active() {\n    return this.count || this.queryCount;\n  }\n\n  get count() {\n    return this.operations.length;\n  }\n\n  listen(skip) {\n    if (!skip && this.count) {\n      if (this.listening) return;\n      _.each(this.operations, op => {this._coupler._dispatcher.clearReady(op);});\n      this._coupler._bridge.on(\n        this.url, this.url, null, 'value', this._handleSnapshot, this._handleError, this,\n        {sync: true});\n      this.listening = true;\n    } else {\n      _.each(this.children, child => {child.listen();});\n    }\n  }\n\n  unlisten(skip) {\n    if (!skip && this.listening) {\n      this._coupler._bridge.off(this.url, this.url, null, 'value', this._handleSnapshot, this);\n      this.listening = false;\n      this._forAllDescendants(node => {\n        if (node.ready) {\n          node.ready = false;\n          angular.digest();\n        }\n      });\n    } else {\n      _.each(this.children, child => {child.unlisten();});\n    }\n  }\n\n  _handleSnapshot(snap) {\n    if (!this.listening || !this._coupler.isTrunkCoupled(snap.path)) return;\n    this._coupler._applySnapshot(snap);\n    if (!this.ready && snap.path === this.path) {\n      this.ready = true;\n      angular.digest();\n      this.unlisten(true);\n      this._forAllDescendants(node => {\n        for (const op of this.operations) this._coupler._dispatcher.markReady(op);\n      });\n    }\n  }\n\n  _handleError(error) {\n    if (!this.count || !this.listening) return;\n    this.listening = false;\n    this._forAllDescendants(node => {\n      if (node.ready) {\n        node.ready = false;\n        angular.digest();\n      }\n      for (const op of this.operations) this._coupler._dispatcher.clearReady(op);\n    });\n    return Promise.all(_.map(this.operations, op => {\n      return this._coupler._dispatcher.retry(op, error).catch(e => {\n        op._disconnect(e);\n        return false;\n      });\n    })).then(results => {\n      if (_.some(results)) {\n        if (this.count) this.listen();\n      } else {\n        for (const op of this.operations) op._disconnect(error);\n        // Pulling all the operations will automatically get us listening on descendants.\n      }\n    });\n  }\n\n  _forAllDescendants(iteratee) {\n    iteratee(this);\n    _.each(this.children, child => child._forAllDescendants(iteratee));\n  }\n\n  collectCoupledDescendantPaths(paths) {\n    if (!paths) paths = {};\n    paths[this.path] = this.active;\n    if (!this.active) {\n      _.each(this.children, child => {child.collectCoupledDescendantPaths(paths);});\n    }\n    return paths;\n  }\n}\n\n\nexport default class Coupler {\n  constructor(rootUrl, bridge, dispatcher, applySnapshot, prunePath) {\n    this._rootUrl = rootUrl;\n    this._bridge = bridge;\n    this._dispatcher = dispatcher;\n    this._applySnapshot = applySnapshot;\n    this._prunePath = prunePath;\n    this._vue = new Vue({data: {root: undefined, queryHandlers: {}}});\n    this._nodeIndex = Object.create(null);\n    Object.freeze(this);\n    // Set root node after freezing Coupler, otherwise it gets vue-ified too.\n    this._vue.$data.root = new Node(this, '/');\n    this._nodeIndex['/'] = this._root;\n  }\n\n  get _root() {\n    return this._vue.$data.root;\n  }\n\n  get _queryHandlers() {\n    return this._vue.$data.queryHandlers;\n  }\n\n  destroy() {\n    _.each(this._queryHandlers, queryHandler => {queryHandler.destroy();});\n    this._root.unlisten();\n    this._vue.$destroy();\n  }\n\n  couple(path, operation) {\n    return this._coupleSegments(splitPath(path, true), operation);\n  }\n\n  _coupleSegments(segments, operation) {\n    let node;\n    let superseded = !operation;\n    let ready = false;\n    for (const segment of segments) {\n      let child = segment ? node.children && node.children[segment] : this._root;\n      if (!child) {\n        child = new Node(this, `${node.path === '/' ? '' : node.path}/${segment}`, node);\n        Vue.set(node.children, segment, child);\n        this._nodeIndex[child.path] = child;\n      }\n      superseded = superseded || child.listening;\n      ready = ready || child.ready;\n      node = child;\n    }\n    if (operation) {\n      node.operations.push(operation);\n    } else {\n      node.queryCount++;\n    }\n    if (superseded) {\n      if (operation && ready) this._dispatcher.markReady(operation);\n    } else {\n      node.listen();  // node will call unlisten() on descendants when ready\n    }\n  }\n\n  decouple(path, operation) {\n    return this._decoupleSegments(splitPath(path, true), operation);\n  }\n\n  _decoupleSegments(segments, operation) {\n    const ancestors = [];\n    let node;\n    for (const segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) break;\n      ancestors.push(node);\n    }\n    if (!node || !(operation ? node.count : node.queryCount)) {\n      throw new Error(`Path not coupled: ${segments.join('/') || '/'}`);\n    }\n    if (operation) {\n      _.pull(node.operations, operation);\n    } else {\n      node.queryCount--;\n    }\n    if (operation && !node.count) {\n      // Ideally, we wouldn't resync the full values here since we probably already have the current\n      // value for all children.  But making sure that's true is tricky in an async system (what if\n      // the node's value changes and the update crosses the 'off' call in transit?) and this\n      // situation should be sufficiently rare that the optimization is probably not worth it right\n      // now.\n      node.listen();\n      if (node.listening) node.unlisten();\n    }\n    if (!node.active) {\n      for (let i = ancestors.length - 1; i > 0; i--) {\n        node = ancestors[i];\n        if (node === this._root || node.active || !_.isEmpty(node.children)) break;\n        Vue.delete(ancestors[i - 1].children, segments[i]);\n        node.ready = undefined;\n        delete this._nodeIndex[node.path];\n      }\n      const path = segments.join('/') || '/';\n      this._prunePath(path, this.findCoupledDescendantPaths(path));\n    }\n  }\n\n  subscribe(query, operation, keysCallback) {\n    let queryHandler = this._queryHandlers[query.toString()];\n    if (!queryHandler) {\n      queryHandler = new QueryHandler(this, query);\n      Vue.set(this._queryHandlers, query.toString(), queryHandler);\n    }\n    queryHandler.attach(operation, keysCallback);\n }\n\n  unsubscribe(query, operation) {\n    const queryHandler = this._queryHandlers[query.toString()];\n    if (queryHandler && !queryHandler.detach(operation)) {\n      queryHandler.destroy();\n      Vue.delete(this._queryHandlers, query.toString());\n    }\n  }\n\n  // Return whether the node at path or any ancestors are coupled.\n  isTrunkCoupled(path) {\n    const segments = splitPath(path, true);\n    let node;\n    for (const segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) return false;\n      if (node.active) return true;\n    }\n    return false;\n  }\n\n  findCoupledDescendantPaths(path) {\n    let node;\n    for (const segment of splitPath(path, true)) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (node && node.active) return {[path]: node.active};\n      if (!node) break;\n    }\n    return node && node.collectCoupledDescendantPaths();\n  }\n\n  isSubtreeReady(path) {\n    let node, childSegment;\n    function extractChildSegment(match) {\n      childSegment = match.slice(1);\n      return '';\n    }\n    while (!(node = this._nodeIndex[path])) {\n      path = path.replace(/\\/[^/]*$/, extractChildSegment) || '/';\n    }\n    if (childSegment) void node.children;  // state an interest in the closest ancestor's children\n    while (node) {\n      if (node.ready) return true;\n      node = node.parent;\n    }\n    return false;\n  }\n\n  isQueryReady(query) {\n    const queryHandler = this._queryHandlers[query.toString()];\n    return queryHandler && queryHandler.ready;\n  }\n\n}\n\n","import _ from 'lodash';\nimport Vue from 'vue';\nimport angular from './angularCompatibility.js';\nimport Bridge from './Bridge.js';\nimport Connector from './Connector.js';\nimport Dispatcher from './Dispatcher.js';\nimport KeyGenerator from './KeyGenerator.js';\nimport MetaTree from './MetaTree.js';\nimport {Handle} from './Reference.js';\nimport Tree from './Tree.js';\nimport stats from './utils/stats.js';\nimport {escapeKey, unescapeKey} from './utils/paths.js';\nimport {wrapPromiseCallback, promiseCancel, promiseFinally} from './utils/promises.js';\nimport {SERVER_TIMESTAMP} from './utils/utils.js';\n\n\nlet bridge, logging;\nconst workerFunctions = {};\n// This version is filled in by the build, don't reformat the line.\nconst VERSION = 'dev';\n\n\nexport default class Truss {\n\n  /**\n   * Create a new Truss instance, specific to a given datastore.  To avoid confusion there should be\n   * exactly one Truss per root datastore URL, so in most code this will be a singleton.\n   *\n   * @param rootUrl {String} The root URL, https://{project}.firebaseio.com.\n   */\n  constructor(rootUrl) {\n    // TODO: allow rootUrl to be a test database object for testing\n    if (!bridge) {\n      throw new Error('Truss worker not connected, please call Truss.connectWorker first');\n    }\n    this._rootUrl = rootUrl.replace(/\\/$/, '');\n    this._keyGenerator = new KeyGenerator();\n    this._dispatcher = new Dispatcher(bridge);\n    this._vue = new Vue();\n\n    bridge.trackServer(this._rootUrl);\n    this._tree = new Tree(this, this._rootUrl, bridge, this._dispatcher);\n    this._metaTree = new MetaTree(this._rootUrl, this._tree, bridge, this._dispatcher);\n\n    Object.freeze(this);\n  }\n\n  get meta() {return this._metaTree.root;}\n  get root() {return this._tree.root;}\n\n  /**\n   * Mount a set of classes against the datastore structure.  Must be called at most once, and\n   * cannot be called once any data has been loaded into the tree.\n   * @param classes {Array<Function> | Object<Function>} A list of the classes to map onto the\n   *    datastore structure.  Each class must have a static $trussMount property that is a\n   *    (wildcarded) unescaped datastore path, or an options object\n   *    {path: string, placeholder: object}, or an array of either.  If the list is an object then\n   *    the keys serve as default option-less $trussMount paths for classes that don't define an\n   *    explicit $trussMount.\n   */\n  mount(classes) {\n    this._tree.init(classes);\n  }\n\n  destroy() {\n    this._vue.$destroy();\n    this._tree.destroy();\n    this._metaTree.destroy();\n  }\n\n  get now() {return Date.now() + this.meta.timeOffset;}\n  newKey() {return this._keyGenerator.generateUniqueKey(this.now);}\n\n  authenticate(token) {\n    return this._metaTree.authenticate(token);\n  }\n\n  unauthenticate() {\n    return this._metaTree.unauthenticate();\n  }\n\n  intercept(actionType, callbacks) {\n    return this._dispatcher.intercept(actionType, callbacks);\n  }\n\n  // connections are {key: Query | Object | fn() -> (Query | Object)}\n  connect(scope, connections) {\n    if (!connections) {\n      connections = scope;\n      scope = undefined;\n    }\n    if (connections instanceof Handle) connections = {_: connections};\n    return new Connector(scope, connections, this._tree, 'connect');\n  }\n\n  // target is Reference, Query, or connection Object like above\n  peek(target, callback) {\n    callback = wrapPromiseCallback(callback);\n    let cleanup, cancel;\n    const promise = Promise.resolve().then(() => new Promise((resolve, reject) => {\n      const scope = {};\n      let callbackPromise;\n\n      let connector = new Connector(scope, {result: target}, this._tree, 'peek');\n\n      let unintercept = this.intercept('peek', {onFailure: op => {\n        function match(descriptor) {\n          if (!descriptor) return;\n          if (descriptor instanceof Handle) return op.target.isEqual(descriptor);\n          return _.some(descriptor, value => match(value));\n        }\n        if (match(connector.at)) {\n          reject(op.error);\n          cleanup();\n        }\n      }});\n\n      let unwatch = this.watch(() => connector.ready, ready => {\n        if (!ready) return;\n        unwatch();\n        unwatch = null;\n        callbackPromise = promiseFinally(\n          callback(scope.result), () => {angular.digest(); callbackPromise = null; cleanup();}\n        ).then(result => {resolve(result);}, error => {reject(error);});\n      });\n\n      cleanup = () => {\n        if (unwatch) {unwatch(); unwatch = null;}\n        if (unintercept) {unintercept(); unintercept = null;}\n        if (connector) {connector.destroy(); connector = null;}\n        if (callbackPromise && callbackPromise.cancel) callbackPromise.cancel();\n      };\n\n      cancel = () => {\n        reject(new Error('Canceled'));\n        cleanup();\n      };\n    }));\n    return promiseCancel(promise, cancel);\n  }\n\n  watch(subjectFn, callbackFn, options) {\n    const usePreciseDefaults = _.isObject(options && options.precise);\n    let numCallbacks = 0;\n    let oldValueClone;\n    if (usePreciseDefaults) oldValueClone = _.clone(options.precise, options.deep);\n\n    const unwatch = this._vue.$watch(subjectFn, (newValue, oldValue) => {\n      if (options && options.precise) {\n        const newValueClone = usePreciseDefaults ?\n          (options.deep ?\n            _.defaultsDeep({}, newValue, options.precise) :\n            _.defaults({}, newValue, options.precise)) :\n          _.clone(newValue, options.deep);\n        if (_.isEqual(newValueClone, oldValueClone)) return;\n        oldValueClone = newValueClone;\n      }\n      numCallbacks++;\n      if (!unwatch) {\n        // Delay the immediate callback until we've had a chance to return the unwatch function.\n        Promise.resolve().then(() => {\n          if (numCallbacks > 1) return;\n          callbackFn(newValue, oldValue);\n          // No need to digest since under Angular we'll be using $q as Promise.\n        });\n      } else {\n        callbackFn(newValue, oldValue);\n        angular.digest();\n      }\n    }, {immediate: true, deep: options && options.deep});\n\n    if (options && options.scope) options.scope.$on('$destroy', unwatch);\n    return unwatch;\n  }\n\n  when(expression, options) {\n    let cleanup, timeoutHandle;\n    let promise = new Promise((resolve, reject) => {\n      let unwatch = this.watch(expression, value => {\n        if (!value) return;\n        // Wait for computed properties to settle and double-check.\n        Vue.nextTick(() => {\n          value = expression();\n          if (!value) return;\n          resolve(value);\n          cleanup();\n        });\n      });\n      if (_.has(options, 'timeout')) {\n        timeoutHandle = setTimeout(() => {\n          timeoutHandle = null;\n          reject(new Error(options.timeoutMessage || 'Timeout'));\n          cleanup();\n        }, options.timeout);\n      }\n      cleanup = () => {\n        if (unwatch) {unwatch(); unwatch = null;}\n        if (timeoutHandle) {clearTimeout(timeoutHandle); timeoutHandle = null;}\n        reject(new Error('Canceled'));\n      };\n    });\n    promise = promiseCancel(promiseFinally(promise, cleanup), cleanup);\n    if (options && options.scope) options.scope.$on('$destroy', () => {promise.cancel();});\n    return promise;\n  }\n\n  nextTick() {\n    let cleanup;\n    let promise = new Promise((resolve, reject) => {\n      Vue.nextTick(resolve);\n      cleanup = () => {\n        reject(new Error('Canceled'));\n      };\n    });\n    promise = promiseCancel(promise, cleanup);\n    return promise;\n  }\n\n  checkObjectsForRogueProperties() {\n    this._tree.checkVueObject(this._tree.root, '/');\n  }\n\n  static get computedPropertyStats() {\n    return stats.list;\n  }\n\n  static logComputedPropertyStats(n = 10) {\n    return stats.log(n);\n  }\n\n  static connectWorker(webWorker) {\n    if (bridge) throw new Error('Worker already connected');\n    if (_.isString(webWorker)) {\n      const Worker = window.SharedWorker || window.Worker;\n      if (!Worker) throw new Error('Browser does not implement Web Workers');\n      webWorker = new Worker(webWorker);\n    }\n    bridge = new Bridge(webWorker);\n    if (logging) bridge.enableLogging(logging);\n    return bridge.init(webWorker).then(\n      ({exposedFunctionNames, firebaseSdkVersion}) => {\n        Object.defineProperty(Truss, 'FIREBASE_SDK_VERSION', {value: firebaseSdkVersion});\n        for (const name of exposedFunctionNames) {\n          Truss.worker[name] = bridge.bindExposedFunction(name);\n        }\n      }\n    );\n  }\n\n  static get worker() {return workerFunctions;}\n  static preExpose(functionName) {\n    Truss.worker[functionName] = bridge.bindExposedFunction(functionName);\n  }\n\n  static bounceConnection() {return bridge.bounceConnection();}\n  static suspend() {return bridge.suspend();}\n  static debugPermissionDeniedErrors(simulatedTokenGenerator, maxSimulationDuration, callFilter) {\n    return bridge.debugPermissionDeniedErrors(\n      simulatedTokenGenerator, maxSimulationDuration, callFilter);\n  }\n\n  static debounceAngularDigest(wait) {\n    angular.debounceDigest(wait);\n  }\n\n  static escapeKey(key) {return escapeKey(key);}\n  static unescapeKey(escapedKey) {return unescapeKey(escapedKey);}\n\n  static enableLogging(fn) {\n    logging = fn;\n    if (bridge) bridge.enableLogging(fn);\n  }\n\n  // Duplicate static constants on instance for convenience.\n  get SERVER_TIMESTAMP() {return Truss.SERVER_TIMESTAMP;}\n  get VERSION() {return Truss.VERSION;}\n  get FIREBASE_SDK_VERSION() {return Truss.FIREBASE_SDK_VERSION;}\n}\n\nObject.defineProperties(Truss, {\n  SERVER_TIMESTAMP: {value: SERVER_TIMESTAMP},\n  VERSION: {value: VERSION}\n});\n\nangular.defineModule(Truss);\n"]}