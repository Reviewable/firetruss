{"version":3,"sources":["../src/angularCompatibility.js","../src/utils.js","../src/Bridge.js","../src/Connector.js","../src/Modeler.js","../src/Tree.js","../src/Reference.js","../src/Dispatcher.js","../src/KeyGenerator.js","../src/MetaTree.js","../src/Coupler.js","../node_modules/performance-now/lib/performance-now.js","../src/Truss.js"],"names":["noop","escapeKey","key","toString","replace","char","charCodeAt","unescapeKey","code","String","fromCharCode","parseInt","slice","wrapPromiseCallback","callback","Promise","resolve","apply","this","arguments","e","reject","makePromiseCancelable","promise","cancel","promiseFinally","propagatePromiseProperty","propertyName","const","originalThen","then","originalCatch","catch","onResolved","onRejected","derivedPromise","call","onFinally","result","error","joinPath","segments","i","list","length","segment","charAt","splice","push","join","makePathMatcher","pattern","let","matcher","pathMatchers","PathMatcher","_","size","maxNumPathMatchers","keys","errorFromJson","json","params","Error","message","hasOwnProperty","extra","getUrlRoot","url","k","indexOf","flattenRefs","refs","Handle","mapValues","computeValue","prop","stats","$$touchThis","startTime","performanceNow","get","ErrorWrapper","runtime","numRecomputes","isTrussValueEqual","a","b","$truss","checkUpdateHasOnlyDescendantsWithNoOverlap","rootPath","values","relativizePaths","each","path","startsWith","absolutePath","allPaths","map","sortBy","value","otherPath","toFirebaseJson","object","earlyDigestPending","bareDigest","angularProxy","active","window","angular","debounceDigest","wait","digest","debounce","forEach","method","watch","module","run","$rootScope","$evalAsync","bind","$watch","defineModule","Truss","constant","SERVER_TIMESTAMP","Object","freeze",".sv","variables","prefixMatch","endsWith","pathTemplate","match","test","_regex","RegExp","_parentRegex","prototype","lastIndex","exec","bindings","testParent","MIN_WORKER_VERSION","Snapshot","ref","valueError","exists","_path","_value","_valueError","_exists","undefined","prototypeAccessors","_checkValue","_key","Bridge","webWorker","_idCounter","_deferreds","_suspended","_servers","_callbacks","_log","_simulatedTokenGenerator","_maxSimulationDuration","_simulatedCallFilter","_inboundMessages","_outboundMessages","_flushMessageQueue","_port","port","_shared","onmessage","_receive","addEventListener","_send","msg","setInterval","init","items","storage","localStorage","sessionStorage","getItem","response","workerVersion","version","minVersion","sufficient","suspend","suspended","_receiveMessages","debugPermissionDeniedErrors","simulatedTokenGenerator","maxSimulationDuration","callFilter","enableLogging","fn","console","log","id","oneWay","this$1","deferred","sent","resolveSent","postMessage","event","concat","data","messages","bindExposedFunction","name","args","Array","probeError","toLowerCase","_simulateCall","securityTrace","permissionDeniedDetails","props","simulatedCalls","spec","newValue","auth","getAuth","simulationPromise","uid","token","all","securityTraces","every","trace","filter","timeoutPromise","setTimeout","race","updateLocalStorage","item","removeItem","setItem","trackServer","rootUrl","server","authListeners","authCallbackId","_registerCallback","_authCallback","callbackId","listener","onAuth","context","offAuth","authWithCustomToken","authToken","options","unauth","set","writeSerial","update","on","listenerKey","eventType","snapshotCallback","cancelCallback","handle","_onCallback","__callbackIds","off","idsToDeregister","_findAndRemoveCallbackId","i$1","list$1","_nullifyCallback","_deregisterCallback","snapshotJson","transaction","oldValue","relativeUpdates","onDisconnect","bounceConnection","predicate","EMPTY_ANNOTATIONS","tree","annotations","_tree","_annotations","$ref","_pathPrefix","parent","Reference","child","children","escapedKeys","arg","isArray","mapping","subPath","rest","subRef","subMapping","isEmpty","peek","truss","isEqual","that","belongsTo","Query","super","_spec","_copyAndValidateSpec","prototypeAccessors$1","ready","isQueryReady","constraints","annotate","extend","by","JSON","stringify","some","clause","clone","childPath","_string","queryTerms","encodeURIComponent","prototypeAccessors$2","isReferenceReady","getObject","query","obj","override","commit","updateFunction","Connector","scope","connections","_scope","_connections","_method","_refs","_subConnectors","_currentDescriptors","_disconnects","_vue","Vue","_linkScopeProperties","descriptor","isFunction","_bindComputedConnection","_connect","$on","$id","destroy","at","_unlinkScopeProperties","_angularUnwatches","unwatch","_disconnect","$destroy","defineProperties","configurable","enumerable","getter","_computeConnection","_updateComputedConnection","immediate","deep","newDescriptor","oldDescriptor","has","_updateConnections","updateFn","_updateScopeRef","connectReference","_updateScopeQuery","connectQuery","subScope","subRefs","subConnector","subReady","$data","childKeys","changed","childKey","contains","delete","split","root","INTERCEPT_KEYS","EMPTY_ARRAY","SlowHandle","operation","delay","_operation","_delay","_callback","_fired","initiate","elapsed","Date","now","_startTimestamp","_timeoutId","clearTimeout","Operation","type","target","_type","_target","_ready","_running","_ended","_tries","_slowHandles","running","ended","tries","_error","onSlow","_setRunning","_setEnded","_markReady","_clearReady","_incrementTries","Dispatcher","bridge","_bridge","intercept","interceptKey","callbacks","badCallbackKeys","difference","wrappedCallbacks","onBefore","_addCallback","onAfter","onError","onFailure","_removeCallbacks","stage","_getCallbacksKey","wrappedCallback","_removeCallback","pull","_getCallbacks","operationType","execute","executor","createOperation","begin","executeWithRetries","_retryOrEnd","end","markReady","clearReady","retry","results","retrying","_afterEnd","onFailureCallbacks","ALPHABET","KeyGenerator","_lastUniqueKeyTime","_lastRandomValues","generateUniqueKey","chars","prefix","Math","floor","random","MetaTree","_rootUrl","$root","connected","timeOffset","user","userid","nowAtInterval","intervalMillis","angularCompatibility","_handleAuthChange","_connectInfoProperty","property","attribute","propertyUrl","snap","QueryHandler","coupler","_coupler","_query","_listeners","_keys","_url","_segments","_listening","attach","keysCallback","_listen","detach","findIndex","_handleSnapshot","_handleError","sync","_decoupleSegments","updatedKeys","_updateKeys","_applySnapshot","_dispatcher","sort","_coupleSegments","hasKey","Node","operations","queryCount","listening","count","listen","skip","op","unlisten","_forAllDescendants","node","isTrunkCoupled","iteratee","collectCoupledDescendantPaths","paths","Coupler","dispatcher","applySnapshot","prunePath","_prunePath","queryHandlers","_root","_queryHandlers","queryHandler","couple","superseded","decouple","ancestors","findCoupledDescendantPaths","subscribe","unsubscribe","pathOrSegments","isString","isSubtreeReady","creatingObjectProperties","getNanoSeconds","hrtime","loadTime","performance","exports","process","hr","getTime","RESERVED_VALUE_PROPERTY_NAMES","$parent","$key","$path","$$initializers","$$finalizers","__ob__","computedPropertyStats","Value","defineProperty","$refs","lastIndexOf","$keys","$values","$meta","meta","$now","$ready","$overridden","$intercept","actionType","unintercept","uninterceptAndRemoveFinalizer","$peek","subjectFn","callbackFn","unwatchAndRemoveFinalizer","$when","expression","when","$set","$update","$override","$commit","writable","ComputedPropertyStats","numUpdates","Modeler","classes","_mounts","uniq","Class","_mountClass","flatten","patterns","mount","badPaths","groupBy","group","compact","_augmentClass","computedProperties","proto","constructor","getOwnPropertyNames","getOwnPropertyDescriptor","fullName","getPrototypeOf","mounts","$trussMount","variable","escapedKey","placeholder","createObject","properties","_buildComputedPropertyDescriptor","writeAllowed","vue","destroyObject","isPlaceholder","forEachPlaceholderChild","checkVueObject","checkedObjects","find","includes","isObject","Function","trussCode","staticAccessors","Transaction","currentValue","outcome","_outcome","_values","_setOutcome","abort","","Tree","_truss","_firebasePropertyEditAllowed","_writeSerial","_localWrites","_localWriteTimestamp","_integrateSnapshot","_prune","_modeler","_createObject","_completeCreateObject","_plantPlaceholders","valueCallback","_checkHandle","_disconnectReference","_disconnected","_coupled","_disconnectQuery","numValues","_applyLocalWrite","_extractCommonPathPrefix","attemptTransaction","txn","committed","coupledDescendantPaths","offset","descendantPath","subValue","last","_plantValue","_scaffoldAncestors","prefixSegments","firstMismatchIndex","maxIndex","min","pathPrefix","_destroyObject","remoteWrite","dropRight","ancestorPath","_setFirebaseProperty","escapedChildKey","lockedDescendantPaths","_avoidLocalWritePaths","_pruneAncestors","_pruneDescendants","localWritePath","targetPath","targetObject","deleted","targetSegments","ghostObjects","_holdsConcreteData","_deleteFirebaseProperty","coupledDescendantFound","valueLocked","shouldDelete","_getFirebasePropertyDescriptor","_overwriteFirebaseProperty","logging","workerFunctions","VERSION","_keyGenerator","_metaTree","newKey","authenticate","rememberMe","unauthenticate","connect","cleanup","callbackPromise","connector","numCallbacks","timeoutHandle","timeoutMessage","timeout","checkObjectsForRogueProperties","connectWorker","Worker","SharedWorker","exposedFunctionNames","firebaseSdkVersion","worker","preExpose","functionName","debounceAngularDigest","FIREBASE_SDK_VERSION"],"mappings":"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","file":"firetruss.umd.min.js","sourcesContent":["/* globals window */\n\nimport _ from 'lodash';\n\n\nlet earlyDigestPending;\nlet bareDigest = function() {\n  earlyDigestPending = true;\n};\n\n\nconst angularProxy = {\n  active: typeof window !== 'undefined' && window.angular,\n  debounceDigest(wait) {\n    if (wait) {\n      angularProxy.digest = _.debounce(bareDigest, wait);\n    } else {\n      angularProxy.digest = bareDigest;\n    }\n  }\n};\n['digest', 'watch', 'defineModule'].forEach(method => {angularProxy[method] = noop;});\n\nif (angularProxy.active) {\n  angularProxy.digest = bareDigest;\n  angularProxy.watch = function() {throw new Error('Angular watch proxy not yet initialized');};\n  window.angular.module('firetruss', []).run(['$rootScope', function($rootScope) {\n    bareDigest = $rootScope.$evalAsync.bind($rootScope);\n    if (earlyDigestPending) bareDigest();\n    angularProxy.watch = $rootScope.$watch.bind($rootScope);\n  }]);\n  angularProxy.defineModule = function(Truss) {\n    window.angular.module('firetruss').constant('Truss', Truss);\n  };\n}\n\nfunction noop() {}\n\nexport default angularProxy;\n","import _ from 'lodash';\n\n\nexport const SERVER_TIMESTAMP = Object.freeze({'.sv': 'timestamp'});\n\nexport function escapeKey(key) {\n  if (!key) return key;\n  return key.toString().replace(/[\\\\\\.\\$\\#\\[\\]\\/]/g, function(char) {\n    return '\\\\' + char.charCodeAt(0).toString(16);\n  });\n}\n\nexport function unescapeKey(key) {\n  if (!key) return key;\n  return key.toString().replace(/\\\\[0-9a-f]{2}/gi, function(code) {\n    return String.fromCharCode(parseInt(code.slice(1), 16));\n  });\n}\n\nexport function wrapPromiseCallback(callback) {\n  return function() {\n    try {\n      return Promise.resolve(callback.apply(this, arguments));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n}\n\nexport function makePromiseCancelable(promise, cancel) {\n  promise = promiseFinally(promise, () => {cancel = null;});\n  promise.cancel = () => {\n    if (!cancel) return;\n    cancel();\n    cancel = null;\n  };\n  propagatePromiseProperty(promise, 'cancel');\n  return promise;\n}\n\nfunction propagatePromiseProperty(promise, propertyName) {\n  const originalThen = promise.then, originalCatch = promise.catch;\n  promise.then = (onResolved, onRejected) => {\n    const derivedPromise = originalThen.call(promise, onResolved, onRejected);\n    derivedPromise[propertyName] = promise[propertyName];\n    propagatePromiseProperty(derivedPromise, propertyName);\n  };\n  promise.catch = onRejected => {\n    const derivedPromise = originalCatch.call(promise, onRejected);\n    derivedPromise[propertyName] = promise[propertyName];\n    propagatePromiseProperty(derivedPromise, propertyName);\n  };\n  return promise;\n}\n\nexport function promiseFinally(promise, onFinally) {\n  if (!onFinally) return promise;\n  onFinally = wrapPromiseCallback(onFinally);\n  return promise.then(result => {\n    return onFinally().then(() => result);\n  }, error => {\n    return onFinally().then(() => Promise.reject(error));\n  });\n}\n\nexport function joinPath() {\n  const segments = [];\n  for (const segment of arguments) {\n    if (segment.charAt(0) === '/') segments.splice(0, segments.length);\n    segments.push(segment);\n  }\n  if (segments[0] === '/') segments[0] = '';\n  return segments.join('/');\n}\n\n\nconst pathMatchers = {};\nconst maxNumPathMatchers = 1000;\n\n\nclass PathMatcher {\n  constructor(pattern) {\n    this.variables = [];\n    const prefixMatch = _.endsWith(pattern, '/$*');\n    if (prefixMatch) pattern = pattern.slice(0, -3);\n    const pathTemplate = pattern.replace(/\\/\\$[^\\/]*/g, match => {\n      if (match.length > 1) this.variables.push(match.slice(1));\n      return '\\u0001';\n    });\n    Object.freeze(this.variables);\n    if (/[$-.?[-^{|}]/.test(pathTemplate)) {\n      throw new Error('Path pattern has unescaped keys: ' + pattern);\n    }\n    this._regex = new RegExp(\n      '^' + pathTemplate.replace(/\\u0001/g, '/([^/]+)') + (prefixMatch ? '($|/)' : '$'));\n    this._parentRegex = new RegExp(\n      '^' + (pathTemplate.replace(/\\/[^/]*$/, '').replace(/\\u0001/g, '/([^/]+)') || '/') + '$');\n  }\n\n  match(path) {\n    this._regex.lastIndex = 0;\n    const match = this._regex.exec(path);\n    if (!match) return;\n    const bindings = {};\n    for (let i = 0; i < this.variables.length; i++) {\n      bindings[this.variables[i]] = unescapeKey(match[i + 1]);\n    }\n    return bindings;\n  }\n\n  test(path) {\n    return this._regex.test(path);\n  }\n\n  testParent(path) {\n    return this._parentRegex.test(path);\n  }\n\n  toString() {\n    return this._regex.toString();\n  }\n}\n\n\nexport function makePathMatcher(pattern) {\n  let matcher = pathMatchers[pattern];\n  if (!matcher) {\n    matcher = new PathMatcher(pattern);\n    // Minimal pseudo-LRU behavior, since we don't expect to actually fill up the cache.\n    if (_.size(pathMatchers) === maxNumPathMatchers) delete pathMatchers[_.keys(pathMatchers)[0]];\n    pathMatchers[pattern] = matcher;\n  }\n  return matcher;\n}\n","import {unescapeKey} from './utils.js';\nimport _ from 'lodash';\n\n// jshint browser:true\n\nconst MIN_WORKER_VERSION = '0.4.0';\n\n\nclass Snapshot {\n  constructor({path, value, valueError, exists}) {\n    this._path = path;\n    this._value = value;\n    this._valueError = errorFromJson(valueError);\n    this._exists = value === undefined ? exists || false : value !== null;\n  }\n\n  get path() {\n    return this._path;\n  }\n\n  get exists() {\n    return this._exists;\n  }\n\n  get value() {\n    this._checkValue();\n    return this._value;\n  }\n\n  get key() {\n    if (this._key === undefined) this._key = unescapeKey(this._path.replace(/.*\\//, ''));\n    return this._key;\n  }\n\n  _checkValue() {\n    if (this._valueError) throw this._valueError;\n    if (this._value === undefined) throw new Error('Value omitted from snapshot');\n  }\n}\n\n\nexport default class Bridge {\n  constructor(webWorker) {\n    this._idCounter = 0;\n    this._deferreds = {};\n    this._suspended = false;\n    this._servers = {};\n    this._callbacks = {};\n    this._log = _.noop;\n    this._simulatedTokenGenerator = null;\n    this._maxSimulationDuration = 5000;\n    this._simulatedCallFilter = null;\n    this._inboundMessages = [];\n    this._outboundMessages = [];\n    this._flushMessageQueue = this._flushMessageQueue.bind(this);\n    this._port = webWorker.port || webWorker;\n    this._shared = !!webWorker.port;\n    this._port.onmessage = this._receive.bind(this);\n    window.addEventListener('unload', () => {this._send({msg: 'destroy'});});\n    setInterval(() => {this._send({msg: 'ping'});}, 60 * 1000);\n  }\n\n  init(webWorker) {\n    const items = [];\n    try {\n      const storage = window.localStorage || window.sessionStorage;\n      if (!storage) return;\n      for (let i = 0; i < storage.length; i++) {\n        const key = storage.key(i);\n        items.push({key, value: storage.getItem(key)});\n      }\n    } catch (e) {\n      // Some browsers don't like us accessing local storage -- nothing we can do.\n    }\n    return this._send({msg: 'init', storage: items}).then(response => {\n      const workerVersion = response.version.match(/^(\\d+)\\.(\\d+)\\.(\\d+)(-.*)?$/);\n      if (workerVersion) {\n        const minVersion = MIN_WORKER_VERSION.match(/^(\\d+)\\.(\\d+)\\.(\\d+)(-.*)?$/);\n        // Major version must match precisely, minor and patch must be greater than or equal.\n        const sufficient = workerVersion[1] === minVersion[1] && (\n          workerVersion[2] > minVersion[2] ||\n          workerVersion[2] === minVersion[2] && workerVersion[3] >= minVersion[3]\n        );\n        if (!sufficient) return Promise.reject(new Error(\n          `Incompatible Firetruss worker version: ${response.version} ` +\n          `(${MIN_WORKER_VERSION} or better required)`\n        ));\n      }\n      return response;\n    });\n  }\n\n  suspend(suspended) {\n    if (suspended === undefined) suspended = true;\n    if (this._suspended === suspended) return;\n    this._suspended = suspended;\n    if (!suspended) {\n      this._receiveMessages(this._inboundMessages);\n      this._inboundMessages = [];\n      if (this._outboundMessages.length) Promise.resolve().then(this._flushMessageQueue);\n    }\n  }\n\n  debugPermissionDeniedErrors(simulatedTokenGenerator, maxSimulationDuration, callFilter) {\n    this._simulatedTokenGenerator = simulatedTokenGenerator;\n    if (maxSimulationDuration !== undefined) this._maxSimulationDuration = maxSimulationDuration;\n    this._simulatedCallFilter = callFilter || function() {return true;};\n  }\n\n  enableLogging(fn) {\n    if (fn) {\n      if (fn === true) fn = console.log.bind(console);\n      this._log = fn;\n    } else {\n      this._log = _.noop;\n    }\n  }\n\n  _send(message) {\n    message.id = ++this._idCounter;\n    let promise;\n    if (message.oneWay) {\n      promise = Promise.resolve();\n    } else {\n      promise = new Promise((resolve, reject) => {\n        this._deferreds[message.id] = {resolve, reject};\n      });\n      const deferred = this._deferreds[message.id];\n      deferred.promise = promise;\n      promise.sent = new Promise(resolve => {\n        deferred.resolveSent = resolve;\n      });\n      deferred.params = message;\n    }\n    if (!this._outboundMessages.length && !this._suspended) {\n      Promise.resolve().then(this._flushMessageQueue);\n    }\n    this._log('send:', message);\n    this._outboundMessages.push(message);\n    return promise;\n  }\n\n  _flushMessageQueue() {\n    this._port.postMessage(this._outboundMessages);\n    this._outboundMessages = [];\n  }\n\n  _receive(event) {\n    if (this._suspended) {\n      this._inboundMessages = this._inboundMessages.concat(event.data);\n    } else {\n      this._receiveMessages(event.data);\n    }\n  }\n\n  _receiveMessages(messages) {\n    for (const message of messages) {\n      this._log('recv:', message);\n      const fn = this[message.msg];\n      if (typeof fn !== 'function') throw new Error('Unknown message: ' + message.msg);\n      fn.call(this, message);\n    }\n  }\n\n  bindExposedFunction(name) {\n    return (function() {\n      return this._send({msg: 'call', name, args: Array.prototype.slice.call(arguments)});\n    }).bind(this);\n  }\n\n  resolve(message) {\n    const deferred = this._deferreds[message.id];\n    if (!deferred) throw new Error('Received resolution to inexistent Firebase call');\n    delete this._deferreds[message.id];\n    deferred.resolve(message.result);\n  }\n\n  reject(message) {\n    const deferred = this._deferreds[message.id];\n    if (!deferred) throw new Error('Received rejection of inexistent Firebase call');\n    delete this._deferreds[message.id];\n    deferred.reject(errorFromJson(message.error, deferred.params));\n  }\n\n  probeError(error) {\n    const code = error.code || error.message;\n    if (error.params && code && code.toLowerCase() === 'permission_denied') {\n      return this._simulateCall(error.params).then(securityTrace => {\n        if (securityTrace) error.permissionDeniedDetails = securityTrace;\n      });\n    } else {\n      return Promise.resolve();\n    }\n  }\n\n  _simulateCall(props) {\n    if (!(this._simulatedTokenGenerator && this._maxSimulationDuration > 0)) {\n      return Promise.resolve();\n    }\n    let simulatedCalls = [];\n    switch (props.msg) {\n      case 'set':\n        simulatedCalls.push({method: 'set', url: props.url, args: [props.value]});\n        break;\n      case 'update':\n        simulatedCalls.push({method: 'update', url: props.url, args: [props.value]});\n        break;\n      case 'on':\n        simulatedCalls.push({method: 'once', url: props.url, spec: props.spec, args: ['value']});\n        break;\n      case 'transaction':\n        simulatedCalls.push({method: 'once', url: props.url, args: ['value']});\n        simulatedCalls.push({method: 'set', url: props.url, args: [props.newValue]});\n        break;\n    }\n    if (!simulatedCalls.length || !this._simulatedCallFilter(props.msg, props.url)) {\n      return Promise.resolve();\n    }\n    const auth = this.getAuth(getUrlRoot(props.url));\n    const simulationPromise = this._simulatedTokenGenerator(auth && auth.uid).then(token => {\n      return Promise.all(simulatedCalls.map(message => {\n        message.msg = 'simulate';\n        message.token = token;\n        return this._send(message);\n      }));\n    }).then(securityTraces => {\n      if (securityTraces.every(trace => trace === null)) {\n        return 'Unable to reproduce error in simulation';\n      }\n      return securityTraces.filter(trace => trace).join('\\n\\n');\n    }).catch(e => {\n      return 'Error running simulation: ' + e;\n    });\n    const timeoutPromise = new Promise(resolve => {\n      setTimeout(resolve.bind(null, 'Simulated call timed out'), this._maxSimulationDuration);\n    });\n    return Promise.race([simulationPromise, timeoutPromise]);\n  }\n\n  updateLocalStorage(items) {\n    try {\n      const storage = window.localStorage || window.sessionStorage;\n      for (const item in items) {\n        if (item.value === null) {\n          storage.removeItem(item.key);\n        } else {\n          storage.setItem(item.key, item.value);\n        }\n      }\n    } catch (e) {\n      // If we're denied access, there's nothing we can do.\n    }\n  }\n\n  trackServer(rootUrl) {\n    if (this._servers.hasOwnProperty(rootUrl)) return;\n    const server = this._servers[rootUrl] = {authListeners: []};\n    const authCallbackId = this._registerCallback(this._authCallback.bind(this, server));\n    this._send({msg: 'onAuth', url: rootUrl, callbackId: authCallbackId});\n  }\n\n  _authCallback(server, auth) {\n    server.auth = auth;\n    for (const listener of server.authListeners) listener(auth);\n  }\n\n  onAuth(rootUrl, callback, context) {\n    const listener = callback.bind(context);\n    listener.callback = callback;\n    listener.context = context;\n    this._servers[rootUrl].authListeners.push(listener);\n    listener(this.getAuth(rootUrl));\n  }\n\n  offAuth(rootUrl, callback, context) {\n    const authListeners = this._servers[rootUrl].authListeners;\n    for (let i = 0; i < authListeners.length; i++) {\n      const listener = authListeners[i];\n      if (listener.callback === callback && listener.context === context) {\n        authListeners.splice(i, 1);\n        break;\n      }\n    }\n  }\n\n  getAuth(rootUrl) {\n    return this._servers[rootUrl].auth;\n  }\n\n  authWithCustomToken(url, authToken, options) {\n    return this._send({msg: 'authWithCustomToken', url, authToken, options});\n  }\n\n  unauth(url) {\n    return this._send({msg: 'unauth', url});\n  }\n\n  set(url, value, writeSerial) {return this._send({msg: 'set', url, value, writeSerial});}\n  update(url, value, writeSerial) {return this._send({msg: 'update', url, value, writeSerial});}\n\n  on(listenerKey, url, spec, eventType, snapshotCallback, cancelCallback, context, options) {\n    const handle = {\n      listenerKey, eventType, snapshotCallback, cancelCallback, context,\n      params: {msg: 'on', listenerKey, url, spec, eventType, options}\n    };\n    const callback = this._onCallback.bind(this, handle);\n    this._registerCallback(callback, handle);\n    // Keep multiple IDs to allow the same snapshotCallback to be reused.\n    snapshotCallback.__callbackIds = snapshotCallback.__callbackIds || [];\n    snapshotCallback.__callbackIds.push(handle.id);\n    this._send({\n      msg: 'on', listenerKey, url, spec, eventType, callbackId: handle.id, options\n    }).catch(error => {\n      callback(error);\n    });\n  }\n\n  off(listenerKey, url, spec, eventType, snapshotCallback, context) {\n    const idsToDeregister = [];\n    let callbackId;\n    if (snapshotCallback) {\n      callbackId = this._findAndRemoveCallbackId(\n        snapshotCallback,\n        handle =>\n          handle.listenerKey === listenerKey && handle.eventType === eventType &&\n          handle.context === context\n      );\n      if (!callbackId) return Promise.resolve();  // no-op, never registered or already deregistered\n      idsToDeregister.push(callbackId);\n    } else {\n      for (const id of Object.keys(this._callbacks)) {\n        const handle = this._callbacks[id];\n        if (handle.listenerKey === listenerKey && (!eventType || handle.eventType === eventType)) {\n          idsToDeregister.push(id);\n        }\n      }\n    }\n    // Nullify callbacks first, then deregister after off() is complete.  We don't want any\n    // callbacks in flight from the worker to be invoked while the off() is processing, but we don't\n    // want them to throw an exception either.\n    for (const id of idsToDeregister) this._nullifyCallback(id);\n    return this._send({msg: 'off', listenerKey, url, spec, eventType, callbackId}).then(() => {\n      for (const id of idsToDeregister) this._deregisterCallback(id);\n    });\n  }\n\n  _onCallback(handle, error, snapshotJson) {\n    if (error) {\n      this._deregisterCallback(handle.id);\n      const e = errorFromJson(error, handle.params);\n      if (handle.cancelCallback) {\n        handle.cancelCallback.call(handle.context, e);\n      } else {\n        console.error(e);\n      }\n    } else {\n      handle.snapshotCallback.call(handle.context, new Snapshot(snapshotJson));\n    }\n  }\n\n  transaction(url, oldValue, relativeUpdates) {\n    return this._send({msg: 'transaction', url, oldValue, relativeUpdates});\n  }\n\n  onDisconnect(url, method, value) {\n    return this._send({msg: 'onDisconnect', url, method, value});\n  }\n\n  bounceConnection() {\n    return this._send({msg: 'bounceConnection'});\n  }\n\n  callback({id, args}) {\n    const handle = this._callbacks[id];\n    if (!handle) throw new Error('Unregistered callback: ' + id);\n    handle.callback.apply(null, args);\n  }\n\n  _registerCallback(callback, handle) {\n    handle = handle || {};\n    handle.callback = callback;\n    handle.id = `cb${++this._idCounter}`;\n    this._callbacks[handle.id] = handle;\n    return handle.id;\n  }\n\n  _nullifyCallback(id) {\n    this._callbacks[id].callback = noop;\n  }\n\n  _deregisterCallback(id) {\n    delete this._callbacks[id];\n  }\n\n  _findAndRemoveCallbackId(callback, predicate) {\n    if (!callback.__callbackIds) return;\n    let i = 0;\n    while (i < callback.__callbackIds.length) {\n      const id = callback.__callbackIds[i];\n      const handle = this._callbacks[id];\n      if (!handle) {\n        callback.__callbackIds.splice(i, 1);\n        continue;\n      }\n      if (predicate(handle)) {\n        callback.__callbackIds.splice(i, 1);\n        return id;\n      }\n      i += 1;\n    }\n  }\n}\n\n\nfunction noop() {}\n\nfunction errorFromJson(json, params) {\n  if (!json || json instanceof Error) return json;\n  const error = new Error(json.message);\n  error.params = params;\n  for (const propertyName in json) {\n    if (propertyName === 'message' || !json.hasOwnProperty(propertyName)) continue;\n    try {\n      error[propertyName] = json[propertyName];\n    } catch (e) {\n      e.extra = {propertyName};\n      throw e;\n    }\n  }\n  return error;\n}\n\nfunction getUrlRoot(url) {\n  const k = url.indexOf('/', 8);\n  return k >= 8 ? url.slice(0, k) : url;\n}\n","import {Handle, Query, Reference} from './Reference.js';\nimport angular from './angularCompatibility.js';\n\nimport _ from 'lodash';\nimport Vue from 'vue';\n\n\nexport default class Connector {\n  constructor(scope, connections, tree, method, refs) {\n    Object.freeze(connections);\n    this._scope = scope;\n    this._connections = connections;\n    this._tree = tree;\n    this._method = method;\n    this._refs = refs || {};\n    this._subConnectors = {};\n    this._currentDescriptors = {};\n    this._disconnects = {};\n    this._vue = new Vue({data: _.mapValues(connections, _.constant(undefined))});\n\n    this._linkScopeProperties();\n\n    _.each(connections, (descriptor, key) => {\n      if (_.isFunction(descriptor)) {\n        this._bindComputedConnection(key, descriptor);\n      } else {\n        this._connect(key, descriptor);\n      }\n    });\n\n    if (angular.active && scope && scope.$on && scope.$id) {\n      scope.$on('$destroy', () => {this.destroy();});\n    }\n  }\n\n  get ready() {\n    return _.every(this._currentDescriptors, (descriptor, key) => {\n      if (!descriptor) return false;\n      if (descriptor instanceof Handle) return descriptor.ready;\n      return this._subConnectors[key].ready;\n    });\n  }\n\n  get at() {\n    return this._refs;\n  }\n\n  destroy() {\n    this._unlinkScopeProperties();\n    _.each(this._angularUnwatches, unwatch => {unwatch();});\n    _.each(this._connections, (descriptor, key) => {this._disconnect(key);});\n    this._vue.$destroy();\n  }\n\n  _linkScopeProperties() {\n    if (!this._scope) return;\n    for (const key in this._connections) {\n      if (key in this._scope) {\n        throw new Error(`Property already defined on connection target: ${key}`);\n      }\n    }\n    Object.defineProperties(this._scope, _.mapValues(this._connections, (descriptor, key) => ({\n      configurable: true, enumerable: true, get: () => this._vue[key]\n    })));\n  }\n\n  _unlinkScopeProperties() {\n    if (!this._scope) return;\n    _.each(this._connections, (descriptor, key) => {\n      delete this._scope[key];\n    });\n  }\n\n  _bindComputedConnection(key, fn) {\n    const getter = this._computeConnection.bind(this, fn);\n    const update = this._updateComputedConnection.bind(this, key, fn);\n    // Use this._vue.$watch instead of truss.watch here so that we can disable the immediate\n    // callback if we'll get one from Angular anyway.\n    this._vue.$watch(getter, update, {immediate: !angular.active, deep: true});\n    if (angular.active) {\n      if (!this._angularUnwatches) this._angularUnwatches = [];\n      this._angularUnwatches.push(angular.watch(getter, update, true));\n    }\n  }\n\n  _computeConnection(fn) {\n    return flattenRefs(fn.call(this._scope));\n  }\n\n  _updateComputedConnection(key, value) {\n    const newDescriptor = _.isFunction(value) ? value(this._scope) : value;\n    const oldDescriptor = this._currentDescriptors[key];\n    if (oldDescriptor === newDescriptor ||\n        newDescriptor instanceof Handle && newDescriptor.isEqual(oldDescriptor)) return;\n    if (!newDescriptor) {\n      this._disconnect(key);\n      return;\n    }\n    if (newDescriptor instanceof Handle || !_.has(this._subConnectors, key)) {\n      this._disconnect(key);\n      this._connect(key, newDescriptor);\n    } else {\n      this._subConnectors[key]._updateConnections(newDescriptor);\n    }\n    this._currentDescriptors[key] = newDescriptor;\n  }\n\n  _updateConnections(connections) {\n    _.each(connections, (descriptor, key) => {\n      this._updateComputedConnection(key, descriptor);\n    });\n    _.each(this._connections, (descriptor, key) => {\n      if (!_.has(connections, key)) this._updateComputedConnection(key);\n    });\n    this._connections = connections;\n  }\n\n  _connect(key, descriptor) {\n    this._currentDescriptors[key] = descriptor;\n    if (!descriptor) return;\n    if (descriptor instanceof Reference) {\n      this._refs[key] = descriptor;\n      const updateFn = this._scope ? this._updateScopeRef.bind(this, key) : null;\n      this._disconnects[key] = this._tree.connectReference(descriptor, updateFn, this._method);\n    } else if (descriptor instanceof Query) {\n      this._refs[key] = descriptor;\n      const updateFn = this._scope ? this._updateScopeQuery.bind(this, key) : null;\n      this._disconnects[key] = this._tree.connectQuery(descriptor, updateFn, this._method);\n    } else {\n      const subScope = {}, subRefs = {};\n      this._refs[key] = subRefs;\n      const subConnector = this._subConnectors[key] =\n        new Connector(subScope, descriptor, this._tree, this._method, subRefs);\n      if (this._scope) {\n        // Use a truss.watch here instead of this._vue.$watch so that the \"immediate\" execution\n        // actually takes place after we've captured the unwatch function, in case the subConnector\n        // is ready immediately.\n        const unwatch = this._disconnects[key] = this._tree.truss.watch(\n          () => subConnector.ready,\n          subReady => {\n            if (!subReady) return;\n            unwatch();\n            delete this._disconnects[key];\n            Vue.set(this._vue.$data, key, subScope);\n            angular.digest();\n          }\n        );\n      }\n    }\n  }\n\n  _disconnect(key) {\n    delete this._refs[key];\n    if (this._scope) this._updateScopeRef(key, undefined);\n    if (_.has(this._subConnectors, key)) {\n      this._subConnectors[key].destroy();\n      delete this._subConnectors[key];\n    }\n    if (this._disconnects[key]) this._disconnects[key]();\n    delete this._disconnects[key];\n    delete this._currentDescriptors[key];\n  }\n\n  _updateScopeRef(key, value) {\n    if (this._vue[key] !== value) {\n      Vue.set(this._vue.$data, key, value);\n      angular.digest();\n    }\n  }\n\n  _updateScopeQuery(key, childKeys) {\n    let changed = false;\n    if (!this._vue[key]) {\n      Vue.set(this._vue.$data, key, {});\n      changed = true;\n    }\n    const subScope = this._vue[key];\n    for (const childKey in subScope) {\n      if (!subScope.hasOwnProperty(childKey)) continue;\n      if (!_.contains(childKeys, childKey)) {\n        Vue.delete(subScope, childKey);\n        changed = true;\n      }\n    }\n    let object;\n    for (const segment of this._currentDescriptors[key].path.split('/')) {\n      object = segment ? object[segment] : this._tree.root;\n    }\n    for (const childKey of childKeys) {\n      if (subScope.hasOwnProperty(childKey)) continue;\n      Vue.set(subScope, childKey, object[childKey]);\n      changed = true;\n    }\n    if (changed) angular.digest();\n  }\n\n}\n\nfunction flattenRefs(refs) {\n  if (!refs) return;\n  if (refs instanceof Handle) return refs.toString();\n  return _.mapValues(refs, flattenRefs);\n}\n\n","import Reference from './Reference.js';\nimport Connector from './Connector.js';\nimport {makePathMatcher, joinPath, escapeKey, unescapeKey, promiseFinally} from './utils.js';\n\nimport _ from 'lodash';\nimport performanceNow from 'performance-now';\n\n// These are defined separately for each object so they're not included in Value below.\nconst RESERVED_VALUE_PROPERTY_NAMES = {\n  $truss: true, $parent: true, $key: true, $path: true, $ref: true,\n  $$touchThis: true, $$initializers: true, $$finalizers: true,\n  __ob__: true\n};\n\nconst computedPropertyStats = {};\n\n// Holds properties that we're going to set on a model object that's being created right now as soon\n// as it's been created, but that we'd like to be accessible in the constructor.  The object\n// prototype's getters will pick those up until they get overridden in the instance.\nlet creatingObjectProperties;\n\n\nclass Value {\n  get $parent() {return creatingObjectProperties.$parent.value;}\n  get $path() {return creatingObjectProperties.$path.value;}\n  get $truss() {\n    Object.defineProperty(this, '$truss', {value: this.$parent.$truss});\n    return this.$truss;\n  }\n  get $ref() {\n    Object.defineProperty(this, '$ref', {value: new Reference(this.$truss._tree, this.$path)});\n    return this.$ref;\n  }\n  get $refs() {return this.$ref;}\n  get $key() {\n    Object.defineProperty(\n      this, '$key', {value: unescapeKey(this.$path.slice(this.$path.lastIndexOf('/') + 1))});\n    return this.$key;\n  }\n  get $keys() {return _.keys(this);}\n  get $values() {return _.values(this);}\n  get $meta() {return this.$truss.meta;}\n  get $root() {return this.$truss.root;}  // access indirectly to leave dependency trace\n  get $now() {return this.$truss.now;}\n  get $ready() {return this.$ref.ready;}\n  get $overridden() {return false;}\n\n  $intercept(actionType, callbacks) {\n    const unintercept = this.$truss.intercept(actionType, callbacks);\n    const uninterceptAndRemoveFinalizer = () => {\n      unintercept();\n      _.pull(this.$$finalizers, uninterceptAndRemoveFinalizer);\n    };\n    this.$$finalizers.push(uninterceptAndRemoveFinalizer);\n    return uninterceptAndRemoveFinalizer;\n  }\n\n  $peek(target, callback) {\n    const promise = promiseFinally(\n      this.$truss.peek(target, callback), () => {_.pull(this.$$finalizers, promise.cancel);}\n    );\n    this.$$finalizers.push(promise.cancel);\n    return promise;\n  }\n\n  $watch(subjectFn, callbackFn, options) {\n    let unwatchAndRemoveFinalizer;\n\n    const unwatch = this.$truss.watch(() => {\n      this.$$touchThis();\n      return subjectFn.call(this);\n    }, callbackFn.bind(this), options);\n\n    unwatchAndRemoveFinalizer = () => {\n      unwatch();\n      _.pull(this.$$finalizers, unwatchAndRemoveFinalizer);\n    };\n    this.$$finalizers.push(unwatchAndRemoveFinalizer);\n    return unwatchAndRemoveFinalizer;\n  }\n\n  $when(expression, options) {\n    const promise = promiseFinally(this.$truss.when(() => {\n      this.$$touchThis();\n      return expression.call(this);\n    }, options), () => {_.pull(this.$$finalizers, promise.cancel);});\n    this.$$finalizers.push(promise.cancel);\n    return promise;\n  }\n\n  $set(value) {return this.$ref.set(value);}\n  $update(values) {return this.$ref.update(values);}\n  $override(values) {return this.$ref.override(values);}\n  $commit(options, updateFn) {return this.$ref.commit(options, updateFn);}\n\n  $$touchThis() {\n    // jshint expr:true\n    if (this.$parent) this.$parent[this.$key]; else this.$root;\n    // jshint expr:false\n  }\n\n  get $$finalizers() {\n    Object.defineProperty(this, '$$finalizers', {\n      value: [], writable: false, enumerable: false, configurable: false});\n    return this.$$finalizers;\n  }\n}\n\nclass ComputedPropertyStats {\n  constructor(name) {\n    _.extend(this, {name, numRecomputes: 0, numUpdates: 0, runtime: 0});\n  }\n}\n\nclass ErrorWrapper {\n  constructor(error) {\n    this.error = error;\n  }\n}\n\n\nexport default class Modeler {\n  constructor(classes) {\n    this._mounts = _(classes).uniq().map(Class => this._mountClass(Class)).flatten().value();\n    const patterns = _.map(this._mounts, mount => mount.matcher.toString());\n    if (patterns.length !== _.uniq(patterns).length) {\n      const badPaths = _(patterns)\n        .groupBy()\n        .map((group, key) =>\n          group.length === 1 ? null : key.replace(/\\(\\[\\^\\/\\]\\+\\)/g, '$').slice(1, -1))\n        .compact()\n        .value();\n      throw new Error('Paths have multiple mounted classes: ' + badPaths.join(', '));\n    }\n  }\n\n  destroy() {\n  }\n\n  _augmentClass(Class) {\n    let computedProperties;\n    let proto = Class.prototype;\n    while (proto && proto.constructor !== Object) {\n      for (const name of Object.getOwnPropertyNames(proto)) {\n        const descriptor = Object.getOwnPropertyDescriptor(proto, name);\n        if (name.charAt(0) === '$') {\n          if (_.isEqual(descriptor, Object.getOwnPropertyDescriptor(Value.prototype, name))) {\n            continue;\n          }\n          throw new Error(`Property names starting with \"$\" are reserved: ${Class.name}.${name}`);\n        }\n        if (descriptor.set) {\n          throw new Error(`Computed properties must not have a setter: ${Class.name}.${name}`);\n        }\n        if (descriptor.get && !(computedProperties && computedProperties[name])) {\n          (computedProperties || (computedProperties = {}))[name] = {\n            name, fullName: `${proto.constructor.name}.${name}`, get: descriptor.get\n          };\n        }\n      }\n      proto = Object.getPrototypeOf(proto);\n    }\n    for (const name of Object.getOwnPropertyNames(Value.prototype)) {\n      if (name === 'constructor' || Class.prototype.hasOwnProperty(name)) continue;\n      Object.defineProperty(\n        Class.prototype, name, Object.getOwnPropertyDescriptor(Value.prototype, name));\n    }\n    return computedProperties;\n  }\n\n  _mountClass(Class) {\n    const computedProperties = this._augmentClass(Class);\n    let mounts = Class.$trussMount;\n    if (!mounts) throw new Error(`Class ${Class.name} lacks a $trussMount static property`);\n    if (!_.isArray(mounts)) mounts = [mounts];\n    return _.map(mounts, mount => {\n      if (_.isString(mount)) mount = {path: mount};\n      const matcher = makePathMatcher(mount.path);\n      for (const variable of matcher.variables) {\n        if (variable === '$' || variable.charAt(1) === '$') {\n          throw new Error(`Invalid variable name: ${variable}`);\n        }\n        if (variable.charAt(0) === '$' && (\n            _.has(Value.prototype, variable) || RESERVED_VALUE_PROPERTY_NAMES[variable]\n        )) {\n          throw new Error(`Variable name conflicts with built-in property or method: ${variable}`);\n        }\n      }\n      const escapedKey = mount.path.match(/\\/([^/]*)$/)[1];\n      if (mount.placeholder && escapedKey.charAt(0) === '$') {\n        throw new Error(\n          `Class ${Class.name} mounted at wildcard ${escapedKey} cannot be a placeholder`);\n      }\n      return {Class, matcher, computedProperties, escapedKey, placeholder: mount.placeholder};\n    });\n  }\n\n  /**\n   * Creates a Truss object and sets all its basic properties: path segment variables, user-defined\n   * properties, and computed properties.  The latter two will be enumerable so that Vue will pick\n   * them up and make the reactive, so you should call _completeCreateObject once it's done so and\n   * before any Firebase properties are added.\n   */\n  createObject(path, properties) {\n    let Class = Value;\n    let computedProperties;\n    for (const mount of this._mounts) {\n      const match = mount.matcher.match(path);\n      if (match) {\n        Class = mount.Class;\n        computedProperties = mount.computedProperties;\n        for (const variable in match) {\n          properties[variable] = {\n            value: match[variable], writable: false, configurable: false, enumerable: false\n          };\n        }\n        break;\n      }\n    }\n\n    creatingObjectProperties = properties;\n    const object = new Class();\n    creatingObjectProperties = null;\n\n    if (computedProperties) {\n      _.each(computedProperties, prop => {\n        properties[prop.name] = this._buildComputedPropertyDescriptor(object, prop);\n      });\n    }\n\n    return object;\n  }\n\n  _buildComputedPropertyDescriptor(object, prop) {\n    if (!computedPropertyStats[prop.fullName]) {\n      Object.defineProperty(computedPropertyStats, prop.fullName, {\n        value: new ComputedPropertyStats(prop.fullName), writable: false, enumerable: true,\n        configurable: false\n      });\n    }\n    const stats = computedPropertyStats[prop.fullName];\n\n    let value;\n    let writeAllowed = false;\n\n    if (!object.$$initializers) {\n      Object.defineProperty(object, '$$initializers', {\n        value: [], writable: false, enumerable: false, configurable: true});\n    }\n    object.$$initializers.push(vue => {\n      object.$$finalizers.push(\n        vue.$watch(computeValue.bind(object, prop, stats), newValue => {\n          if (_.isEqual(value, newValue, isTrussValueEqual)) return;\n          stats.numUpdates += 1;\n          writeAllowed = true;\n          object[prop.name] = newValue;\n          writeAllowed = false;\n        }, {immediate: true})  // use immediate:true since watcher will run computeValue anyway\n      );\n    });\n    return {\n      enumerable: true, configurable: true,\n      get: function() {\n        if (value instanceof ErrorWrapper) throw value.error;\n        return value;\n      },\n      set: function(newValue) {\n        if (!writeAllowed) throw new Error(`You cannot set a computed property: ${prop.name}`);\n        value = newValue;\n      }\n    };\n  }\n\n  destroyObject(object) {\n    if (_.has(object, '$$finalizers')) {\n      // Some destructors remove themselves from the array, so clone it before iterating.\n      for (const fn of _.clone(object.$$finalizers)) fn();\n    }\n  }\n\n  isPlaceholder(path) {\n    // TODO: optimize by precomputing a single all-placeholder-paths regex\n    return _.some(this._mounts, mount => mount.placeholder && mount.matcher.test(path));\n  }\n\n  forEachPlaceholderChild(path, iteratee) {\n    _.each(this._mounts, mount => {\n      if (mount.placeholder && mount.matcher.testParent(path)) {\n        iteratee(mount.escapedKey, mount.placeholder);\n      }\n    });\n  }\n\n  checkVueObject(object, path, checkedObjects) {\n    checkedObjects = checkedObjects || [];\n    for (const key of Object.getOwnPropertyNames(object)) {\n      if (RESERVED_VALUE_PROPERTY_NAMES[key]) continue;\n      // jshint loopfunc:true\n      const mount = _.find(this._mounts, mount => mount.Class === object.constructor);\n      // jshint loopfunc:false\n      if (mount && _.includes(mount.matcher.variables, key)) continue;\n      if (!(Array.isArray(object) && (/\\d+/.test(key) || key === 'length'))) {\n        const descriptor = Object.getOwnPropertyDescriptor(object, key);\n        if ('value' in descriptor || !descriptor.get) {\n          throw new Error(\n            `Value at ${path}, contained in a Firetruss object, has a rogue property: ${key}`);\n        }\n      }\n      const value = object[key];\n      if (_.isObject(value) && !(value instanceof Connector) && !(value instanceof Function) &&\n          !_.includes(checkedObjects, value)) {\n        checkedObjects.push(value);\n        this.checkVueObject(value, joinPath(path, escapeKey(key)), checkedObjects);\n      }\n    }\n    if (object.$truss) {\n      for (const key in object) {\n        if (!object.hasOwnProperty(key)) continue;\n        try {\n          object[key] = object[key];\n          throw new Error(\n            `Firetruss object at ${path} has an enumerable non-Firebase property: ${key}`);\n        } catch (e) {\n          if (e.trussCode !== 'firebase_overwrite') throw e;\n        }\n      }\n    }\n  }\n\n  static get computedPropertyStats() {\n    return computedPropertyStats;\n  }\n}\n\n\nfunction computeValue(prop, stats) {\n  // jshint validthis: true\n  // Touch this object, since a failed access to a missing property doesn't get captured as a\n  // dependency.\n  this.$$touchThis();\n\n  const startTime = performanceNow();\n  try {\n    return prop.get.call(this);\n  } catch (e) {\n    return new ErrorWrapper(e);\n  } finally {\n    stats.runtime += performanceNow() - startTime;\n    stats.numRecomputes += 1;\n  }\n  // jshint validthis: false\n}\n\nfunction isTrussValueEqual(a, b) {\n  if (a && a.$truss || b && b.$truss) return a === b;\n}\n","import angularCompatibility from './angularCompatibility.js';\nimport Coupler from './Coupler.js';\nimport Modeler from './Modeler.js';\nimport {escapeKey, unescapeKey, joinPath, SERVER_TIMESTAMP} from './utils.js';\n\nimport _ from 'lodash';\nimport Vue from 'vue';\n\n\nclass Transaction {\n  constructor(path, tree) {\n    this._path = path;\n    this._tree = tree;\n  }\n\n  get currentValue() {return this._tree.getObject(this._path);}\n  get outcome() {return this._outcome;}\n  get values() {return this._values;}\n\n  _setOutcome(value) {\n    if (this._outcome) throw new Error('Transaction already resolved with ' + this._outcome);\n    this._outcome = value;\n  }\n\n  abort() {\n    this._setOutcome('abort');\n  }\n\n  cancel() {\n    this._setOutcome('cancel');\n  }\n\n  set(value) {\n    if (value === undefined) throw new Error('Invalid argument: undefined');\n    this._setOutcome('set');\n    this._values = {'': value};\n  }\n\n  update(values) {\n    if (values === undefined) throw new Error('Invalid argument: undefined');\n    if (_.isEmpty(values)) return this.cancel();\n    this._setOutcome('update');\n    this._values = values;\n  }\n}\n\n\nexport default class Tree {\n  constructor(truss, rootUrl, bridge, dispatcher) {\n    this._truss = truss;\n    this._rootUrl = rootUrl;\n    this._bridge = bridge;\n    this._dispatcher = dispatcher;\n    this._firebasePropertyEditAllowed = false;\n    this._writeSerial = 0;\n    this._localWrites = {};\n    this._localWriteTimestamp = null;\n    this._coupler = new Coupler(\n      rootUrl, bridge, dispatcher, this._integrateSnapshot.bind(this), this._prune.bind(this));\n    this._vue = new Vue({data: {$root: undefined}});\n    if (angularCompatibility.active) {\n      this._vue.$watch('$data', angularCompatibility.digest, {deep: true});\n    }\n    // Call this.init(classes) to complete initialization; we need two phases so that truss can bind\n    // the tree into its own accessors prior to defining computed functions, which may try to\n    // access the tree root via truss.\n  }\n\n  get root() {\n    return this._vue.$data.$root;\n  }\n\n  get truss() {\n    return this._truss;\n  }\n\n  init(classes) {\n    this._modeler = new Modeler(classes);\n    this._vue.$data.$root = this._createObject('/', '');\n    this._completeCreateObject(this.root);\n    this._plantPlaceholders(this.root, '/');\n  }\n\n  destroy() {\n    this._coupler.destroy();\n    if (this._modeler) this._modeler.destroy();\n    this._vue.$destroy();\n  }\n\n  connectReference(ref, valueCallback, method) {\n    this._checkHandle(ref);\n    const operation = this._dispatcher.createOperation('read', method, ref);\n    let unwatch;\n    if (valueCallback) {\n      const segments = _(ref.path).split('/').map(segment => unescapeKey(segment)).value();\n      unwatch = this._vue.$watch(\n        this.getObject.bind(this, segments), valueCallback, {immediate: true});\n    }\n    operation._disconnect = this._disconnectReference.bind(this, ref, operation, unwatch);\n    this._dispatcher.begin(operation).then(() => {\n      if (operation.running && !operation._disconnected) {\n        this._coupler.couple(ref.path, operation);\n        operation._coupled = true;\n      }\n    }).catch(e => {});  // ignore exception, let onFailure handlers deal with it\n    return operation._disconnect;\n  }\n\n  _disconnectReference(ref, operation, unwatch, error) {\n    if (operation._disconnected) return;\n    operation._disconnected = true;\n    if (unwatch) unwatch();\n    if (operation._coupled) {\n      this._coupler.decouple(ref.path, operation);  // will call back to _prune if necessary\n      operation._coupled = false;\n    }\n    this._dispatcher.end(operation, error).catch(e => {});\n  }\n\n  isReferenceReady(ref) {\n    this._checkHandle(ref);\n    return this._coupler.isSubtreeReady(ref.path);\n  }\n\n  connectQuery(query, keysCallback, method) {\n    this._checkHandle(query);\n    const operation = this._dispatcher.createOperation('read', method, query);\n    operation._disconnect = this._disconnectQuery.bind(this, query, operation);\n    this._dispatcher.begin(operation).then(() => {\n      if (operation.running && !operation._disconnected) {\n        this._coupler.subscribe(query, operation, keysCallback);\n        operation._coupled = true;\n      }\n    }).catch(e => {});  // ignore exception, let onFailure handlers deal with it\n    return operation._disconnect;\n  }\n\n  _disconnectQuery(query, operation, error) {\n    if (operation._disconnected) return;\n    operation._disconnected = true;\n    if (operation._coupled) {\n      this._coupler.unsubscribe(query, operation);  // will call back to _prune if necessary\n      operation._coupled = false;\n    }\n    this._dispatcher.end(operation, error).catch(e => {});\n  }\n\n  isQueryReady(query) {\n    return this._coupler.isQueryReady(query);\n  }\n\n  _checkHandle(handle) {\n    if (!handle.belongsTo(this._truss)) {\n      throw new Error('Reference belongs to another Truss instance');\n    }\n  }\n\n  update(ref, method, values) {\n    const numValues = _.size(values);\n    if (!numValues) return;\n    if (method === 'update' || method === 'override') {\n      checkUpdateHasOnlyDescendantsWithNoOverlap(ref.path, values);\n    }\n    this._applyLocalWrite(values, method === 'override');\n    if (method === 'override') return Promise.resolve();\n    const url = this._rootUrl + this._extractCommonPathPrefix(values);\n    return this._dispatcher.execute('write', method, ref, () => {\n      if (numValues === 1) {\n        return this._bridge.set(url, values[''], this._writeSerial);\n      } else {\n        return this._bridge.update(url, values, this._writeSerial);\n      }\n    });\n  }\n\n  commit(ref, updateFunction) {\n    let tries = 0;\n\n    const attemptTransaction = () => {\n      if (tries++ >= 25) return Promise.reject(new Error('maxretry'));\n      const txn = new Transaction();\n      try {\n        updateFunction(txn);\n      } catch (e) {\n        return Promise.reject(e);\n      }\n      const oldValue = toFirebaseJson(this.getObject(ref.path));\n      switch (txn.outcome) {\n        case 'abort': return;\n        case 'cancel':\n          break;\n        case 'set':\n          this._applyLocalWrite({[ref.path]: txn.values['']});\n          break;\n        case 'update':\n          checkUpdateHasOnlyDescendantsWithNoOverlap(ref.path, txn.values, true);\n          this._applyLocalWrite(txn.values);\n          break;\n        default:\n          throw new Error('Invalid transaction outcome: ' + (txn.outcome || 'none'));\n      }\n      return this._bridge.transaction(\n        this._rootUrl + ref.path, oldValue, txn.values\n      ).then(committed => {\n        if (!committed) return attemptTransaction();\n        return txn;\n      });\n    };\n\n    return this._truss.peek(ref, () => {\n      return this._dispatcher.execute('write', 'commit', ref, attemptTransaction);\n    });\n  }\n\n  _applyLocalWrite(values, override) {\n    // TODO: correctly apply local writes that impact queries.  Currently, a local write will update\n    // any objects currently selected by a query, but won't add or remove results.\n    this._writeSerial++;\n    this._localWriteTimestamp = this._truss.now;\n    _.each(values, (value, path) => {\n      const coupledDescendantPaths = this._coupler.findCoupledDescendantPaths(path);\n      if (_.isEmpty(coupledDescendantPaths)) return;\n      const offset = (path === '/' ? 0 : path.length) + 1;\n      for (const descendantPath of coupledDescendantPaths) {\n        const subPath = descendantPath.slice(offset);\n        let subValue = value;\n        if (subPath) {\n          const segments = subPath.split('/');\n          for (const segment of segments) {\n            subValue = subValue[unescapeKey(segment)];\n            if (subValue === undefined) break;\n          }\n        }\n        if (subValue === undefined || subValue === null) {\n          this._prune(subPath);\n        } else {\n          const key = unescapeKey(_.last(descendantPath.split('/')));\n          this._plantValue(\n            descendantPath, key, subValue, this._scaffoldAncestors(descendantPath), false,\n            override\n          );\n        }\n        if (!override) this._localWrites[descendantPath] = this._writeSerial;\n      }\n    });\n  }\n\n  _extractCommonPathPrefix(values) {\n    let prefixSegments;\n    _.each(values, (value, path) => {\n      const segments = path === '/' ? [''] : path.split('/');\n      if (prefixSegments) {\n        let firstMismatchIndex = 0;\n        const maxIndex = Math.min(prefixSegments.length, segments.length);\n        while (firstMismatchIndex < maxIndex &&\n               prefixSegments[firstMismatchIndex] === segments[firstMismatchIndex]) {\n          firstMismatchIndex++;\n        }\n        prefixSegments = prefixSegments.slice(0, firstMismatchIndex);\n        if (!prefixSegments.length) return false;\n      } else {\n        prefixSegments = segments;\n      }\n    });\n    const pathPrefix = prefixSegments.length === 1 ? '/' : prefixSegments.join('/');\n    _.each(_.keys(values), key => {\n      values[key.slice(pathPrefix.length + 1)] = values[key];\n      delete values[key];\n    });\n    return pathPrefix;\n  }\n\n  /**\n   * Creates a Truss object and sets all its basic properties: path segment variables, user-defined\n   * properties, and computed properties.  The latter two will be enumerable so that Vue will pick\n   * them up and make the reactive, so you should call _completeCreateObject once it's done so and\n   * before any Firebase properties are added.\n   */\n  _createObject(path, key, parent) {\n    let properties = {\n      // We want Vue to wrap this; we'll make it non-enumerable in _completeCreateObject.\n      $parent: {value: parent, configurable: true, enumerable: true},\n      $path: {value: path}\n    };\n    if (path === '/') properties.$truss = {value: this._truss};\n\n    const object = this._modeler.createObject(path, properties);\n    Object.defineProperties(object, properties);\n    return object;\n  }\n\n  // To be called on the result of _createObject after it's been inserted into the _vue hierarchy\n  // and Vue has had a chance to initialize it.\n  _completeCreateObject(object) {\n    for (const name of Object.getOwnPropertyNames(object)) {\n      const descriptor = Object.getOwnPropertyDescriptor(object, name);\n      if (descriptor.configurable && descriptor.enumerable) {\n        descriptor.enumerable = false;\n        if (name === '$parent') descriptor.configurable = false;\n        Object.defineProperty(object, name, descriptor);\n      }\n    }\n    if (object.$$initializers) {\n      for (const fn of object.$$initializers) fn(this._vue);\n      delete object.$$initializers;\n    }\n  }\n\n  _destroyObject(object) {\n    if (!(object && object.$truss)) return;\n    this._modeler.destroyObject(object);\n    for (const key in object) {\n      if (!Object.hasOwnProperty(object, key)) continue;\n      this._destroyObject(object[key]);\n    }\n  }\n\n  _integrateSnapshot(snap) {\n    _.each(_.keys(this._localWrites), (writeSerial, path) => {\n      if (snap.writeSerial >= writeSerial) delete this._localWrites[path];\n    });\n    if (snap.exists) {\n      const parent = this._scaffoldAncestors(snap.path, true);\n      if (parent) this._plantValue(snap.path, snap.key, snap.value, parent, true, false);\n    } else {\n      this._prune(snap.path, null, true);\n    }\n  }\n\n  _scaffoldAncestors(path, remoteWrite) {\n    let object;\n    const segments = _(path).split('/').dropRight().value();\n    _.each(segments, (segment, i) => {\n      const childKey = unescapeKey(segment);\n      let child = childKey ? object[childKey] : this.root;\n      if (!child) {\n        const ancestorPath = segments.slice(0, i + 1).join('/');\n        if (remoteWrite && this._localWrites[ancestorPath || '/']) return;\n        child = this._plantValue(ancestorPath, childKey, {}, object);\n      }\n      object = child;\n    });\n    return object;\n  }\n\n  _plantValue(path, key, value, parent, remoteWrite, override) {\n    if (value === null || value === undefined) {\n      throw new Error('Snapshot includes invalid value: ' + value);\n    }\n    if (remoteWrite && this._localWrites[path]) return;\n    if (value === SERVER_TIMESTAMP) value = this._localWriteTimestamp;\n    if (!_.isArray(value) && !_.isObject(value)) {\n      this._setFirebaseProperty(parent, key, value);\n      return;\n    }\n    let object = parent[key];\n    if (!_.isObject(object)) {\n      object = this._createObject(path, key, parent);\n      this._setFirebaseProperty(parent, key, object);\n      this._completeCreateObject(object);\n    }\n    if (override) {\n      Object.defineProperty(object, '$overridden', {get: _.constant(true), configurable: true});\n    } else if (object.$overridden) {\n      delete object.$overridden;\n    }\n    _.each(value, (item, escapedChildKey) => {\n      this._plantValue(\n        joinPath(path, escapedChildKey), unescapeKey(escapedChildKey), item, object, remoteWrite,\n        override\n      );\n    });\n    _.each(object, (item, childKey) => {\n      const escapedChildKey = escapeKey(childKey);\n      if (!value.hasOwnProperty(escapedChildKey)) {\n        this._prune(joinPath(path, escapedChildKey), null, remoteWrite);\n      }\n    });\n    this._plantPlaceholders(object, path);\n    return object;\n  }\n\n  _plantPlaceholders(object, path) {\n    this._modeler.forEachPlaceholderChild(path, (escapedKey, placeholder) => {\n      const key = unescapeKey(escapedKey);\n      if (!object.hasOwnProperty(key)) {\n        this._plantValue(joinPath(path, escapedKey), key, placeholder, object);\n      }\n    });\n  }\n\n  _prune(path, lockedDescendantPaths, remoteWrite) {\n    lockedDescendantPaths = lockedDescendantPaths || {};\n    const object = this.getObject(path);\n    if (object === undefined) return;\n    if (remoteWrite && this._avoidLocalWritePaths(path, lockedDescendantPaths)) return;\n    if (!(_.isEmpty(lockedDescendantPaths) && this._pruneAncestors(path, object)) &&\n        _.isObject(object)) {\n      // The target object is a placeholder, and all ancestors are placeholders or otherwise needed\n      // as well, so we can't delete it.  Instead, dive into its descendants to delete what we can.\n      this._pruneDescendants(object, lockedDescendantPaths);\n    }\n  }\n\n  _avoidLocalWritePaths(path, lockedDescendantPaths) {\n    for (const localWritePath in this._localWrites) {\n      if (!this._localWrites.hasOwnProperty(localWritePath)) continue;\n      if (path === localWritePath || localWritePath === '/' ||\n          _.startsWith(path, localWritePath + '/')) return true;\n      if (path === '/' || _.startsWith(localWritePath, path + '/')) {\n        const segments = localWritePath.split('/');\n        for (let i = segments.length; i > 0; i--) {\n          const subPath = segments.slice(0, i).join('/');\n          const active = i === segments.length;\n          if (lockedDescendantPaths[subPath] || lockedDescendantPaths[subPath] === active) break;\n          lockedDescendantPaths[subPath] = active;\n          if (subPath === path) break;\n        }\n      }\n    }\n  }\n\n  _pruneAncestors(targetPath, targetObject) {\n    // Destroy the child (unless it's a placeholder that's still needed) and any ancestors that\n    // are no longer needed to keep this child rooted, and have no other reason to exist.\n    let deleted = false;\n    let object = targetObject;\n    // The target object may be a primitive, in which case it won't have $parent and $key\n    // properties.  In that case, use the target path to figure those out instead.  Note that all\n    // ancestors of the target object will necessarily not be primitives and will have those\n    // properties.\n    const targetSegments = _(targetPath).split('/').map(unescapeKey).value();\n    while (object && object !== this.root) {\n      const parent =\n        object.$parent || object === targetObject && this.getObject(targetSegments.slice(0, -1));\n      if (!this._modeler.isPlaceholder(object.$path)) {\n        const ghostObjects = deleted ? null : [targetObject];\n        if (!this._holdsConcreteData(object, ghostObjects)) {\n          deleted = true;\n          this._deleteFirebaseProperty(\n            parent, object.$key || object === targetObject && _.last(targetSegments));\n        }\n      }\n      object = parent;\n    }\n    return deleted;\n  }\n\n  _holdsConcreteData(object, ghostObjects) {\n    if (ghostObjects && _.includes(ghostObjects, object)) return false;\n    if (_.some(object, value => !value.$truss)) return true;\n    return _.some(object, value => this._holdsConcreteData(value, ghostObjects));\n  }\n\n  _pruneDescendants(object, lockedDescendantPaths) {\n    if (lockedDescendantPaths[object.$path]) return true;\n    if (object.$overridden) delete object.$overridden;\n    let coupledDescendantFound = false;\n    _.each(object, (value, key) => {\n      let shouldDelete = true;\n      let valueLocked;\n      if (lockedDescendantPaths[joinPath(object.$path, escapeKey(key))]) {\n        shouldDelete = false;\n        valueLocked = true;\n      } else if (value.$truss) {\n        const placeholder = this._modeler.isPlaceholder(value.$path);\n        if (placeholder || _.has(lockedDescendantPaths, value.$path)) {\n          valueLocked = this._pruneDescendants(value, lockedDescendantPaths);\n          shouldDelete = !placeholder && !valueLocked;\n        }\n      }\n      if (shouldDelete) this._deleteFirebaseProperty(object, key);\n      coupledDescendantFound = coupledDescendantFound || valueLocked;\n    });\n    return coupledDescendantFound;\n  }\n\n  getObject(pathOrSegments) {\n    let object;\n    const segments = _.isString(pathOrSegments) ?\n      _(pathOrSegments).split('/').map(unescapeKey).value() : pathOrSegments;\n    for (const segment of segments) {\n      object = segment ? object[segment] : this.root;\n      if (object === undefined) return;\n    }\n    return object;\n  }\n\n  _getFirebasePropertyDescriptor(object, key) {\n    let descriptor = Object.getOwnPropertyDescriptor(object, key);\n    if (descriptor) {\n      if (!descriptor.enumerable) {\n        throw new Error(\n          `Key conflict between Firebase and instance or computed properties at ` +\n          `${object.$path}: ${key}`);\n      }\n      if (!descriptor.get || !descriptor.set) {\n        throw new Error(`Unbound property at ${object.$path}: ${key}`);\n      }\n    }\n    return descriptor;\n  }\n\n  _setFirebaseProperty(object, key, value) {\n    let descriptor = this._getFirebasePropertyDescriptor(object, key);\n    if (descriptor) {\n      this._firebasePropertyEditAllowed = true;\n      object[key] = value;\n      this._firebasePropertyEditAllowed = false;\n    } else {\n      Vue.set(object, key, value);\n      descriptor = Object.getOwnPropertyDescriptor(object, key);\n      Object.defineProperty(object, key, {\n        get: descriptor.get, set: this._overwriteFirebaseProperty.bind(this, descriptor, key),\n        configurable: true, enumerable: true\n      });\n    }\n  }\n\n  _overwriteFirebaseProperty(descriptor, key, newValue) {\n    if (!this._firebasePropertyEditAllowed) {\n      const e = new Error(`Firebase data cannot be mutated directly: ${key}`);\n      e.trussCode = 'firebase_overwrite';\n      throw e;\n    }\n    descriptor.set.call(this, newValue);\n  }\n\n  _deleteFirebaseProperty(object, key) {\n    // Make sure it's actually a Firebase property.\n    this._getFirebasePropertyDescriptor(object, key);\n    this._destroyObject(object[key]);\n    Vue.delete(object, key);\n  }\n\n  checkVueObject(object, path) {\n    this._modeler.checkVueObject(object, path);\n  }\n\n  static get computedPropertyStats() {\n    return Modeler.computedPropertyStats;\n  }\n}\n\n\nexport function checkUpdateHasOnlyDescendantsWithNoOverlap(rootPath, values, relativizePaths) {\n  // First, check all paths for correctness and absolutize them, since there could be a mix of\n  // absolute paths and relative keys.\n  _.each(_.keys(values), path => {\n    if (path.charAt(0) === '/') {\n      if (!(path === rootPath || rootPath === '/' ||\n            _.startsWith(path, rootPath + '/') && path.length > rootPath.length + 1)) {\n        throw new Error(`Update item is not a descendant of target ref: ${path}`);\n      }\n    } else {\n      if (path.indexOf('/') >= 0) {\n        throw new Error(`Update item deep path must be absolute, taken from a reference: ${path}`);\n      }\n      const absolutePath = joinPath(rootPath, escapeKey(path));\n      if (values.hasOwnProperty(absolutePath)) {\n        throw new Error(`Update items overlap: ${path} and ${absolutePath}`);\n      }\n      values[absolutePath] = values[path];\n      delete values[path];\n    }\n  });\n  // Then check for overlaps and relativize if desired.\n  const allPaths = _(values).keys().map(path => joinPath(path, '')).sortBy('length').value();\n  _.each(_.keys(values), path => {\n    for (const otherPath of allPaths) {\n      if (otherPath.length > path.length) break;\n      if (path !== otherPath && _.startsWith(path, otherPath)) {\n        throw new Error(`Update items overlap: ${otherPath} and ${path}`);\n      }\n    }\n    if (relativizePaths) {\n      values[path.slice(rootPath === '/' ? 1 : rootPath.length + 1)] = values[path];\n      delete values[path];\n    }\n  });\n}\n\nexport function toFirebaseJson(object) {\n  if (typeof object === 'object') {\n    const result = {};\n    for (const key in object) {\n      if (!object.hasOwnProperty(key)) continue;\n      result[escapeKey(key)] = toFirebaseJson(object[key]);\n    }\n    return result;\n  } else {\n    return object;\n  }\n}\n\n","import {escapeKey, unescapeKey, makePathMatcher} from './utils.js';\n\nimport _ from 'lodash';\n\n\nconst EMPTY_ANNOTATIONS = {};\nObject.freeze(EMPTY_ANNOTATIONS);\n\n\nexport class Handle {\n  constructor(tree, path, annotations) {\n    this._tree = tree;\n    this._path = path.replace(/^\\/*/, '/').replace(/\\/$/, '');\n    if (annotations) {\n      this._annotations = annotations;\n      Object.freeze(annotations);\n    }\n  }\n\n  get $ref() {return this;}\n  get key() {\n    if (!this._key) this._key = unescapeKey(this._path.replace(/.*\\//, ''));\n    return this._key;\n  }\n  get path() {return this._path;}\n  get _pathPrefix() {return this._path === '/' ? '' : this._path;}\n  get parent() {\n    return new Reference(this._tree, this._path.replace(/\\/[^/]*$/, ''), this._annotations);\n  }\n\n  get annotations() {\n    return this._annotations || EMPTY_ANNOTATIONS;\n  }\n\n  child() {\n    if (!arguments.length) return this;\n    const segments = [];\n    for (const key of arguments) {\n      if (key === undefined || key === null) return;\n      segments.push(escapeKey(key));\n    }\n    return new Reference(\n      this._tree, `${this._pathPrefix}/${segments.join('/')}`,\n      this._annotations\n    );\n  }\n\n  children() {\n    if (!arguments.length) return this;\n    const escapedKeys = [];\n    for (let i = 0; i < arguments.length; i++) {\n      const arg = arguments[i];\n      if (_.isArray(arg)) {\n        const mapping = {};\n        const subPath = `${this._pathPrefix}/${escapedKeys.join('/')}`;\n        const rest = _.slice(arguments, i + 1);\n        for (const key of arg) {\n          const subRef =\n            new Reference(this._tree, `${subPath}/${escapeKey(key)}`, this._annotations);\n          const subMapping = subRef.children.apply(subRef, rest);\n          if (subMapping) mapping[key] = subMapping;\n        }\n        if (_.isEmpty(mapping)) return;\n        return mapping;\n      } else {\n        if (arg === undefined || arg === null) return;\n        escapedKeys.push(escapeKey(arg));\n      }\n    }\n    return new Reference(\n      this._tree, `${this._pathPrefix}/${escapedKeys.join('/')}`, this._annotations);\n  }\n\n  peek(callback) {\n    return this._tree.truss.peek(this, callback);\n  }\n\n  match(pattern) {\n    return makePathMatcher(pattern).match(this.path);\n  }\n\n  isEqual(that) {\n    if (!(that instanceof Handle)) return false;\n    return this._tree === that._tree && this.toString() === that.toString();\n  }\n\n  belongsTo(truss) {\n    return this._tree.truss === truss;\n  }\n}\n\n\nexport class Query extends Handle {\n  constructor(tree, path, spec, annotations) {\n    super(tree, path, annotations);\n    this._spec = this._copyAndValidateSpec(spec);\n  }\n\n  // Vue-bound\n  get ready() {\n    return this._tree.isQueryReady(this);\n  }\n\n  get constraints() {\n    return this._spec;\n  }\n\n  annotate(annotations) {\n    return new Query(\n      this._tree, this._path, this._spec, _.extend({}, this._annotations, annotations));\n  }\n\n  _copyAndValidateSpec(spec) {\n    if (!spec.by) throw new Error('Query needs \"by\" clause: ' + JSON.stringify(spec));\n    if (('at' in spec) + ('from' in spec) + ('to' in spec) > 1) {\n      throw new Error(\n        'Query must contain at most one of \"at\", \"from\", or \"to\" clauses: ' + JSON.stringify(spec));\n    }\n    if (('first' in spec) + ('last' in spec) > 1) {\n      throw new Error(\n        'Query must contain at most one of \"first\" or \"last\" clauses: ' + JSON.stringify(spec));\n    }\n    if (!_.some(['at', 'from', 'to', 'first', 'last'], clause => clause in spec)) {\n      throw new Error(\n        'Query must contain at least one of \"at\", \"from\", \"to\", \"first\", or \"last\" clauses: ' +\n        JSON.stringify(spec));\n    }\n    spec = _.clone(spec);\n    if (spec.by !== '$key' && spec.by !== '$value') {\n      if (!(spec.by instanceof Reference)) {\n        throw new Error('Query \"by\" value must be a reference: ' + spec.by);\n      }\n      let childPath = spec.by.toString();\n      if (!_.startsWith(childPath, this._path)) {\n        throw new Error(\n          'Query \"by\" value must be a descendant of target reference: ' + spec.by);\n      }\n      childPath = childPath.slice(this._path.length).replace(/^\\/?/, '');\n      if (childPath.indexOf('/') === -1) {\n        throw new Error(\n          'Query \"by\" value must not be a direct child of target reference: ' + spec.by);\n      }\n      spec.by = childPath.replace(/.*?\\//, '');\n    }\n    Object.freeze(spec);\n    return spec;\n  }\n\n\n  toString() {\n    if (!this._string) {\n      const queryTerms = _(this._spec)\n        .map((value, key) => `${key}=${encodeURIComponent(JSON.stringify(value))}`)\n        .sortBy()\n        .join('&');\n      this._string = `${this._path}?${queryTerms}`;\n    }\n    return this._string;\n  }\n}\n\n\n// jshint latedef:false\nexport class Reference extends Handle {\n// jshint latedef:nofunc\n\n  constructor(tree, path, annotations) {\n    super(tree, path, annotations);\n  }\n\n  get ready() {return this._tree.isReferenceReady(this);}  // Vue-bound\n  get value() {return this._tree.getObject(this.path);}  // Vue-bound\n  toString() {return this._path;}\n\n  annotate(annotations) {\n    return new Reference(this._tree, this._path, _.extend({}, this._annotations, annotations));\n  }\n\n  query(spec) {\n    return new Query(this._tree, this._path, spec);\n  }\n\n  set(value) {\n    return this._tree.update(this, 'set', {[this.path]: value});\n  }\n\n  update(values) {\n    return this._tree.update(this, 'update', values);\n  }\n\n  override(value) {\n    return this._tree.update(this, 'override', {[this.path]: value});\n  }\n\n  commit(updateFunction) {\n    return this._tree.commit(this, updateFunction);\n  }\n}\n\nexport default Reference;\n","import _ from 'lodash';\nimport {wrapPromiseCallback} from './utils.js';\n\n\nconst INTERCEPT_KEYS = [\n  'read', 'write', 'auth', 'set', 'update', 'commit', 'connect', 'peek', 'all'\n];\n\nconst EMPTY_ARRAY = [];\n\n\nclass SlowHandle {\n  constructor(operation, delay, callback) {\n    this._operation = operation;\n    this._delay = delay;\n    this._callback = callback;\n    this._fired = false;\n  }\n\n  initiate() {\n    this.cancel();\n    this._fired = false;\n    const elapsed = Date.now() - this._operation._startTimestamp;\n    this._timeoutId = setTimeout(this._delay - elapsed, () => {\n      this._fired = true;\n      this._callback(this._operation);\n    });\n  }\n\n  cancel() {\n    if (this._fired) this._callback(this._operation);\n    if (this._timeoutId) clearTimeout(this._timeoutId);\n  }\n}\n\n\nclass Operation {\n  constructor(type, method, target) {\n    this._type = type;\n    this._method = method;\n    this._target = target;\n    this._ready = false;\n    this._running = false;\n    this._ended = false;\n    this._tries = 0;\n    this._startTimestamp = Date.now();\n    this._slowHandles = [];\n  }\n\n  get type() {return this._type;}\n  get method() {return this._method;}\n  get target() {return this._target;}\n  get ready() {return this._ready;}\n  get running() {return this._running;}\n  get ended() {return this._ended;}\n  get tries() {return this._tries;}\n  get error() {return this._error;}\n\n  onSlow(delay, callback) {\n    const handle = new SlowHandle(this, delay, callback);\n    this._slowHandles.push(handle);\n    handle.initiate();\n  }\n\n  _setRunning(value) {\n    this._running = value;\n  }\n\n  _setEnded(value) {\n    this._ended = value;\n  }\n\n  _markReady() {\n    this._ready = true;\n    this._tries = 0;\n    _.each(this._slowHandles, handle => handle.cancel());\n  }\n\n  _clearReady() {\n    this._ready = false;\n    this._startTimestamp = Date.now();\n    _.each(this._slowHandles, handle => handle.initiate());\n  }\n\n  _incrementTries() {\n    this._tries++;\n  }\n}\n\n\nexport default class Dispatcher {\n  constructor(bridge) {\n    this._bridge = bridge;\n    this._callbacks = {};\n  }\n\n  intercept(interceptKey, callbacks) {\n    if (!_.contains(INTERCEPT_KEYS, interceptKey)) {\n      throw new Error('Unknown intercept operation type: ' + interceptKey);\n    }\n    const badCallbackKeys =\n      _.difference(_.keys(callbacks), ['onBefore', 'onAfter', 'onError', 'onFailure']);\n    if (badCallbackKeys.length) {\n      throw new Error('Unknown intercept callback types: ' + badCallbackKeys.join(', '));\n    }\n    const wrappedCallbacks = {\n      onBefore: this._addCallback('onBefore', interceptKey, callbacks.onBefore),\n      onAfter: this._addCallback('onAfter', interceptKey, callbacks.onAfter),\n      onError: this._addCallback('onError', interceptKey, callbacks.onError),\n      onFailure: this._addCallback('onFailure', interceptKey, callbacks.onFailure)\n    };\n    return this._removeCallbacks.bind(this, interceptKey, wrappedCallbacks);\n  }\n\n  _addCallback(stage, interceptKey, callback) {\n    if (!callback) return;\n    const key = this._getCallbacksKey(stage, interceptKey);\n    const wrappedCallback = wrapPromiseCallback(callback);\n    (this._callbacks[key] || (this._callbacks[key] = [])).push(wrappedCallback);\n    return wrappedCallback;\n  }\n\n  _removeCallback(stage, interceptKey, wrappedCallback) {\n    if (!wrappedCallback) return;\n    const key = this._getCallbacksKey(stage, interceptKey);\n    if (this._callbacks[key]) _.pull(this._callbacks[key], wrappedCallback);\n  }\n\n  _removeCallbacks(interceptKey, wrappedCallbacks) {\n    _.each(wrappedCallbacks, (wrappedCallback, stage) => {\n      this._removeCallback(stage, interceptKey, wrappedCallback);\n    });\n  }\n\n  _getCallbacks(stage, operationType, method) {\n    return [].concat(\n      this._callbacks[this._getCallbacksKey(stage, method)] || EMPTY_ARRAY,\n      this._callbacks[this._getCallbacksKey(stage, operationType)] || EMPTY_ARRAY,\n      this._callbacks[this._getCallbacksKey(stage, 'all')] || EMPTY_ARRAY\n    );\n  }\n\n  _getCallbacksKey(stage, interceptKey) {\n    return `${stage}_${interceptKey}`;\n  }\n\n  execute(operationType, method, target, executor) {\n    executor = wrapPromiseCallback(executor);\n    const operation = this.createOperation(operationType, method, target);\n    return this.begin(operation).then(() => {\n      const executeWithRetries = () => {\n        return executor().catch(e => this._retryOrEnd(operation, e).then(executeWithRetries));\n      };\n      return executeWithRetries();\n    }).then(result => this.end(operation).then(() => result));\n  }\n\n  createOperation(operationType, method, target) {\n    return new Operation(operationType, method, target);\n  }\n\n  begin(operation) {\n    return Promise.all(_.map(\n      this._getCallbacks('onBefore', operation.type, operation.method),\n      onBefore => onBefore(operation)\n    )).then(() => {\n      if (!operation.ended) operation._setRunning(true);\n    }, e => this.end(operation, e));\n  }\n\n  markReady(operation) {\n    operation._markReady();\n  }\n\n  clearReady(operation) {\n    operation._clearReady();\n  }\n\n  retry(operation, error) {\n    operation._incrementTries();\n    operation._error = error;\n    return Promise.all(_.map(\n      this._getCallbacks('onError', operation.type, operation.method),\n      onError => onError(operation, error)\n    )).then(results => {\n      const retrying = _.some(results);\n      if (retrying) delete operation._error;\n      return retrying;\n    });\n  }\n\n  _retryOrEnd(operation, error) {\n    return this.retry(operation, error).then(result => {\n      if (!result) return this.end(operation, error);\n    }, e => this.end(operation, e));\n  }\n\n  end(operation, error) {\n    if (operation.ended) return;\n    operation._setRunning(false);\n    operation._setEnded(true);\n    if (error) operation._error = error;\n    return Promise.all(_.map(\n      this._getCallbacks('onAfter', operation.type, operation.method),\n      onAfter => onAfter(operation)\n    )).then(\n      () => this._afterEnd(operation),\n      e => {\n        operation._error = e;\n        return this._afterEnd(operation);\n      }\n    );\n  }\n\n  _afterEnd(operation) {\n    this.markReady(operation);\n    if (operation.error) {\n      const onFailureCallbacks = this._getCallbacks('onFailure', operation.type, operation.method);\n      return this._bridge.probeError(operation.error).then(() => {\n        if (onFailureCallbacks) {\n          setTimeout(() => {\n            _.each(onFailureCallbacks, onFailure => onFailure(operation));\n          }, 0);\n        }\n        return Promise.reject(operation.error);\n      });\n    }\n  }\n}\n\n","'use strict';\n\nconst ALPHABET = '-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz';\n\nexport default class KeyGenerator {\n  constructor() {\n    this._lastUniqueKeyTime = 0;\n    this._lastRandomValues = [];\n  }\n\n  generateUniqueKey(now) {\n    now = now || Date.now();\n    const chars = new Array(20);\n    let prefix = now;\n    for (let i = 7; i >= 0; i--) {\n      chars[i] = ALPHABET.charAt(prefix & 0x3f);\n      prefix = Math.floor(prefix / 64);\n    }\n    if (now === this._lastUniqueKeyTime) {\n      let i = 11;\n      while (i >= 0 && this._lastRandomValues[i] === 63) {\n        this._lastRandomValues[i] = 0;\n        i -= 1;\n      }\n      if (i === -1) {\n        throw new Error('Internal assertion failure: ran out of unique IDs for this millisecond');\n      }\n      this._lastRandomValues[i] += 1;\n    } else {\n      this._lastUniqueKeyTime = now;\n      for (let i = 0; i < 12; i++) {\n        // Make sure to leave some space for incrementing in the top nibble.\n        this._lastRandomValues[i] = Math.floor(Math.random() * (i ? 64 : 16));\n      }\n    }\n    for (let i = 0; i < 12; i++) {\n      chars[i + 8] = ALPHABET[this._lastRandomValues[i]];\n    }\n    return chars.join('');\n  }\n}\n","import angularCompatibility from './angularCompatibility.js';\nimport Vue from 'vue';\n\nexport default class MetaTree {\n  constructor(rootUrl, bridge) {\n    this._rootUrl = rootUrl;\n    this._bridge = bridge;\n    this._vue = new Vue({data: {$root: {\n      connected: undefined, timeOffset: 0, user: undefined, userid: undefined,\n      nowAtInterval(intervalMillis) {\n        const key = 'now' + intervalMillis;\n        if (!this.hasOwnProperty(key)) {\n          const update = () => {\n            this[key] = Date.now() + this.timeOffset;\n            angularCompatibility.digest();\n          };\n          update();\n          setInterval(() => update, intervalMillis);\n        }\n        return this[key];\n      }\n    }}});\n\n    if (angularCompatibility.active) {\n      this._vue.$watch('$data', angularCompatibility.digest, {deep: true});\n    }\n\n    bridge.onAuth(rootUrl, this._handleAuthChange, this);\n\n    this._connectInfoProperty('serverTimeOffset', 'timeOffset');\n    this._connectInfoProperty('connected', 'connected');\n  }\n\n  get root() {\n    return this._vue.$data.$root;\n  }\n\n  destroy() {\n    this._bridge.offAuth(this._rootUrl, this._handleAuthChange, this);\n    this._vue.$destroy();\n  }\n\n  _handleAuthChange(user) {\n    this.root.user = user;\n    this.root.userid = user && user.uid;\n  }\n\n  _connectInfoProperty(property, attribute) {\n    const propertyUrl = `${this._rootUrl}/.info/${property}`;\n    this._bridge.on(propertyUrl, propertyUrl, null, 'value', snap => {\n      this.root[attribute] = snap.value;\n    });\n  }\n}\n","import _ from 'lodash';\nimport Vue from 'vue';\nimport angularCompatibility from './angularCompatibility.js';\n\n\nclass QueryHandler {\n  constructor(coupler, query) {\n    this._coupler = coupler;\n    this._query = query;\n    this._listeners = [];\n    this._keys = [];\n    this._url = this._coupler._rootUrl + query.path;\n    this._segments = query.path.split('/');\n    this._listening = false;\n    this.ready = false;\n  }\n\n  attach(operation, keysCallback) {\n    this._listen();\n    this._listeners.push({operation, keysCallback});\n    keysCallback(this._keys);\n  }\n\n  detach(operation) {\n    const k = _.findIndex(this._listeners, {operation});\n    if (k >= 0) this._listeners.splice(k, 1);\n    return this._listeners.length;\n  }\n\n  _listen() {\n    if (this._listening) return;\n    this._coupler._bridge.on(\n      this._query.toString(), this._url, this._query.constraints, 'value',\n      this._handleSnapshot, this._handleError.bind(this._query.path), this, {sync: true});\n    this._listening = true;\n  }\n\n  destroy() {\n    this._coupler._bridge.off(\n      this._query.toString(), this._url, this._query.constraints, 'value', this._handleSnapshot,\n      this);\n    this._listening = false;\n    this.ready = false;\n    angularCompatibility.digest();\n    for (const key of this._keys) {\n      this._coupler._decoupleSegments(this._segments.concat(key));\n    }\n  }\n\n  _handleSnapshot(snap) {\n    // Order is important here: first couple any new subpaths so _handleSnapshot will update the\n    // tree, then tell the client to update its keys, pulling values from the tree.\n    if (!this._listeners.length || !this._listening) return;\n    const updatedKeys = this._updateKeys(snap);\n    this._coupler._applySnapshot(snap);\n    if (!this.ready) {\n      this.ready = true;\n      angularCompatibility.digest();\n      for (const listener of this._listeners) {\n        this._coupler._dispatcher.markReady(listener.operation);\n      }\n    }\n    if (updatedKeys) {\n      for (const listener of this._listeners) listener.keysCallback(updatedKeys);\n    }\n  }\n\n  _updateKeys(snap) {\n    let updatedKeys;\n    if (snap.path === this._query.path) {\n      updatedKeys = _.keys(snap.value);\n      updatedKeys.sort();\n      if (_.isEqual(this._keys, updatedKeys)) {\n        updatedKeys = null;\n      } else {\n        for (const key of _.difference(updatedKeys, this._keys)) {\n          this._coupler._coupleSegments(this._segments.concat(key));\n        }\n        for (const key of _.difference(this._keys, updatedKeys)) {\n          this._coupler._decoupleSegments(this._segments.concat(key));\n        }\n        this._keys = updatedKeys;\n      }\n    } else if (snap.path.replace(/\\/[^/]+/, '') === this._query.path) {\n      const hasKey = _.contains(this._keys, snap.key);\n      if (snap.value) {\n        if (!hasKey) {\n          this._coupler._coupleSegments(this._segments.concat(snap.key));\n          this._keys.push(snap.key);\n          this._keys.sort();\n          updatedKeys = this._keys;\n        }\n      } else {\n        if (hasKey) {\n          this._coupler._decoupleSegments(this._segments.concat(snap.key));\n          _.pull(this._keys, snap.key);\n          this._keys.sort();\n          updatedKeys = this._keys;\n        }\n      }\n    }\n    return updatedKeys;\n  }\n\n  _handleError(error) {\n    if (!this._listeners.length || !this._listening) return;\n    this._listening = false;\n    Promise.all(_.map(this._listeners, listener => {\n      this._coupler._dispatcher.clearReady(listener.operation);\n      return this._coupler._dispatcher.retry(listener.operation, error).catch(e => {\n        listener.operation._disconnect(e);\n        return false;\n      });\n    })).then(results => {\n      if (_.some(results)) {\n        if (this._listeners.length) this._listen();\n      } else {\n        for (const listener of this._listeners) listener.operation._disconnect(error);\n      }\n    });\n  }\n}\n\n\nclass Node {\n  constructor(coupler, path) {\n    this._coupler = coupler;\n    this.path = path;\n    this.url = this._coupler._rootUrl + path;\n    this.operations = [];\n    this.queryCount = 0;\n    this.listening = false;\n    this.ready = false;\n    this.children = {};\n  }\n\n  get active() {\n    return this.count || this.queryCount;\n  }\n\n  get count() {\n    return this.operations.length;\n  }\n\n  listen(skip) {\n    if (!skip && this.count) {\n      if (this.listening) return;\n      _.each(this.operations, op => {this._coupler._dispatcher.clearReady(op);});\n      this._coupler._bridge.on(\n        this.url, this.url, null, 'value', this._handleSnapshot, this._handleError.bind(this),\n        this, {sync: true});\n      this.listening = true;\n    } else {\n      _.each(this.children, child => {child.listen();});\n    }\n  }\n\n  unlisten(skip) {\n    if (!skip && this.listening) {\n      this._coupler._bridge.off(this.url, this.url, null, 'value', this._handleSnapshot, this);\n      this.listening = false;\n      this._forAllDescendants(node => {\n        if (node.ready) {\n          node.ready = false;\n          angularCompatibility.digest();\n        }\n      });\n    } else {\n      _.each(this.children, child => {child.unlisten();});\n    }\n  }\n\n  _handleSnapshot(snap) {\n    if (!this.listening || !this._coupler.isTrunkCoupled(snap.path)) return;\n    this._coupler._applySnapshot(snap);\n    if (!this.ready && snap.path === this.path) {\n      this.ready = true;\n      angularCompatibility.digest();\n      this.unlisten(true);\n      this._forAllDescendants(node => {\n        for (const op of this.operations) this._coupler._dispatcher.markReady(op);\n      });\n    }\n  }\n\n  _handleError(error) {\n    if (!this.count || !this.listening) return;\n    this.listening = false;\n    this._forAllDescendants(node => {\n      if (node.ready) {\n        node.ready = false;\n        angularCompatibility.digest();\n      }\n      for (const op of this.operations) this._coupler._dispatcher.clearReady(op);\n    });\n    return Promise.all(_.map(this.operations, op => {\n      return this._coupler._dispatcher.retry(op, error).catch(e => {\n        op._disconnect(e);\n        return false;\n      });\n    })).then(results => {\n      if (_.some(results)) {\n        if (this.count) this.listen();\n      } else {\n        for (const op of this.operations) op._disconnect(error);\n        // Pulling all the operations will automatically get us listening on descendants.\n      }\n    });\n  }\n\n  _forAllDescendants(iteratee) {\n    iteratee(this);\n    _.each(this.children, child => child._forAllDescendants(iteratee));\n  }\n\n  collectCoupledDescendantPaths(paths) {\n    if (!paths) paths = {};\n    paths[this.path] = this.active;\n    if (!this.active) {\n      _.each(this.children, child => {child.collectCoupledDescendantPaths(paths);});\n    }\n    return paths;\n  }\n}\n\n\nexport default class Coupler {\n  constructor(rootUrl, bridge, dispatcher, applySnapshot, prunePath) {\n    this._rootUrl = rootUrl;\n    this._bridge = bridge;\n    this._dispatcher = dispatcher;\n    this._applySnapshot = applySnapshot;\n    this._prunePath = prunePath;\n    this._vue = new Vue({data: {root: new Node(this, '/'), queryHandlers: {}}});\n  }\n\n  get _root() {return this._vue.root;}\n  get _queryHandlers() {return this._vue.queryHandlers;}\n\n  destroy() {\n    _.each(this._queryHandlers, queryHandler => {queryHandler.destroy();});\n    this._root.unlisten();\n    this._vue.$destroy();\n  }\n\n  couple(path, operation) {\n    return this._coupleSegments(path.split('/'), operation);\n  }\n\n  _coupleSegments(segments, operation) {\n    let node;\n    let superseded = !operation;\n    let ready = false;\n    for (const segment of segments) {\n      let child = segment ? node.children && node.children[segment] : this._root;\n      if (!child) {\n        child = new Node(this, `${node.path === '/' ? '' : node.path}/${segment}`);\n        Vue.set(node.children, segment, child);\n      }\n      superseded = superseded || child.listening;\n      ready = ready || child.ready;\n      node = child;\n    }\n    if (operation) {\n      node.operations.push(operation);\n    } else {\n      node.queryCount++;\n    }\n    if (superseded) {\n      if (operation && ready) this._dispatcher.markReady(operation);\n    } else {\n      node.listen();  // node will call unlisten() on descendants when ready\n    }\n  }\n\n  decouple(path, operation) {\n    return this._decoupleSegments(path.split('/'), operation);\n  }\n\n  _decoupleSegments(segments, operation) {\n    const ancestors = [];\n    let node;\n    for (const segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) break;\n      ancestors.push(node);\n    }\n    if (!node || !(operation ? node.count : node.queryCount)) {\n      throw new Error(`Path not coupled: ${segments.join('/')}`);\n    }\n    if (operation) {\n      _.pull(node.operations, operation);\n    } else {\n      node.queryCount--;\n    }\n    if (operation && !node.count) {\n      // Ideally, we wouldn't resync the full values here since we probably already have the current\n      // value for all children.  But making sure that's true is tricky in an async system (what if\n      // the node's value changes and the update crosses the 'off' call in transit?) and this\n      // situation should be sufficiently rare that the optimization is probably not worth it right\n      // now.\n      node.listen();\n      if (node.listening) node.unlisten();\n    }\n    if (!node.active) {\n      for (let i = ancestors.length - 1; i > 0; i--) {\n        node = ancestors[i];\n        if (node === this._root || node.active || !_.isEmpty(node.children)) break;\n        Vue.delete(ancestors[i - 1].children, segments[i]);\n      }\n      this._prunePath(segments.join('/'), this.findCoupledDescendantPaths(segments));\n    }\n  }\n\n  subscribe(query, operation, keysCallback) {\n    let queryHandler = this._queryHandlers[query.toString()];\n    if (!queryHandler) {\n      queryHandler = new QueryHandler(this, query);\n      Vue.set(this._queryHandlers, query.toString(), queryHandler);\n    }\n    queryHandler.attach(operation, keysCallback);\n }\n\n  unsubscribe(query, operation) {\n    const queryHandler = this._queryHandlers[query.toString()];\n    if (queryHandler && !queryHandler.detach(operation)) {\n      queryHandler.destroy();\n      Vue.delete(this._queryHandlers, query.toString());\n    }\n  }\n\n  // Return whether the node at path or any ancestors are coupled.\n  isTrunkCoupled(path) {\n    const segments = path.split('/');\n    let node;\n    for (const segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) return false;\n      if (node.active) return true;\n    }\n    return false;\n  }\n\n  findCoupledDescendantPaths(pathOrSegments) {\n    const segments = _.isString(pathOrSegments) ? pathOrSegments.split('/') : pathOrSegments;\n    let node;\n    for (const segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) break;\n    }\n    return node && node.collectCoupledDescendantPaths();\n  }\n\n  isSubtreeReady(path) {\n    const segments = path.split('/');\n    let node;\n    for (const segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) return false;\n      if (node.ready) return true;\n    }\n    return false;\n  }\n\n  isQueryReady(query) {\n    const queryHandler = this._queryHandlers[query.toString()];\n    return queryHandler && queryHandler.ready;\n  }\n\n}\n\n","// Generated by CoffeeScript 1.7.1\n(function() {\n  var getNanoSeconds, hrtime, loadTime;\n\n  if ((typeof performance !== \"undefined\" && performance !== null) && performance.now) {\n    module.exports = function() {\n      return performance.now();\n    };\n  } else if ((typeof process !== \"undefined\" && process !== null) && process.hrtime) {\n    module.exports = function() {\n      return (getNanoSeconds() - loadTime) / 1e6;\n    };\n    hrtime = process.hrtime;\n    getNanoSeconds = function() {\n      var hr;\n      hr = hrtime();\n      return hr[0] * 1e9 + hr[1];\n    };\n    loadTime = getNanoSeconds();\n  } else if (Date.now) {\n    module.exports = function() {\n      return Date.now() - loadTime;\n    };\n    loadTime = Date.now();\n  } else {\n    module.exports = function() {\n      return new Date().getTime() - loadTime;\n    };\n    loadTime = new Date().getTime();\n  }\n\n}).call(this);\n","import _ from 'lodash';\nimport Vue from 'vue';\nimport angularCompatibility from './angularCompatibility.js';\nimport Bridge from './Bridge.js';\nimport Connector from './Connector.js';\nimport Dispatcher from './Dispatcher.js';\nimport KeyGenerator from './KeyGenerator.js';\nimport MetaTree from './MetaTree.js';\nimport {Handle, Reference} from './Reference.js';\nimport Tree from './Tree.js';\nimport {\n  escapeKey, unescapeKey, wrapPromiseCallback, makePromiseCancelable, promiseFinally,\n  SERVER_TIMESTAMP\n} from './utils.js';\n\n\nlet bridge, logging;\nconst workerFunctions = {};\n// This version is filled in by the build, don't reformat the line.\nconst VERSION = 'dev';\n\n\nexport default class Truss {\n\n  /**\n   * Create a new Truss instance, specific to a given datastore.  To avoid confusion there should be\n   * exactly one Truss per root datastore URL, so in most code this will be a singleton.\n   *\n   * @param rootUrl {String} The root URL, https://{project}.firebaseio.com.\n   * @param classes {Array<Function>} A list of the classes to map onto the datastore structure.\n   *    Each class must have a static $trussMount property that is a (wildcarded) datastore path, or\n   *    an options object {path: string, placeholder: object}, or an array of either.\n   */\n  constructor(rootUrl, classes) {\n    // TODO: allow rootUrl to be a test database object for testing\n    if (!bridge) {\n      throw new Error('Truss worker not connected, please call Truss.connectWorker first');\n    }\n    this._rootUrl = rootUrl.replace(/\\/$/, '');\n    this._keyGenerator = new KeyGenerator();\n    this._dispatcher = new Dispatcher(bridge);\n    this._vue = new Vue();\n\n    bridge.trackServer(this._rootUrl);\n    this._metaTree = new MetaTree(this._rootUrl, bridge);\n    this._tree = new Tree(this, this._rootUrl, bridge, this._dispatcher);\n    this._tree.init(classes);\n  }\n\n  get meta() {return this._metaTree.root;}\n  get root() {return this._tree.root;}\n\n  destroy() {\n    this._vue.$destroy();\n    this._tree.destroy();\n    this._metaTree.destroy();\n  }\n\n  get now() {return Date.now() + this.meta.timeOffset;}\n  newKey() {return this._keyGenerator.generateUniqueKey(this.now);}\n\n  authenticate(token) {\n    return this._dispatcher.execute('auth', 'authenticate', new Reference(this._tree, '/'), () => {\n      return bridge.authWithCustomToken(this._rootUrl, token, {rememberMe: true});\n    });\n  }\n\n  unauthenticate() {\n    return this._dispatcher.execute(\n      'auth', 'unauthenticate', new Reference(this._tree, '/'), () => {\n        return bridge.unauth(this._rootUrl);\n      }\n    );\n  }\n\n  intercept(actionType, callbacks) {\n    return this._dispatcher.intercept(actionType, callbacks);\n  }\n\n  // connections are {key: Query | Object | fn() -> (Query | Object)}\n  connect(scope, connections) {\n    if (!connections) {\n      connections = scope;\n      scope = undefined;\n      if (connections instanceof Handle) connections = {_: connections};\n    }\n    return new Connector(scope, connections, this._tree, 'connect');\n  }\n\n  // target is Reference, Query, or connection Object like above\n  peek(target, callback) {\n    callback = wrapPromiseCallback(callback);\n    let cleanup, cancel;\n    const promise = new Promise((resolve, reject) => {\n      const scope = {};\n      let callbackPromise;\n\n      let connector = new Connector(scope, {result: target}, this._tree, 'peek');\n\n      let unintercept = this.intercept('peek', {onFailure: op => {\n        function match(descriptor) {\n          if (!descriptor) return;\n          if (descriptor instanceof Handle) return op.target.isEqual(descriptor);\n          return _.some(descriptor, value => match(value));\n        }\n        if (match(connector.at)) {\n          reject(op.error);\n          cleanup();\n        }\n      }});\n\n      let unwatch = this.watch(() => connector.ready, ready => {\n        if (!ready) return;\n        unwatch();\n        unwatch = null;\n        callbackPromise = promiseFinally(\n          callback(scope.result), () => {callbackPromise = null; cleanup();}\n        ).then(result => {resolve(result);}, error => {reject(error);});\n      });\n\n      cleanup = () => {\n        if (unwatch) {unwatch(); unwatch = null;}\n        if (unintercept) {unintercept(); unintercept = null;}\n        if (connector) {connector.destroy(); connector = null;}\n        if (callbackPromise && callbackPromise.cancel) callbackPromise.cancel();\n      };\n\n      cancel = () => {\n        reject(new Error('Canceled'));\n        cleanup();\n      };\n    });\n    makePromiseCancelable(promise, cancel);\n    return promise;\n  }\n\n  watch(subjectFn, callbackFn, options) {\n    let numCallbacks = 0;\n\n    const unwatch = this._vue.$watch(subjectFn, (newValue, oldValue) => {\n      numCallbacks++;\n      if (numCallbacks === 1) {\n        // Delay the immediate callback until we've had a chance to return the unwatch function.\n        Promise.resolve().then(() => {\n          if (numCallbacks > 1 || subjectFn() !== newValue) return;\n          callbackFn(newValue, oldValue);\n          angularCompatibility.digest();\n        });\n      } else {\n        callbackFn(newValue, oldValue);\n        angularCompatibility.digest();\n      }\n    }, {immediate: true, deep: options && options.deep});\n\n    return unwatch;\n  }\n\n  when(expression, options) {\n    let cleanup, timeoutHandle;\n    let promise = new Promise((resolve, reject) => {\n      let unwatch = this.watch(expression, value => {\n        if (value) {\n          resolve(value);\n          cleanup();\n        }\n      });\n      if (_.has(options, 'timeout')) {\n        timeoutHandle = setTimeout(() => {\n          timeoutHandle = null;\n          reject(new Error(options.timeoutMessage || 'Timeout'));\n          cleanup();\n        }, options.timeout);\n      }\n      cleanup = () => {\n        if (unwatch) {unwatch(); unwatch = null;}\n        if (timeoutHandle) {clearTimeout(timeoutHandle); timeoutHandle = null;}\n        reject(new Error('Canceled'));\n      };\n    });\n    promise = promiseFinally(promise, cleanup);\n    makePromiseCancelable(promise, cleanup);\n    return promise;\n  }\n\n  checkObjectsForRogueProperties() {\n    this._tree.checkVueObject(this._tree.root, '/');\n  }\n\n  static get computedPropertyStats() {return this._tree.computedPropertyStats;}\n\n  static connectWorker(webWorker) {\n    if (bridge) throw new Error('Worker already connected');\n    if (_.isString(webWorker)) {\n      const Worker = window.SharedWorker || window.Worker;\n      if (!Worker) throw new Error('Browser does not implement Web Workers');\n      webWorker = new Worker(webWorker);\n    }\n    bridge = new Bridge(webWorker);\n    if (logging) bridge.enableLogging(logging);\n    return bridge.init(webWorker).then(\n      ({exposedFunctionNames, firebaseSdkVersion}) => {\n        Object.defineProperty(Truss, 'FIREBASE_SDK_VERSION', {value: firebaseSdkVersion});\n        for (const name of exposedFunctionNames) {\n          Truss.worker[name] = bridge.bindExposedFunction(name);\n        }\n      }\n    );\n  }\n\n  static get worker() {return workerFunctions;}\n  static preExpose(functionName) {\n    Truss.worker[functionName] = bridge.bindExposedFunction(functionName);\n  }\n\n  static bounceConnection() {return bridge.bounceConnection();}\n  static suspend() {return bridge.suspend();}\n  static debugPermissionDeniedErrors(simulatedTokenGenerator, maxSimulationDuration, callFilter) {\n    return bridge.debugPermissionDeniedErrors(\n      simulatedTokenGenerator, maxSimulationDuration, callFilter);\n  }\n\n  static debounceAngularDigest(wait) {\n    angularCompatibility.debounceDigest(wait);\n  }\n\n  static escapeKey(key) {return escapeKey(key);}\n  static unescapeKey(escapedKey) {return unescapeKey(escapedKey);}\n\n  static enableLogging(fn) {\n    logging = fn;\n    if (bridge) bridge.enableLogging(fn);\n  }\n\n  // Duplicate static constants on instance for convenience.\n  get SERVER_TIMESTAMP() {return Truss.SERVER_TIMESTAMP;}\n  get VERSION() {return Truss.VERSION;}\n  get FIREBASE_SDK_VERSION() {return Truss.FIREBASE_SDK_VERSION;}\n}\n\nObject.defineProperties(Truss, {\n  SERVER_TIMESTAMP: {value: SERVER_TIMESTAMP},\n  VERSION: {value: VERSION}\n});\n\nangularCompatibility.defineModule(Truss);\n"]}