{"version":3,"sources":["../src/angularCompatibility.js","../src/utils.js","../src/Bridge.js","../src/Connector.js","../src/Modeler.js","../src/Tree.js","../src/Reference.js","../src/Dispatcher.js","../src/KeyGenerator.js","../src/MetaTree.js","../src/Coupler.js","../node_modules/performance-now/lib/performance-now.js","../src/Truss.js"],"names":["noop","escapeKey","key","toString","replace","char","charCodeAt","unescapeKey","code","String","fromCharCode","parseInt","slice","wrapPromiseCallback","callback","Promise","resolve","apply","this","arguments","e","reject","joinPath","segments","i","list","length","const","segment","charAt","splice","push","join","makePathMatcher","pattern","let","matcher","pathMatchers","PathMatcher","_","size","maxNumPathMatchers","keys","errorFromJson","json","params","Error","error","message","propertyName","hasOwnProperty","extra","getUrlRoot","url","k","indexOf","flattenRefs","refs","Handle","mapValues","computeValue","prop","stats","$$touchThis","startTime","performanceNow","get","call","ErrorWrapper","runtime","numRecomputes","isTrussValueEqual","a","b","$truss","checkUpdateHasOnlyDescendantsWithNoOverlap","rootPath","values","relativizePaths","each","path","startsWith","absolutePath","allPaths","map","sortBy","value","otherPath","toFirebaseJson","object","result","earlyDigestPending","bareDigest","angularProxy","active","window","angular","debounceDigest","wait","digest","debounce","forEach","method","watch","module","run","$rootScope","$evalAsync","bind","$watch","defineModule","Truss","constant","SERVER_TIMESTAMP","Object","freeze",".sv","variables","prefixMatch","endsWith","pathTemplate","match","test","_regex","RegExp","_parentRegex","prototype","lastIndex","exec","bindings","testParent","MIN_WORKER_VERSION","Snapshot","ref","valueError","exists","_path","_value","_valueError","_exists","undefined","prototypeAccessors","_checkValue","_key","Bridge","webWorker","_idCounter","_deferreds","_suspended","_servers","_callbacks","_log","_simulatedTokenGenerator","_maxSimulationDuration","_simulatedCallFilter","_inboundMessages","_outboundMessages","_flushMessageQueue","_port","port","_shared","onmessage","_receive","addEventListener","_send","msg","setInterval","init","items","storage","localStorage","sessionStorage","getItem","then","response","workerVersion","version","minVersion","sufficient","suspend","suspended","_receiveMessages","debugPermissionDeniedErrors","simulatedTokenGenerator","maxSimulationDuration","callFilter","enableLogging","fn","console","log","id","promise","oneWay","this$1","deferred","sent","resolveSent","postMessage","event","concat","data","messages","bindExposedFunction","name","args","Array","probeError","toLowerCase","_simulateCall","securityTrace","permissionDeniedDetails","props","simulatedCalls","spec","newValue","auth","getAuth","simulationPromise","uid","token","all","securityTraces","every","trace","filter","catch","timeoutPromise","setTimeout","race","updateLocalStorage","item","removeItem","setItem","trackServer","rootUrl","server","authListeners","authCallbackId","_registerCallback","_authCallback","callbackId","listener","onAuth","context","offAuth","authWithCustomToken","authToken","options","unauth","set","writeSerial","update","on","listenerKey","eventType","snapshotCallback","cancelCallback","handle","_onCallback","__callbackIds","off","idsToDeregister","_findAndRemoveCallbackId","i$1","list$1","_nullifyCallback","_deregisterCallback","snapshotJson","transaction","oldValue","relativeUpdates","onDisconnect","bounceConnection","predicate","EMPTY_ANNOTATIONS","tree","annotations","_tree","_annotations","$ref","_pathPrefix","parent","Reference","child","children","escapedKeys","arg","isArray","mapping","subPath","rest","subRef","subMapping","isEmpty","peek","truss","isEqual","that","belongsTo","Query","super","_spec","_copyAndValidateSpec","prototypeAccessors$1","ready","isQueryReady","constraints","annotate","extend","by","JSON","stringify","some","clause","clone","childPath","_string","queryTerms","encodeURIComponent","prototypeAccessors$2","isReferenceReady","getObject","query","obj","override","commit","updateFunction","Connector","scope","connections","_scope","_connections","_method","_refs","_subConnectors","_currentDescriptors","_disconnects","_vue","Vue","_linkScopeProperties","descriptor","isFunction","_bindComputedConnection","_connect","$on","$id","destroy","at","_unlinkScopeProperties","_angularUnwatches","unwatch","_disconnect","$destroy","defineProperties","configurable","enumerable","getter","_computeConnection","_updateComputedConnection","immediate","deep","newDescriptor","oldDescriptor","has","_updateConnections","updateFn","_updateScopeRef","connectReference","_updateScopeQuery","connectQuery","subScope","subRefs","subConnector","subReady","childKeys","changed","childKey","contains","delete","split","root","INTERCEPT_KEYS","EMPTY_ARRAY","SlowHandle","operation","delay","_operation","_delay","_callback","_fired","initiate","cancel","elapsed","Date","now","_startTimestamp","_timeoutId","clearTimeout","Operation","type","target","_type","_target","_ready","_running","_ended","_tries","_slowHandles","running","ended","tries","_error","onSlow","_setRunning","_setEnded","_markReady","_clearReady","_incrementTries","Dispatcher","bridge","_bridge","intercept","interceptKey","callbacks","badCallbackKeys","difference","wrappedCallbacks","onBefore","_addCallback","onAfter","onError","onFailure","_removeCallbacks","stage","_getCallbacksKey","wrappedCallback","_removeCallback","pull","_getCallbacks","operationType","execute","executor","createOperation","begin","executeWithRetries","_retryOrEnd","end","markReady","clearReady","retry","results","retrying","_afterEnd","onFailureCallbacks","ALPHABET","KeyGenerator","_lastUniqueKeyTime","_lastRandomValues","generateUniqueKey","chars","prefix","Math","floor","random","MetaTree","_rootUrl","$root","connected","timeOffset","user","userid","updateNowAtIntervals","intervalMillis","angularCompatibility","_handleAuthChange","_connectInfoProperty","$data","property","attribute","propertyUrl","snap","QueryHandler","coupler","_coupler","_query","_listeners","_keys","_url","_segments","_listening","attach","keysCallback","_listen","detach","findIndex","_handleSnapshot","_handleError","sync","_decoupleSegments","updatedKeys","_updateKeys","_applySnapshot","_dispatcher","sort","_coupleSegments","hasKey","Node","operations","queryCount","listening","count","listen","skip","op","unlisten","_forAllDescendants","node","isTrunkCoupled","iteratee","collectCoupledDescendantPaths","paths","Coupler","dispatcher","applySnapshot","prunePath","_prunePath","queryHandlers","_root","_queryHandlers","queryHandler","couple","superseded","decouple","ancestors","findCoupledDescendantPaths","subscribe","unsubscribe","pathOrSegments","isString","isSubtreeReady","getNanoSeconds","hrtime","loadTime","performance","exports","process","hr","getTime","RESERVED_VALUE_PROPERTY_NAMES","$parent","$key","$path","$$initializers","$$finalizers","__ob__","computedPropertyStats","Value","defineProperty","$refs","lastIndexOf","$keys","$values","$ready","$overridden","subjectFn","callbackFn","unwatchAndRemoveDestructor","$when","expression","when","originalCancel","$set","$update","$override","$commit","writable","ComputedPropertyStats","numUpdates","Modeler","classes","_mounts","uniq","Class","_mountClass","flatten","patterns","mount","badPaths","groupBy","group","compact","_augmentClass","computedProperties","proto","constructor","getOwnPropertyNames","getOwnPropertyDescriptor","fullName","getPrototypeOf","mounts","$trussMount","variable","escapedKey","placeholder","createObject","properties","_buildComputedPropertyDescriptor","writeAllowed","firstCallback","vue","isPlaceholder","forEachPlaceholderChild","checkVueObject","isObject","staticAccessors","Transaction","currentValue","outcome","_outcome","_values","_setOutcome","abort","","Tree","_truss","_firebasePropertyEditAllowed","_writeSerial","_localWrites","_localWriteTimestamp","_integrateSnapshot","_prune","_modeler","_createObject","_completeCreateObject","_plantPlaceholders","valueCallback","_checkHandle","_disconnectReference","_disconnected","_coupled","_disconnectQuery","numValues","_applyLocalWrite","_extractCommonPathPrefix","attemptTransaction","txn","committed","coupledDescendantPaths","offset","descendantPath","subValue","last","_plantValue","_scaffoldAncestors","prefixSegments","firstMismatchIndex","maxIndex","min","pathPrefix","_destroyObject","remoteWrite","dropRight","ancestorPath","_setFirebaseProperty","escapedChildKey","lockedDescendantPaths","_avoidLocalWritePaths","_pruneAncestors","_pruneDescendants","localWritePath","targetPath","targetObject","deleted","targetSegments","ghostObjects","_holdsConcreteData","_deleteFirebaseProperty","includes","coupledDescendantFound","valueLocked","shouldDelete","_getFirebasePropertyDescriptor","_overwriteFirebaseProperty","logging","workerFunctions","VERSION","_keyGenerator","_metaTree","meta","newKey","authenticate","rememberMe","unauthenticate","actionType","connect","connector","numCallbacks","checkObjectsForRogueProperties","connectWorker","Worker","SharedWorker","exposedFunctionNames","firebaseSdkVersion","worker","preExpose","functionName","debounceAngularDigest","FIREBASE_SDK_VERSION"],"mappings":"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","file":"firetruss.umd.min.js","sourcesContent":["/* globals window */\n\nimport _ from 'lodash';\n\n\nlet earlyDigestPending;\nlet bareDigest = function() {\n  earlyDigestPending = true;\n};\n\n\nconst angularProxy = {\n  active: typeof window !== 'undefined' && window.angular,\n  debounceDigest(wait) {\n    if (wait) {\n      angularProxy.digest = _.debounce(bareDigest, wait);\n    } else {\n      angularProxy.digest = bareDigest;\n    }\n  }\n};\n['digest', 'watch', 'defineModule'].forEach(method => {angularProxy[method] = noop;});\n\nif (angularProxy.active) {\n  angularProxy.digest = bareDigest;\n  angularProxy.watch = function() {throw new Error('Angular watch proxy not yet initialized');};\n  window.angular.module('firetruss', []).run(['$rootScope', function($rootScope) {\n    bareDigest = $rootScope.$evalAsync.bind($rootScope);\n    if (earlyDigestPending) bareDigest();\n    angularProxy.watch = $rootScope.$watch.bind($rootScope);\n  }]);\n  angularProxy.defineModule = function(Truss) {\n    window.angular.module('firetruss').constant('Truss', Truss);\n  };\n}\n\nfunction noop() {}\n\nexport default angularProxy;\n","import _ from 'lodash';\n\n\nexport const SERVER_TIMESTAMP = Object.freeze({'.sv': 'timestamp'});\n\nexport function escapeKey(key) {\n  if (!key) return key;\n  return key.toString().replace(/[\\\\\\.\\$\\#\\[\\]\\/]/g, function(char) {\n    return '\\\\' + char.charCodeAt(0).toString(16);\n  });\n}\n\nexport function unescapeKey(key) {\n  if (!key) return key;\n  return key.toString().replace(/\\\\[0-9a-f]{2}/gi, function(code) {\n    return String.fromCharCode(parseInt(code.slice(1), 16));\n  });\n}\n\nexport function wrapPromiseCallback(callback) {\n  return function() {\n    try {\n      return Promise.resolve(callback.apply(this, arguments));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n}\n\nexport function joinPath() {\n  const segments = [];\n  for (const segment of arguments) {\n    if (segment.charAt(0) === '/') segments.splice(0, segments.length);\n    segments.push(segment);\n  }\n  if (segments[0] === '/') segments[0] = '';\n  return segments.join('/');\n}\n\n\nconst pathMatchers = {};\nconst maxNumPathMatchers = 1000;\n\n\nclass PathMatcher {\n  constructor(pattern) {\n    this.variables = [];\n    const prefixMatch = _.endsWith(pattern, '/$*');\n    if (prefixMatch) pattern = pattern.slice(0, -3);\n    const pathTemplate = pattern.replace(/\\/\\$[^\\/]*/g, match => {\n      if (match.length > 1) this.variables.push(match.slice(1));\n      return '\\u0001';\n    });\n    Object.freeze(this.variables);\n    if (/[$-.?[-^{|}]/.test(pathTemplate)) {\n      throw new Error('Path pattern has unescaped keys: ' + pattern);\n    }\n    this._regex = new RegExp(\n      '^' + pathTemplate.replace(/\\u0001/g, '/([^/]+)') + (prefixMatch ? '($|/)' : '$'));\n    this._parentRegex = new RegExp(\n      '^' + (pathTemplate.replace(/\\/[^/]*$/, '').replace(/\\u0001/g, '/([^/]+)') || '/') + '$');\n  }\n\n  match(path) {\n    this._regex.lastIndex = 0;\n    const match = this._regex.exec(path);\n    if (!match) return;\n    const bindings = {};\n    for (let i = 0; i < this.variables.length; i++) {\n      bindings[this.variables[i]] = unescapeKey(match[i + 1]);\n    }\n    return bindings;\n  }\n\n  test(path) {\n    return this._regex.test(path);\n  }\n\n  testParent(path) {\n    return this._parentRegex.test(path);\n  }\n\n  toString() {\n    return this._regex.toString();\n  }\n}\n\n\nexport function makePathMatcher(pattern) {\n  let matcher = pathMatchers[pattern];\n  if (!matcher) {\n    matcher = new PathMatcher(pattern);\n    // Minimal pseudo-LRU behavior, since we don't expect to actually fill up the cache.\n    if (_.size(pathMatchers) === maxNumPathMatchers) delete pathMatchers[_.keys(pathMatchers)[0]];\n    pathMatchers[pattern] = matcher;\n  }\n  return matcher;\n}\n","import {unescapeKey} from './utils.js';\nimport _ from 'lodash';\n\n// jshint browser:true\n\nconst MIN_WORKER_VERSION = '0.4.0';\n\n\nclass Snapshot {\n  constructor({path, value, valueError, exists}) {\n    this._path = path;\n    this._value = value;\n    this._valueError = errorFromJson(valueError);\n    this._exists = value === undefined ? exists || false : value !== null;\n  }\n\n  get path() {\n    return this._path;\n  }\n\n  get exists() {\n    return this._exists;\n  }\n\n  get value() {\n    this._checkValue();\n    return this._value;\n  }\n\n  get key() {\n    if (this._key === undefined) this._key = unescapeKey(this._path.replace(/.*\\//, ''));\n    return this._key;\n  }\n\n  _checkValue() {\n    if (this._valueError) throw this._valueError;\n    if (this._value === undefined) throw new Error('Value omitted from snapshot');\n  }\n}\n\n\nexport default class Bridge {\n  constructor(webWorker) {\n    this._idCounter = 0;\n    this._deferreds = {};\n    this._suspended = false;\n    this._servers = {};\n    this._callbacks = {};\n    this._log = _.noop;\n    this._simulatedTokenGenerator = null;\n    this._maxSimulationDuration = 5000;\n    this._simulatedCallFilter = null;\n    this._inboundMessages = [];\n    this._outboundMessages = [];\n    this._flushMessageQueue = this._flushMessageQueue.bind(this);\n    this._port = webWorker.port || webWorker;\n    this._shared = !!webWorker.port;\n    this._port.onmessage = this._receive.bind(this);\n    window.addEventListener('unload', () => {this._send({msg: 'destroy'});});\n    setInterval(() => {this._send({msg: 'ping'});}, 60 * 1000);\n  }\n\n  init(webWorker) {\n    const items = [];\n    try {\n      const storage = window.localStorage || window.sessionStorage;\n      if (!storage) return;\n      for (let i = 0; i < storage.length; i++) {\n        const key = storage.key(i);\n        items.push({key, value: storage.getItem(key)});\n      }\n    } catch (e) {\n      // Some browsers don't like us accessing local storage -- nothing we can do.\n    }\n    return this._send({msg: 'init', storage: items}).then(response => {\n      const workerVersion = response.version.match(/^(\\d+)\\.(\\d+)\\.(\\d+)(-.*)?$/);\n      if (workerVersion) {\n        const minVersion = MIN_WORKER_VERSION.match(/^(\\d+)\\.(\\d+)\\.(\\d+)(-.*)?$/);\n        // Major version must match precisely, minor and patch must be greater than or equal.\n        const sufficient = workerVersion[1] === minVersion[1] && (\n          workerVersion[2] > minVersion[2] ||\n          workerVersion[2] === minVersion[2] && workerVersion[3] >= minVersion[3]\n        );\n        if (!sufficient) return Promise.reject(new Error(\n          `Incompatible Firetruss worker version: ${response.version} ` +\n          `(${MIN_WORKER_VERSION} or better required)`\n        ));\n      }\n      return response;\n    });\n  }\n\n  suspend(suspended) {\n    if (suspended === undefined) suspended = true;\n    if (this._suspended === suspended) return;\n    this._suspended = suspended;\n    if (!suspended) {\n      this._receiveMessages(this._inboundMessages);\n      this._inboundMessages = [];\n      if (this._outboundMessages.length) Promise.resolve().then(this._flushMessageQueue);\n    }\n  }\n\n  debugPermissionDeniedErrors(simulatedTokenGenerator, maxSimulationDuration, callFilter) {\n    this._simulatedTokenGenerator = simulatedTokenGenerator;\n    if (maxSimulationDuration !== undefined) this._maxSimulationDuration = maxSimulationDuration;\n    this._simulatedCallFilter = callFilter || function() {return true;};\n  }\n\n  enableLogging(fn) {\n    if (fn) {\n      if (fn === true) fn = console.log.bind(console);\n      this._log = fn;\n    } else {\n      this._log = _.noop;\n    }\n  }\n\n  _send(message) {\n    message.id = ++this._idCounter;\n    let promise;\n    if (message.oneWay) {\n      promise = Promise.resolve();\n    } else {\n      promise = new Promise((resolve, reject) => {\n        this._deferreds[message.id] = {resolve, reject};\n      });\n      const deferred = this._deferreds[message.id];\n      deferred.promise = promise;\n      promise.sent = new Promise(resolve => {\n        deferred.resolveSent = resolve;\n      });\n      deferred.params = message;\n    }\n    if (!this._outboundMessages.length && !this._suspended) {\n      Promise.resolve().then(this._flushMessageQueue);\n    }\n    this._log('send:', message);\n    this._outboundMessages.push(message);\n    return promise;\n  }\n\n  _flushMessageQueue() {\n    this._port.postMessage(this._outboundMessages);\n    this._outboundMessages = [];\n  }\n\n  _receive(event) {\n    if (this._suspended) {\n      this._inboundMessages = this._inboundMessages.concat(event.data);\n    } else {\n      this._receiveMessages(event.data);\n    }\n  }\n\n  _receiveMessages(messages) {\n    for (const message of messages) {\n      this._log('recv:', message);\n      const fn = this[message.msg];\n      if (typeof fn !== 'function') throw new Error('Unknown message: ' + message.msg);\n      fn.call(this, message);\n    }\n  }\n\n  bindExposedFunction(name) {\n    return (function() {\n      return this._send({msg: 'call', name, args: Array.prototype.slice.call(arguments)});\n    }).bind(this);\n  }\n\n  resolve(message) {\n    const deferred = this._deferreds[message.id];\n    if (!deferred) throw new Error('Received resolution to inexistent Firebase call');\n    delete this._deferreds[message.id];\n    deferred.resolve(message.result);\n  }\n\n  reject(message) {\n    const deferred = this._deferreds[message.id];\n    if (!deferred) throw new Error('Received rejection of inexistent Firebase call');\n    delete this._deferreds[message.id];\n    deferred.reject(errorFromJson(message.error, deferred.params));\n  }\n\n  probeError(error) {\n    const code = error.code || error.message;\n    if (error.params && code && code.toLowerCase() === 'permission_denied') {\n      return this._simulateCall(error.params).then(securityTrace => {\n        if (securityTrace) error.permissionDeniedDetails = securityTrace;\n      });\n    } else {\n      return Promise.resolve();\n    }\n  }\n\n  _simulateCall(props) {\n    if (!(this._simulatedTokenGenerator && this._maxSimulationDuration > 0)) {\n      return Promise.resolve();\n    }\n    let simulatedCalls = [];\n    switch (props.msg) {\n      case 'set':\n        simulatedCalls.push({method: 'set', url: props.url, args: [props.value]});\n        break;\n      case 'update':\n        simulatedCalls.push({method: 'update', url: props.url, args: [props.value]});\n        break;\n      case 'on':\n        simulatedCalls.push({method: 'once', url: props.url, spec: props.spec, args: ['value']});\n        break;\n      case 'transaction':\n        simulatedCalls.push({method: 'once', url: props.url, args: ['value']});\n        simulatedCalls.push({method: 'set', url: props.url, args: [props.newValue]});\n        break;\n    }\n    if (!simulatedCalls.length || !this._simulatedCallFilter(props.msg, props.url)) {\n      return Promise.resolve();\n    }\n    const auth = this.getAuth(getUrlRoot(props.url));\n    const simulationPromise = this._simulatedTokenGenerator(auth && auth.uid).then(token => {\n      return Promise.all(simulatedCalls.map(message => {\n        message.msg = 'simulate';\n        message.token = token;\n        return this._send(message);\n      }));\n    }).then(securityTraces => {\n      if (securityTraces.every(trace => trace === null)) {\n        return 'Unable to reproduce error in simulation';\n      }\n      return securityTraces.filter(trace => trace).join('\\n\\n');\n    }).catch(e => {\n      return 'Error running simulation: ' + e;\n    });\n    const timeoutPromise = new Promise(resolve => {\n      setTimeout(resolve.bind(null, 'Simulated call timed out'), this._maxSimulationDuration);\n    });\n    return Promise.race([simulationPromise, timeoutPromise]);\n  }\n\n  updateLocalStorage(items) {\n    try {\n      const storage = window.localStorage || window.sessionStorage;\n      for (const item in items) {\n        if (item.value === null) {\n          storage.removeItem(item.key);\n        } else {\n          storage.setItem(item.key, item.value);\n        }\n      }\n    } catch (e) {\n      // If we're denied access, there's nothing we can do.\n    }\n  }\n\n  trackServer(rootUrl) {\n    if (this._servers.hasOwnProperty(rootUrl)) return;\n    const server = this._servers[rootUrl] = {authListeners: []};\n    const authCallbackId = this._registerCallback(this._authCallback.bind(this, server));\n    this._send({msg: 'onAuth', url: rootUrl, callbackId: authCallbackId});\n  }\n\n  _authCallback(server, auth) {\n    server.auth = auth;\n    for (const listener of server.authListeners) listener(auth);\n  }\n\n  onAuth(rootUrl, callback, context) {\n    const listener = callback.bind(context);\n    listener.callback = callback;\n    listener.context = context;\n    this._servers[rootUrl].authListeners.push(listener);\n    listener(this.getAuth(rootUrl));\n  }\n\n  offAuth(rootUrl, callback, context) {\n    const authListeners = this._servers[rootUrl].authListeners;\n    for (let i = 0; i < authListeners.length; i++) {\n      const listener = authListeners[i];\n      if (listener.callback === callback && listener.context === context) {\n        authListeners.splice(i, 1);\n        break;\n      }\n    }\n  }\n\n  getAuth(rootUrl) {\n    return this._servers[rootUrl].auth;\n  }\n\n  authWithCustomToken(url, authToken, options) {\n    return this._send({msg: 'authWithCustomToken', url, authToken, options});\n  }\n\n  unauth(url) {\n    return this._send({msg: 'unauth', url});\n  }\n\n  set(url, value, writeSerial) {return this._send({msg: 'set', url, value, writeSerial});}\n  update(url, value, writeSerial) {return this._send({msg: 'update', url, value, writeSerial});}\n\n  on(listenerKey, url, spec, eventType, snapshotCallback, cancelCallback, context, options) {\n    const handle = {\n      listenerKey, eventType, snapshotCallback, cancelCallback, context,\n      params: {msg: 'on', listenerKey, url, spec, eventType, options}\n    };\n    const callback = this._onCallback.bind(this, handle);\n    this._registerCallback(callback, handle);\n    // Keep multiple IDs to allow the same snapshotCallback to be reused.\n    snapshotCallback.__callbackIds = snapshotCallback.__callbackIds || [];\n    snapshotCallback.__callbackIds.push(handle.id);\n    this._send({\n      msg: 'on', listenerKey, url, spec, eventType, callbackId: handle.id, options\n    }).catch(error => {\n      callback(error);\n    });\n  }\n\n  off(listenerKey, url, spec, eventType, snapshotCallback, context) {\n    const idsToDeregister = [];\n    let callbackId;\n    if (snapshotCallback) {\n      callbackId = this._findAndRemoveCallbackId(\n        snapshotCallback,\n        handle =>\n          handle.listenerKey === listenerKey && handle.eventType === eventType &&\n          handle.context === context\n      );\n      if (!callbackId) return Promise.resolve();  // no-op, never registered or already deregistered\n      idsToDeregister.push(callbackId);\n    } else {\n      for (const id of Object.keys(this._callbacks)) {\n        const handle = this._callbacks[id];\n        if (handle.listenerKey === listenerKey && (!eventType || handle.eventType === eventType)) {\n          idsToDeregister.push(id);\n        }\n      }\n    }\n    // Nullify callbacks first, then deregister after off() is complete.  We don't want any\n    // callbacks in flight from the worker to be invoked while the off() is processing, but we don't\n    // want them to throw an exception either.\n    for (const id of idsToDeregister) this._nullifyCallback(id);\n    return this._send({msg: 'off', listenerKey, url, spec, eventType, callbackId}).then(() => {\n      for (const id of idsToDeregister) this._deregisterCallback(id);\n    });\n  }\n\n  _onCallback(handle, error, snapshotJson) {\n    if (error) {\n      this._deregisterCallback(handle.id);\n      const e = errorFromJson(error, handle.params);\n      if (handle.cancelCallback) {\n        handle.cancelCallback.call(handle.context, e);\n      } else {\n        console.error(e);\n      }\n    } else {\n      handle.snapshotCallback.call(handle.context, new Snapshot(snapshotJson));\n    }\n  }\n\n  transaction(url, oldValue, relativeUpdates) {\n    return this._send({msg: 'transaction', url, oldValue, relativeUpdates});\n  }\n\n  onDisconnect(url, method, value) {\n    return this._send({msg: 'onDisconnect', url, method, value});\n  }\n\n  bounceConnection() {\n    return this._send({msg: 'bounceConnection'});\n  }\n\n  callback({id, args}) {\n    const handle = this._callbacks[id];\n    if (!handle) throw new Error('Unregistered callback: ' + id);\n    handle.callback.apply(null, args);\n  }\n\n  _registerCallback(callback, handle) {\n    handle = handle || {};\n    handle.callback = callback;\n    handle.id = `cb${++this._idCounter}`;\n    this._callbacks[handle.id] = handle;\n    return handle.id;\n  }\n\n  _nullifyCallback(id) {\n    this._callbacks[id].callback = noop;\n  }\n\n  _deregisterCallback(id) {\n    delete this._callbacks[id];\n  }\n\n  _findAndRemoveCallbackId(callback, predicate) {\n    if (!callback.__callbackIds) return;\n    let i = 0;\n    while (i < callback.__callbackIds.length) {\n      const id = callback.__callbackIds[i];\n      const handle = this._callbacks[id];\n      if (!handle) {\n        callback.__callbackIds.splice(i, 1);\n        continue;\n      }\n      if (predicate(handle)) {\n        callback.__callbackIds.splice(i, 1);\n        return id;\n      }\n      i += 1;\n    }\n  }\n}\n\n\nfunction noop() {}\n\nfunction errorFromJson(json, params) {\n  if (!json || json instanceof Error) return json;\n  const error = new Error(json.message);\n  error.params = params;\n  for (const propertyName in json) {\n    if (propertyName === 'message' || !json.hasOwnProperty(propertyName)) continue;\n    try {\n      error[propertyName] = json[propertyName];\n    } catch (e) {\n      e.extra = {propertyName};\n      throw e;\n    }\n  }\n  return error;\n}\n\nfunction getUrlRoot(url) {\n  const k = url.indexOf('/', 8);\n  return k >= 8 ? url.slice(0, k) : url;\n}\n","import {Handle, Query, Reference} from './Reference.js';\nimport angular from './angularCompatibility.js';\n\nimport _ from 'lodash';\nimport Vue from 'vue';\n\n\nexport default class Connector {\n  constructor(scope, connections, tree, method, refs) {\n    Object.freeze(connections);\n    this._scope = scope;\n    this._connections = connections;\n    this._tree = tree;\n    this._method = method;\n    this._refs = refs || {};\n    this._subConnectors = {};\n    this._currentDescriptors = {};\n    this._disconnects = {};\n    this._vue = new Vue({data: _.mapValues(connections, _.constant(undefined))});\n\n    this._linkScopeProperties();\n\n    _.each(connections, (descriptor, key) => {\n      if (_.isFunction(descriptor)) {\n        this._bindComputedConnection(key, descriptor);\n      } else {\n        this._connect(key, descriptor);\n      }\n    });\n\n    if (angular.active && scope && scope.$on && scope.$id) {\n      scope.$on('$destroy', () => {this.destroy();});\n    }\n  }\n\n  get ready() {\n    return _.every(this._currentDescriptors, (descriptor, key) => {\n      if (!descriptor) return false;\n      if (descriptor instanceof Handle) return descriptor.ready;\n      return this._subConnectors[key].ready;\n    });\n  }\n\n  get at() {\n    return this._refs;\n  }\n\n  destroy() {\n    this._unlinkScopeProperties();\n    _.each(this._angularUnwatches, unwatch => {unwatch();});\n    _.each(this._connections, (descriptor, key) => {this._disconnect(key);});\n    this._vue.$destroy();\n  }\n\n  _linkScopeProperties() {\n    if (!this._scope) return;\n    for (const key in this._connections) {\n      if (key in this._scope) {\n        throw new Error(`Property already defined on connection target: ${key}`);\n      }\n    }\n    Object.defineProperties(this._scope, _.mapValues(this._connections, (descriptor, key) => ({\n      configurable: true, enumerable: true, get: () => this._vue[key]\n    })));\n  }\n\n  _unlinkScopeProperties() {\n    if (!this._scope) return;\n    _.each(this._connections, (descriptor, key) => {\n      delete this._scope[key];\n    });\n  }\n\n  _bindComputedConnection(key, fn) {\n    const getter = this._computeConnection.bind(this, fn);\n    const update = this._updateComputedConnection.bind(this, key, fn);\n    // Use this._vue.$watch instead of truss.watch here so that we can disable the immediate\n    // callback if we'll get one from Angular anyway.\n    this._vue.$watch(getter, update, {immediate: !angular.active, deep: true});\n    if (angular.active) {\n      if (!this._angularUnwatches) this._angularUnwatches = [];\n      this._angularUnwatches.push(angular.watch(getter, update, true));\n    }\n  }\n\n  _computeConnection(fn) {\n    return flattenRefs(fn.call(this._scope));\n  }\n\n  _updateComputedConnection(key, value) {\n    const newDescriptor = _.isFunction(value) ? value(this._scope) : value;\n    const oldDescriptor = this._currentDescriptors[key];\n    if (oldDescriptor === newDescriptor ||\n        newDescriptor instanceof Handle && newDescriptor.isEqual(oldDescriptor)) return;\n    if (!newDescriptor) {\n      this._disconnect(key);\n      return;\n    }\n    if (newDescriptor instanceof Handle || !_.has(this._subConnectors, key)) {\n      this._disconnect(key);\n      this._connect(key, newDescriptor);\n    } else {\n      this._subConnectors[key]._updateConnections(newDescriptor);\n    }\n    this._currentDescriptors[key] = newDescriptor;\n  }\n\n  _updateConnections(connections) {\n    _.each(connections, (descriptor, key) => {\n      this._updateComputedConnection(key, descriptor);\n    });\n    _.each(this._connections, (descriptor, key) => {\n      if (!_.has(connections, key)) this._updateComputedConnection(key);\n    });\n    this._connections = connections;\n  }\n\n  _connect(key, descriptor) {\n    this._currentDescriptors[key] = descriptor;\n    if (!descriptor) return;\n    if (descriptor instanceof Reference) {\n      this._refs[key] = descriptor;\n      const updateFn = this._scope ? this._updateScopeRef.bind(this, key) : null;\n      this._disconnects[key] = this._tree.connectReference(descriptor, updateFn, this._method);\n    } else if (descriptor instanceof Query) {\n      this._refs[key] = descriptor;\n      const updateFn = this._scope ? this._updateScopeQuery.bind(this, key) : null;\n      this._disconnects[key] = this._tree.connectQuery(descriptor, updateFn, this._method);\n    } else {\n      const subScope = {}, subRefs = {};\n      this._refs[key] = subRefs;\n      const subConnector = this._subConnectors[key] =\n        new Connector(subScope, descriptor, this._tree, this._method, subRefs);\n      if (this._scope) {\n        // Use a truss.watch here instead of this._vue.$watch so that the \"immediate\" execution\n        // actually takes place after we've captured the unwatch function, in case the subConnector\n        // is ready immediately.\n        const unwatch = this._disconnects[key] = this._tree.truss.watch(\n          () => subConnector.ready,\n          subReady => {\n            if (!subReady) return;\n            unwatch();\n            delete this._disconnects[key];\n            Vue.set(this._vue, key, subScope);\n            angular.digest();\n          }\n        );\n      }\n    }\n  }\n\n  _disconnect(key) {\n    delete this._refs[key];\n    if (this._scope) this._updateScopeRef(key, undefined);\n    if (_.has(this._subConnectors, key)) {\n      this._subConnectors[key].destroy();\n      delete this._subConnectors[key];\n    }\n    if (this._disconnects[key]) this._disconnects[key]();\n    delete this._disconnects[key];\n    delete this._currentDescriptors[key];\n  }\n\n  _updateScopeRef(key, value) {\n    if (this._vue[key] !== value) {\n      Vue.set(this._vue, key, value);\n      angular.digest();\n    }\n  }\n\n  _updateScopeQuery(key, childKeys) {\n    let changed = false;\n    if (!this._vue[key]) {\n      Vue.set(this._vue, key, {});\n      changed = true;\n    }\n    const subScope = this._vue[key];\n    for (const childKey in subScope) {\n      if (!subScope.hasOwnProperty(childKey)) continue;\n      if (!_.contains(childKeys, childKey)) {\n        Vue.delete(subScope, childKey);\n        changed = true;\n      }\n    }\n    let object;\n    for (const segment of this._currentDescriptors[key].path.split('/')) {\n      object = segment ? object[segment] : this._tree.root;\n    }\n    for (const childKey of childKeys) {\n      if (subScope.hasOwnProperty(childKey)) continue;\n      Vue.set(subScope, childKey, object[childKey]);\n      changed = true;\n    }\n    if (changed) angular.digest();\n  }\n\n}\n\nfunction flattenRefs(refs) {\n  if (!refs) return;\n  if (refs instanceof Handle) return refs.toString();\n  return _.mapValues(refs, flattenRefs);\n}\n\n","import Reference from './Reference.js';\nimport {makePathMatcher, joinPath, escapeKey, unescapeKey} from './utils.js';\n\nimport _ from 'lodash';\nimport performanceNow from 'performance-now';\n\n// These are defined separately for each object so they're not included in Value below.\nconst RESERVED_VALUE_PROPERTY_NAMES = {\n  $truss: true, $parent: true, $key: true, $path: true, $ref: true,\n  $$touchThis: true, $$initializers: true, $$finalizers: true,\n  __ob__: true\n};\n\nconst computedPropertyStats = {};\n\n\nclass Value {\n  get $truss() {\n    Object.defineProperty(this, '$truss', {value: this.$parent.$truss});\n    return this.$truss;\n  }\n  get $ref() {\n    Object.defineProperty(this, '$ref', {value: new Reference(this.$truss._tree, this.$path)});\n    return this.$ref;\n  }\n  get $refs() {return this.$ref;}\n  get $key() {\n    Object.defineProperty(\n      this, '$key', {value: unescapeKey(this.$path.slice(this.$path.lastIndexOf('/') + 1))});\n    return this.$key;\n  }\n  get $keys() {return _.keys(this);}\n  get $values() {return _.values(this);}\n  get $root() {return this.$truss.root;}  // access indirectly to leave dependency trace\n  get $ready() {return this.$ref.ready;}\n  get $overridden() {return false;}\n\n  $watch(subjectFn, callbackFn, options) {\n    let unwatchAndRemoveDestructor;\n\n    const unwatch = this.$truss.watch(() => {\n      this.$$touchThis();\n      return subjectFn.call(this);\n    }, callbackFn.bind(this), options);\n\n    unwatchAndRemoveDestructor = () => {\n      unwatch();\n      _.pull(this.$$finalizers, unwatchAndRemoveDestructor);\n    };\n    this.$$finalizers.push(unwatchAndRemoveDestructor);\n    return unwatchAndRemoveDestructor;\n  }\n\n  $when(expression, options) {\n    const promise = this.$truss.when(() => {\n      this.$$touchThis();\n      return expression.call(this);\n    }, options);\n\n    const originalCancel = promise.cancel;\n    promise.cancel = () => {\n      originalCancel();\n      _.pull(this.$$finalizers, promise.cancel);\n    };\n    this.$$finalizers.push(promise.cancel);\n    return promise;\n  }\n\n  $set(value) {return this.$ref.set(value);}\n  $update(values) {return this.$ref.update(values);}\n  $override(values) {return this.$ref.override(values);}\n  $commit(options, updateFn) {return this.$ref.commit(options, updateFn);}\n\n  $$touchThis() {\n    // jshint expr:true\n    if (this.$parent) this.$parent[this.$key]; else this.$root;\n    // jshint expr:false\n  }\n\n  get $$finalizers() {\n    Object.defineProperty(this, '$$finalizers', {\n      value: [], writable: false, enumerable: false, configurable: false});\n    return this.$$finalizers;\n  }\n}\n\nclass ComputedPropertyStats {\n  constructor(name) {\n    _.extend(this, {name, numRecomputes: 0, numUpdates: 0, runtime: 0});\n  }\n}\n\nclass ErrorWrapper {\n  constructor(error) {\n    this.error = error;\n  }\n}\n\n\nexport default class Modeler {\n  constructor(classes) {\n    this._mounts = _(classes).uniq().map(Class => this._mountClass(Class)).flatten().value();\n    const patterns = _.map(this._mounts, mount => mount.matcher.toString());\n    if (patterns.length !== _.uniq(patterns).length) {\n      const badPaths = _(patterns)\n        .groupBy()\n        .map((group, key) =>\n          group.length === 1 ? null : key.replace(/\\(\\[\\^\\/\\]\\+\\)/g, '$').slice(1, -1))\n        .compact()\n        .value();\n      throw new Error('Paths have multiple mounted classes: ' + badPaths.join(', '));\n    }\n  }\n\n  destroy() {\n  }\n\n  _augmentClass(Class) {\n    let computedProperties;\n    let proto = Class.prototype;\n    while (proto && proto.constructor !== Object) {\n      for (const name of Object.getOwnPropertyNames(proto)) {\n        const descriptor = Object.getOwnPropertyDescriptor(proto, name);\n        if (name.charAt(0) === '$') {\n          if (_.isEqual(descriptor, Object.getOwnPropertyDescriptor(Value.prototype, name))) {\n            continue;\n          }\n          throw new Error(`Property names starting with \"$\" are reserved: ${Class.name}.${name}`);\n        }\n        if (descriptor.set) {\n          throw new Error(`Computed properties must not have a setter: ${Class.name}.${name}`);\n        }\n        if (descriptor.get && !(computedProperties && computedProperties[name])) {\n          (computedProperties || (computedProperties = {}))[name] = {\n            name, fullName: `${proto.constructor.name}.${name}`, get: descriptor.get\n          };\n        }\n      }\n      proto = Object.getPrototypeOf(proto);\n    }\n    for (const name of Object.getOwnPropertyNames(Value.prototype)) {\n      if (name === 'constructor' || Class.prototype.hasOwnProperty(name)) continue;\n      Object.defineProperty(\n        Class.prototype, name, Object.getOwnPropertyDescriptor(Value.prototype, name));\n    }\n    return computedProperties;\n  }\n\n  _mountClass(Class) {\n    const computedProperties = this._augmentClass(Class);\n    let mounts = Class.$trussMount;\n    if (!mounts) throw new Error(`Class ${Class.name} lacks a $trussMount static property`);\n    if (!_.isArray(mounts)) mounts = [mounts];\n    return _.map(mounts, mount => {\n      if (_.isString(mount)) mount = {path: mount};\n      const matcher = makePathMatcher(mount.path);\n      for (const variable of matcher.variables) {\n        if (variable === '$' || variable.charAt(1) === '$') {\n          throw new Error(`Invalid variable name: ${variable}`);\n        }\n        if (variable.charAt(0) === '$' && (\n            _.has(Value.prototype, variable) || RESERVED_VALUE_PROPERTY_NAMES[variable]\n        )) {\n          throw new Error(`Variable name conflicts with built-in property or method: ${variable}`);\n        }\n      }\n      const escapedKey = mount.path.match(/\\/([^/]*)$/)[1];\n      if (mount.placeholder && escapedKey.charAt(0) === '$') {\n        throw new Error(\n          `Class ${Class.name} mounted at wildcard ${escapedKey} cannot be a placeholder`);\n      }\n      return {Class, matcher, computedProperties, escapedKey, placeholder: mount.placeholder};\n    });\n  }\n\n  /**\n   * Creates a Truss object and sets all its basic properties: path segment variables, user-defined\n   * properties, and computed properties.  The latter two will be enumerable so that Vue will pick\n   * them up and make the reactive, so you should call _completeCreateObject once it's done so and\n   * before any Firebase properties are added.\n   */\n  createObject(path, properties, truss) {\n    let Class = Value;\n    let computedProperties;\n    for (const mount of this._mounts) {\n      const match = mount.matcher.match(path);\n      if (match) {\n        Class = mount.Class;\n        computedProperties = mount.computedProperties;\n        for (const variable in match) {\n          properties[variable] = {\n            value: match[variable], writable: false, configurable: false, enumerable: false\n          };\n        }\n        break;\n      }\n    }\n\n    const object = new Class(truss);\n\n    if (computedProperties) {\n      _.each(computedProperties, prop => {\n        properties[prop.name] = this._buildComputedPropertyDescriptor(object, prop);\n      });\n    }\n\n    return object;\n  }\n\n  _buildComputedPropertyDescriptor(object, prop) {\n    if (!computedPropertyStats[prop.fullName]) {\n      Object.defineProperty(computedPropertyStats, prop.fullName, {\n        value: new ComputedPropertyStats(prop.fullName), writable: false, enumerable: true,\n        configurable: false\n      });\n    }\n    const stats = computedPropertyStats[prop.fullName];\n\n    let value;\n    let writeAllowed = false;\n    let firstCallback = true;\n\n    if (!object.$$initializers) {\n      Object.defineProperty(object, '$$initializers', {\n        value: [], writable: false, enumerable: false, configurable: true});\n    }\n    object.$$initializers.push(vue => {\n      object.$$finalizers.push(\n        vue.$watch(computeValue.bind(object, prop, stats), newValue => {\n          if (firstCallback) {\n            stats.numUpdates += 1;\n            value = newValue;\n            firstCallback = false;\n          } else {\n            if (_.isEqual(value, newValue, isTrussValueEqual)) return;\n            stats.numUpdates += 1;\n            writeAllowed = true;\n            object[prop.name] = newValue;\n            writeAllowed = false;\n          }\n        }, {immediate: true})  // use immediate:true since watcher will run computeValue anyway\n      );\n    });\n    return {\n      enumerable: true, configurable: true,\n      get: function() {\n        if (value instanceof ErrorWrapper) throw value.error;\n        return value;\n      },\n      set: function(newValue) {\n        if (!writeAllowed) throw new Error(`You cannot set a computed property: ${prop.name}`);\n        value = newValue;\n      }\n    };\n  }\n\n  isPlaceholder(path) {\n    // TODO: optimize by precomputing a single all-placeholder-paths regex\n    return _.some(this._mounts, mount => mount.placeholder && mount.matcher.test(path));\n  }\n\n  forEachPlaceholderChild(path, iteratee) {\n    _.each(this._mounts, mount => {\n      if (mount.placeholder && mount.matcher.testParent(path)) {\n        iteratee(mount.escapedKey, mount.placeholder);\n      }\n    });\n  }\n\n  checkVueObject(object, path) {\n    for (const key of Object.getOwnPropertyNames(object)) {\n      if (RESERVED_VALUE_PROPERTY_NAMES[key]) continue;\n      const descriptor = Object.getOwnPropertyDescriptor(object, key);\n      if ('value' in descriptor || !descriptor.get || !descriptor.set) {\n        throw new Error(`Firetruss object at ${path} has a rogue property: ${key}`);\n      }\n      const value = object[key];\n      if (_.isObject(value)) this.checkVueObject(value, joinPath(path, escapeKey(key)));\n    }\n  }\n\n  static get computedPropertyStats() {\n    return computedPropertyStats;\n  }\n}\n\n\nfunction computeValue(prop, stats) {\n  // jshint validthis: true\n  // Touch this object, since a failed access to a missing property doesn't get captured as a\n  // dependency.\n  this.$$touchThis();\n\n  const startTime = performanceNow();\n  try {\n    return prop.get.call(this);\n  } catch (e) {\n    return new ErrorWrapper(e);\n  } finally {\n    stats.runtime += performanceNow() - startTime;\n    stats.numRecomputes += 1;\n  }\n  // jshint validthis: false\n}\n\nfunction isTrussValueEqual(a, b) {\n  if (a && a.$truss || b && b.$truss) return a === b;\n}\n","import angularCompatibility from './angularCompatibility.js';\nimport Coupler from './Coupler.js';\nimport Modeler from './Modeler.js';\nimport {escapeKey, unescapeKey, joinPath, SERVER_TIMESTAMP} from './utils.js';\n\nimport _ from 'lodash';\nimport Vue from 'vue';\n\n\nclass Transaction {\n  constructor(path, tree) {\n    this._path = path;\n    this._tree = tree;\n  }\n\n  get currentValue() {return this._tree.getObject(this._path);}\n  get outcome() {return this._outcome;}\n  get values() {return this._values;}\n\n  _setOutcome(value) {\n    if (this._outcome) throw new Error('Transaction already resolved with ' + this._outcome);\n    this._outcome = value;\n  }\n\n  abort() {\n    this._setOutcome('abort');\n  }\n\n  cancel() {\n    this._setOutcome('cancel');\n  }\n\n  set(value) {\n    if (value === undefined) throw new Error('Invalid argument: undefined');\n    this._setOutcome('set');\n    this._values = {'': value};\n  }\n\n  update(values) {\n    if (values === undefined) throw new Error('Invalid argument: undefined');\n    if (_.isEmpty(values)) return this.cancel();\n    this._setOutcome('update');\n    this._values = values;\n  }\n}\n\n\nexport default class Tree {\n  constructor(truss, rootUrl, bridge, dispatcher) {\n    this._truss = truss;\n    this._rootUrl = rootUrl;\n    this._bridge = bridge;\n    this._dispatcher = dispatcher;\n    this._firebasePropertyEditAllowed = false;\n    this._writeSerial = 0;\n    this._localWrites = {};\n    this._localWriteTimestamp = null;\n    this._coupler = new Coupler(\n      rootUrl, bridge, dispatcher, this._integrateSnapshot.bind(this), this._prune.bind(this));\n    this._vue = new Vue({data: {$root: undefined}});\n    if (angularCompatibility.active) {\n      this._vue.$watch('$data', angularCompatibility.digest, {deep: true});\n    }\n    // Call this.init(classes) to complete initialization; we need two phases so that truss can bind\n    // the tree into its own accessors prior to defining computed functions, which may try to\n    // access the tree root via truss.\n  }\n\n  get root() {\n    return this._vue.$data.$root;\n  }\n\n  get truss() {\n    return this._truss;\n  }\n\n  init(classes) {\n    this._modeler = new Modeler(classes);\n    this._vue.$data.$root = this._createObject('/', '');\n    this._completeCreateObject(this.root);\n    this._plantPlaceholders(this.root, '/');\n  }\n\n  destroy() {\n    this._coupler.destroy();\n    if (this._modeler) this._modeler.destroy();\n    this._vue.$destroy();\n  }\n\n  connectReference(ref, valueCallback, method) {\n    this._checkHandle(ref);\n    const operation = this._dispatcher.createOperation('read', method, ref);\n    let unwatch;\n    if (valueCallback) {\n      const segments = _(ref.path).split('/').map(segment => unescapeKey(segment)).value();\n      unwatch = this._vue.$watch(\n        this.getObject.bind(this, segments), valueCallback, {immediate: true});\n    }\n    operation._disconnect = this._disconnectReference.bind(this, ref, operation, unwatch);\n    this._dispatcher.begin(operation).then(() => {\n      if (operation.running && !operation._disconnected) {\n        this._coupler.couple(ref.path, operation);\n        operation._coupled = true;\n      }\n    }).catch(e => {});  // ignore exception, let onFailure handlers deal with it\n    return operation._disconnect;\n  }\n\n  _disconnectReference(ref, operation, unwatch, error) {\n    if (operation._disconnected) return;\n    operation._disconnected = true;\n    if (unwatch) unwatch();\n    if (operation._coupled) {\n      this._coupler.decouple(ref.path, operation);  // will call back to _prune if necessary\n      operation._coupled = false;\n    }\n    this._dispatcher.end(operation, error).catch(e => {});\n  }\n\n  isReferenceReady(ref) {\n    this._checkHandle(ref);\n    return this._coupler.isSubtreeReady(ref.path);\n  }\n\n  connectQuery(query, keysCallback, method) {\n    this._checkHandle(query);\n    const operation = this._dispatcher.createOperation('read', method, query);\n    operation._disconnect = this._disconnectQuery.bind(this, query, operation);\n    this._dispatcher.begin(operation).then(() => {\n      if (operation.running && !operation._disconnected) {\n        this._coupler.subscribe(query, operation, keysCallback);\n        operation._coupled = true;\n      }\n    }).catch(e => {});  // ignore exception, let onFailure handlers deal with it\n    return operation._disconnect;\n  }\n\n  _disconnectQuery(query, operation, error) {\n    if (operation._disconnected) return;\n    operation._disconnected = true;\n    if (operation._coupled) {\n      this._coupler.unsubscribe(query, operation);  // will call back to _prune if necessary\n      operation._coupled = false;\n    }\n    this._dispatcher.end(operation, error).catch(e => {});\n  }\n\n  isQueryReady(query) {\n    return this._coupler.isQueryReady(query);\n  }\n\n  _checkHandle(handle) {\n    if (!handle.belongsTo(this._truss)) {\n      throw new Error('Reference belongs to another Truss instance');\n    }\n  }\n\n  update(ref, method, values) {\n    const numValues = _.size(values);\n    if (!numValues) return;\n    if (method === 'update' || method === 'override') {\n      checkUpdateHasOnlyDescendantsWithNoOverlap(ref.path, values);\n    }\n    this._applyLocalWrite(values, method === 'override');\n    if (method === 'override') return Promise.resolve();\n    const url = this._rootUrl + this._extractCommonPathPrefix(values);\n    return this._dispatcher.execute('write', method, ref, () => {\n      if (numValues === 1) {\n        return this._bridge.set(url, values[''], this._writeSerial);\n      } else {\n        return this._bridge.update(url, values, this._writeSerial);\n      }\n    });\n  }\n\n  commit(ref, updateFunction) {\n    let tries = 0;\n\n    const attemptTransaction = () => {\n      if (tries++ >= 25) return Promise.reject(new Error('maxretry'));\n      const txn = new Transaction();\n      try {\n        updateFunction(txn);\n      } catch (e) {\n        return Promise.reject(e);\n      }\n      const oldValue = toFirebaseJson(this.getObject(ref.path));\n      switch (txn.outcome) {\n        case 'abort': return;\n        case 'cancel':\n          break;\n        case 'set':\n          this._applyLocalWrite({[ref.path]: txn.values['']});\n          break;\n        case 'update':\n          checkUpdateHasOnlyDescendantsWithNoOverlap(ref.path, txn.values, true);\n          this._applyLocalWrite(txn.values);\n          break;\n        default:\n          throw new Error('Invalid transaction outcome: ' + (txn.outcome || 'none'));\n      }\n      return this._bridge.transaction(\n        this._rootUrl + ref.path, oldValue, txn.values\n      ).then(committed => {\n        if (!committed) return attemptTransaction();\n        return txn;\n      });\n    };\n\n    return this._truss.peek(ref, () => {\n      return this._dispatcher.execute('write', 'commit', ref, attemptTransaction);\n    });\n  }\n\n  _applyLocalWrite(values, override) {\n    // TODO: correctly apply local writes that impact queries.  Currently, a local write will update\n    // any objects currently selected by a query, but won't add or remove results.\n    this._writeSerial++;\n    this._localWriteTimestamp = this._truss.now;\n    _.each(values, (value, path) => {\n      const coupledDescendantPaths = this._coupler.findCoupledDescendantPaths(path);\n      if (_.isEmpty(coupledDescendantPaths)) return;\n      const offset = (path === '/' ? 0 : path.length) + 1;\n      for (const descendantPath of coupledDescendantPaths) {\n        const subPath = descendantPath.slice(offset);\n        let subValue = value;\n        if (subPath) {\n          const segments = subPath.split('/');\n          for (const segment of segments) {\n            subValue = subValue[unescapeKey(segment)];\n            if (subValue === undefined) break;\n          }\n        }\n        if (subValue === undefined || subValue === null) {\n          this._prune(subPath);\n        } else {\n          const key = unescapeKey(_.last(descendantPath.split('/')));\n          this._plantValue(\n            descendantPath, key, subValue, this._scaffoldAncestors(descendantPath), false,\n            override\n          );\n        }\n        if (!override) this._localWrites[descendantPath] = this._writeSerial;\n      }\n    });\n  }\n\n  _extractCommonPathPrefix(values) {\n    let prefixSegments;\n    _.each(values, (value, path) => {\n      const segments = path === '/' ? [''] : path.split('/');\n      if (prefixSegments) {\n        let firstMismatchIndex = 0;\n        const maxIndex = Math.min(prefixSegments.length, segments.length);\n        while (firstMismatchIndex < maxIndex &&\n               prefixSegments[firstMismatchIndex] === segments[firstMismatchIndex]) {\n          firstMismatchIndex++;\n        }\n        prefixSegments = prefixSegments.slice(0, firstMismatchIndex);\n        if (!prefixSegments.length) return false;\n      } else {\n        prefixSegments = segments;\n      }\n    });\n    const pathPrefix = prefixSegments.length === 1 ? '/' : prefixSegments.join('/');\n    _.each(_.keys(values), key => {\n      values[key.slice(pathPrefix.length + 1)] = values[key];\n      delete values[key];\n    });\n    return pathPrefix;\n  }\n\n  /**\n   * Creates a Truss object and sets all its basic properties: path segment variables, user-defined\n   * properties, and computed properties.  The latter two will be enumerable so that Vue will pick\n   * them up and make the reactive, so you should call _completeCreateObject once it's done so and\n   * before any Firebase properties are added.\n   */\n  _createObject(path, key, parent) {\n    let properties = {\n      // We want Vue to wrap this; we'll make it non-enumerable in _completeCreateObject.\n      $parent: {value: parent, configurable: true, enumerable: true},\n      $path: {value: path},\n      // $$touchThis: {\n      //   value: parent ? () => parent[key] : () => this._vue.$data.$root,\n      //   writable: false, configurable: false, enumerable: false\n      // }\n    };\n    if (path === '/') properties.$truss = {value: this._truss};\n\n    const object = this._modeler.createObject(path, properties, this._truss);\n    Object.defineProperties(object, properties);\n    return object;\n  }\n\n  // To be called on the result of _createObject after it's been inserted into the _vue hierarchy\n  // and Vue has had a chance to initialize it.\n  _completeCreateObject(object) {\n    for (const name of Object.getOwnPropertyNames(object)) {\n      const descriptor = Object.getOwnPropertyDescriptor(object, name);\n      if (descriptor.configurable && descriptor.enumerable) {\n        descriptor.enumerable = false;\n        if (name === '$parent') descriptor.configurable = false;\n        Object.defineProperty(object, name, descriptor);\n      }\n    }\n    if (object.$$initializers) {\n      for (const fn of object.$$initializers) fn(this._vue);\n      delete object.$$initializers;\n    }\n  }\n\n  _destroyObject(object) {\n    if (!(object && object.$truss)) return;\n    if (object.$$finalizers) {\n      // Some destructors remove themselves from the array, so clone it before iterating.\n      for (const fn of _.clone(object.$$finalizers)) fn();\n    }\n    for (const key in object) {\n      if (!Object.hasOwnProperty(object, key)) continue;\n      this._destroyObject(object[key]);\n    }\n  }\n\n  _integrateSnapshot(snap) {\n    _.each(_.keys(this._localWrites), (writeSerial, path) => {\n      if (snap.writeSerial >= writeSerial) delete this._localWrites[path];\n    });\n    if (snap.exists) {\n      const parent = this._scaffoldAncestors(snap.path, true);\n      if (parent) this._plantValue(snap.path, snap.key, snap.value, parent, true, false);\n    } else {\n      this._prune(snap.path, null, true);\n    }\n  }\n\n  _scaffoldAncestors(path, remoteWrite) {\n    let object;\n    const segments = _(path).split('/').dropRight().value();\n    _.each(segments, (segment, i) => {\n      const childKey = unescapeKey(segment);\n      let child = childKey ? object[childKey] : this.root;\n      if (!child) {\n        const ancestorPath = segments.slice(0, i + 1).join('/');\n        if (remoteWrite && this._localWrites[ancestorPath || '/']) return;\n        child = this._plantValue(ancestorPath, childKey, {}, object);\n      }\n      object = child;\n    });\n    return object;\n  }\n\n  _plantValue(path, key, value, parent, remoteWrite, override) {\n    if (value === null || value === undefined) {\n      throw new Error('Snapshot includes invalid value: ' + value);\n    }\n    if (remoteWrite && this._localWrites[path]) return;\n    if (value === SERVER_TIMESTAMP) value = this._localWriteTimestamp;\n    if (!_.isArray(value) && !_.isObject(value)) {\n      this._setFirebaseProperty(parent, key, value);\n      return;\n    }\n    let object = parent[key];\n    if (!_.isObject(object)) {\n      object = this._createObject(path, key, parent);\n      this._setFirebaseProperty(parent, key, object);\n      this._completeCreateObject(object);\n    }\n    if (override) {\n      Object.defineProperty(object, '$overridden', {get: _.constant(true), configurable: true});\n    } else if (object.$overridden) {\n      delete object.$overridden;\n    }\n    _.each(value, (item, escapedChildKey) => {\n      this._plantValue(\n        joinPath(path, escapedChildKey), unescapeKey(escapedChildKey), item, object, remoteWrite,\n        override\n      );\n    });\n    _.each(object, (item, childKey) => {\n      const escapedChildKey = escapeKey(childKey);\n      if (!value.hasOwnProperty(escapedChildKey)) {\n        this._prune(joinPath(path, escapedChildKey), null, remoteWrite);\n      }\n    });\n    this._plantPlaceholders(object, path);\n    return object;\n  }\n\n  _plantPlaceholders(object, path) {\n    this._modeler.forEachPlaceholderChild(path, (escapedKey, placeholder) => {\n      const key = unescapeKey(escapedKey);\n      if (!object.hasOwnProperty(key)) {\n        this._plantValue(joinPath(path, escapedKey), key, placeholder, object);\n      }\n    });\n  }\n\n  _prune(path, lockedDescendantPaths, remoteWrite) {\n    lockedDescendantPaths = lockedDescendantPaths || {};\n    const object = this.getObject(path);\n    if (object === undefined) return;\n    if (remoteWrite && this._avoidLocalWritePaths(path, lockedDescendantPaths)) return;\n    if (!(_.isEmpty(lockedDescendantPaths) && this._pruneAncestors(path, object)) &&\n        _.isObject(object)) {\n      // The target object is a placeholder, and all ancestors are placeholders or otherwise needed\n      // as well, so we can't delete it.  Instead, dive into its descendants to delete what we can.\n      this._pruneDescendants(object, lockedDescendantPaths);\n    }\n  }\n\n  _avoidLocalWritePaths(path, lockedDescendantPaths) {\n    for (const localWritePath in this._localWrites) {\n      if (!this._localWrites.hasOwnProperty(localWritePath)) continue;\n      if (path === localWritePath || localWritePath === '/' ||\n          _.startsWith(path, localWritePath + '/')) return true;\n      if (path === '/' || _.startsWith(localWritePath, path + '/')) {\n        const segments = localWritePath.split('/');\n        for (let i = segments.length; i > 0; i--) {\n          const subPath = segments.slice(0, i).join('/');\n          const active = i === segments.length;\n          if (lockedDescendantPaths[subPath] || lockedDescendantPaths[subPath] === active) break;\n          lockedDescendantPaths[subPath] = active;\n          if (subPath === path) break;\n        }\n      }\n    }\n  }\n\n  _pruneAncestors(targetPath, targetObject) {\n    // Destroy the child (unless it's a placeholder that's still needed) and any ancestors that\n    // are no longer needed to keep this child rooted, and have no other reason to exist.\n    let deleted = false;\n    let object = targetObject;\n    // The target object may be a primitive, in which case it won't have $parent and $key\n    // properties.  In that case, use the target path to figure those out instead.  Note that all\n    // ancestors of the target object will necessarily not be primitives and will have those\n    // properties.\n    const targetSegments = _(targetPath).split('/').map(unescapeKey).value();\n    while (object && object !== this.root) {\n      const parent =\n        object.$parent || object === targetObject && this.getObject(targetSegments.slice(0, -1));\n      if (!this._modeler.isPlaceholder(object.$path)) {\n        const ghostObjects = deleted ? null : [targetObject];\n        if (!this._holdsConcreteData(object, ghostObjects)) {\n          deleted = true;\n          this._deleteFirebaseProperty(\n            parent, object.$key || object === targetObject && _.last(targetSegments));\n        }\n      }\n      object = parent;\n    }\n    return deleted;\n  }\n\n  _holdsConcreteData(object, ghostObjects) {\n    if (ghostObjects && _.includes(ghostObjects, object)) return false;\n    if (_.some(object, value => !value.$truss)) return true;\n    return _.some(object, value => this._holdsConcreteData(value, ghostObjects));\n  }\n\n  _pruneDescendants(object, lockedDescendantPaths) {\n    if (lockedDescendantPaths[object.$path]) return true;\n    if (object.$overridden) delete object.$overridden;\n    let coupledDescendantFound = false;\n    _.each(object, (value, key) => {\n      let shouldDelete = true;\n      let valueLocked;\n      if (lockedDescendantPaths[joinPath(object.$path, escapeKey(key))]) {\n        shouldDelete = false;\n        valueLocked = true;\n      } else if (value.$truss) {\n        const placeholder = this._modeler.isPlaceholder(value.$path);\n        if (placeholder || _.has(lockedDescendantPaths, value.$path)) {\n          valueLocked = this._pruneDescendants(value, lockedDescendantPaths);\n          shouldDelete = !placeholder && !valueLocked;\n        }\n      }\n      if (shouldDelete) this._deleteFirebaseProperty(object, key);\n      coupledDescendantFound = coupledDescendantFound || valueLocked;\n    });\n    return coupledDescendantFound;\n  }\n\n  getObject(pathOrSegments) {\n    let object;\n    const segments = _.isString(pathOrSegments) ?\n      _(pathOrSegments).split('/').map(unescapeKey).value() : pathOrSegments;\n    for (const segment of segments) {\n      object = segment ? object[segment] : this.root;\n      if (object === undefined) return;\n    }\n    return object;\n  }\n\n  _getFirebasePropertyDescriptor(object, key) {\n    let descriptor = Object.getOwnPropertyDescriptor(object, key);\n    if (descriptor) {\n      if (!descriptor.enumerable) {\n        throw new Error(\n          `Key conflict between Firebase and instance or computed properties at ` +\n          `${object.$path}: ${key}`);\n      }\n      if (!descriptor.get || !descriptor.set) {\n        throw new Error(`Unbound property at ${object.$path}: ${key}`);\n      }\n    }\n    return descriptor;\n  }\n\n  _setFirebaseProperty(object, key, value) {\n    let descriptor = this._getFirebasePropertyDescriptor(object, key);\n    if (descriptor) {\n      this._firebasePropertyEditAllowed = true;\n      object[key] = value;\n      this._firebasePropertyEditAllowed = false;\n    } else {\n      Vue.set(object, key, value);\n      descriptor = Object.getOwnPropertyDescriptor(object, key);\n      Object.defineProperty(object, key, {\n        get: descriptor.get, set: this._overwriteFirebaseProperty.bind(this, descriptor, key),\n        configurable: true, enumerable: true\n      });\n    }\n  }\n\n  _overwriteFirebaseProperty(descriptor, key, newValue) {\n    if (!this._firebasePropertyEditAllowed) {\n      throw new Error(`Firebase data cannot be mutated directly: ${key}`);\n    }\n    descriptor.set.call(this, newValue);\n  }\n\n  _deleteFirebaseProperty(object, key) {\n    // Make sure it's actually a Firebase property.\n    this._getFirebasePropertyDescriptor(object, key);\n    this._destroyObject(object[key]);\n    Vue.delete(object, key);\n  }\n\n  checkVueObject(object, path) {\n    this._modeler.checkVueObject(object, path);\n  }\n\n  static get computedPropertyStats() {\n    return Modeler.computedPropertyStats;\n  }\n}\n\n\nexport function checkUpdateHasOnlyDescendantsWithNoOverlap(rootPath, values, relativizePaths) {\n  // First, check all paths for correctness and absolutize them, since there could be a mix of\n  // absolute paths and relative keys.\n  _.each(_.keys(values), path => {\n    if (path.charAt(0) === '/') {\n      if (!(path === rootPath || rootPath === '/' ||\n            _.startsWith(path, rootPath + '/') && path.length > rootPath.length + 1)) {\n        throw new Error(`Update item is not a descendant of target ref: ${path}`);\n      }\n    } else {\n      if (path.indexOf('/') >= 0) {\n        throw new Error(`Update item deep path must be absolute, taken from a reference: ${path}`);\n      }\n      const absolutePath = joinPath(rootPath, escapeKey(path));\n      if (values.hasOwnProperty(absolutePath)) {\n        throw new Error(`Update items overlap: ${path} and ${absolutePath}`);\n      }\n      values[absolutePath] = values[path];\n      delete values[path];\n    }\n  });\n  // Then check for overlaps and relativize if desired.\n  const allPaths = _(values).keys().map(path => joinPath(path, '')).sortBy('length').value();\n  _.each(_.keys(values), path => {\n    for (const otherPath of allPaths) {\n      if (otherPath.length > path.length) break;\n      if (path !== otherPath && _.startsWith(path, otherPath)) {\n        throw new Error(`Update items overlap: ${otherPath} and ${path}`);\n      }\n    }\n    if (relativizePaths) {\n      values[path.slice(rootPath === '/' ? 1 : rootPath.length + 1)] = values[path];\n      delete values[path];\n    }\n  });\n}\n\nexport function toFirebaseJson(object) {\n  if (typeof object === 'object') {\n    const result = {};\n    for (const key in object) {\n      if (!object.hasOwnProperty(key)) continue;\n      result[escapeKey(key)] = toFirebaseJson(object[key]);\n    }\n    return result;\n  } else {\n    return object;\n  }\n}\n\n","import {escapeKey, unescapeKey, makePathMatcher} from './utils.js';\n\nimport _ from 'lodash';\n\n\nconst EMPTY_ANNOTATIONS = {};\nObject.freeze(EMPTY_ANNOTATIONS);\n\n\nexport class Handle {\n  constructor(tree, path, annotations) {\n    this._tree = tree;\n    this._path = path.replace(/^\\/*/, '/').replace(/\\/$/, '');\n    if (annotations) {\n      this._annotations = annotations;\n      Object.freeze(annotations);\n    }\n  }\n\n  get $ref() {return this;}\n  get key() {\n    if (!this._key) this._key = unescapeKey(this._path.replace(/.*\\//, ''));\n    return this._key;\n  }\n  get path() {return this._path;}\n  get _pathPrefix() {return this._path === '/' ? '' : this._path;}\n  get parent() {\n    return new Reference(this._tree, this._path.replace(/\\/[^/]*$/, ''), this._annotations);\n  }\n\n  get annotations() {\n    return this._annotations || EMPTY_ANNOTATIONS;\n  }\n\n  child() {\n    if (!arguments.length) return this;\n    const segments = [];\n    for (const key of arguments) {\n      if (key === undefined || key === null) return;\n      segments.push(escapeKey(key));\n    }\n    return new Reference(\n      this._tree, `${this._pathPrefix}/${segments.join('/')}`,\n      this._annotations\n    );\n  }\n\n  children() {\n    if (!arguments.length) return this;\n    const escapedKeys = [];\n    for (let i = 0; i < arguments.length; i++) {\n      const arg = arguments[i];\n      if (_.isArray(arg)) {\n        const mapping = {};\n        const subPath = `${this._pathPrefix}/${escapedKeys.join('/')}`;\n        const rest = _.slice(arguments, i + 1);\n        for (const key of arg) {\n          const subRef =\n            new Reference(this._tree, `${subPath}/${escapeKey(key)}`, this._annotations);\n          const subMapping = subRef.children.apply(subRef, rest);\n          if (subMapping) mapping[key] = subMapping;\n        }\n        if (_.isEmpty(mapping)) return;\n        return mapping;\n      } else {\n        if (arg === undefined || arg === null) return;\n        escapedKeys.push(escapeKey(arg));\n      }\n    }\n    return new Reference(\n      this._tree, `${this._pathPrefix}/${escapedKeys.join('/')}`, this._annotations);\n  }\n\n  peek(callback) {\n    return this._tree.truss.peek(this, callback);\n  }\n\n  match(pattern) {\n    return makePathMatcher(pattern).match(this.path);\n  }\n\n  isEqual(that) {\n    if (!(that instanceof Handle)) return false;\n    return this._tree === that._tree && this.toString() === that.toString();\n  }\n\n  belongsTo(truss) {\n    return this._tree.truss === truss;\n  }\n}\n\n\nexport class Query extends Handle {\n  constructor(tree, path, spec, annotations) {\n    super(tree, path, annotations);\n    this._spec = this._copyAndValidateSpec(spec);\n  }\n\n  // Vue-bound\n  get ready() {\n    return this._tree.isQueryReady(this);\n  }\n\n  get constraints() {\n    return this._spec;\n  }\n\n  annotate(annotations) {\n    return new Query(\n      this._tree, this._path, this._spec, _.extend({}, this._annotations, annotations));\n  }\n\n  _copyAndValidateSpec(spec) {\n    if (!spec.by) throw new Error('Query needs \"by\" clause: ' + JSON.stringify(spec));\n    if (('at' in spec) + ('from' in spec) + ('to' in spec) > 1) {\n      throw new Error(\n        'Query must contain at most one of \"at\", \"from\", or \"to\" clauses: ' + JSON.stringify(spec));\n    }\n    if (('first' in spec) + ('last' in spec) > 1) {\n      throw new Error(\n        'Query must contain at most one of \"first\" or \"last\" clauses: ' + JSON.stringify(spec));\n    }\n    if (!_.some(['at', 'from', 'to', 'first', 'last'], clause => clause in spec)) {\n      throw new Error(\n        'Query must contain at least one of \"at\", \"from\", \"to\", \"first\", or \"last\" clauses: ' +\n        JSON.stringify(spec));\n    }\n    spec = _.clone(spec);\n    if (spec.by !== '$key' && spec.by !== '$value') {\n      if (!(spec.by instanceof Reference)) {\n        throw new Error('Query \"by\" value must be a reference: ' + spec.by);\n      }\n      let childPath = spec.by.toString();\n      if (!_.startsWith(childPath, this._path)) {\n        throw new Error(\n          'Query \"by\" value must be a descendant of target reference: ' + spec.by);\n      }\n      childPath = childPath.slice(this._path.length).replace(/^\\/?/, '');\n      if (childPath.indexOf('/') === -1) {\n        throw new Error(\n          'Query \"by\" value must not be a direct child of target reference: ' + spec.by);\n      }\n      spec.by = childPath.replace(/.*?\\//, '');\n    }\n    Object.freeze(spec);\n    return spec;\n  }\n\n\n  toString() {\n    if (!this._string) {\n      const queryTerms = _(this._spec)\n        .map((value, key) => `${key}=${encodeURIComponent(JSON.stringify(value))}`)\n        .sortBy()\n        .join('&');\n      this._string = `${this._path}?${queryTerms}`;\n    }\n    return this._string;\n  }\n}\n\n\n// jshint latedef:false\nexport class Reference extends Handle {\n// jshint latedef:nofunc\n\n  constructor(tree, path, annotations) {\n    super(tree, path, annotations);\n  }\n\n  get ready() {return this._tree.isReferenceReady(this);}  // Vue-bound\n  get value() {return this._tree.getObject(this.path);}  // Vue-bound\n  toString() {return this._path;}\n\n  annotate(annotations) {\n    return new Reference(this._tree, this._path, _.extend({}, this._annotations, annotations));\n  }\n\n  query(spec) {\n    return new Query(this._tree, this._path, spec);\n  }\n\n  set(value) {\n    return this._tree.update(this, 'set', {[this.path]: value});\n  }\n\n  update(values) {\n    return this._tree.update(this, 'update', values);\n  }\n\n  override(value) {\n    return this._tree.update(this, 'override', {[this.path]: value});\n  }\n\n  commit(updateFunction) {\n    return this._tree.commit(this, updateFunction);\n  }\n}\n\nexport default Reference;\n","import _ from 'lodash';\nimport {wrapPromiseCallback} from './utils.js';\n\n\nconst INTERCEPT_KEYS = [\n  'read', 'write', 'auth', 'set', 'update', 'commit', 'connect', 'peek', 'all'\n];\n\nconst EMPTY_ARRAY = [];\n\n\nclass SlowHandle {\n  constructor(operation, delay, callback) {\n    this._operation = operation;\n    this._delay = delay;\n    this._callback = callback;\n    this._fired = false;\n  }\n\n  initiate() {\n    this.cancel();\n    this._fired = false;\n    const elapsed = Date.now() - this._operation._startTimestamp;\n    this._timeoutId = setTimeout(this._delay - elapsed, () => {\n      this._fired = true;\n      this._callback(this._operation);\n    });\n  }\n\n  cancel() {\n    if (this._fired) this._callback(this._operation);\n    if (this._timeoutId) clearTimeout(this._timeoutId);\n  }\n}\n\n\nclass Operation {\n  constructor(type, method, target) {\n    this._type = type;\n    this._method = method;\n    this._target = target;\n    this._ready = false;\n    this._running = false;\n    this._ended = false;\n    this._tries = 0;\n    this._startTimestamp = Date.now();\n    this._slowHandles = [];\n  }\n\n  get type() {return this._type;}\n  get method() {return this._method;}\n  get target() {return this._target;}\n  get ready() {return this._ready;}\n  get running() {return this._running;}\n  get ended() {return this._ended;}\n  get tries() {return this._tries;}\n  get error() {return this._error;}\n\n  onSlow(delay, callback) {\n    const handle = new SlowHandle(this, delay, callback);\n    this._slowHandles.push(handle);\n    handle.initiate();\n  }\n\n  _setRunning(value) {\n    this._running = value;\n  }\n\n  _setEnded(value) {\n    this._ended = value;\n  }\n\n  _markReady() {\n    this._ready = true;\n    this._tries = 0;\n    _.each(this._slowHandles, handle => handle.cancel());\n  }\n\n  _clearReady() {\n    this._ready = false;\n    this._startTimestamp = Date.now();\n    _.each(this._slowHandles, handle => handle.initiate());\n  }\n\n  _incrementTries() {\n    this._tries++;\n  }\n}\n\n\nexport default class Dispatcher {\n  constructor(bridge) {\n    this._bridge = bridge;\n    this._callbacks = {};\n  }\n\n  intercept(interceptKey, callbacks) {\n    if (!_.contains(INTERCEPT_KEYS, interceptKey)) {\n      throw new Error('Unknown intercept operation type: ' + interceptKey);\n    }\n    const badCallbackKeys =\n      _.difference(_.keys(callbacks), ['onBefore', 'onAfter', 'onError', 'onFailure']);\n    if (badCallbackKeys.length) {\n      throw new Error('Unknown intercept callback types: ' + badCallbackKeys.join(', '));\n    }\n    const wrappedCallbacks = {\n      onBefore: this._addCallback('onBefore', interceptKey, callbacks.onBefore),\n      onAfter: this._addCallback('onAfter', interceptKey, callbacks.onAfter),\n      onError: this._addCallback('onError', interceptKey, callbacks.onError),\n      onFailure: this._addCallback('onFailure', interceptKey, callbacks.onFailure)\n    };\n    return this._removeCallbacks.bind(this, interceptKey, wrappedCallbacks);\n  }\n\n  _addCallback(stage, interceptKey, callback) {\n    if (!callback) return;\n    const key = this._getCallbacksKey(stage, interceptKey);\n    const wrappedCallback = wrapPromiseCallback(callback);\n    (this._callbacks[key] || (this._callbacks[key] = [])).push(wrappedCallback);\n    return wrappedCallback;\n  }\n\n  _removeCallback(stage, interceptKey, wrappedCallback) {\n    if (!wrappedCallback) return;\n    const key = this._getCallbacksKey(stage, interceptKey);\n    if (this._callbacks[key]) _.pull(this._callbacks[key], wrappedCallback);\n  }\n\n  _removeCallbacks(interceptKey, wrappedCallbacks) {\n    _.each(wrappedCallbacks, (wrappedCallback, stage) => {\n      this._removeCallback(stage, interceptKey, wrappedCallback);\n    });\n  }\n\n  _getCallbacks(stage, operationType, method) {\n    return [].concat(\n      this._callbacks[this._getCallbacksKey(stage, method)] || EMPTY_ARRAY,\n      this._callbacks[this._getCallbacksKey(stage, operationType)] || EMPTY_ARRAY,\n      this._callbacks[this._getCallbacksKey(stage, 'all')] || EMPTY_ARRAY\n    );\n  }\n\n  _getCallbacksKey(stage, interceptKey) {\n    return `${stage}_${interceptKey}`;\n  }\n\n  execute(operationType, method, target, executor) {\n    executor = wrapPromiseCallback(executor);\n    const operation = this.createOperation(operationType, method, target);\n    return this.begin(operation).then(() => {\n      const executeWithRetries = () => {\n        return executor().catch(e => this._retryOrEnd(operation, e).then(executeWithRetries));\n      };\n      return executeWithRetries();\n    }).then(result => this.end(operation).then(() => result));\n  }\n\n  createOperation(operationType, method, target) {\n    return new Operation(operationType, method, target);\n  }\n\n  begin(operation) {\n    return Promise.all(_.map(\n      this._getCallbacks('onBefore', operation.type, operation.method),\n      onBefore => onBefore(operation)\n    )).then(() => {\n      if (!operation.ended) operation._setRunning(true);\n    }, e => this.end(operation, e));\n  }\n\n  markReady(operation) {\n    operation._markReady();\n  }\n\n  clearReady(operation) {\n    operation._clearReady();\n  }\n\n  retry(operation, error) {\n    operation._incrementTries();\n    operation._error = error;\n    return Promise.all(_.map(\n      this._getCallbacks('onError', operation.type, operation.method),\n      onError => onError(operation, error)\n    )).then(results => {\n      const retrying = _.some(results);\n      if (retrying) delete operation._error;\n      return retrying;\n    });\n  }\n\n  _retryOrEnd(operation, error) {\n    return this.retry(operation, error).then(result => {\n      if (!result) return this.end(operation, error);\n    }, e => this.end(operation, e));\n  }\n\n  end(operation, error) {\n    if (operation.ended) return;\n    operation._setRunning(false);\n    operation._setEnded(true);\n    if (error) operation._error = error;\n    return Promise.all(_.map(\n      this._getCallbacks('onAfter', operation.type, operation.method),\n      onAfter => onAfter(operation)\n    )).then(\n      () => this._afterEnd(operation),\n      e => {\n        operation._error = e;\n        return this._afterEnd(operation);\n      }\n    );\n  }\n\n  _afterEnd(operation) {\n    this.markReady(operation);\n    if (operation.error) {\n      const onFailureCallbacks = this._getCallbacks('onFailure', operation.type, operation.method);\n      return this._bridge.probeError(operation.error).then(() => {\n        if (onFailureCallbacks) {\n          setTimeout(() => {\n            _.each(onFailureCallbacks, onFailure => onFailure(operation));\n          }, 0);\n        }\n        return Promise.reject(operation.error);\n      });\n    }\n  }\n}\n\n","'use strict';\n\nconst ALPHABET = '-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz';\n\nexport default class KeyGenerator {\n  constructor() {\n    this._lastUniqueKeyTime = 0;\n    this._lastRandomValues = [];\n  }\n\n  generateUniqueKey(now) {\n    now = now || Date.now();\n    const chars = new Array(20);\n    let prefix = now;\n    for (let i = 7; i >= 0; i--) {\n      chars[i] = ALPHABET.charAt(prefix & 0x3f);\n      prefix = Math.floor(prefix / 64);\n    }\n    if (now === this._lastUniqueKeyTime) {\n      let i = 11;\n      while (i >= 0 && this._lastRandomValues[i] === 63) {\n        this._lastRandomValues[i] = 0;\n        i -= 1;\n      }\n      if (i === -1) {\n        throw new Error('Internal assertion failure: ran out of unique IDs for this millisecond');\n      }\n      this._lastRandomValues[i] += 1;\n    } else {\n      this._lastUniqueKeyTime = now;\n      for (let i = 0; i < 12; i++) {\n        // Make sure to leave some space for incrementing in the top nibble.\n        this._lastRandomValues[i] = Math.floor(Math.random() * (i ? 64 : 16));\n      }\n    }\n    for (let i = 0; i < 12; i++) {\n      chars[i + 8] = ALPHABET[this._lastRandomValues[i]];\n    }\n    return chars.join('');\n  }\n}\n","import angularCompatibility from './angularCompatibility.js';\nimport Vue from 'vue';\n\nexport default class MetaTree {\n  constructor(rootUrl, bridge) {\n    this._rootUrl = rootUrl;\n    this._bridge = bridge;\n    this._vue = new Vue({data: {$root: {\n      connected: undefined, timeOffset: 0, user: undefined, userid: undefined,\n      updateNowAtIntervals(name, intervalMillis) {\n        if (this.hasOwnProperty(name)) throw new Error(`Property \"${name}\" already defined`);\n        Vue.set(this, name, Date.now() + this.timeOffset);\n        setInterval(() => {\n          this[name] = Date.now() + this.timeOffset;\n        }, intervalMillis);\n      }\n    }}});\n\n    if (angularCompatibility.active) {\n      this._vue.$watch('$data', angularCompatibility.digest, {deep: true});\n    }\n\n    bridge.onAuth(rootUrl, this._handleAuthChange, this);\n\n    this._connectInfoProperty('serverTimeOffset', 'timeOffset');\n    this._connectInfoProperty('connected', 'connected');\n  }\n\n  get root() {\n    return this._vue.$data.$root;\n  }\n\n  destroy() {\n    this._bridge.offAuth(this._rootUrl, this._handleAuthChange, this);\n    this._vue.$destroy();\n  }\n\n  _handleAuthChange(user) {\n    this.root.user = user;\n    this.root.userid = user && user.uid;\n  }\n\n  _connectInfoProperty(property, attribute) {\n    const propertyUrl = `${this._rootUrl}/.info/${property}`;\n    this._bridge.on(propertyUrl, propertyUrl, null, 'value', snap => {\n      this.root[attribute] = snap.value;\n    });\n  }\n}\n","import _ from 'lodash';\nimport Vue from 'vue';\nimport angularCompatibility from './angularCompatibility.js';\n\n\nclass QueryHandler {\n  constructor(coupler, query) {\n    this._coupler = coupler;\n    this._query = query;\n    this._listeners = [];\n    this._keys = [];\n    this._url = this._coupler._rootUrl + query.path;\n    this._segments = query.path.split('/');\n    this._listening = false;\n    this.ready = false;\n  }\n\n  attach(operation, keysCallback) {\n    this._listen();\n    this._listeners.push({operation, keysCallback});\n    keysCallback(this._keys);\n  }\n\n  detach(operation) {\n    const k = _.findIndex(this._listeners, {operation});\n    if (k >= 0) this._listeners.splice(k, 1);\n    return this._listeners.length;\n  }\n\n  _listen() {\n    if (this._listening) return;\n    this._coupler._bridge.on(\n      this._query.toString(), this._url, this._query.constraints, 'value',\n      this._handleSnapshot, this._handleError.bind(this._query.path), this, {sync: true});\n    this._listening = true;\n  }\n\n  destroy() {\n    this._coupler._bridge.off(\n      this._query.toString(), this._url, this._query.constraints, 'value', this._handleSnapshot,\n      this);\n    this._listening = false;\n    this.ready = false;\n    angularCompatibility.digest();\n    for (const key of this._keys) {\n      this._coupler._decoupleSegments(this._segments.concat(key));\n    }\n  }\n\n  _handleSnapshot(snap) {\n    // Order is important here: first couple any new subpaths so _handleSnapshot will update the\n    // tree, then tell the client to update its keys, pulling values from the tree.\n    if (!this._listeners.length || !this._listening) return;\n    const updatedKeys = this._updateKeys(snap);\n    this._coupler._applySnapshot(snap);\n    if (!this.ready) {\n      this.ready = true;\n      angularCompatibility.digest();\n      for (const listener of this._listeners) {\n        this._coupler._dispatcher.markReady(listener.operation);\n      }\n    }\n    if (updatedKeys) {\n      for (const listener of this._listeners) listener.keysCallback(updatedKeys);\n    }\n  }\n\n  _updateKeys(snap) {\n    let updatedKeys;\n    if (snap.path === this._query.path) {\n      updatedKeys = _.keys(snap.value);\n      updatedKeys.sort();\n      if (_.isEqual(this._keys, updatedKeys)) {\n        updatedKeys = null;\n      } else {\n        for (const key of _.difference(updatedKeys, this._keys)) {\n          this._coupler._coupleSegments(this._segments.concat(key));\n        }\n        for (const key of _.difference(this._keys, updatedKeys)) {\n          this._coupler._decoupleSegments(this._segments.concat(key));\n        }\n        this._keys = updatedKeys;\n      }\n    } else if (snap.path.replace(/\\/[^/]+/, '') === this._query.path) {\n      const hasKey = _.contains(this._keys, snap.key);\n      if (snap.value) {\n        if (!hasKey) {\n          this._coupler._coupleSegments(this._segments.concat(snap.key));\n          this._keys.push(snap.key);\n          this._keys.sort();\n          updatedKeys = this._keys;\n        }\n      } else {\n        if (hasKey) {\n          this._coupler._decoupleSegments(this._segments.concat(snap.key));\n          _.pull(this._keys, snap.key);\n          this._keys.sort();\n          updatedKeys = this._keys;\n        }\n      }\n    }\n    return updatedKeys;\n  }\n\n  _handleError(error) {\n    if (!this._listeners.length || !this._listening) return;\n    this._listening = false;\n    Promise.all(_.map(this._listeners, listener => {\n      this._coupler._dispatcher.clearReady(listener.operation);\n      return this._coupler._dispatcher.retry(listener.operation, error).catch(e => {\n        listener.operation._disconnect(e);\n        return false;\n      });\n    })).then(results => {\n      if (_.some(results)) {\n        if (this._listeners.length) this._listen();\n      } else {\n        for (const listener of this._listeners) listener.operation._disconnect(error);\n      }\n    });\n  }\n}\n\n\nclass Node {\n  constructor(coupler, path) {\n    this._coupler = coupler;\n    this.path = path;\n    this.url = this._coupler._rootUrl + path;\n    this.operations = [];\n    this.queryCount = 0;\n    this.listening = false;\n    this.ready = false;\n    this.children = {};\n  }\n\n  get active() {\n    return this.count || this.queryCount;\n  }\n\n  get count() {\n    return this.operations.length;\n  }\n\n  listen(skip) {\n    if (!skip && this.count) {\n      if (this.listening) return;\n      _.each(this.operations, op => {this._coupler._dispatcher.clearReady(op);});\n      this._coupler._bridge.on(\n        this.url, this.url, null, 'value', this._handleSnapshot, this._handleError.bind(this),\n        this, {sync: true});\n      this.listening = true;\n    } else {\n      _.each(this.children, child => {child.listen();});\n    }\n  }\n\n  unlisten(skip) {\n    if (!skip && this.listening) {\n      this._coupler._bridge.off(this.url, this.url, null, 'value', this._handleSnapshot, this);\n      this.listening = false;\n      this._forAllDescendants(node => {\n        if (node.ready) {\n          node.ready = false;\n          angularCompatibility.digest();\n        }\n      });\n    } else {\n      _.each(this.children, child => {child.unlisten();});\n    }\n  }\n\n  _handleSnapshot(snap) {\n    if (!this.listening || !this._coupler.isTrunkCoupled(snap.path)) return;\n    this._coupler._applySnapshot(snap);\n    if (!this.ready && snap.path === this.path) {\n      this.ready = true;\n      angularCompatibility.digest();\n      this.unlisten(true);\n      this._forAllDescendants(node => {\n        for (const op of this.operations) this._coupler._dispatcher.markReady(op);\n      });\n    }\n  }\n\n  _handleError(error) {\n    if (!this.count || !this.listening) return;\n    this.listening = false;\n    this._forAllDescendants(node => {\n      if (node.ready) {\n        node.ready = false;\n        angularCompatibility.digest();\n      }\n      for (const op of this.operations) this._coupler._dispatcher.clearReady(op);\n    });\n    return Promise.all(_.map(this.operations, op => {\n      return this._coupler._dispatcher.retry(op, error).catch(e => {\n        op._disconnect(e);\n        return false;\n      });\n    })).then(results => {\n      if (_.some(results)) {\n        if (this.count) this.listen();\n      } else {\n        for (const op of this.operations) op._disconnect(error);\n        // Pulling all the operations will automatically get us listening on descendants.\n      }\n    });\n  }\n\n  _forAllDescendants(iteratee) {\n    iteratee(this);\n    _.each(this.children, child => child._forAllDescendants(iteratee));\n  }\n\n  collectCoupledDescendantPaths(paths) {\n    if (!paths) paths = {};\n    paths[this.path] = this.active;\n    if (!this.active) {\n      _.each(this.children, child => {child.collectCoupledDescendantPaths(paths);});\n    }\n    return paths;\n  }\n}\n\n\nexport default class Coupler {\n  constructor(rootUrl, bridge, dispatcher, applySnapshot, prunePath) {\n    this._rootUrl = rootUrl;\n    this._bridge = bridge;\n    this._dispatcher = dispatcher;\n    this._applySnapshot = applySnapshot;\n    this._prunePath = prunePath;\n    this._vue = new Vue({data: {root: new Node(this, '/'), queryHandlers: {}}});\n  }\n\n  get _root() {return this._vue.root;}\n  get _queryHandlers() {return this._vue.queryHandlers;}\n\n  destroy() {\n    _.each(this._queryHandlers, queryHandler => {queryHandler.destroy();});\n    this._root.unlisten();\n    this._vue.$destroy();\n  }\n\n  couple(path, operation) {\n    return this._coupleSegments(path.split('/'), operation);\n  }\n\n  _coupleSegments(segments, operation) {\n    let node;\n    let superseded = !operation;\n    let ready = false;\n    for (const segment of segments) {\n      let child = segment ? node.children && node.children[segment] : this._root;\n      if (!child) {\n        child = new Node(this, `${node.path === '/' ? '' : node.path}/${segment}`);\n        Vue.set(node.children, segment, child);\n      }\n      superseded = superseded || child.listening;\n      ready = ready || child.ready;\n      node = child;\n    }\n    if (operation) {\n      node.operations.push(operation);\n    } else {\n      node.queryCount++;\n    }\n    if (superseded) {\n      if (operation && ready) this._dispatcher.markReady(operation);\n    } else {\n      node.listen();  // node will call unlisten() on descendants when ready\n    }\n  }\n\n  decouple(path, operation) {\n    return this._decoupleSegments(path.split('/'), operation);\n  }\n\n  _decoupleSegments(segments, operation) {\n    const ancestors = [];\n    let node;\n    for (const segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) break;\n      ancestors.push(node);\n    }\n    if (!node || !(operation ? node.count : node.queryCount)) {\n      throw new Error(`Path not coupled: ${segments.join('/')}`);\n    }\n    if (operation) {\n      _.pull(node.operations, operation);\n    } else {\n      node.queryCount--;\n    }\n    if (operation && !node.count) {\n      // Ideally, we wouldn't resync the full values here since we probably already have the current\n      // value for all children.  But making sure that's true is tricky in an async system (what if\n      // the node's value changes and the update crosses the 'off' call in transit?) and this\n      // situation should be sufficiently rare that the optimization is probably not worth it right\n      // now.\n      node.listen();\n      if (node.listening) node.unlisten();\n    }\n    if (!node.active) {\n      for (let i = ancestors.length - 1; i > 0; i--) {\n        node = ancestors[i];\n        if (node === this._root || node.active || !_.isEmpty(node.children)) break;\n        Vue.delete(ancestors[i - 1].children, segments[i]);\n      }\n      this._prunePath(segments.join('/'), this.findCoupledDescendantPaths(segments));\n    }\n  }\n\n  subscribe(query, operation, keysCallback) {\n    let queryHandler = this._queryHandlers[query.toString()];\n    if (!queryHandler) {\n      queryHandler = new QueryHandler(this, query);\n      Vue.set(this._queryHandlers, query.toString(), queryHandler);\n    }\n    queryHandler.attach(operation, keysCallback);\n }\n\n  unsubscribe(query, operation) {\n    const queryHandler = this._queryHandlers[query.toString()];\n    if (queryHandler && !queryHandler.detach(operation)) {\n      queryHandler.destroy();\n      Vue.delete(this._queryHandlers, query.toString());\n    }\n  }\n\n  // Return whether the node at path or any ancestors are coupled.\n  isTrunkCoupled(path) {\n    const segments = path.split('/');\n    let node;\n    for (const segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) return false;\n      if (node.active) return true;\n    }\n    return false;\n  }\n\n  findCoupledDescendantPaths(pathOrSegments) {\n    const segments = _.isString(pathOrSegments) ? pathOrSegments.split('/') : pathOrSegments;\n    let node;\n    for (const segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) break;\n    }\n    return node && node.collectCoupledDescendantPaths();\n  }\n\n  isSubtreeReady(path) {\n    const segments = path.split('/');\n    let node;\n    for (const segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) return false;\n      if (node.ready) return true;\n    }\n    return false;\n  }\n\n  isQueryReady(query) {\n    const queryHandler = this._queryHandlers[query.toString()];\n    return queryHandler && queryHandler.ready;\n  }\n\n}\n\n","// Generated by CoffeeScript 1.7.1\n(function() {\n  var getNanoSeconds, hrtime, loadTime;\n\n  if ((typeof performance !== \"undefined\" && performance !== null) && performance.now) {\n    module.exports = function() {\n      return performance.now();\n    };\n  } else if ((typeof process !== \"undefined\" && process !== null) && process.hrtime) {\n    module.exports = function() {\n      return (getNanoSeconds() - loadTime) / 1e6;\n    };\n    hrtime = process.hrtime;\n    getNanoSeconds = function() {\n      var hr;\n      hr = hrtime();\n      return hr[0] * 1e9 + hr[1];\n    };\n    loadTime = getNanoSeconds();\n  } else if (Date.now) {\n    module.exports = function() {\n      return Date.now() - loadTime;\n    };\n    loadTime = Date.now();\n  } else {\n    module.exports = function() {\n      return new Date().getTime() - loadTime;\n    };\n    loadTime = new Date().getTime();\n  }\n\n}).call(this);\n","import _ from 'lodash';\nimport Vue from 'vue';\nimport angularCompatibility from './angularCompatibility.js';\nimport Bridge from './Bridge.js';\nimport Connector from './Connector.js';\nimport Dispatcher from './Dispatcher.js';\nimport KeyGenerator from './KeyGenerator.js';\nimport MetaTree from './MetaTree.js';\nimport {Handle, Reference} from './Reference.js';\nimport Tree from './Tree.js';\nimport {escapeKey, unescapeKey, wrapPromiseCallback, SERVER_TIMESTAMP} from './utils.js';\n\n\nlet bridge, logging;\nconst workerFunctions = {};\n// This version is filled in by the build, don't reformat the line.\nconst VERSION = 'dev';\n\n\nexport default class Truss {\n\n  /**\n   * Create a new Truss instance, specific to a given datastore.  To avoid confusion there should be\n   * exactly one Truss per root datastore URL, so in most code this will be a singleton.\n   *\n   * @param rootUrl {String} The root URL, https://{project}.firebaseio.com.\n   * @param classes {Array<Function>} A list of the classes to map onto the datastore structure.\n   *    Each class must have a static $trussMount property that is a (wildcarded) datastore path, or\n   *    an options object {path: string, placeholder: object}, or an array of either.\n   */\n  constructor(rootUrl, classes) {\n    // TODO: allow rootUrl to be a test database object for testing\n    if (!bridge) {\n      throw new Error('Truss worker not connected, please call Truss.connectWorker first');\n    }\n    this._rootUrl = rootUrl.replace(/\\/$/, '');\n    this._keyGenerator = new KeyGenerator();\n    this._dispatcher = new Dispatcher(bridge);\n    this._vue = new Vue();\n\n    bridge.trackServer(this._rootUrl);\n    this._metaTree = new MetaTree(this._rootUrl, bridge);\n    this._tree = new Tree(this, this._rootUrl, bridge, this._dispatcher);\n    this._tree.init(classes);\n  }\n\n  get meta() {return this._metaTree.root;}\n  get root() {return this._tree.root;}\n\n  destroy() {\n    this._vue.$destroy();\n    this._tree.destroy();\n    this._metaTree.destroy();\n  }\n\n  get now() {return Date.now() + this.meta.timeOffset;}\n  newKey() {return this._keyGenerator.generateUniqueKey(this.now);}\n\n  authenticate(token) {\n    return this._dispatcher.execute('auth', 'authenticate', new Reference(this._tree, '/'), () => {\n      return bridge.authWithCustomToken(this._rootUrl, token, {rememberMe: true});\n    });\n  }\n\n  unauthenticate() {\n    return this._dispatcher.execute(\n      'auth', 'unauthenticate', new Reference(this._tree, '/'), () => {\n        return bridge.unauth(this._rootUrl);\n      }\n    );\n  }\n\n  intercept(actionType, callbacks) {\n    return this._dispatcher.intercept(actionType, callbacks);\n  }\n\n  // connections are {key: Query | Object | fn() -> (Query | Object)}\n  connect(scope, connections) {\n    if (!connections) {\n      connections = scope;\n      scope = undefined;\n      if (connections instanceof Handle) connections = {_: connections};\n    }\n    return new Connector(scope, connections, this._tree, 'connect');\n  }\n\n  // target is Reference, Query, or connection Object like above\n  peek(target, callback) {\n    callback = wrapPromiseCallback(callback);\n    return new Promise((resolve, reject) => {\n      const scope = {};\n      const connector = new Connector(scope, {result: target}, this._tree, 'peek');\n      const unwatch = this._vue.$watch(() => connector.ready, ready => {\n        if (!ready) return;\n        unwatch();\n        callback(scope.result).then(result => {\n          connector.destroy();\n          resolve(result);\n        }, error => {\n          connector.destroy();\n          reject(error);\n        });\n      });\n    });\n  }\n\n  watch(subjectFn, callbackFn, options) {\n    let numCallbacks = 0;\n\n    const unwatch = this._vue.$watch(subjectFn, (newValue, oldValue) => {\n      numCallbacks++;\n      if (numCallbacks === 1) {\n        // Delay the immediate callback until we've had a chance to return the unwatch function.\n        Promise.resolve().then(() => {\n          if (numCallbacks > 1) return;\n          if (subjectFn() !== newValue) return;\n          callbackFn(newValue, oldValue);\n          angularCompatibility.digest();\n        });\n      } else {\n        callbackFn(newValue, oldValue);\n        angularCompatibility.digest();\n      }\n    }, {immediate: true, deep: options && options.deep});\n\n    return unwatch;\n  }\n\n  when(expression, options) {\n    let unwatch;\n    const promise = new Promise(resolve => {\n      unwatch = this.watch(expression, value => {\n        if (value !== undefined && value !== null) {\n          promise.cancel();\n          resolve(value);\n        }\n      }, options);\n    });\n    promise.cancel = unwatch;\n    return promise;\n  }\n\n  checkObjectsForRogueProperties() {\n    this._tree.checkVueObject(this._tree.root, '/');\n  }\n\n  static get computedPropertyStats() {return this._tree.computedPropertyStats;}\n\n  static connectWorker(webWorker) {\n    if (bridge) throw new Error('Worker already connected');\n    if (_.isString(webWorker)) {\n      const Worker = window.SharedWorker || window.Worker;\n      if (!Worker) throw new Error('Browser does not implement Web Workers');\n      webWorker = new Worker(webWorker);\n    }\n    bridge = new Bridge(webWorker);\n    if (logging) bridge.enableLogging(logging);\n    return bridge.init(webWorker).then(\n      ({exposedFunctionNames, firebaseSdkVersion}) => {\n        Object.defineProperty(Truss, 'FIREBASE_SDK_VERSION', {value: firebaseSdkVersion});\n        for (const name of exposedFunctionNames) {\n          Truss.worker[name] = bridge.bindExposedFunction(name);\n        }\n      }\n    );\n  }\n\n  static get worker() {return workerFunctions;}\n  static preExpose(functionName) {\n    Truss.worker[functionName] = bridge.bindExposedFunction(functionName);\n  }\n\n  static bounceConnection() {return bridge.bounceConnection();}\n  static suspend() {return bridge.suspend();}\n  static debugPermissionDeniedErrors(simulatedTokenGenerator, maxSimulationDuration, callFilter) {\n    return bridge.debugPermissionDeniedErrors(\n      simulatedTokenGenerator, maxSimulationDuration, callFilter);\n  }\n\n  static debounceAngularDigest(wait) {\n    angularCompatibility.debounceDigest(wait);\n  }\n\n  static escapeKey(key) {return escapeKey(key);}\n  static unescapeKey(escapedKey) {return unescapeKey(escapedKey);}\n\n  static enableLogging(fn) {\n    logging = fn;\n    if (bridge) bridge.enableLogging(fn);\n  }\n\n  // Duplicate static constants on instance for convenience.\n  get SERVER_TIMESTAMP() {return Truss.SERVER_TIMESTAMP;}\n  get VERSION() {return Truss.VERSION;}\n  get FIREBASE_SDK_VERSION() {return Truss.FIREBASE_SDK_VERSION;}\n}\n\nObject.defineProperties(Truss, {\n  SERVER_TIMESTAMP: {value: SERVER_TIMESTAMP},\n  VERSION: {value: VERSION}\n});\n\nangularCompatibility.defineModule(Truss);\n"]}