{"version":3,"sources":["../src/angularCompatibility.js","../src/utils/paths.js","../src/Bridge.js","../src/utils/utils.js","../src/Connector.js","../src/utils/promises.js","../src/Modeler.js","../src/Tree.js","../src/utils/LruCache.js","../src/Reference.js","../node_modules/performance-now/lib/performance-now.js","../src/utils/stats.js","../src/Dispatcher.js","../src/KeyGenerator.js","../src/MetaTree.js","../src/Coupler.js","../src/Truss.js"],"names":["patchRenderWatcherGet","prototype","const","originalGet","get","call","this","e","vm","_watcher","Vue","config","errorHandler","escapeKey","key","toString","replace","char","charCodeAt","unescapeKey","code","String","fromCharCode","parseInt","slice","escapeKeys","object","_","isObject","Object","isExtensible","let","result","hasOwnProperty","value","escapedKey","escapedValue","clone","joinPath","segments","i","list","arguments","length","segment","isString","charAt","splice","push","join","splitPath","path","leaveSegmentsEscaped","pathSegments","split","map","set","makePathMatcher","pattern","matcher","pathMatchers","PathMatcher","size","maxNumPathMatchers","keys","errorFromJson","json","params","isError","error","Error","message","propertyName","extra","isTrussEqual","a","b","isEqual","isTrussValueEqual","undefined","$truss","copyPrototype","getOwnPropertyNames","prop","defineProperty","getOwnPropertyDescriptor","flattenRefs","refs","Handle","mapValues","wrapPromiseCallback","callback","Promise","resolve","apply","reject","promiseCancel","promise","cancel","promiseFinally","propagatePromiseProperty","originalThen","then","originalCatch","catch","onResolved","onRejected","derivedPromise","onFinally","computeValue","propertyStats","$destroyed","$$touchThis","oldPropertyFrozen","currentPropertyFrozen","startTime","performanceNow","ErrorWrapper","runtime","numRecomputes","FrozenWrapper","wrapConnections","connections","descriptor","isFunction","fn","angularWatchSuppressed","freeze","isFrozen","isArray","checkUpdateHasOnlyDescendantsWithNoOverlap","rootPath","values","forEach","startsWith","includes","absolutePath","allPaths","sortBy","otherPath","extractCommonPathPrefix","prefixSegments","firstMismatchIndex","maxIndex","Math","min","relativizePaths","offset","toFirebaseJson","data","$data","vue","lastDigestRequest","digestInProgress","bareDigest","digestRequest","angularProxy","active","window","angular","module","digest","watch","defineModule","Truss","constant","debounceDigest","wait","debouncedDigest","debounce","$provide","decorator","$delegate","$exceptionHandler","rootScope","$watch","bind","proto","getPrototypeOf","angularDigest","$digest","original","nextTick","last","_watchers","id","Infinity","method","noop","LruCacheItem","touch","timestamp","Date","now","LruCache","maxSize","pruningSize","_items","create","_size","_maxSize","_pruningSize","ceil","has","Boolean","item","_prune","delete","itemsToPrune","toArray","take","variables","prefixMatch","endsWith","pathTemplate","match","test","_regex","RegExp","lastIndex","exec","bindings","MIN_WORKER_VERSION","Snapshot","ref","exists","writeSerial","_path","_value","_exists","_writeSerial","prototypeAccessors","_key","Bridge","webWorker","_idCounter","_deferreds","_suspended","_servers","_callbacks","_log","_inboundMessages","_outboundMessages","_flushMessageQueue","_port","port","_shared","seal","onmessage","_receive","addEventListener","_send","msg","init","items","storage","localStorage","sessionStorage","getItem","response","workerVersion","version","minVersion","suspend","suspended","_receiveMessages","enableLogging","console","log","oneWay","this$1","deferred","sent","resolveSent","postMessage","messages","event","concat","bindExposedFunction","name","args","Array","updateLocalStorage","removeItem","setItem","trackServer","rootUrl","server","authListeners","authCallbackId","_registerCallback","_authCallback","url","callbackId","auth","listener","onAuth","context","getAuth","offAuth","authWithCustomToken","authToken","unauth","update","once","snapshot","on","listenerKey","spec","eventType","snapshotCallback","cancelCallback","options","handle","_onCallback","__callbackIds","off","idsToDeregister","_findAndRemoveCallbackId","isMatch","i$1","list$1","_nullifyCallback","_deregisterCallback","snapshotJson","transaction","oldValue","relativeUpdates","snapshots","jsonSnapshot","onDisconnect","bounceConnection","predicate","EMPTY_ANNOTATIONS","tree","annotations","_tree","_annotations","$ref","_pathPrefix","parent","Reference","child","children","escapedKeys","arg","mapping","subPath","rest","subRef","subMapping","peek","truss","that","belongsTo","Query","super","_spec","_copyAndValidateSpec","queryTerms","encodeURIComponent","JSON","stringify","_string","prototypeAccessors$1","ready","isQueryReady","constraints","annotate","assign","by","some","clause","childPath","prototypeAccessors$2","isReferenceReady","getObject","query","obj","override","commit","updateFunction","SERVER_TIMESTAMP",".sv","getNanoSeconds","hrtime","loadTime","performance","exports","process","hr","getTime","StatItem","numUpdates","add","runtimePerRecompute","toLogParts","totals","toFixed","Stats","for","n","stats","stat","above","lines","widths","range","line","max","column","padLeft","wrap","getter","className","propName","_computedWatchers","newValue","Connector","scope","_scope","_connections","_method","_subConnectors","_disconnects","_angularUnwatches","_data","_vue","descriptors","destroy","_linkScopeProperties","_bindComputedConnection","_connect","$on","$id","every","ignored","at","_unlinkScopeProperties","unwatch","_disconnect","$destroy","dataProperties","unused","configurable","enumerable","defineProperties","__ob__","dep","notify","connectionStats","_computeConnection","_updateComputedConnection","angularWatch","immediate","newDescriptor","oldDescriptor","descriptorChanged","_updateConnections","connectReference","updateFn","_updateQueryValue","connectQuery","subScope","subRefs","subConnector","unobserve","observe","subReady","_updateRefValue","childKeys","childKey","INTERCEPT_KEYS","EMPTY_ARRAY","SlowHandle","operation","delay","_operation","_delay","_callback","_fired","initiate","elapsed","_startTimestamp","_timeoutId","setTimeout","clearTimeout","Operation","type","target","operand","_type","_target","_operand","_ready","_running","_ended","_tries","_slowHandles","targets","escapedPathFragment","running","ended","tries","_error","onSlow","_setRunning","_setEnded","_markReady","ending","_clearReady","_incrementTries","Dispatcher","bridge","_bridge","intercept","interceptKey","callbacks","badCallbackKeys","difference","wrappedCallbacks","onBefore","_addCallback","onAfter","onError","onFailure","_removeCallbacks","stage","_getCallbacksKey","wrappedCallback","_removeCallback","pull","_getCallbacks","operationType","execute","executor","createOperation","begin","executeWithRetries","_retryOrEnd","end","all","markReady","clearReady","retry","results","retrying","_afterEnd","onFailureCallbacks","ALPHABET","getRandomValues","crypto","KeyGenerator","_lastUniqueKeyTime","_lastRandomValues","generateUniqueKey","chars","prefix","floor","array","Uint8Array","random","MetaTree","dispatcher","_rootUrl","_dispatcher","$root","connected","timeOffset","user","userid","nowAtInterval","intervalMillis","setInterval","_auth","serial","initialAuthChangeReceived","_handleAuthChange","_connectInfoProperty","root","authenticate","token","unauthenticate","approved","supersededChange","authSerial","uid","_isAuthChangeStale","property","attribute","propertyUrl","snap","creatingObjectProperties","RESERVED_VALUE_PROPERTY_NAMES","$$$trussCheck","BaseValue","$meta","meta","$store","store","$now","$newKey","newKey","$intercept","actionType","unintercept","uninterceptAndRemoveFinalizer","$$finalizers","$connect","connector","connect","originalDestroy","$peek","$observe","subjectFn","callbackFn","unobserveAndRemoveFinalizer","$when","expression","when","writable","Value","$parent","$path","$refs","$key","lastIndexOf","$hidden","$empty","isEmpty","$keys","$values","$ready","$overridden","$nextTick","$freezeComputedProperty","isBoolean","$set","$update","$override","$commit","depend","$$initializers","Modeler","debug","_trie","Class","_debug","classes","rootAcceptable","isPlainObject","$trussMount","$$trussMount","uniq","_mountClass","_decorateTrie","_getMount","scaffold","node","$","_findMount","local","localDescendants","_augmentClass","computedProperties","constructor","fullName","allVariables","mounts","mount","variable","placeholder","targetMount","pick","createObject","properties","_wrapProperties","keysUnsafe","hidden","_buildComputedPropertyDescriptor","valueKey","pendingPromise","writeAllowed","unwatchNow","compute","finalValue","trussExpectedException","watcher","destroyObject","$finalize","isPlaceholder","isLocal","_hasLocalProperties","forEachPlaceholderChild","iteratee","checkVueObject","checkedObjects","top","trussCode","QueryHandler","coupler","_coupler","_query","_listeners","_keys","_url","_segments","_listening","attach","keysCallback","_listen","detach","k","findIndex","_handleSnapshot","_handleError","sync","_decoupleSegments","_queueSnapshotCallback","updatedKeys","_updateKeys","_applySnapshot","sort","_coupleSegments","hasKey","Node","operations","queryCount","listening","count","listen","skip","op","unlisten","_forAllDescendants","isTrunkCoupled","collectCoupledDescendantPaths","paths","Coupler","applySnapshot","prunePath","_pendingSnapshotCallbacks","_throttled","processPendingSnapshots","_processPendingSnapshots","_prunePath","queryHandlers","_nodeIndex","_root","_queryHandlers","queryHandler","couple","superseded","decouple","ancestors","findCoupledDescendantPaths","subscribe","unsubscribe","isSubtreeReady","extractChildSegment","childSegment","throttleSnapshots","throttle","Transaction","_ref","_outcome","_values","currentValue","outcome","_setOutcome","abort","","Tree","_truss","_firebasePropertyEditAllowed","_localWrites","_localWriteTimestamp","_initialized","_modeler","VERSION","_integrateSnapshot","_createObject","_fixObject","_completeCreateObject","createdObjects","_plantPlaceholders","_checkHandle","_disconnectReference","_disconnected","_coupled","_disconnectQuery","throttleRemoteDataUpdates","numValues","_applyLocalWrite","pathPrefix","immediateFailure","_repair","attemptTransaction","txn","committed","basePath","flatten","numLocal","coupledDescendantPaths","descendantPath","subValue","_plantValue","_scaffoldAncestors","_destroyObject","remoteWrite","dropRight","ancestorPath","_setFirebaseProperty","objectCreated","escapedChildKey","lockedDescendantPaths","_avoidLocalWritePaths","_pruneAncestors","_pruneDescendants","localWritePath","targetPath","targetObject","targetKey","deleted","targetParentPath","ghostObjects","_holdsConcreteData","_deleteFirebaseProperty","coupledDescendantFound","valueLocked","shouldDelete","_getFirebasePropertyDescriptor","_overwriteFirebaseProperty","logging","workerFunctions","_keyGenerator","_metaTree","identity","cleanup","callbackPromise","oldValueClone","usePreciseDefaults","precise","numCallbacks","deep","newValueClone","defaultsDeep","defaults","timeoutHandle","timeoutMessage","timeout","checkObjectsForRogueProperties","staticAccessors","computedPropertyStats","connectWorker","Worker","SharedWorker","exposedFunctionNames","firebaseSdkVersion","worker","preExpose","functionName","debugPermissionDeniedErrors","simulatedTokenGenerator","maxSimulationDuration","callFilter","debounceAngularDigest","FIREBASE_SDK_VERSION","ComponentPlugin","install","Vue2","pluginOptions","prototypeExtension","_isBeingDestroyed","_isDestroyed","conflictingKeys","union","intersection","mixin","destroyed"],"mappings":"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","file":"firetruss.umd.min.js","sourcesContent":["/* globals window */\n\nimport _ from 'lodash';\nimport Vue from 'vue';\n\n\nlet vue;\nlet lastDigestRequest = 0, digestInProgress = false;\nconst bareDigest = function() {\n  if (vue.digestRequest > lastDigestRequest) return;\n  vue.digestRequest = lastDigestRequest + 1;\n};\n\nconst angularProxy = {\n  active: typeof window !== 'undefined' && window.angular\n};\n\nif (angularProxy.active) {\n  initAngular();\n} else {\n  _.forEach(['digest', 'watch', 'defineModule', 'debounceDigest'], method => {\n    angularProxy[method] = _.noop;\n  });\n}\n\nfunction initAngular() {\n  const module = window.angular.module('firetruss', []);\n  angularProxy.digest = bareDigest;\n  angularProxy.watch = function() {throw new Error('Angular watch proxy not yet initialized');};\n  angularProxy.defineModule = function(Truss) {\n    module.constant('Truss', Truss);\n  };\n  angularProxy.debounceDigest = function(wait) {\n    if (wait) {\n      const debouncedDigest = _.debounce(bareDigest, wait);\n      angularProxy.digest = function() {\n        if (vue.digestRequest > lastDigestRequest) return;\n        if (digestInProgress) bareDigest(); else debouncedDigest();\n      };\n    } else {\n      angularProxy.digest = bareDigest;\n    }\n  };\n\n  module.config(['$provide', function($provide) {\n    $provide.decorator('$rootScope', ['$delegate', '$exceptionHandler',\n      function($delegate, $exceptionHandler) {\n        const rootScope = $delegate;\n        angularProxy.watch = rootScope.$watch.bind(rootScope);\n        const proto = Object.getPrototypeOf(rootScope);\n        const angularDigest = proto.$digest;\n        proto.$digest = bareDigest;\n        proto.$digest.original = angularDigest;\n        vue = new Vue({data: {digestRequest: 0}});\n        vue.$watch(() => vue.digestRequest, () => {\n          if (vue.digestRequest > lastDigestRequest) {\n            // Make sure we execute the digest outside the Vue task queue, because otherwise if the\n            // client replaced Promise with angular.$q all Truss.nextTick().then() functions will be\n            // executed inside the Angular digest and hence inside the Vue task queue. But\n            // Truss.nextTick() is used precisely to avoid that.  Note that it's OK to use\n            // Vue.nextTick() here because even though it will schedule a flush via Promise.then()\n            // it only uses the native Promise, before it could've been monkey-patched by the app.\n            Vue.nextTick(() => {\n              if (vue.digestRequest <= lastDigestRequest) return;\n              digestInProgress = true;\n              rootScope.$digest.original.call(rootScope);\n              lastDigestRequest = vue.digestRequest = vue.digestRequest + 1;\n            });\n          } else {\n            digestInProgress = false;\n          }\n        });\n        _.last(vue._watchers).id = Infinity;  // make sure watcher is scheduled last\n        patchRenderWatcherGet(Object.getPrototypeOf(_.last(vue._watchers)));\n        return rootScope;\n      }\n    ]);\n  }]);\n}\n\n// This is a kludge that catches errors that get through render watchers and end up killing the\n// entire Vue event loop (e.g., errors raised in transition callbacks).  The state of the DOM may\n// not be consistent after such an error is caught, but the global error handler should stop the\n// world anyway.  May be related to https://github.com/vuejs/vue/issues/7653.\nfunction patchRenderWatcherGet(prototype) {\n  const originalGet = prototype.get;\n  prototype.get = function get() {\n    try {\n      return originalGet.call(this);\n    } catch (e) {\n      if (this.vm._watcher === this && Vue.config.errorHandler) {\n        Vue.config.errorHandler(e, this.vm, 'uncaught render error');\n      } else {\n        throw e;\n      }\n    }\n  };\n}\n\nexport default angularProxy;\n","import LruCache from './LruCache.js';\nimport _ from 'lodash';\n\n\nconst pathSegments = new LruCache(1000);\nconst pathMatchers = {};\nconst maxNumPathMatchers = 1000;\n\n\nexport function escapeKey(key) {\n  if (!key) return key;\n  return key.toString().replace(/[\\\\.$#[\\]/]/g, function(char) {\n    return '\\\\' + char.charCodeAt(0).toString(16);\n  });\n}\n\nexport function unescapeKey(key) {\n  if (!key) return key;\n  return key.toString().replace(/\\\\[0-9a-f]{2}/gi, function(code) {\n    return String.fromCharCode(parseInt(code.slice(1), 16));\n  });\n}\n\nexport function escapeKeys(object) {\n  // isExtensible check avoids trying to escape references to Firetruss internals.\n  if (!(_.isObject(object) && Object.isExtensible(object))) return object;\n  let result = object;\n  for (const key in object) {\n    if (!object.hasOwnProperty(key)) continue;\n    const value = object[key];\n    const escapedKey = escapeKey(key);\n    const escapedValue = escapeKeys(value);\n    if (escapedKey !== key || escapedValue !== value) {\n      if (result === object) result = _.clone(object);\n      result[escapedKey] = escapedValue;\n      if (result[key] === value) delete result[key];\n    }\n  }\n  return result;\n}\n\nexport function joinPath() {\n  const segments = [];\n  for (let segment of arguments) {\n    if (!_.isString(segment)) segment = '' + segment;\n    if (segment.charAt(0) === '/') segments.splice(0, segments.length);\n    segments.push(segment);\n  }\n  if (segments[0] === '/') segments[0] = '';\n  return segments.join('/');\n}\n\nexport function splitPath(path, leaveSegmentsEscaped) {\n  const key = (leaveSegmentsEscaped ? 'esc:' : '') + path;\n  let segments = pathSegments.get(key);\n  if (!segments) {\n    segments = path.split('/');\n    if (!leaveSegmentsEscaped) segments = _.map(segments, unescapeKey);\n    pathSegments.set(key, segments);\n  }\n  return segments;\n}\n\n\nclass PathMatcher {\n  constructor(pattern) {\n    this.variables = [];\n    const prefixMatch = _.endsWith(pattern, '/$*');\n    if (prefixMatch) pattern = pattern.slice(0, -3);\n    const pathTemplate = pattern.replace(/\\/\\$[^/]*/g, match => {\n      if (match.length > 1) this.variables.push(match.slice(1));\n      return '\\u0001';\n    });\n    Object.freeze(this.variables);\n    if (/[.$#[\\]]|\\\\(?![0-9a-f][0-9a-f])/i.test(pathTemplate)) {\n      throw new Error('Path pattern has unescaped keys: ' + pattern);\n    }\n    this._regex = new RegExp(\n      // eslint-disable-next-line no-control-regex\n      '^' + pathTemplate.replace(/\\u0001/g, '/([^/]+)') + (prefixMatch ? '($|/)' : '$'));\n  }\n\n  match(path) {\n    this._regex.lastIndex = 0;\n    const match = this._regex.exec(path);\n    if (!match) return;\n    const bindings = {};\n    for (let i = 0; i < this.variables.length; i++) {\n      bindings[this.variables[i]] = unescapeKey(match[i + 1]);\n    }\n    return bindings;\n  }\n\n  test(path) {\n    return this._regex.test(path);\n  }\n\n  toString() {\n    return this._regex.toString();\n  }\n}\n\nexport function makePathMatcher(pattern) {\n  let matcher = pathMatchers[pattern];\n  if (!matcher) {\n    matcher = new PathMatcher(pattern);\n    // Minimal pseudo-LRU behavior, since we don't expect to actually fill up the cache.\n    if (_.size(pathMatchers) === maxNumPathMatchers) delete pathMatchers[_.keys(pathMatchers)[0]];\n    pathMatchers[pattern] = matcher;\n  }\n  return matcher;\n}\n","import {unescapeKey} from './utils/paths.js';\nimport _ from 'lodash';\n\nconst MIN_WORKER_VERSION = '2.0.0';\n\n\nclass Snapshot {\n  constructor({path, value, exists, writeSerial}) {\n    this._path = path;\n    this._value = value;\n    this._exists = value === undefined ? exists || false : value !== null;\n    this._writeSerial = writeSerial;\n  }\n\n  get path() {\n    return this._path;\n  }\n\n  get exists() {\n    return this._exists;\n  }\n\n  get value() {\n    if (this._value === undefined) throw new Error('Value omitted from snapshot');\n    return this._value;\n  }\n\n  get key() {\n    if (this._key === undefined) this._key = unescapeKey(this._path.replace(/.*\\//, ''));\n    return this._key;\n  }\n\n  get writeSerial() {\n    return this._writeSerial;\n  }\n}\n\n\nexport default class Bridge {\n  constructor(webWorker) {\n    this._idCounter = 0;\n    this._deferreds = {};\n    this._suspended = false;\n    this._servers = {};\n    this._callbacks = {};\n    this._log = _.noop;\n    this._inboundMessages = [];\n    this._outboundMessages = [];\n    this._flushMessageQueue = this._flushMessageQueue.bind(this);\n    this._port = webWorker.port || webWorker;\n    this._shared = !!webWorker.port;\n    Object.seal(this);\n    this._port.onmessage = this._receive.bind(this);\n    window.addEventListener('unload', () => {this._send({msg: 'destroy'});});\n  }\n\n  init(webWorker, config) {\n    const items = [];\n    try {\n      const storage = window.localStorage || window.sessionStorage;\n      if (!storage) throw new Error('localStorage and sessionStorage not available');\n      for (let i = 0; i < storage.length; i++) {\n        const key = storage.key(i);\n        items.push({key, value: storage.getItem(key)});\n      }\n    } catch (e) {\n      // Some browsers don't like us accessing local storage -- nothing we can do.\n    }\n    return this._send({msg: 'init', storage: items, config}).then(response => {\n      const workerVersion = response.version.match(/^(\\d+)\\.(\\d+)\\.(\\d+)(-.*)?$/);\n      if (workerVersion) {\n        const minVersion = MIN_WORKER_VERSION.match(/^(\\d+)\\.(\\d+)\\.(\\d+)(-.*)?$/);\n        // Major version must match precisely, minor and patch must be greater than or equal.\n        const sufficient = workerVersion[1] === minVersion[1] && (\n          workerVersion[2] > minVersion[2] ||\n          workerVersion[2] === minVersion[2] && workerVersion[3] >= minVersion[3]\n        );\n        if (!sufficient) {\n          return Promise.reject(new Error(\n            `Incompatible Firetruss worker version: ${response.version} ` +\n            `(${MIN_WORKER_VERSION} or better required)`\n          ));\n        }\n      }\n      return response;\n    });\n  }\n\n  suspend(suspended) {\n    if (suspended === undefined) suspended = true;\n    if (this._suspended === suspended) return;\n    this._suspended = suspended;\n    if (!suspended) {\n      this._receiveMessages(this._inboundMessages);\n      this._inboundMessages = [];\n      if (this._outboundMessages.length) Promise.resolve().then(this._flushMessageQueue);\n    }\n  }\n\n  enableLogging(fn) {\n    if (fn) {\n      if (fn === true) fn = console.log.bind(console);\n      this._log = fn;\n    } else {\n      this._log = _.noop;\n    }\n  }\n\n  _send(message) {\n    message.id = ++this._idCounter;\n    let promise;\n    if (message.oneWay) {\n      promise = Promise.resolve();\n    } else {\n      promise = new Promise((resolve, reject) => {\n        this._deferreds[message.id] = {resolve, reject};\n      });\n      const deferred = this._deferreds[message.id];\n      deferred.promise = promise;\n      promise.sent = new Promise(resolve => {\n        deferred.resolveSent = resolve;\n      });\n      deferred.params = message;\n    }\n    if (!this._outboundMessages.length && !this._suspended) {\n      Promise.resolve().then(this._flushMessageQueue);\n    }\n    this._log('send:', message);\n    this._outboundMessages.push(message);\n    return promise;\n  }\n\n  _flushMessageQueue() {\n    try {\n      this._port.postMessage(this._outboundMessages);\n      this._outboundMessages = [];\n    } catch (e) {\n      e.extra = {messages: this._outboundMessages};\n      throw e;\n    }\n  }\n\n  _receive(event) {\n    if (this._suspended) {\n      this._inboundMessages = this._inboundMessages.concat(event.data);\n    } else {\n      this._receiveMessages(event.data);\n    }\n  }\n\n  _receiveMessages(messages) {\n    for (const message of messages) {\n      this._log('recv:', message);\n      const fn = this[message.msg];\n      if (!_.isFunction(fn)) throw new Error('Unknown message: ' + message.msg);\n      fn.call(this, message);\n    }\n  }\n\n  bindExposedFunction(name) {\n    return (function() {\n      return this._send({msg: 'call', name, args: Array.prototype.slice.call(arguments)});\n    }).bind(this);\n  }\n\n  resolve(message) {\n    const deferred = this._deferreds[message.id];\n    if (!deferred) throw new Error('Received resolution to inexistent Firebase call');\n    delete this._deferreds[message.id];\n    deferred.resolve(message.result);\n  }\n\n  reject(message) {\n    const deferred = this._deferreds[message.id];\n    if (!deferred) throw new Error('Received rejection of inexistent Firebase call');\n    delete this._deferreds[message.id];\n    deferred.reject(errorFromJson(message.error, deferred.params));\n  }\n\n  updateLocalStorage({items}) {\n    try {\n      const storage = window.localStorage || window.sessionStorage;\n      for (const item of items) {\n        if (item.value === null) {\n          storage.removeItem(item.key);\n        } else {\n          storage.setItem(item.key, item.value);\n        }\n      }\n    } catch (e) {\n      // If we're denied access, there's nothing we can do.\n    }\n  }\n\n  trackServer(rootUrl) {\n    if (this._servers.hasOwnProperty(rootUrl)) return Promise.resolve();\n    const server = this._servers[rootUrl] = {authListeners: []};\n    const authCallbackId = this._registerCallback(this._authCallback.bind(this, server));\n    this._send({msg: 'onAuth', url: rootUrl, callbackId: authCallbackId});\n  }\n\n  _authCallback(server, auth) {\n    server.auth = auth;\n    for (const listener of server.authListeners) listener(auth);\n  }\n\n  onAuth(rootUrl, callback, context) {\n    const listener = callback.bind(context);\n    listener.callback = callback;\n    listener.context = context;\n    this._servers[rootUrl].authListeners.push(listener);\n    listener(this.getAuth(rootUrl));\n  }\n\n  offAuth(rootUrl, callback, context) {\n    const authListeners = this._servers[rootUrl].authListeners;\n    for (let i = 0; i < authListeners.length; i++) {\n      const listener = authListeners[i];\n      if (listener.callback === callback && listener.context === context) {\n        authListeners.splice(i, 1);\n        break;\n      }\n    }\n  }\n\n  getAuth(rootUrl) {\n    return this._servers[rootUrl].auth;\n  }\n\n  authWithCustomToken(url, authToken) {\n    return this._send({msg: 'authWithCustomToken', url, authToken});\n  }\n\n  unauth(url) {\n    return this._send({msg: 'unauth', url});\n  }\n\n  set(url, value, writeSerial) {return this._send({msg: 'set', url, value, writeSerial});}\n  update(url, value, writeSerial) {return this._send({msg: 'update', url, value, writeSerial});}\n\n  once(url, writeSerial) {\n    return this._send({msg: 'once', url, writeSerial}).then(snapshot => new Snapshot(snapshot));\n  }\n\n  on(listenerKey, url, spec, eventType, snapshotCallback, cancelCallback, context, options) {\n    const handle = {\n      listenerKey, eventType, snapshotCallback, cancelCallback, context,\n      params: {msg: 'on', listenerKey, url, spec, eventType, options}\n    };\n    const callback = this._onCallback.bind(this, handle);\n    this._registerCallback(callback, handle);\n    // Keep multiple IDs to allow the same snapshotCallback to be reused.\n    snapshotCallback.__callbackIds = snapshotCallback.__callbackIds || [];\n    snapshotCallback.__callbackIds.push(handle.id);\n    this._send({\n      msg: 'on', listenerKey, url, spec, eventType, callbackId: handle.id, options\n    }).catch(error => {\n      callback(error);\n    });\n  }\n\n  off(listenerKey, url, spec, eventType, snapshotCallback, context) {\n    const idsToDeregister = [];\n    let callbackId;\n    if (snapshotCallback) {\n      callbackId = this._findAndRemoveCallbackId(\n        snapshotCallback, handle => _.isMatch(handle, {listenerKey, eventType, context})\n      );\n      if (!callbackId) return Promise.resolve();  // no-op, never registered or already deregistered\n      idsToDeregister.push(callbackId);\n    } else {\n      for (const id of _.keys(this._callbacks)) {\n        const handle = this._callbacks[id];\n        if (handle.listenerKey === listenerKey && (!eventType || handle.eventType === eventType)) {\n          idsToDeregister.push(id);\n        }\n      }\n    }\n    // Nullify callbacks first, then deregister after off() is complete.  We don't want any\n    // callbacks in flight from the worker to be invoked while the off() is processing, but we don't\n    // want them to throw an exception either.\n    for (const id of idsToDeregister) this._nullifyCallback(id);\n    return this._send({msg: 'off', listenerKey, url, spec, eventType, callbackId}).then(() => {\n      for (const id of idsToDeregister) this._deregisterCallback(id);\n    });\n  }\n\n  _onCallback(handle, error, snapshotJson) {\n    if (error) {\n      this._deregisterCallback(handle.id);\n      const e = errorFromJson(error, handle.params);\n      if (handle.cancelCallback) {\n        handle.cancelCallback.call(handle.context, e);\n      } else {\n        console.error(e);\n      }\n    } else {\n      handle.snapshotCallback.call(handle.context, new Snapshot(snapshotJson));\n    }\n  }\n\n  transaction(url, oldValue, relativeUpdates, writeSerial) {\n    return this._send(\n      {msg: 'transaction', url, oldValue, relativeUpdates, writeSerial}\n    ).then(result => {\n      if (result.snapshots) {\n        result.snapshots = _.map(result.snapshots, jsonSnapshot => new Snapshot(jsonSnapshot));\n      }\n      return result;\n    });\n  }\n\n  onDisconnect(url, method, value) {\n    return this._send({msg: 'onDisconnect', url, method, value});\n  }\n\n  bounceConnection() {\n    return this._send({msg: 'bounceConnection'});\n  }\n\n  callback({id, args}) {\n    const handle = this._callbacks[id];\n    if (!handle) throw new Error('Unregistered callback: ' + id);\n    handle.callback.apply(null, args);\n  }\n\n  _registerCallback(callback, handle) {\n    handle = handle || {};\n    handle.callback = callback;\n    handle.id = `cb${++this._idCounter}`;\n    this._callbacks[handle.id] = handle;\n    return handle.id;\n  }\n\n  _nullifyCallback(id) {\n    this._callbacks[id].callback = _.noop;\n  }\n\n  _deregisterCallback(id) {\n    delete this._callbacks[id];\n  }\n\n  _findAndRemoveCallbackId(callback, predicate) {\n    if (!callback.__callbackIds) return;\n    let i = 0;\n    while (i < callback.__callbackIds.length) {\n      const id = callback.__callbackIds[i];\n      const handle = this._callbacks[id];\n      if (!handle) {\n        callback.__callbackIds.splice(i, 1);\n        continue;\n      }\n      if (predicate(handle)) {\n        callback.__callbackIds.splice(i, 1);\n        return id;\n      }\n      i += 1;\n    }\n  }\n}\n\n\nfunction errorFromJson(json, params) {\n  if (!json || _.isError(json)) return json;\n  const error = new Error(json.message);\n  error.params = params;\n  for (const propertyName in json) {\n    if (propertyName === 'message' || !json.hasOwnProperty(propertyName)) continue;\n    try {\n      error[propertyName] = json[propertyName];\n    } catch (e) {\n      error.extra = error.extra || {};\n      error.extra[propertyName] = json[propertyName];\n    }\n  }\n  return error;\n}\n","import _ from 'lodash';\n\n\nexport const SERVER_TIMESTAMP = Object.freeze({'.sv': 'timestamp'});\n\nexport function isTrussEqual(a, b) {\n  return _.isEqual(a, b, isTrussValueEqual);\n}\n\nfunction isTrussValueEqual(a, b) {\n  if (a === b || a === undefined || a === null || b === undefined || b === null ||\n      a.$truss || b.$truss) return a === b;\n  if (a.isEqual) return a.isEqual(b);\n}\n\nexport function copyPrototype(a, b) {\n  for (const prop of Object.getOwnPropertyNames(a.prototype)) {\n    if (prop === 'constructor') continue;\n    Object.defineProperty(b.prototype, prop, Object.getOwnPropertyDescriptor(a.prototype, prop));\n  }\n}\n","import {Handle, Query, Reference} from './Reference.js';\nimport angular from './angularCompatibility.js';\nimport stats from './utils/stats.js';\nimport {isTrussEqual} from './utils/utils.js';\n\nimport _ from 'lodash';\nimport performanceNow from 'performance-now';\nimport Vue from 'vue';\n\n\nexport default class Connector {\n  constructor(scope, connections, tree, method, refs) {\n    Object.freeze(connections);\n    this._scope = scope;\n    this._connections = connections;\n    this._tree = tree;\n    this._method = method;\n\n    this._subConnectors = {};\n    this._disconnects = {};\n    this._angularUnwatches = undefined;\n    this._data = {};\n    this._vue = new Vue({data: {\n      descriptors: {},\n      refs: refs || {},\n      values: _.mapValues(connections, _.constant(undefined))\n    }});\n    this.destroy = this.destroy;  // allow instance-level overrides of destroy() method\n    Object.seal(this);\n\n    this._linkScopeProperties();\n\n    _.forEach(connections, (descriptor, key) => {\n      if (_.isFunction(descriptor)) {\n        this._bindComputedConnection(key, descriptor);\n      } else {\n        this._connect(key, descriptor);\n      }\n    });\n\n    if (angular.active && scope && scope.$on && scope.$id) {\n      scope.$on('$destroy', () => {this.destroy();});\n    }\n  }\n\n  get ready() {\n    return _.every(this._connections, (ignored, key) => {\n      const descriptor = this._vue.descriptors[key];\n      if (!descriptor) return false;\n      if (descriptor instanceof Handle) return descriptor.ready;\n      return this._subConnectors[key].ready;\n    });\n  }\n\n  get at() {\n    return this._vue.refs;\n  }\n\n  get data() {\n    return this._data;\n  }\n\n  destroy() {\n    this._unlinkScopeProperties();\n    _.forEach(this._angularUnwatches, unwatch => {unwatch();});\n    _.forEach(this._connections, (descriptor, key) => {this._disconnect(key);});\n    this._vue.$destroy();\n  }\n\n  _linkScopeProperties() {\n    const dataProperties = _.mapValues(this._connections, (unused, key) => ({\n      configurable: true, enumerable: false, get: () => {\n        const descriptor = this._vue.descriptors[key];\n        if (descriptor instanceof Reference) return descriptor.value;\n        return this._vue.values[key];\n      }\n    }));\n    Object.defineProperties(this._data, dataProperties);\n    if (this._scope) {\n      for (const key in this._connections) {\n        if (key in this._scope) {\n          throw new Error(`Property already defined on connection target: ${key}`);\n        }\n      }\n      Object.defineProperties(this._scope, dataProperties);\n      if (this._scope.__ob__) this._scope.__ob__.dep.notify();\n    }\n  }\n\n  _unlinkScopeProperties() {\n    if (!this._scope) return;\n    _.forEach(this._connections, (descriptor, key) => {\n      delete this._scope[key];\n    });\n  }\n\n  _bindComputedConnection(key, fn) {\n    const connectionStats = stats.for(`connection.at.${key}`);\n    const getter = this._computeConnection.bind(this, fn, connectionStats);\n    const update = this._updateComputedConnection.bind(this, key, fn, connectionStats);\n    const angularWatch = angular.active && !fn.angularWatchSuppressed;\n    // Use this._vue.$watch instead of truss.observe here so that we can disable the immediate\n    // callback if we'll get one from Angular anyway.\n    this._vue.$watch(getter, update, {immediate: !angularWatch});\n    if (angularWatch) {\n      if (!this._angularUnwatches) this._angularUnwatches = [];\n      this._angularUnwatches.push(angular.watch(getter, update, true));\n    }\n  }\n\n  _computeConnection(fn, connectionStats) {\n    const startTime = performanceNow();\n    try {\n      return flattenRefs(fn.call(this._scope));\n    } finally {\n      connectionStats.runtime += performanceNow() - startTime;\n      connectionStats.numRecomputes += 1;\n    }\n  }\n\n  _updateComputedConnection(key, value, connectionStats) {\n    const newDescriptor = _.isFunction(value) ? value(this._scope) : value;\n    const oldDescriptor = this._vue.descriptors[key];\n    const descriptorChanged = !isTrussEqual(oldDescriptor, newDescriptor);\n    if (!descriptorChanged) return;\n    if (connectionStats && descriptorChanged) connectionStats.numUpdates += 1;\n    if (!newDescriptor) {\n      this._disconnect(key);\n      return;\n    }\n    if (newDescriptor instanceof Handle || !_.has(this._subConnectors, key)) {\n      this._disconnect(key);\n      this._connect(key, newDescriptor);\n    } else {\n      this._subConnectors[key]._updateConnections(newDescriptor);\n    }\n    Vue.set(this._vue.descriptors, key, newDescriptor);\n    angular.digest();\n  }\n\n  _updateConnections(connections) {\n    _.forEach(connections, (descriptor, key) => {\n      this._updateComputedConnection(key, descriptor);\n    });\n    _.forEach(this._connections, (descriptor, key) => {\n      if (!_.has(connections, key)) this._updateComputedConnection(key);\n    });\n    this._connections = connections;\n  }\n\n  _connect(key, descriptor) {\n    Vue.set(this._vue.descriptors, key, descriptor);\n    angular.digest();\n    if (!descriptor) return;\n    Vue.set(this._vue.values, key, undefined);\n    if (descriptor instanceof Reference) {\n      Vue.set(this._vue.refs, key, descriptor);\n      this._disconnects[key] = this._tree.connectReference(descriptor, this._method);\n    } else if (descriptor instanceof Query) {\n      Vue.set(this._vue.refs, key, descriptor);\n      const updateFn = this._updateQueryValue.bind(this, key);\n      this._disconnects[key] = this._tree.connectQuery(descriptor, updateFn, this._method);\n    } else {\n      const subScope = {}, subRefs = {};\n      Vue.set(this._vue.refs, key, subRefs);\n      const subConnector = this._subConnectors[key] =\n        new Connector(subScope, descriptor, this._tree, this._method, subRefs);\n      // Use a truss.observe here instead of this._vue.$watch so that the \"immediate\" execution\n      // actually takes place after we've captured the unwatch function, in case the subConnector\n      // is ready immediately.\n      const unobserve = this._disconnects[key] = this._tree.truss.observe(\n        () => subConnector.ready,\n        subReady => {\n          if (!subReady) return;\n          unobserve();\n          delete this._disconnects[key];\n          Vue.set(this._vue.values, key, subScope);\n          angular.digest();\n        }\n      );\n    }\n  }\n\n  _disconnect(key) {\n    Vue.delete(this._vue.refs, key);\n    this._updateRefValue(key, undefined);\n    if (_.has(this._subConnectors, key)) {\n      this._subConnectors[key].destroy();\n      delete this._subConnectors[key];\n    }\n    if (this._disconnects[key]) this._disconnects[key]();\n    delete this._disconnects[key];\n    Vue.delete(this._vue.descriptors, key);\n    angular.digest();\n  }\n\n  _updateRefValue(key, value) {\n    if (this._vue.values[key] !== value) {\n      Vue.set(this._vue.values, key, value);\n      angular.digest();\n    }\n  }\n\n  _updateQueryValue(key, childKeys) {\n    if (!this._vue.values[key]) {\n      Vue.set(this._vue.values, key, {});\n      angular.digest();\n    }\n    const subScope = this._vue.values[key];\n    for (const childKey in subScope) {\n      if (!subScope.hasOwnProperty(childKey)) continue;\n      if (!_.includes(childKeys, childKey)) {\n        Vue.delete(subScope, childKey);\n        angular.digest();\n      }\n    }\n    const object = this._tree.getObject(this._vue.descriptors[key].path);\n    for (const childKey of childKeys) {\n      if (subScope.hasOwnProperty(childKey)) continue;\n      Vue.set(subScope, childKey, object[childKey]);\n      angular.digest();\n    }\n  }\n\n}\n\nfunction flattenRefs(refs) {\n  if (!refs) return;\n  if (refs instanceof Handle) return refs.toString();\n  return _.mapValues(refs, flattenRefs);\n}\n\n","export function wrapPromiseCallback(callback) {\n  return function() {\n    try {\n      // eslint-disable-next-line no-invalid-this\n      return Promise.resolve(callback.apply(this, arguments));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n}\n\nexport function promiseCancel(promise, cancel) {\n  promise = promiseFinally(promise, () => {cancel = null;});\n  promise.cancel = () => {\n    if (!cancel) return;\n    cancel();\n    cancel = null;\n  };\n  propagatePromiseProperty(promise, 'cancel');\n  return promise;\n}\n\nfunction propagatePromiseProperty(promise, propertyName) {\n  const originalThen = promise.then, originalCatch = promise.catch;\n  promise.then = (onResolved, onRejected) => {\n    const derivedPromise = originalThen.call(promise, onResolved, onRejected);\n    derivedPromise[propertyName] = promise[propertyName];\n    propagatePromiseProperty(derivedPromise, propertyName);\n    return derivedPromise;\n  };\n  promise.catch = onRejected => {\n    const derivedPromise = originalCatch.call(promise, onRejected);\n    derivedPromise[propertyName] = promise[propertyName];\n    propagatePromiseProperty(derivedPromise, propertyName);\n    return derivedPromise;\n  };\n  return promise;\n}\n\nexport function promiseFinally(promise, onFinally) {\n  if (!onFinally) return promise;\n  onFinally = wrapPromiseCallback(onFinally);\n  return promise.then(result => {\n    return onFinally().then(() => result);\n  }, error => {\n    return onFinally().then(() => Promise.reject(error));\n  });\n}\n","import {Reference, Handle} from './Reference.js';\nimport angular from './angularCompatibility.js';\nimport stats from './utils/stats.js';\nimport {makePathMatcher, joinPath, splitPath, escapeKey, unescapeKey} from './utils/paths.js';\nimport {isTrussEqual, copyPrototype} from './utils/utils.js';\nimport {promiseFinally} from './utils/promises.js';\n\nimport _ from 'lodash';\nimport performanceNow from 'performance-now';\n\n// These are defined separately for each object so they're not included in Value below.\nconst RESERVED_VALUE_PROPERTY_NAMES = {$$$trussCheck: true, __ob__: true};\n\n// Holds properties that we're going to set on a model object that's being created right now as soon\n// as it's been created, but that we'd like to be accessible in the constructor.  The object\n// prototype's getters will pick those up until they get overridden in the instance.\nlet creatingObjectProperties;\n\nlet currentPropertyFrozen;\n\n\nexport class BaseValue {\n  get $meta() {return this.$truss.meta;}\n  get $store() {return this.$truss.store;}  // access indirectly to leave dependency trace\n  get $now() {return this.$truss.now;}\n\n  $newKey() {return this.$truss.newKey();}\n\n  $intercept(actionType, callbacks) {\n    if (this.$destroyed) throw new Error('Object already destroyed');\n    const unintercept = this.$truss.intercept(actionType, callbacks);\n    const uninterceptAndRemoveFinalizer = () => {\n      unintercept();\n      _.pull(this.$$finalizers, uninterceptAndRemoveFinalizer);\n    };\n    this.$$finalizers.push(uninterceptAndRemoveFinalizer);\n    return uninterceptAndRemoveFinalizer;\n  }\n\n  $connect(scope, connections) {\n    if (this.$destroyed) throw new Error('Object already destroyed');\n    if (!connections) {\n      connections = scope;\n      scope = undefined;\n    }\n    const connector = this.$truss.connect(scope, wrapConnections(this, connections));\n    const originalDestroy = connector.destroy;\n    const destroy = () => {\n      _.pull(this.$$finalizers, destroy);\n      return originalDestroy.call(connector);\n    };\n    this.$$finalizers.push(destroy);\n    connector.destroy = destroy;\n    return connector;\n  }\n\n  $peek(target, callback) {\n    if (this.$destroyed) throw new Error('Object already destroyed');\n    const promise = promiseFinally(\n      this.$truss.peek(target, callback), () => {_.pull(this.$$finalizers, promise.cancel);}\n    );\n    this.$$finalizers.push(promise.cancel);\n    return promise;\n  }\n\n  $observe(subjectFn, callbackFn, options) {\n    if (this.$destroyed) throw new Error('Object already destroyed');\n    let unobserveAndRemoveFinalizer;\n\n    const unobserve = this.$truss.observe(() => {\n      this.$$touchThis();\n      return subjectFn.call(this);\n    }, callbackFn.bind(this), options);\n\n    unobserveAndRemoveFinalizer = () => {  // eslint-disable-line prefer-const\n      unobserve();\n      _.pull(this.$$finalizers, unobserveAndRemoveFinalizer);\n    };\n    this.$$finalizers.push(unobserveAndRemoveFinalizer);\n    return unobserveAndRemoveFinalizer;\n  }\n\n  $when(expression, options) {\n    if (this.$destroyed) throw new Error('Object already destroyed');\n    const promise = this.$truss.when(() => {\n      this.$$touchThis();\n      return expression.call(this);\n    }, options);\n    promiseFinally(promise, () => {_.pull(this.$$finalizers, promise.cancel);});\n    this.$$finalizers.push(promise.cancel);\n    return promise;\n  }\n\n  get $$finalizers() {\n    Object.defineProperty(this, '$$finalizers', {\n      value: [], writable: false, enumerable: false, configurable: false});\n    return this.$$finalizers;\n  }\n}\n\n\nclass Value {\n  get $parent() {return creatingObjectProperties.$parent.value;}\n  get $path() {return creatingObjectProperties.$path.value;}\n  get $truss() {\n    Object.defineProperty(this, '$truss', {value: this.$parent.$truss});\n    return this.$truss;\n  }\n  get $ref() {\n    Object.defineProperty(this, '$ref', {value: new Reference(this.$truss._tree, this.$path)});\n    return this.$ref;\n  }\n  get $refs() {return this.$ref;}\n  get $key() {\n    Object.defineProperty(\n      this, '$key', {value: unescapeKey(this.$path.slice(this.$path.lastIndexOf('/') + 1))});\n    return this.$key;\n  }\n  get $data() {return this;}\n  get $hidden() {return false;}  // eslint-disable-line lodash/prefer-constant\n  get $empty() {return _.isEmpty(this.$data);}\n  get $keys() {return _.keys(this.$data);}\n  get $values() {return _.values(this.$data);}\n  get $ready() {return this.$ref.ready;}\n  get $overridden() {return false;}  // eslint-disable-line lodash/prefer-constant\n\n  $nextTick() {\n    if (this.$destroyed) throw new Error('Object already destroyed');\n    const promise = this.$truss.nextTick();\n    promiseFinally(promise, () => {_.pull(this.$$finalizers, promise.cancel);});\n    this.$$finalizers.push(promise.cancel);\n    return promise;\n  }\n\n  $freezeComputedProperty() {\n    if (!_.isBoolean(currentPropertyFrozen)) {\n      throw new Error('Cannot freeze a computed property outside of its getter function');\n    }\n    currentPropertyFrozen = true;\n  }\n\n  $set(value) {return this.$ref.set(value);}\n  $update(values) {return this.$ref.update(values);}\n  $override(values) {return this.$ref.override(values);}\n  $commit(options, updateFn) {return this.$ref.commit(options, updateFn);}\n\n  $$touchThis() {\n    /* eslint-disable no-unused-expressions */\n    if (this.__ob__) {\n      this.__ob__.dep.depend();\n    } else if (this.$parent) {\n      (this.$parent.hasOwnProperty('$data') ? this.$parent.$data : this.$parent)[this.$key];\n    } else {\n      this.$store;\n    }\n    /* eslint-enable no-unused-expressions */\n  }\n\n  get $$initializers() {\n    Object.defineProperty(this, '$$initializers', {\n      value: [], writable: false, enumerable: false, configurable: true});\n    return this.$$initializers;\n  }\n\n  get $destroyed() {  // eslint-disable-line lodash/prefer-constant\n    return false;\n  }\n}\n\ncopyPrototype(BaseValue, Value);\n\n_.forEach(Value.prototype, (prop, name) => {\n  Object.defineProperty(\n    Value.prototype, name, {value: prop, enumerable: false, configurable: false, writable: false});\n});\n\n\nclass ErrorWrapper {\n  constructor(error) {\n    this.error = error;\n  }\n}\n\n\nclass FrozenWrapper {\n  constructor(value) {\n    this.value = value;\n  }\n}\n\n\nexport default class Modeler {\n  constructor(debug) {\n    this._trie = {Class: Value};\n    this._debug = debug;\n    Object.freeze(this);\n  }\n\n  init(classes, rootAcceptable) {\n    if (_.isPlainObject(classes)) {\n      _.forEach(classes, (Class, path) => {\n        if (Class.$trussMount) return;\n        Class.$$trussMount = Class.$$trussMount || [];\n        Class.$$trussMount.push(path);\n      });\n      classes = _.values(classes);\n      _.forEach(classes, Class => {\n        if (!Class.$trussMount && Class.$$trussMount) {\n          Class.$trussMount = Class.$$trussMount;\n          delete Class.$$trussMount;\n        }\n      });\n    }\n    classes = _.uniq(classes);\n    _.forEach(classes, Class => this._mountClass(Class, rootAcceptable));\n    this._decorateTrie(this._trie);\n  }\n\n  destroy() {  // eslint-disable-line no-empty-function\n  }\n\n  _getMount(path, scaffold, predicate) {\n    const segments = splitPath(path, true);\n    let node;\n    for (const segment of segments) {\n      let child = segment ?\n        node.children && (node.children[segment] || !scaffold && node.children.$) : this._trie;\n      if (!child) {\n        if (!scaffold) return;\n        node.children = node.children || {};\n        child = node.children[segment] = {Class: Value};\n      }\n      node = child;\n      if (predicate && predicate(node)) break;\n    }\n    return node;\n  }\n\n  _findMount(predicate, node) {\n    if (!node) node = this._trie;\n    if (predicate(node)) return node;\n    for (const childKey of _.keys(node.children)) {\n      const result = this._findMount(predicate, node.children[childKey]);\n      if (result) return result;\n    }\n  }\n\n  _decorateTrie(node) {\n    _.forEach(node.children, child => {\n      this._decorateTrie(child);\n      if (child.local || child.localDescendants) node.localDescendants = true;\n    });\n  }\n\n  _augmentClass(Class) {\n    let computedProperties;\n    let proto = Class.prototype;\n    while (proto && proto.constructor !== Object) {\n      for (const name of Object.getOwnPropertyNames(proto)) {\n        const descriptor = Object.getOwnPropertyDescriptor(proto, name);\n        if (name.charAt(0) === '$') {\n          if (name === '$finalize') continue;\n          if (_.isEqual(descriptor, Object.getOwnPropertyDescriptor(Value.prototype, name))) {\n            continue;\n          }\n          throw new Error(`Property names starting with \"$\" are reserved: ${Class.name}.${name}`);\n        }\n        if (descriptor.get && !(computedProperties && computedProperties[name])) {\n          (computedProperties || (computedProperties = {}))[name] = {\n            name, fullName: `${proto.constructor.name}.${name}`, get: descriptor.get,\n            set: descriptor.set\n          };\n        }\n      }\n      proto = Object.getPrototypeOf(proto);\n    }\n    for (const name of Object.getOwnPropertyNames(Value.prototype)) {\n      if (name === 'constructor' || Class.prototype.hasOwnProperty(name)) continue;\n      Object.defineProperty(\n        Class.prototype, name, Object.getOwnPropertyDescriptor(Value.prototype, name));\n    }\n    return computedProperties;\n  }\n\n  _mountClass(Class, rootAcceptable) {\n    const computedProperties = this._augmentClass(Class);\n    const allVariables = [];\n    let mounts = Class.$trussMount;\n    if (!mounts) throw new Error(`Class ${Class.name} lacks a $trussMount static property`);\n    if (!_.isArray(mounts)) mounts = [mounts];\n    _.forEach(mounts, mount => {\n      if (_.isString(mount)) mount = {path: mount};\n      if (!rootAcceptable && mount.path === '/') {\n        throw new Error('Data root already accessed, too late to mount class');\n      }\n      const matcher = makePathMatcher(mount.path);\n      for (const variable of matcher.variables) {\n        if (variable === '$' || variable.charAt(1) === '$') {\n          throw new Error(`Invalid variable name: ${variable}`);\n        }\n        if (variable.charAt(0) === '$' && (\n          _.has(Value.prototype, variable) || RESERVED_VALUE_PROPERTY_NAMES[variable]\n        )) {\n          throw new Error(`Variable name conflicts with built-in property or method: ${variable}`);\n        }\n        allVariables.push(variable);\n      }\n      const escapedKey = mount.path.match(/\\/([^/]*)$/)[1];\n      if (escapedKey.charAt(0) === '$') {\n        if (mount.placeholder) {\n          throw new Error(\n            `Class ${Class.name} mounted at wildcard ${escapedKey} cannot be a placeholder`);\n        }\n      } else if (!_.has(mount, 'placeholder')) {\n        mount.placeholder = {};\n      }\n      const targetMount = this._getMount(mount.path.replace(/\\$[^/]*/g, '$'), true);\n      if (targetMount.matcher && (\n        targetMount.escapedKey === escapedKey ||\n        targetMount.escapedKey.charAt(0) === '$' && escapedKey.charAt(0) === '$'\n      )) {\n        throw new Error(\n          `Multiple classes mounted at ${mount.path}: ${targetMount.Class.name}, ${Class.name}`);\n      }\n      _.assign(\n        targetMount, {Class, matcher, computedProperties, escapedKey},\n        _.pick(mount, 'placeholder', 'local', 'keysUnsafe', 'hidden'));\n    });\n    _.forEach(allVariables, variable => {\n      if (!Class.prototype[variable]) {\n        Object.defineProperty(Class.prototype, variable, {get() {\n          return creatingObjectProperties ?\n            creatingObjectProperties[variable] && creatingObjectProperties[variable].value :\n            undefined;\n        }});\n      }\n    });\n  }\n\n  /**\n   * Creates a Truss object and sets all its basic properties: path segment variables, user-defined\n   * properties, and computed properties.  The latter two will be enumerable so that Vue will pick\n   * them up and make the reactive.\n   */\n  createObject(path, properties) {\n    const mount = this._getMount(path) || {Class: Value};\n    try {\n      if (mount.matcher) {\n        const match = mount.matcher.match(path);\n        for (const variable in match) {\n          properties[variable] = {value: match[variable]};\n        }\n      }\n\n      creatingObjectProperties = properties;\n      const object = new mount.Class();\n      creatingObjectProperties = null;\n\n      if (angular.active) this._wrapProperties(object);\n\n      if (mount.keysUnsafe) {\n        properties.$data = {value: Object.create(null), configurable: true, enumerable: true};\n      }\n      if (mount.hidden) properties.$hidden = {value: true};\n      if (mount.computedProperties) {\n        _.forEach(mount.computedProperties, prop => {\n          properties[prop.name] = this._buildComputedPropertyDescriptor(object, prop);\n        });\n      }\n\n      return object;\n    } catch (e) {\n      e.extra = _.assign({mount, properties, className: mount.Class && mount.Class.name}, e.extra);\n      throw e;\n    }\n  }\n\n  _wrapProperties(object) {\n    _.forEach(object, (value, key) => {\n      const valueKey = '$_' + key;\n      Object.defineProperties(object, {\n        [valueKey]: {value, writable: true},\n        [key]: {\n          get: () => object[valueKey],\n          set: arg => {object[valueKey] = arg; angular.digest();},\n          enumerable: true, configurable: true\n        }\n      });\n    });\n  }\n\n  _buildComputedPropertyDescriptor(object, prop) {\n    const propertyStats = stats.for(prop.fullName);\n\n    let value, pendingPromise;\n    let writeAllowed = false;\n\n    object.$$initializers.push(vue => {\n      let unwatchNow = false;\n      const compute = computeValue.bind(object, prop, propertyStats);\n      if (this._debug) compute.toString = () => {return prop.fullName;};\n      let unwatch = () => {unwatchNow = true;};\n      unwatch = vue.$watch(compute, newValue => {\n        if (object.$destroyed) {\n          unwatch();\n          return;\n        }\n        if (pendingPromise) {\n          if (pendingPromise.cancel) pendingPromise.cancel();\n          pendingPromise = undefined;\n        }\n        if (_.isObject(newValue) && _.isFunction(newValue.then)) {\n          const promise = newValue.then(finalValue => {\n            if (promise === pendingPromise) update(finalValue);\n            // No need to angular.digest() here, since if we're running under Angular then we expect\n            // promises to be aliased to its $q service, which triggers digest itself.\n          }, error => {\n            if (promise === pendingPromise && update(new ErrorWrapper(error)) &&\n                !error.trussExpectedException) throw error;\n          });\n          pendingPromise = promise;\n        } else if (update(newValue)) {\n          angular.digest();\n          if (newValue instanceof ErrorWrapper && !newValue.error.trussExpectedException) {\n            throw newValue.error;\n          }\n        }\n      }, {immediate: true});  // use immediate:true since watcher will run computeValue anyway\n      // Hack to change order of computed property watchers.  By flipping their ids to be negative,\n      // we ensure that they will settle before all other watchers, and also that children\n      // properties will settle before their parents since values are often aggregated upwards.\n      const watcher = _.last(vue._watchers);\n      watcher.id = -watcher.id;\n\n      function update(newValue) {\n        if (newValue instanceof FrozenWrapper) {\n          newValue = newValue.value;\n          unwatch();\n          _.pull(object.$$finalizers, unwatch);\n        }\n        if (isTrussEqual(value, newValue)) return;\n        // console.log('updating', object.$key, prop.fullName, 'from', value, 'to', newValue);\n        propertyStats.numUpdates += 1;\n        writeAllowed = true;\n        object[prop.name] = newValue;\n        writeAllowed = false;\n        // Freeze the computed value so it can't be accidentally modified by a third party.  Ideally\n        // we'd freeze it before setting it so that Vue wouldn't instrument the object recursively\n        // (since it can't change anyway), but we actually need the instrumentation in case a client\n        // tries to access an inexistent property off a computed pointer to an unfrozen value (e.g.,\n        // a $truss-ified object).  When instrumented, Vue will add a dependency on the unfrozen\n        // value in case the property is later added.  If uninstrumented, the dependency won't be\n        // added and we won't be notified.  And Vue only instruments extensible objects...\n        freeze(newValue);\n        return true;\n      }\n\n      if (unwatchNow) {\n        unwatch();\n      } else {\n        object.$$finalizers.push(unwatch);\n      }\n    });\n    return {\n      enumerable: true, configurable: true,\n      get() {\n        if (!writeAllowed && value instanceof ErrorWrapper) throw value.error;\n        return value;\n      },\n      set(newValue) {\n        if (writeAllowed) {\n          value = newValue;\n        } else if (prop.set) {\n          prop.set.call(this, newValue);\n        } else {\n          throw new Error(`You cannot set a computed property: ${prop.name}`);\n        }\n      }\n    };\n  }\n\n  destroyObject(object) {\n    if (_.has(object, '$$finalizers')) {\n      // Some finalizers remove themselves from the array, so clone it before iterating.\n      for (const fn of _.clone(object.$$finalizers)) fn();\n    }\n    if (_.isFunction(object.$finalize)) object.$finalize();\n    Object.defineProperty(\n      object, '$destroyed', {value: true, enumerable: false, configurable: false});\n  }\n\n  isPlaceholder(path) {\n    const mount = this._getMount(path);\n    return mount && mount.placeholder;\n  }\n\n  isLocal(path, value) {\n    // eslint-disable-next-line no-shadow\n    const mount = this._getMount(path, false, mount => mount.local);\n    if (mount && mount.local) return true;\n    if (this._hasLocalProperties(mount, value)) {\n      throw new Error('Write on a mix of local and remote tree paths.');\n    }\n    return false;\n  }\n\n  _hasLocalProperties(mount, value) {\n    if (!mount) return false;\n    if (mount.local) return true;\n    if (!mount.localDescendants || !_.isObject(value)) return false;\n    for (const key in value) {\n      const local =\n        this._hasLocalProperties(mount.children[escapeKey(key)] || mount.children.$, value[key]);\n      if (local) return true;\n    }\n    return false;\n  }\n\n  forEachPlaceholderChild(path, iteratee) {\n    const mount = this._getMount(path);\n    _.forEach(mount && mount.children, child => {\n      if (child.placeholder) iteratee(child);\n    });\n  }\n\n  checkVueObject(object, path, checkedObjects) {\n    const top = !checkedObjects;\n    if (top) checkedObjects = [];\n    try {\n      for (const key of Object.getOwnPropertyNames(object)) {\n        if (RESERVED_VALUE_PROPERTY_NAMES[key] || Value.prototype.hasOwnProperty(key) ||\n            /^\\$_/.test(key)) continue;\n        // eslint-disable-next-line no-shadow\n        const mount = this._findMount(mount => mount.Class === object.constructor);\n        if (mount && mount.matcher && _.includes(mount.matcher.variables, key)) continue;\n        let value;\n        try {\n          value = object[key];\n        } catch (e) {\n          // Ignore any values that hold exceptions, or otherwise throw on access -- we won't be\n          // able to check them anyway.\n          continue;\n        }\n        if (!(_.isArray(object) && (/\\d+/.test(key) || key === 'length'))) {\n          const descriptor = Object.getOwnPropertyDescriptor(object, key);\n          if ('value' in descriptor || !descriptor.get) {\n            throw new Error(\n              `Value at ${path}, contained in a Firetruss object, has a rogue property: ${key}`);\n          }\n          if (object.$truss && descriptor.enumerable) {\n            try {\n              object[key] = value;\n              throw new Error(\n                `Firetruss object at ${path} has an enumerable non-Firebase property: ${key}`);\n            } catch (e) {\n              if (e.trussCode !== 'firebase_overwrite') throw e;\n            }\n          }\n        }\n        if (_.isObject(value) && !value.$$$trussCheck && Object.isExtensible(value) &&\n            !(_.isFunction(value) || value instanceof Promise)) {\n          value.$$$trussCheck = true;\n          checkedObjects.push(value);\n          this.checkVueObject(value, joinPath(path, escapeKey(key)), checkedObjects);\n        }\n      }\n    } finally {\n      if (top) {\n        for (const item of checkedObjects) delete item.$$$trussCheck;\n      }\n    }\n  }\n}\n\n\nfunction computeValue(prop, propertyStats) {\n  /* eslint-disable no-invalid-this */\n  if (this.$destroyed) return;\n  // Touch this object, since a failed access to a missing property doesn't get captured as a\n  // dependency.\n  this.$$touchThis();\n\n  const oldPropertyFrozen = currentPropertyFrozen;\n  currentPropertyFrozen = false;\n  const startTime = performanceNow();\n  let value;\n  try {\n    try {\n      value = prop.get.call(this);\n    } catch (e) {\n      value = new ErrorWrapper(e);\n    } finally {\n      propertyStats.runtime += performanceNow() - startTime;\n      propertyStats.numRecomputes += 1;\n    }\n    if (currentPropertyFrozen) value = new FrozenWrapper(value);\n    return value;\n  } finally {\n    currentPropertyFrozen = oldPropertyFrozen;\n  }\n  /* eslint-enable no-invalid-this */\n}\n\nfunction wrapConnections(object, connections) {\n  if (!connections || connections instanceof Handle) return connections;\n  return _.mapValues(connections, descriptor => {\n    if (descriptor instanceof Handle) return descriptor;\n    if (_.isFunction(descriptor)) {\n      const fn = function() {\n        /* eslint-disable no-invalid-this */\n        object.$$touchThis();\n        return wrapConnections(object, descriptor.call(this));\n        /* eslint-enable no-invalid-this */\n      };\n      fn.angularWatchSuppressed = true;\n      return fn;\n    }\n    return wrapConnections(object, descriptor);\n  });\n}\n\nfunction freeze(object) {\n  if (object === null || object === undefined || !_.isObject(object) || Object.isFrozen(object) ||\n      object.$truss) return object;\n  object = Object.freeze(object);\n  if (_.isArray(object)) return _.map(object, value => freeze(value));\n  return _.mapValues(object, value => freeze(value));\n}\n","import angular from './angularCompatibility.js';\nimport Coupler from './Coupler.js';\nimport Modeler from './Modeler.js';\nimport Reference from './Reference.js';\nimport {escapeKey, escapeKeys, unescapeKey, joinPath, splitPath} from './utils/paths.js';\nimport {wrapPromiseCallback, promiseFinally} from './utils/promises.js';\nimport {SERVER_TIMESTAMP} from './utils/utils.js';\n\nimport _ from 'lodash';\nimport Vue from 'vue';\n\n\nclass Transaction {\n  constructor(ref) {\n    this._ref = ref;\n    this._outcome = undefined;\n    this._values = undefined;\n  }\n\n  get currentValue() {return this._ref.value;}\n  get outcome() {return this._outcome;}\n  get values() {return this._values;}\n\n  _setOutcome(value) {\n    if (this._outcome) throw new Error('Transaction already resolved with ' + this._outcome);\n    this._outcome = value;\n  }\n\n  abort() {\n    this._setOutcome('abort');\n  }\n\n  cancel() {\n    this._setOutcome('cancel');\n  }\n\n  set(value) {\n    if (value === undefined) throw new Error('Invalid argument: undefined');\n    this._setOutcome('set');\n    this._values = {'': value};\n  }\n\n  update(values) {\n    if (values === undefined) throw new Error('Invalid argument: undefined');\n    if (_.isEmpty(values)) return this.cancel();\n    this._setOutcome('update');\n    this._values = values;\n  }\n}\n\n\nexport default class Tree {\n  constructor(truss, rootUrl, bridge, dispatcher) {\n    this._truss = truss;\n    this._rootUrl = rootUrl;\n    this._bridge = bridge;\n    this._dispatcher = dispatcher;\n    this._firebasePropertyEditAllowed = false;\n    this._writeSerial = 0;\n    this._localWrites = {};\n    this._localWriteTimestamp = null;\n    this._initialized = false;\n    this._modeler = new Modeler(truss.constructor.VERSION === 'dev');\n    this._coupler = new Coupler(\n      rootUrl, bridge, dispatcher, this._integrateSnapshot.bind(this), this._prune.bind(this));\n    this._vue = new Vue({data: {$root: undefined}});\n    Object.seal(this);\n    // Call this.init(classes) to complete initialization; we need two phases so that truss can bind\n    // the tree into its own accessors prior to defining computed functions, which may try to\n    // access the tree root via truss.\n  }\n\n  get root() {\n    if (!this._vue.$data.$root) {\n      this._vue.$data.$root = this._createObject('/');\n      this._fixObject(this._vue.$data.$root);\n      this._completeCreateObject(this._vue.$data.$root);\n      angular.digest();\n    }\n    return this._vue.$data.$root;\n  }\n\n  get truss() {\n    return this._truss;\n  }\n\n  init(classes) {\n    if (this._initialized) {\n      throw new Error('Data objects already created, too late to mount classes');\n    }\n    this._initialized = true;\n    this._modeler.init(classes, !this._vue.$data.$root);\n    const createdObjects = [];\n    this._plantPlaceholders(this.root, '/', undefined, createdObjects);\n    for (const object of createdObjects) this._completeCreateObject(object);\n  }\n\n  destroy() {\n    this._coupler.destroy();\n    if (this._modeler) this._modeler.destroy();\n    this._vue.$destroy();\n  }\n\n  connectReference(ref, method) {\n    this._checkHandle(ref);\n    const operation = this._dispatcher.createOperation('read', method, ref);\n    let unwatch;\n    operation._disconnect = this._disconnectReference.bind(this, ref, operation, unwatch);\n    this._dispatcher.begin(operation).then(() => {\n      if (operation.running && !operation._disconnected) {\n        this._coupler.couple(ref.path, operation);\n        operation._coupled = true;\n      }\n    }).catch(_.noop);  // ignore exception, let onFailure handlers deal with it\n    return operation._disconnect;\n  }\n\n  _disconnectReference(ref, operation, unwatch, error) {\n    if (operation._disconnected) return;\n    operation._disconnected = true;\n    if (unwatch) unwatch();\n    if (operation._coupled) {\n      this._coupler.decouple(ref.path, operation);  // will call back to _prune if necessary\n      operation._coupled = false;\n    }\n    this._dispatcher.end(operation, error).catch(_.noop);\n  }\n\n  isReferenceReady(ref) {\n    this._checkHandle(ref);\n    return this._coupler.isSubtreeReady(ref.path);\n  }\n\n  connectQuery(query, keysCallback, method) {\n    this._checkHandle(query);\n    const operation = this._dispatcher.createOperation('read', method, query);\n    operation._disconnect = this._disconnectQuery.bind(this, query, operation);\n    this._dispatcher.begin(operation).then(() => {\n      if (operation.running && !operation._disconnected) {\n        this._coupler.subscribe(query, operation, keysCallback);\n        operation._coupled = true;\n      }\n    }).catch(_.noop);  // ignore exception, let onFailure handlers deal with it\n    return operation._disconnect;\n  }\n\n  _disconnectQuery(query, operation, error) {\n    if (operation._disconnected) return;\n    operation._disconnected = true;\n    if (operation._coupled) {\n      this._coupler.unsubscribe(query, operation);  // will call back to _prune if necessary\n      operation._coupled = false;\n    }\n    this._dispatcher.end(operation, error).catch(_.noop);\n  }\n\n  isQueryReady(query) {\n    return this._coupler.isQueryReady(query);\n  }\n\n  _checkHandle(handle) {\n    if (!handle.belongsTo(this._truss)) {\n      throw new Error('Reference belongs to another Truss instance');\n    }\n  }\n\n  throttleRemoteDataUpdates(delay) {\n    this._coupler.throttleSnapshots(delay);\n  }\n\n  update(ref, method, values) {\n    values = _.mapValues(values, value => escapeKeys(value));\n    const numValues = _.size(values);\n    if (!numValues) return Promise.resolve();\n    if (method === 'update' || method === 'override') {\n      checkUpdateHasOnlyDescendantsWithNoOverlap(ref.path, values);\n    }\n    if (this._applyLocalWrite(values, method === 'override')) return Promise.resolve();\n    const pathPrefix = extractCommonPathPrefix(values);\n    relativizePaths(pathPrefix, values);\n    if (pathPrefix !== ref.path) ref = new Reference(ref._tree, pathPrefix, ref._annotations);\n    const url = this._rootUrl + pathPrefix;\n    const writeSerial = this._writeSerial;\n    const set = numValues === 1;\n    const operand = set ? values[''] : values;\n    return this._dispatcher.execute('write', set ? 'set' : 'update', ref, operand, () => {\n      const promise = this._bridge[set ? 'set' : 'update'](url, operand, writeSerial);\n      return promise.catch(e => {\n        if (!e.immediateFailure) return Promise.reject(e);\n        return promiseFinally(this._repair(ref, values), () => Promise.reject(e));\n      });\n    });\n  }\n\n  commit(ref, updateFunction) {\n    let tries = 0;\n    updateFunction = wrapPromiseCallback(updateFunction);\n\n    const attemptTransaction = () => {\n      if (tries++ >= 25) {\n        return Promise.reject(new Error('Transaction needed too many retries, giving up'));\n      }\n      const txn = new Transaction(ref);\n      let oldValue;\n      // Ensure that Vue's watcher queue gets emptied and computed properties are up to date before\n      // running the updateFunction.\n      return Vue.nextTick().then(() => {\n        oldValue = toFirebaseJson(txn.currentValue);\n        return updateFunction(txn);\n      }).then(() => {\n        if (!_.isEqual(oldValue, toFirebaseJson(txn.currentValue))) return attemptTransaction();\n        if (txn.outcome === 'abort') return txn;  // early return to save time\n        const values = _.mapValues(txn.values, value => escapeKeys(value));\n        switch (txn.outcome) {\n          case 'cancel':\n            break;\n          case 'set':\n            if (this._applyLocalWrite({[ref.path]: values['']})) return Promise.resolve();\n            break;\n          case 'update':\n            checkUpdateHasOnlyDescendantsWithNoOverlap(ref.path, values);\n            if (this._applyLocalWrite(values)) return Promise.resolve();\n            relativizePaths(ref.path, values);\n            break;\n          default:\n            throw new Error('Invalid transaction outcome: ' + (txn.outcome || 'none'));\n        }\n        return this._bridge.transaction(\n          this._rootUrl + ref.path, oldValue, values, this._writeSerial\n        ).then(result => {\n          _.forEach(result.snapshots, snapshot => this._integrateSnapshot(snapshot));\n          return result.committed ? txn : attemptTransaction();\n        }, e => {\n          if (e.immediateFailure && (txn.outcome === 'set' || txn.outcome === 'update')) {\n            return promiseFinally(this._repair(ref, values), () => Promise.reject(e));\n          }\n          return Promise.reject(e);\n        });\n      });\n    };\n\n    return this._truss.peek(ref, () => {\n      return this._dispatcher.execute('write', 'commit', ref, undefined, attemptTransaction);\n    });\n  }\n\n  _repair(ref, values) {\n    // If a write fails early -- that is, before it gets applied to the Firebase client's local\n    // tree -- then we need to repair our own local tree manually since Firebase won't send events\n    // to unwind the change.  This should be very rare since it's always due to a developer mistake\n    // so we don't need to be particularly efficient.\n    const basePath = ref.path;\n    const paths = _(values).keys().map(key => {\n      let path = basePath;\n      if (key) path = joinPath(path, key);\n      return _.keys(this._coupler.findCoupledDescendantPaths(path));\n    }).flatten().value();\n    return Promise.all(_.map(paths, path => {\n      return this._bridge.once(this._rootUrl + path).then(snap => {\n        this._integrateSnapshot(snap);\n      });\n    }));\n  }\n\n  _applyLocalWrite(values, override) {\n    // TODO: correctly apply local writes that impact queries.  Currently, a local write will update\n    // any objects currently selected by a query, but won't add or remove results.\n    this._writeSerial++;\n    this._localWriteTimestamp = this._truss.now;\n    const createdObjects = [];\n    let numLocal = 0;\n    _.forEach(values, (value, path) => {\n      const local = this._modeler.isLocal(path, value);\n      if (local) numLocal++;\n      const coupledDescendantPaths =\n        local ? {[path]: true} : this._coupler.findCoupledDescendantPaths(path);\n      if (_.isEmpty(coupledDescendantPaths)) return;\n      const offset = (path === '/' ? 0 : path.length) + 1;\n      for (const descendantPath in coupledDescendantPaths) {\n        const subPath = descendantPath.slice(offset);\n        let subValue = value;\n        if (subPath && value !== null && value !== undefined) {\n          for (const segment of splitPath(subPath)) {\n            subValue = subValue.$data[segment];\n            if (subValue === undefined) break;\n          }\n        }\n        if (subValue === undefined || subValue === null) {\n          this._prune(descendantPath);\n        } else {\n          const key = _.last(splitPath(descendantPath));\n          this._plantValue(\n            descendantPath, key, subValue,\n            this._scaffoldAncestors(descendantPath, false, createdObjects), false, override, local,\n            createdObjects\n          );\n        }\n        if (!override && !local) this._localWrites[descendantPath] = this._writeSerial;\n      }\n    });\n    for (const object of createdObjects) this._completeCreateObject(object);\n    if (numLocal && numLocal < _.size(values)) {\n      throw new Error('Write on a mix of local and remote tree paths.');\n    }\n    return override || !!numLocal;\n  }\n\n  /**\n   * Creates a Truss object and sets all its basic properties: path segment variables, user-defined\n   * properties, and computed properties.  The latter two will be enumerable so that Vue will pick\n   * them up and make the reactive, so you should call _completeCreateObject once it's done so and\n   * before any Firebase properties are added.\n   */\n  _createObject(path, parent) {\n    if (!this._initialized && path !== '/') this.init();\n    const properties = {\n      // We want Vue to wrap this; we'll make it non-enumerable in _fixObject.\n      $parent: {value: parent, configurable: true, enumerable: true},\n      $path: {value: path}\n    };\n    if (path === '/') properties.$truss = {value: this._truss};\n\n    const object = this._modeler.createObject(path, properties);\n    Object.defineProperties(object, properties);\n    return object;\n  }\n\n  // To be called on the result of _createObject after it's been inserted into the _vue hierarchy\n  // and Vue has had a chance to initialize it.\n  _fixObject(object) {\n    for (const name of Object.getOwnPropertyNames(object)) {\n      const descriptor = Object.getOwnPropertyDescriptor(object, name);\n      if (descriptor.configurable && descriptor.enumerable) {\n        descriptor.enumerable = false;\n        if (_.startsWith(name, '$')) descriptor.configurable = false;\n        Object.defineProperty(object, name, descriptor);\n      }\n    }\n  }\n\n  // To be called on the result of _createObject after _fixObject, and after any additional Firebase\n  // properties have been set, to run initialiers.\n  _completeCreateObject(object) {\n    if (object.hasOwnProperty('$$initializers')) {\n      for (const fn of object.$$initializers) fn(this._vue);\n      delete object.$$initializers;\n    }\n  }\n\n  _destroyObject(object) {\n    if (!(object && object.$truss) || object.$destroyed) return;\n    this._modeler.destroyObject(object);\n    // Normally we'd only destroy enumerable children, which are the Firebase properties.  However,\n    // clients have the option of creating hidden placeholders, so we need to scan non-enumerable\n    // properties as well.  To distinguish such placeholders from the myriad other non-enumerable\n    // properties (that lead all over tree, e.g. $parent), we check that the property's parent is\n    // ourselves before destroying.\n    for (const key of Object.getOwnPropertyNames(object.$data)) {\n      const child = object.$data[key];\n      if (child && child.$parent === object) this._destroyObject(child);\n    }\n  }\n\n  _integrateSnapshot(snap) {\n    _.forEach(this._localWrites, (writeSerial, path) => {\n      if (snap.writeSerial >= writeSerial) delete this._localWrites[path];\n    });\n    if (snap.exists) {\n      const createdObjects = [];\n      const parent = this._scaffoldAncestors(snap.path, true, createdObjects);\n      if (parent) {\n        this._plantValue(\n          snap.path, snap.key, snap.value, parent, true, false, false, createdObjects);\n      }\n      for (const object of createdObjects) this._completeCreateObject(object);\n    } else {\n      this._prune(snap.path, null, true);\n    }\n  }\n\n  _scaffoldAncestors(path, remoteWrite, createdObjects) {\n    let object;\n    const segments = _.dropRight(splitPath(path, true));\n    let ancestorPath = '/';\n    for (let i = 0; i < segments.length; i++) {\n      const segment = segments[i];\n      const key = unescapeKey(segment);\n      let child = segment ? object.$data[key] : this.root;\n      if (segment) ancestorPath += (ancestorPath === '/' ? '' : '/') + segment;\n      if (child) {\n        if (remoteWrite && this._localWrites[ancestorPath]) return;\n      } else {\n        child = this._plantValue(\n          ancestorPath, key, {}, object, remoteWrite, false, false, createdObjects);\n        if (!child) return;\n      }\n      object = child;\n    }\n    return object;\n  }\n\n  _plantValue(path, key, value, parent, remoteWrite, override, local, createdObjects) {\n    if (remoteWrite && (value === null || value === undefined)) {\n      throw new Error(`Snapshot includes invalid value at ${path}: ${value}`);\n    }\n    if (remoteWrite && this._localWrites[path || '/']) return;\n    if (_.isEqual(value, SERVER_TIMESTAMP)) value = this._localWriteTimestamp;\n    let object = parent.$data[key];\n    if (!_.isArray(value) && !(local ? _.isPlainObject(value) : _.isObject(value))) {\n      this._destroyObject(object);\n      this._setFirebaseProperty(parent, key, value);\n      return;\n    }\n    let objectCreated = false;\n    if (!_.isObject(object)) {\n      // Need to pre-set the property, so that if the child object attempts to watch any of its own\n      // properties while being created the $$touchThis method has something to add a dependency on\n      // as the object's own properties won't be made reactive until *after* it's been created.\n      this._setFirebaseProperty(parent, key, null);\n      object = this._createObject(path, parent);\n      this._setFirebaseProperty(parent, key, object, object.$hidden);\n      this._fixObject(object);\n      createdObjects.push(object);\n      objectCreated = true;\n    }\n    if (override) {\n      Object.defineProperty(object, '$overridden', {get: _.constant(true), configurable: true});\n    } else if (object.$overridden) {\n      delete object.$overridden;\n    }\n    // Plant hidden placeholders first, so their computed watchers will have a similar precedence to\n    // the parent object, and the parent object's other children will get computed first.  This can\n    // optimize updates when parts of a complex model are broken out into hidden sub-models, and\n    // shouldn't risk being overwritten by actual Firebase data since that will rarely (never?) be\n    // hidden.\n    if (objectCreated) this._plantPlaceholders(object, path, true, createdObjects);\n    _.forEach(value, (item, escapedChildKey) => {\n      this._plantValue(\n        joinPath(path, escapedChildKey), unescapeKey(escapedChildKey), item, object, remoteWrite,\n        override, local, createdObjects\n      );\n    });\n    if (objectCreated) {\n      this._plantPlaceholders(object, path, false, createdObjects);\n    } else {\n      _.forEach(object.$data, (item, childKey) => {\n        const escapedChildKey = escapeKey(childKey);\n        if (!value.hasOwnProperty(escapedChildKey)) {\n          this._prune(joinPath(path, escapedChildKey), null, remoteWrite);\n        }\n      });\n    }\n    return object;\n  }\n\n  _plantPlaceholders(object, path, hidden, createdObjects) {\n    this._modeler.forEachPlaceholderChild(path, mount => {\n      if (hidden !== undefined && hidden !== !!mount.hidden) return;\n      const key = unescapeKey(mount.escapedKey);\n      if (!object.$data.hasOwnProperty(key)) {\n        this._plantValue(\n          joinPath(path, mount.escapedKey), key, mount.placeholder, object, false, false, false,\n          createdObjects);\n      }\n    });\n  }\n\n  _prune(path, lockedDescendantPaths, remoteWrite) {\n    lockedDescendantPaths = lockedDescendantPaths || {};\n    const object = this.getObject(path);\n    if (object === undefined) return;\n    if (remoteWrite && this._avoidLocalWritePaths(path, lockedDescendantPaths)) return;\n    if (!(_.isEmpty(lockedDescendantPaths) && this._pruneAncestors(path, object)) &&\n        _.isObject(object)) {\n      // The target object is a placeholder, and all ancestors are placeholders or otherwise needed\n      // as well, so we can't delete it.  Instead, dive into its descendants to delete what we can.\n      this._pruneDescendants(object, lockedDescendantPaths);\n    }\n  }\n\n  _avoidLocalWritePaths(path, lockedDescendantPaths) {\n    for (const localWritePath in this._localWrites) {\n      if (!this._localWrites.hasOwnProperty(localWritePath)) continue;\n      if (path === localWritePath || localWritePath === '/' ||\n          _.startsWith(path, localWritePath + '/')) return true;\n      if (path === '/' || _.startsWith(localWritePath, path + '/')) {\n        const segments = splitPath(localWritePath, true);\n        for (let i = segments.length; i > 0; i--) {\n          const subPath = segments.slice(0, i).join('/');\n          const active = i === segments.length;\n          if (lockedDescendantPaths[subPath] || lockedDescendantPaths[subPath] === active) break;\n          lockedDescendantPaths[subPath] = active;\n          if (subPath === path) break;\n        }\n      }\n    }\n  }\n\n  _pruneAncestors(targetPath, targetObject) {\n    // Destroy the child (unless it's a placeholder that's still needed) and any ancestors that\n    // are no longer needed to keep this child rooted, and have no other reason to exist.\n    let deleted = false;\n    let object = targetObject;\n    // The target object may be a primitive, in which case it won't have $path, $parent and $key\n    // properties.  In that case, use the target path to figure those out instead.  Note that all\n    // ancestors of the target object will necessarily not be primitives and will have those\n    // properties.\n    let targetKey;\n    const targetParentPath = targetPath.replace(/\\/[^/]+$/, match => {\n      targetKey = unescapeKey(match.slice(1));\n      return '';\n    });\n    while (object !== undefined && object !== this.root) {\n      const parent =\n        object && object.$parent || object === targetObject && this.getObject(targetParentPath);\n      if (!this._modeler.isPlaceholder(object && object.$path || targetPath)) {\n        const ghostObjects = deleted ? null : [targetObject];\n        if (!this._holdsConcreteData(object, ghostObjects)) {\n          deleted = true;\n          this._deleteFirebaseProperty(\n            parent, object && object.$key || object === targetObject && targetKey);\n        }\n      }\n      object = parent;\n    }\n    return deleted;\n  }\n\n  _holdsConcreteData(object, ghostObjects) {\n    if (object === undefined || object === null) return false;\n    if (ghostObjects && _.includes(ghostObjects, object)) return false;\n    if (!_.isObject(object) || !object.$truss) return true;\n    return _.some(object.$data, value => this._holdsConcreteData(value, ghostObjects));\n  }\n\n  _pruneDescendants(object, lockedDescendantPaths) {\n    if (lockedDescendantPaths[object.$path]) return true;\n    if (object.$overridden) delete object.$overridden;\n    let coupledDescendantFound = false;\n    _.forEach(object.$data, (value, key) => {\n      let shouldDelete = true;\n      let valueLocked;\n      if (lockedDescendantPaths[joinPath(object.$path, escapeKey(key))]) {\n        shouldDelete = false;\n        valueLocked = true;\n      } else if (value.$truss) {\n        const placeholder = this._modeler.isPlaceholder(value.$path);\n        if (placeholder || _.has(lockedDescendantPaths, value.$path)) {\n          valueLocked = this._pruneDescendants(value, lockedDescendantPaths);\n          shouldDelete = !placeholder && !valueLocked;\n        }\n      }\n      if (shouldDelete) this._deleteFirebaseProperty(object, key);\n      coupledDescendantFound = coupledDescendantFound || valueLocked;\n    });\n    return coupledDescendantFound;\n  }\n\n  getObject(path) {\n    const segments = splitPath(path);\n    let object;\n    for (const segment of segments) {\n      object = segment ? object.$data[segment] : this.root;\n      if (object === undefined) return;\n    }\n    return object;\n  }\n\n  _getFirebasePropertyDescriptor(object, data, key) {\n    const descriptor = Object.getOwnPropertyDescriptor(data, key);\n    if (descriptor) {\n      if (!descriptor.enumerable) {\n        const child = data[key];\n        if (!child || child.$parent !== object) {\n          throw new Error(\n            `Key conflict between Firebase and instance or computed properties at ` +\n            `${object.$path}: ${key}`);\n        }\n      }\n      if (!descriptor.get || !descriptor.set) {\n        throw new Error(`Unbound property at ${object.$path}: ${key}`);\n      }\n    } else if (key in data) {\n      throw new Error(\n        `Key conflict between Firebase and inherited property at ${object.$path}: ${key}`);\n    }\n    return descriptor;\n  }\n\n  _setFirebaseProperty(object, key, value, hidden) {\n    const data = object.hasOwnProperty('$data') ? object.$data : object;\n    let descriptor = this._getFirebasePropertyDescriptor(object, data, key);\n    if (descriptor) {\n      if (hidden) {\n        // Redefine property as hidden after it's been created, since we usually don't know whether\n        // it should be hidden until too late.  This is a one-way deal -- you can't unhide a\n        // property later, but that's fine for our purposes.\n        Object.defineProperty(data, key, {\n          get: descriptor.get, set: descriptor.set, configurable: true, enumerable: false\n        });\n      }\n      if (data[key] === value) return;\n      this._firebasePropertyEditAllowed = true;\n      data[key] = value;\n      this._firebasePropertyEditAllowed = false;\n    } else {\n      Vue.set(data, key, value);\n      descriptor = Object.getOwnPropertyDescriptor(data, key);\n      Object.defineProperty(data, key, {\n        get: descriptor.get, set: this._overwriteFirebaseProperty.bind(this, descriptor, key),\n        configurable: true, enumerable: !hidden\n      });\n    }\n    angular.digest();\n  }\n\n  _overwriteFirebaseProperty(descriptor, key, newValue) {\n    if (!this._firebasePropertyEditAllowed) {\n      const e = new Error(`Firebase data cannot be mutated directly: ${key}`);\n      e.trussCode = 'firebase_overwrite';\n      throw e;\n    }\n    descriptor.set.call(this, newValue);\n  }\n\n  _deleteFirebaseProperty(object, key) {\n    const data = object.hasOwnProperty('$data') ? object.$data : object;\n    // Make sure it's actually a Firebase property.\n    this._getFirebasePropertyDescriptor(object, data, key);\n    this._destroyObject(data[key]);\n    Vue.delete(data, key);\n    angular.digest();\n  }\n\n  checkVueObject(object, path) {\n    this._modeler.checkVueObject(object, path);\n  }\n}\n\n\nexport function checkUpdateHasOnlyDescendantsWithNoOverlap(rootPath, values) {\n  // First, check all paths for correctness and absolutize them, since there could be a mix of\n  // absolute paths and relative keys.\n  _.forEach(_.keys(values), path => {\n    if (path.charAt(0) === '/') {\n      if (!(path === rootPath || rootPath === '/' ||\n            _.startsWith(path, rootPath + '/') && path.length > rootPath.length + 1)) {\n        throw new Error(`Update item is not a descendant of target ref: ${path}`);\n      }\n    } else {\n      if (_.includes(path, '/')) {\n        throw new Error(`Update item deep path must be absolute, taken from a reference: ${path}`);\n      }\n      const absolutePath = joinPath(rootPath, escapeKey(path));\n      if (values.hasOwnProperty(absolutePath)) {\n        throw new Error(`Update items overlap: ${path} and ${absolutePath}`);\n      }\n      values[absolutePath] = values[path];\n      delete values[path];\n    }\n  });\n  // Then check for overlaps;\n  const allPaths = _(values).keys().map(path => joinPath(path, '')).sortBy('length').value();\n  _.forEach(values, (value, path) => {\n    for (const otherPath of allPaths) {\n      if (otherPath.length > path.length) break;\n      if (path !== otherPath && _.startsWith(path, otherPath)) {\n        throw new Error(`Update items overlap: ${otherPath} and ${path}`);\n      }\n    }\n  });\n}\n\nexport function extractCommonPathPrefix(values) {\n  let prefixSegments;\n  _.forEach(values, (value, path) => {\n    const segments = path === '/' ? [''] : splitPath(path, true);\n    if (prefixSegments) {\n      let firstMismatchIndex = 0;\n      const maxIndex = Math.min(prefixSegments.length, segments.length);\n      while (firstMismatchIndex < maxIndex &&\n             prefixSegments[firstMismatchIndex] === segments[firstMismatchIndex]) {\n        firstMismatchIndex++;\n      }\n      prefixSegments = prefixSegments.slice(0, firstMismatchIndex);\n      if (!prefixSegments.length) return false;\n    } else {\n      prefixSegments = segments;\n    }\n  });\n  return prefixSegments.length === 1 ? '/' : prefixSegments.join('/');\n}\n\nexport function relativizePaths(rootPath, values) {\n  const offset = rootPath === '/' ? 1 : rootPath.length + 1;\n  _.forEach(_.keys(values), path => {\n    values[path.slice(offset)] = values[path];\n    delete values[path];\n  });\n}\n\nexport function toFirebaseJson(object) {\n  if (!_.isObject(object)) return object;\n  const result = {};\n  const data = object.$data;\n  for (const key in data) {\n    if (data.hasOwnProperty(key)) result[escapeKey(key)] = toFirebaseJson(data[key]);\n  }\n  return result;\n}\n\n","import _ from 'lodash';\n\n\nclass LruCacheItem {\n  constructor(key, value) {\n    this.key = key;\n    this.value = value;\n    this.touch();\n  }\n\n  touch() {\n    this.timestamp = Date.now();\n  }\n}\n\n\nexport default class LruCache {\n  constructor(maxSize, pruningSize) {\n    this._items = Object.create(null);\n    this._size = 0;\n    this._maxSize = maxSize;\n    this._pruningSize = pruningSize || Math.ceil(maxSize * 0.10);\n  }\n\n  has(key) {\n    return Boolean(this._items[key]);\n  }\n\n  get(key) {\n    const item = this._items[key];\n    if (!item) return;\n    item.touch();\n    return item.value;\n  }\n\n  set(key, value) {\n    const item = this._items[key];\n    if (item) {\n      item.value = value;\n    } else {\n      if (this._size >= this._maxSize) this._prune();\n      this._items[key] = new LruCacheItem(key, value);\n      this._size += 1;\n    }\n  }\n\n  delete(key) {\n    const item = this._items[key];\n    if (!item) return;\n    delete this._items[key];\n    this._size -= 1;\n  }\n\n  _prune() {\n    const itemsToPrune =\n      _(this._items).toArray().sortBy('timestamp').take(this._pruningSize).value();\n    for (const item of itemsToPrune) this.delete(item.key);\n  }\n}\n","import {escapeKey, unescapeKey, makePathMatcher} from './utils/paths.js';\n\nimport _ from 'lodash';\n\n/* eslint-disable no-use-before-define */\n\nconst EMPTY_ANNOTATIONS = {};\nObject.freeze(EMPTY_ANNOTATIONS);\n\n\nexport class Handle {\n  constructor(tree, path, annotations) {\n    this._tree = tree;\n    this._path = path.replace(/^\\/*/, '/').replace(/\\/$/, '') || '/';\n    if (annotations) {\n      this._annotations = annotations;\n      Object.freeze(annotations);\n    }\n  }\n\n  get $ref() {return this;}\n  get key() {\n    if (!this._key) this._key = unescapeKey(this._path.replace(/.*\\//, ''));\n    return this._key;\n  }\n  get path() {return this._path;}\n  get _pathPrefix() {return this._path === '/' ? '' : this._path;}\n  get parent() {\n    return new Reference(this._tree, this._path.replace(/\\/[^/]*$/, ''), this._annotations);\n  }\n\n  get annotations() {\n    return this._annotations || EMPTY_ANNOTATIONS;\n  }\n\n  child() {\n    if (!arguments.length) return this;\n    const segments = [];\n    for (const key of arguments) {\n      if (key === undefined || key === null) return;\n      segments.push(escapeKey(key));\n    }\n    return new Reference(\n      this._tree, `${this._pathPrefix}/${segments.join('/')}`,\n      this._annotations\n    );\n  }\n\n  children() {\n    if (!arguments.length) return this;\n    const escapedKeys = [];\n    for (let i = 0; i < arguments.length; i++) {\n      const arg = arguments[i];\n      if (_.isArray(arg)) {\n        const mapping = {};\n        const subPath = this._pathPrefix + (escapedKeys.length ? `/${escapedKeys.join('/')}` : '');\n        const rest = _.slice(arguments, i + 1);\n        for (const key of arg) {\n          const subRef =\n            new Reference(this._tree, `${subPath}/${escapeKey(key)}`, this._annotations);\n          const subMapping = subRef.children.apply(subRef, rest);\n          if (subMapping) mapping[key] = subMapping;\n        }\n        return mapping;\n      }\n      if (arg === undefined || arg === null) return;\n      escapedKeys.push(escapeKey(arg));\n    }\n    return new Reference(\n      this._tree, `${this._pathPrefix}/${escapedKeys.join('/')}`, this._annotations);\n  }\n\n  peek(callback) {\n    return this._tree.truss.peek(this, callback);\n  }\n\n  match(pattern) {\n    return makePathMatcher(pattern).match(this.path);\n  }\n\n  test(pattern) {\n    return makePathMatcher(pattern).test(this.path);\n  }\n\n  isEqual(that) {\n    if (!(that instanceof Handle)) return false;\n    return this._tree === that._tree && this.toString() === that.toString() &&\n      _.isEqual(this._annotations, that._annotations);\n  }\n\n  belongsTo(truss) {\n    return this._tree.truss === truss;\n  }\n}\n\n\nexport class Query extends Handle {\n  constructor(tree, path, spec, annotations) {\n    super(tree, path, annotations);\n    this._spec = this._copyAndValidateSpec(spec);\n    const queryTerms = _(this._spec)\n      .map((value, key) => `${key}=${encodeURIComponent(JSON.stringify(value))}`)\n      .sortBy()\n      .join('&');\n    this._string = `${this._path}?${queryTerms}`;\n    Object.freeze(this);\n  }\n\n  // Vue-bound\n  get ready() {\n    return this._tree.isQueryReady(this);\n  }\n\n  get constraints() {\n    return this._spec;\n  }\n\n  annotate(annotations) {\n    return new Query(\n      this._tree, this._path, this._spec, _.assign({}, this._annotations, annotations));\n  }\n\n  _copyAndValidateSpec(spec) {\n    if (!spec.by) throw new Error('Query needs \"by\" clause: ' + JSON.stringify(spec));\n    if (('at' in spec) + ('from' in spec) + ('to' in spec) > 1) {\n      throw new Error(\n        'Query must contain at most one of \"at\", \"from\", or \"to\" clauses: ' + JSON.stringify(spec));\n    }\n    if (('first' in spec) + ('last' in spec) > 1) {\n      throw new Error(\n        'Query must contain at most one of \"first\" or \"last\" clauses: ' + JSON.stringify(spec));\n    }\n    if (!_.some(['at', 'from', 'to', 'first', 'last'], clause => clause in spec)) {\n      throw new Error(\n        'Query must contain at least one of \"at\", \"from\", \"to\", \"first\", or \"last\" clauses: ' +\n        JSON.stringify(spec));\n    }\n    spec = _.clone(spec);\n    if (spec.by !== '$key' && spec.by !== '$value') {\n      if (!(spec.by instanceof Reference)) {\n        throw new Error('Query \"by\" value must be a reference: ' + spec.by);\n      }\n      let childPath = spec.by.toString();\n      if (!_.startsWith(childPath, this._path)) {\n        throw new Error(\n          'Query \"by\" value must be a descendant of target reference: ' + spec.by);\n      }\n      childPath = childPath.slice(this._path.length).replace(/^\\/?/, '');\n      if (!_.includes(childPath, '/')) {\n        throw new Error(\n          'Query \"by\" value must not be a direct child of target reference: ' + spec.by);\n      }\n      spec.by = childPath.replace(/.*?\\//, '');\n    }\n    Object.freeze(spec);\n    return spec;\n  }\n\n\n  toString() {\n    return this._string;\n  }\n}\n\n\nexport class Reference extends Handle {\n\n  constructor(tree, path, annotations) {\n    super(tree, path, annotations);\n    Object.freeze(this);\n  }\n\n  get ready() {return this._tree.isReferenceReady(this);}  // Vue-bound\n  get value() {return this._tree.getObject(this.path);}  // Vue-bound\n  toString() {return this._path;}\n\n  annotate(annotations) {\n    return new Reference(this._tree, this._path, _.assign({}, this._annotations, annotations));\n  }\n\n  query(spec) {\n    return new Query(this._tree, this._path, spec, this._annotations);\n  }\n\n  set(value) {\n    return this._tree.update(this, 'set', {[this.path]: value});\n  }\n\n  update(values) {\n    return this._tree.update(this, 'update', values);\n  }\n\n  override(value) {\n    return this._tree.update(this, 'override', {[this.path]: value});\n  }\n\n  commit(updateFunction) {\n    return this._tree.commit(this, updateFunction);\n  }\n}\n\nexport default Reference;\n","// Generated by CoffeeScript 1.7.1\n(function() {\n  var getNanoSeconds, hrtime, loadTime;\n\n  if ((typeof performance !== \"undefined\" && performance !== null) && performance.now) {\n    module.exports = function() {\n      return performance.now();\n    };\n  } else if ((typeof process !== \"undefined\" && process !== null) && process.hrtime) {\n    module.exports = function() {\n      return (getNanoSeconds() - loadTime) / 1e6;\n    };\n    hrtime = process.hrtime;\n    getNanoSeconds = function() {\n      var hr;\n      hr = hrtime();\n      return hr[0] * 1e9 + hr[1];\n    };\n    loadTime = getNanoSeconds();\n  } else if (Date.now) {\n    module.exports = function() {\n      return Date.now() - loadTime;\n    };\n    loadTime = Date.now();\n  } else {\n    module.exports = function() {\n      return new Date().getTime() - loadTime;\n    };\n    loadTime = new Date().getTime();\n  }\n\n}).call(this);\n","import {isTrussEqual} from './utils.js';\n\nimport _ from 'lodash';\nimport performanceNow from 'performance-now';\n\n\nclass StatItem {\n  constructor(name) {\n    _.assign(this, {name, numRecomputes: 0, numUpdates: 0, runtime: 0});\n  }\n\n  add(item) {\n    this.runtime += item.runtime;\n    this.numUpdates += item.numUpdates;\n    this.numRecomputes += item.numRecomputes;\n  }\n\n  get runtimePerRecompute() {\n    return this.numRecomputes ? this.runtime / this.numRecomputes : 0;\n  }\n\n  toLogParts(totals) {\n    return [\n      `${this.name}:`, ` ${(this.runtime / 1000).toFixed(2)}s`,\n      `(${(this.runtime / totals.runtime * 100).toFixed(1)}%)`,\n      ` ${this.numUpdates} upd /`, `${this.numRecomputes} runs`,\n      `(${(this.numUpdates / this.numRecomputes * 100).toFixed(1)}%)`,\n      ` ${this.runtimePerRecompute.toFixed(2)}ms / run`\n    ];\n  }\n}\n\nclass Stats {\n  constructor() {\n    this._items = {};\n  }\n\n  for(name) {\n    if (!this._items[name]) this._items[name] = new StatItem(name);\n    return this._items[name];\n  }\n\n  get list() {\n    return _(this._items).values().sortBy(item => -item.runtime).value();\n  }\n\n  log(n = 10) {\n    let stats = this.list;\n    if (!stats.length) return;\n    const totals = new StatItem('=== Total');\n    _.forEach(stats, stat => {totals.add(stat);});\n    stats = _.take(stats, n);\n    const above = new StatItem('--- Above');\n    _.forEach(stats, stat => {above.add(stat);});\n    const lines = _.map(stats, item => item.toLogParts(totals));\n    lines.push(above.toLogParts(totals));\n    lines.push(totals.toLogParts(totals));\n    const widths = _.map(_.range(lines[0].length), i => _(lines).map(line => line[i].length).max());\n    _.forEach(lines, line => {\n      console.log(_.map(line, (column, i) => _.padLeft(column, widths[i])).join(' '));\n    });\n  }\n\n  wrap(getter, className, propName) {\n    const item = this.for(`${className}.${propName}`);\n    return function() {\n      /* eslint-disable no-invalid-this */\n      const startTime = performanceNow();\n      const oldValue = this._computedWatchers && this._computedWatchers[propName].value;\n      try {\n        const newValue = getter.call(this);\n        if (!isTrussEqual(oldValue, newValue)) item.numUpdates += 1;\n        return newValue;\n      } finally {\n        item.runtime += performanceNow() - startTime;\n        item.numRecomputes += 1;\n      }\n    };\n  }\n}\n\nexport default new Stats();\n","import _ from 'lodash';\nimport Reference from './Reference.js';\nimport {wrapPromiseCallback} from './utils/promises.js';\nimport {joinPath} from './utils/paths.js';\n\n\nconst INTERCEPT_KEYS = [\n  'read', 'write', 'auth', 'set', 'update', 'commit', 'connect', 'peek', 'authenticate',\n  'unathenticate', 'certify', 'all'\n];\n\nconst EMPTY_ARRAY = [];\n\n\nclass SlowHandle {\n  constructor(operation, delay, callback) {\n    this._operation = operation;\n    this._delay = delay;\n    this._callback = callback;\n    this._fired = false;\n  }\n\n  initiate() {\n    this.cancel();\n    this._fired = false;\n    const elapsed = Date.now() - this._operation._startTimestamp;\n    this._timeoutId = setTimeout(() => {\n      this._fired = true;\n      this._callback(this._operation);\n    }, this._delay - elapsed);\n  }\n\n  cancel() {\n    if (this._fired) this._callback(this._operation);\n    if (this._timeoutId) clearTimeout(this._timeoutId);\n  }\n}\n\n\nclass Operation {\n  constructor(type, method, target, operand) {\n    this._type = type;\n    this._method = method;\n    this._target = target;\n    this._operand = operand;\n    this._ready = false;\n    this._running = false;\n    this._ended = false;\n    this._tries = 0;\n    this._startTimestamp = Date.now();\n    this._slowHandles = [];\n  }\n\n  get type() {return this._type;}\n  get method() {return this._method;}\n  get target() {return this._target;}\n  get targets() {\n    if (this._method !== 'update') return [this._target];\n    return _.map(this._operand, (value, escapedPathFragment) => {\n      return new Reference(\n        this._target._tree, joinPath(this._target.path, escapedPathFragment),\n        this._target._annotations);\n    });\n  }\n  get operand() {return this._operand;}\n  get ready() {return this._ready;}\n  get running() {return this._running;}\n  get ended() {return this._ended;}\n  get tries() {return this._tries;}\n  get error() {return this._error;}\n\n  onSlow(delay, callback) {\n    const handle = new SlowHandle(this, delay, callback);\n    this._slowHandles.push(handle);\n    handle.initiate();\n  }\n\n  _setRunning(value) {\n    this._running = value;\n  }\n\n  _setEnded(value) {\n    this._ended = value;\n  }\n\n  _markReady(ending) {\n    this._ready = true;\n    if (!ending) this._tries = 0;\n    _.forEach(this._slowHandles, handle => handle.cancel());\n  }\n\n  _clearReady() {\n    this._ready = false;\n    this._startTimestamp = Date.now();\n    _.forEach(this._slowHandles, handle => handle.initiate());\n  }\n\n  _incrementTries() {\n    this._tries++;\n  }\n}\n\n\nexport default class Dispatcher {\n  constructor(bridge) {\n    this._bridge = bridge;\n    this._callbacks = {};\n    Object.freeze(this);\n  }\n\n  intercept(interceptKey, callbacks) {\n    if (!_.includes(INTERCEPT_KEYS, interceptKey)) {\n      throw new Error('Unknown intercept operation type: ' + interceptKey);\n    }\n    const badCallbackKeys =\n      _.difference(_.keys(callbacks), ['onBefore', 'onAfter', 'onError', 'onFailure']);\n    if (badCallbackKeys.length) {\n      throw new Error('Unknown intercept callback types: ' + badCallbackKeys.join(', '));\n    }\n    const wrappedCallbacks = {\n      onBefore: this._addCallback('onBefore', interceptKey, callbacks.onBefore),\n      onAfter: this._addCallback('onAfter', interceptKey, callbacks.onAfter),\n      onError: this._addCallback('onError', interceptKey, callbacks.onError),\n      onFailure: this._addCallback('onFailure', interceptKey, callbacks.onFailure)\n    };\n    return this._removeCallbacks.bind(this, interceptKey, wrappedCallbacks);\n  }\n\n  _addCallback(stage, interceptKey, callback) {\n    if (!callback) return;\n    const key = this._getCallbacksKey(stage, interceptKey);\n    const wrappedCallback = wrapPromiseCallback(callback);\n    (this._callbacks[key] || (this._callbacks[key] = [])).push(wrappedCallback);\n    return wrappedCallback;\n  }\n\n  _removeCallback(stage, interceptKey, wrappedCallback) {\n    if (!wrappedCallback) return;\n    const key = this._getCallbacksKey(stage, interceptKey);\n    if (this._callbacks[key]) _.pull(this._callbacks[key], wrappedCallback);\n  }\n\n  _removeCallbacks(interceptKey, wrappedCallbacks) {\n    _.forEach(wrappedCallbacks, (wrappedCallback, stage) => {\n      this._removeCallback(stage, interceptKey, wrappedCallback);\n    });\n  }\n\n  _getCallbacks(stage, operationType, method) {\n    return [].concat(\n      this._callbacks[this._getCallbacksKey(stage, method)] || EMPTY_ARRAY,\n      this._callbacks[this._getCallbacksKey(stage, operationType)] || EMPTY_ARRAY,\n      this._callbacks[this._getCallbacksKey(stage, 'all')] || EMPTY_ARRAY\n    );\n  }\n\n  _getCallbacksKey(stage, interceptKey) {\n    return `${stage}_${interceptKey}`;\n  }\n\n  execute(operationType, method, target, operand, executor) {\n    executor = wrapPromiseCallback(executor);\n    const operation = this.createOperation(operationType, method, target, operand);\n    return this.begin(operation).then(() => {\n      const executeWithRetries = () => {\n        return executor().catch(e => this._retryOrEnd(operation, e).then(executeWithRetries));\n      };\n      return executeWithRetries();\n    }).then(result => this.end(operation).then(() => result));\n  }\n\n  createOperation(operationType, method, target, operand) {\n    return new Operation(operationType, method, target, operand);\n  }\n\n  begin(operation) {\n    return Promise.all(_.map(\n      this._getCallbacks('onBefore', operation.type, operation.method),\n      onBefore => onBefore(operation)\n    )).then(() => {\n      if (!operation.ended) operation._setRunning(true);\n    }, e => this.end(operation, e));\n  }\n\n  markReady(operation) {\n    operation._markReady();\n  }\n\n  clearReady(operation) {\n    operation._clearReady();\n  }\n\n  retry(operation, error) {\n    operation._incrementTries();\n    operation._error = error;\n    return Promise.all(_.map(\n      this._getCallbacks('onError', operation.type, operation.method),\n      onError => onError(operation, error)\n    )).then(results => {\n      // If the operation ended in the meantime, bail.  This will cause the caller to attempt to\n      // fail the operation, but since it's already ended the call to end() with an error will be a\n      // no-op.\n      if (operation.ended) return;\n      const retrying = _.some(results);\n      if (retrying) delete operation._error;\n      return retrying;\n    });\n  }\n\n  _retryOrEnd(operation, error) {\n    return this.retry(operation, error).then(result => {\n      if (!result) return this.end(operation, error);\n    }, e => this.end(operation, e));\n  }\n\n  end(operation, error) {\n    if (operation.ended) return Promise.resolve();\n    operation._setRunning(false);\n    operation._setEnded(true);\n    if (error) {\n      operation._error = error;\n    } else {\n      // In case we're racing with a retry(), wipe out the error.\n      delete operation._error;\n    }\n    return Promise.all(_.map(\n      this._getCallbacks('onAfter', operation.type, operation.method),\n      onAfter => onAfter(operation)\n    )).then(\n      () => this._afterEnd(operation),\n      e => {\n        operation._error = e;\n        return this._afterEnd(operation);\n      }\n    );\n  }\n\n  _afterEnd(operation) {\n    operation._markReady(true);\n    if (!operation.error) return Promise.resolve();\n    const onFailureCallbacks = this._getCallbacks('onFailure', operation.type, operation.method);\n    if (onFailureCallbacks) {\n      setTimeout(() => {\n        _.forEach(onFailureCallbacks, onFailure => onFailure(operation));\n      }, 0);\n    }\n    return Promise.reject(operation.error);\n  }\n}\n\n","const ALPHABET = '-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz';\n\nconst getRandomValues = window.crypto && window.crypto.getRandomValues &&\n  window.crypto.getRandomValues.bind(window.crypto);\n\nexport default class KeyGenerator {\n  constructor() {\n    this._lastUniqueKeyTime = 0;\n    this._lastRandomValues = [];\n  }\n\n  generateUniqueKey(now) {\n    now = now || Date.now();\n    const chars = new Array(20);\n    let prefix = now;\n    for (let i = 7; i >= 0; i--) {\n      chars[i] = ALPHABET.charAt(prefix & 0x3f);  // eslint-disable-line no-bitwise\n      prefix = Math.floor(prefix / 64);\n    }\n    if (now === this._lastUniqueKeyTime) {\n      let i = 11;\n      while (i >= 0 && this._lastRandomValues[i] === 63) {\n        this._lastRandomValues[i] = 0;\n        i -= 1;\n      }\n      if (i === -1) {\n        throw new Error('Internal assertion failure: ran out of unique IDs for this millisecond');\n      }\n      this._lastRandomValues[i] += 1;\n    } else {\n      this._lastUniqueKeyTime = now;\n      if (getRandomValues) {\n        /* global Uint8Array */\n        const array = new Uint8Array(12);\n        getRandomValues(array);\n        for (let i = 0; i < 12; i++) {\n          // eslint-disable-next-line no-bitwise\n          this._lastRandomValues[i] = array[i] & (i ? 0x3f : 0x0f);\n        }\n      } else {\n        for (let i = 0; i < 12; i++) {\n          // Make sure to leave some space for incrementing in the top nibble.\n          this._lastRandomValues[i] = Math.floor(Math.random() * (i ? 64 : 16));\n        }\n      }\n    }\n    for (let i = 0; i < 12; i++) {\n      chars[i + 8] = ALPHABET[this._lastRandomValues[i]];\n    }\n    return chars.join('');\n  }\n}\n","import angular from './angularCompatibility.js';\nimport Vue from 'vue';\nimport Reference from './Reference.js';\n\n\nexport default class MetaTree {\n  constructor(rootUrl, tree, bridge, dispatcher) {\n    this._rootUrl = rootUrl;\n    this._tree = tree;\n    this._dispatcher = dispatcher;\n    this._bridge = bridge;\n    this._vue = new Vue({data: {$root: {\n      connected: undefined, timeOffset: 0, user: undefined, userid: undefined,\n      nowAtInterval(intervalMillis) {\n        const key = 'now' + intervalMillis;\n        if (!this.hasOwnProperty(key)) {\n          const update = () => {\n            Vue.set(this, key, Date.now() + this.timeOffset);\n            angular.digest();\n          };\n          update();\n          setInterval(update, intervalMillis);\n        }\n        return this[key];\n      }\n    }}});\n\n    this._auth = {serial: 0, initialAuthChangeReceived: false};\n\n    bridge.onAuth(rootUrl, this._handleAuthChange, this);\n\n    this._connectInfoProperty('serverTimeOffset', 'timeOffset');\n    this._connectInfoProperty('connected', 'connected');\n    Object.freeze(this);\n  }\n\n  get root() {\n    return this._vue.$data.$root;\n  }\n\n  destroy() {\n    this._bridge.offAuth(this._rootUrl, this._handleAuthChange, this);\n    this._vue.$destroy();\n  }\n\n  authenticate(token) {\n    this._auth.serial++;\n    return this._dispatcher.execute(\n      'auth', 'authenticate', new Reference(this._tree, '/'), token, () => {\n        return this._bridge.authWithCustomToken(this._rootUrl, token);\n      }\n    );\n  }\n\n  unauthenticate() {\n    // Signal user change to null pre-emptively.  This is what the Firebase SDK does as well, since\n    // it lets the app tear down user-required connections before the user is actually deauthed,\n    // which can prevent spurious permission denied errors.\n    this._auth.serial++;\n    return this._handleAuthChange(null).then(approved => {\n      // Bail if auth change callback initiated another authentication, since it will have already\n      // sent the command to the bridge and sending our own now would incorrectly override it.\n      if (!approved) return;\n      return this._dispatcher.execute(\n        'auth', 'unauthenticate', new Reference(this._tree, '/'), undefined, () => {\n          return this._bridge.unauth(this._rootUrl);\n        }\n      );\n    });\n  }\n\n  _handleAuthChange(user) {\n    const supersededChange = !this._auth.initialAuthChangeReceived && this._auth.serial;\n    if (user !== undefined) this._auth.initialAuthChangeReceived = true;\n    if (supersededChange) return;\n    const authSerial = this._auth.serial;\n    if (this.root.user === user) return Promise.resolve(false);\n    return this._dispatcher.execute('auth', 'certify', new Reference(this._tree, '/'), user, () => {\n      if (this.root.user === user || authSerial !== this._auth.serial) return false;\n      if (user) Object.freeze(user);\n      this.root.user = user;\n      this.root.userid = user && user.uid;\n      angular.digest();\n      return true;\n    });\n  }\n\n  _isAuthChangeStale(user) {\n    return this.root.user === user;\n  }\n\n  _connectInfoProperty(property, attribute) {\n    const propertyUrl = `${this._rootUrl}/.info/${property}`;\n    this._bridge.on(propertyUrl, propertyUrl, null, 'value', snap => {\n      this.root[attribute] = snap.value;\n      angular.digest();\n    });\n  }\n}\n","import _ from 'lodash';\nimport Vue from 'vue';\nimport angular from './angularCompatibility.js';\nimport {splitPath} from './utils/paths.js';\n\n\nclass QueryHandler {\n  constructor(coupler, query) {\n    this._coupler = coupler;\n    this._query = query;\n    this._listeners = [];\n    this._keys = [];\n    this._url = this._coupler._rootUrl + query.path;\n    this._segments = splitPath(query.path, true);\n    this._listening = false;\n    this.ready = false;\n  }\n\n  attach(operation, keysCallback) {\n    this._listen();\n    this._listeners.push({operation, keysCallback});\n    if (keysCallback) keysCallback(this._keys);\n  }\n\n  detach(operation) {\n    const k = _.findIndex(this._listeners, {operation});\n    if (k >= 0) this._listeners.splice(k, 1);\n    return this._listeners.length;\n  }\n\n  _listen() {\n    if (this._listening) return;\n    this._coupler._bridge.on(\n      this._query.toString(), this._url, this._query.constraints, 'value',\n      this._handleSnapshot, this._handleError, this, {sync: true});\n    this._listening = true;\n  }\n\n  destroy() {\n    this._coupler._bridge.off(\n      this._query.toString(), this._url, this._query.constraints, 'value', this._handleSnapshot,\n      this);\n    this._listening = false;\n    this.ready = false;\n    angular.digest();\n    for (const key of this._keys) {\n      this._coupler._decoupleSegments(this._segments.concat(key));\n    }\n  }\n\n  _handleSnapshot(snap) {\n    this._coupler._queueSnapshotCallback(() => {\n      // Order is important here: first couple any new subpaths so _handleSnapshot will update the\n      // tree, then tell the client to update its keys, pulling values from the tree.\n      if (!this._listeners.length || !this._listening) return;\n      const updatedKeys = this._updateKeys(snap);\n      this._coupler._applySnapshot(snap);\n      if (!this.ready) {\n        this.ready = true;\n        angular.digest();\n        for (const listener of this._listeners) {\n          this._coupler._dispatcher.markReady(listener.operation);\n        }\n      }\n      if (updatedKeys) {\n        for (const listener of this._listeners) {\n          if (listener.keysCallback) listener.keysCallback(updatedKeys);\n        }\n      }\n    });\n  }\n\n  _updateKeys(snap) {\n    let updatedKeys;\n    if (snap.path === this._query.path) {\n      updatedKeys = _.keys(snap.value);\n      updatedKeys.sort();\n      if (_.isEqual(this._keys, updatedKeys)) {\n        updatedKeys = null;\n      } else {\n        for (const key of _.difference(updatedKeys, this._keys)) {\n          this._coupler._coupleSegments(this._segments.concat(key));\n        }\n        for (const key of _.difference(this._keys, updatedKeys)) {\n          this._coupler._decoupleSegments(this._segments.concat(key));\n        }\n        this._keys = updatedKeys;\n      }\n    } else if (snap.path.replace(/\\/[^/]+/, '') === this._query.path) {\n      const hasKey = _.includes(this._keys, snap.key);\n      if (snap.value) {\n        if (!hasKey) {\n          this._coupler._coupleSegments(this._segments.concat(snap.key));\n          this._keys.push(snap.key);\n          this._keys.sort();\n          updatedKeys = this._keys;\n        }\n      } else if (hasKey) {\n        this._coupler._decoupleSegments(this._segments.concat(snap.key));\n        _.pull(this._keys, snap.key);\n        this._keys.sort();\n        updatedKeys = this._keys;\n      }\n    }\n    return updatedKeys;\n  }\n\n  _handleError(error) {\n    if (!this._listeners.length || !this._listening) return;\n    this._listening = false;\n    this.ready = false;\n    angular.digest();\n    Promise.all(_.map(this._listeners, listener => {\n      this._coupler._dispatcher.clearReady(listener.operation);\n      return this._coupler._dispatcher.retry(listener.operation, error).catch(e => {\n        listener.operation._disconnect(e);\n        return false;\n      });\n    })).then(results => {\n      if (_.some(results)) {\n        if (this._listeners.length) this._listen();\n      } else {\n        for (const listener of this._listeners) listener.operation._disconnect(error);\n      }\n    });\n  }\n}\n\n\nclass Node {\n  constructor(coupler, path, parent) {\n    this._coupler = coupler;\n    this.path = path;\n    this.parent = parent;\n    this.url = this._coupler._rootUrl + path;\n    this.operations = [];\n    this.queryCount = 0;\n    this.listening = false;\n    this.ready = false;\n    this.children = {};\n  }\n\n  get active() {\n    return this.count || this.queryCount;\n  }\n\n  get count() {\n    return this.operations.length;\n  }\n\n  listen(skip) {\n    if (!skip && this.count) {\n      if (this.listening) return;\n      _.forEach(this.operations, op => {this._coupler._dispatcher.clearReady(op);});\n      this._coupler._bridge.on(\n        this.url, this.url, null, 'value', this._handleSnapshot, this._handleError, this,\n        {sync: true});\n      this.listening = true;\n    } else {\n      _.forEach(this.children, child => {child.listen();});\n    }\n  }\n\n  unlisten(skip) {\n    if (!skip && this.listening) {\n      this._coupler._bridge.off(this.url, this.url, null, 'value', this._handleSnapshot, this);\n      this.listening = false;\n      this._forAllDescendants(node => {\n        if (node.listening) return false;\n        if (node.ready) {\n          node.ready = false;\n          angular.digest();\n        }\n      });\n    } else {\n      _.forEach(this.children, child => {child.unlisten();});\n    }\n  }\n\n  _handleSnapshot(snap) {\n    this._coupler._queueSnapshotCallback(() => {\n      if (!this.listening || !this._coupler.isTrunkCoupled(snap.path)) return;\n      this._coupler._applySnapshot(snap);\n      if (!this.ready && snap.path === this.path) {\n        this.ready = true;\n        angular.digest();\n        this.unlisten(true);\n        this._forAllDescendants(node => {\n          for (const op of node.operations) this._coupler._dispatcher.markReady(op);\n        });\n      }\n    });\n  }\n\n  _handleError(error) {\n    if (!this.count || !this.listening) return;\n    this.listening = false;\n    this._forAllDescendants(node => {\n      if (node.listening) return false;\n      if (node.ready) {\n        node.ready = false;\n        angular.digest();\n      }\n      for (const op of node.operations) this._coupler._dispatcher.clearReady(op);\n    });\n    return Promise.all(_.map(this.operations, op => {\n      return this._coupler._dispatcher.retry(op, error).catch(e => {\n        op._disconnect(e);\n        return false;\n      });\n    })).then(results => {\n      if (_.some(results)) {\n        if (this.count) this.listen();\n      } else {\n        for (const op of this.operations) op._disconnect(error);\n        // Pulling all the operations will automatically get us listening on descendants.\n      }\n    });\n  }\n\n  _forAllDescendants(iteratee) {\n    if (iteratee(this) === false) return;\n    _.forEach(this.children, child => child._forAllDescendants(iteratee));\n  }\n\n  collectCoupledDescendantPaths(paths) {\n    if (!paths) paths = {};\n    paths[this.path] = this.active;\n    if (!this.active) {\n      _.forEach(this.children, child => {child.collectCoupledDescendantPaths(paths);});\n    }\n    return paths;\n  }\n}\n\n\nexport default class Coupler {\n  constructor(rootUrl, bridge, dispatcher, applySnapshot, prunePath) {\n    this._rootUrl = rootUrl;\n    this._bridge = bridge;\n    this._dispatcher = dispatcher;\n    this._applySnapshot = applySnapshot;\n    this._pendingSnapshotCallbacks = [];\n    this._throttled = {processPendingSnapshots: this._processPendingSnapshots};\n    this._prunePath = prunePath;\n    this._vue = new Vue({data: {root: undefined, queryHandlers: {}}});\n    this._nodeIndex = Object.create(null);\n    Object.freeze(this);\n    // Set root node after freezing Coupler, otherwise it gets vue-ified too.\n    this._vue.$data.root = new Node(this, '/');\n    this._nodeIndex['/'] = this._root;\n  }\n\n  get _root() {\n    return this._vue.$data.root;\n  }\n\n  get _queryHandlers() {\n    return this._vue.$data.queryHandlers;\n  }\n\n  destroy() {\n    _.forEach(this._queryHandlers, queryHandler => {queryHandler.destroy();});\n    this._root.unlisten();\n    this._vue.$destroy();\n  }\n\n  couple(path, operation) {\n    return this._coupleSegments(splitPath(path, true), operation);\n  }\n\n  _coupleSegments(segments, operation) {\n    let node;\n    let superseded = !operation;\n    let ready = false;\n    for (const segment of segments) {\n      let child = segment ? node.children && node.children[segment] : this._root;\n      if (!child) {\n        child = new Node(this, `${node.path === '/' ? '' : node.path}/${segment}`, node);\n        Vue.set(node.children, segment, child);\n        this._nodeIndex[child.path] = child;\n      }\n      superseded = superseded || child.listening;\n      ready = ready || child.ready;\n      node = child;\n    }\n    if (operation) {\n      node.operations.push(operation);\n    } else {\n      node.queryCount++;\n    }\n    if (superseded) {\n      if (operation && ready) this._dispatcher.markReady(operation);\n    } else {\n      node.listen();  // node will call unlisten() on descendants when ready\n    }\n  }\n\n  decouple(path, operation) {\n    return this._decoupleSegments(splitPath(path, true), operation);\n  }\n\n  _decoupleSegments(segments, operation) {\n    const ancestors = [];\n    let node;\n    for (const segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) break;\n      ancestors.push(node);\n    }\n    if (!node || !(operation ? node.count : node.queryCount)) {\n      throw new Error(`Path not coupled: ${segments.join('/') || '/'}`);\n    }\n    if (operation) {\n      _.pull(node.operations, operation);\n    } else {\n      node.queryCount--;\n    }\n    if (operation && !node.count) {\n      // Ideally, we wouldn't resync the full values here since we probably already have the current\n      // value for all children.  But making sure that's true is tricky in an async system (what if\n      // the node's value changes and the update crosses the 'off' call in transit?) and this\n      // situation should be sufficiently rare that the optimization is probably not worth it right\n      // now.\n      node.listen();\n      if (node.listening) node.unlisten();\n    }\n    if (!node.active) {\n      for (let i = ancestors.length - 1; i > 0; i--) {\n        node = ancestors[i];\n        if (node === this._root || node.active || !_.isEmpty(node.children)) break;\n        Vue.delete(ancestors[i - 1].children, segments[i]);\n        node.ready = undefined;\n        delete this._nodeIndex[node.path];\n      }\n      const path = segments.join('/') || '/';\n      this._prunePath(path, this.findCoupledDescendantPaths(path));\n    }\n  }\n\n  subscribe(query, operation, keysCallback) {\n    let queryHandler = this._queryHandlers[query.toString()];\n    if (!queryHandler) {\n      queryHandler = new QueryHandler(this, query);\n      Vue.set(this._queryHandlers, query.toString(), queryHandler);\n    }\n    queryHandler.attach(operation, keysCallback);\n  }\n\n  unsubscribe(query, operation) {\n    const queryHandler = this._queryHandlers[query.toString()];\n    if (queryHandler && !queryHandler.detach(operation)) {\n      queryHandler.destroy();\n      Vue.delete(this._queryHandlers, query.toString());\n    }\n  }\n\n  // Return whether the node at path or any ancestors are coupled.\n  isTrunkCoupled(path) {\n    const segments = splitPath(path, true);\n    let node;\n    for (const segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) return false;\n      if (node.active) return true;\n    }\n    return false;\n  }\n\n  findCoupledDescendantPaths(path) {\n    let node;\n    for (const segment of splitPath(path, true)) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (node && node.active) return {[path]: node.active};\n      if (!node) break;\n    }\n    return node && node.collectCoupledDescendantPaths();\n  }\n\n  isSubtreeReady(path) {\n    let node, childSegment;\n    function extractChildSegment(match) {\n      childSegment = match.slice(1);\n      return '';\n    }\n    while (!(node = this._nodeIndex[path])) {\n      path = path.replace(/\\/[^/]*$/, extractChildSegment) || '/';\n    }\n    if (childSegment) void node.children;  // state an interest in the closest ancestor's children\n    while (node) {\n      if (node.ready) return true;\n      node = node.parent;\n    }\n    return false;\n  }\n\n  isQueryReady(query) {\n    const queryHandler = this._queryHandlers[query.toString()];\n    return queryHandler && queryHandler.ready;\n  }\n\n  _queueSnapshotCallback(callback) {\n    this._pendingSnapshotCallbacks.push(callback);\n    this._throttled.processPendingSnapshots.call(this);\n  }\n\n  _processPendingSnapshots() {\n    for (const callback of this._pendingSnapshotCallbacks) callback();\n    // Property is frozen, so we need to splice to empty the array.\n    this._pendingSnapshotCallbacks.splice(0, Infinity);\n  }\n\n  throttleSnapshots(delay) {\n    if (delay) {\n      this._throttled.processPendingSnapshots = _.throttle(this._processPendingSnapshots, delay);\n    } else {\n      this._throttled.processPendingSnapshots = this._processPendingSnapshots;\n    }\n  }\n}\n\n","import _ from 'lodash';\nimport Vue from 'vue';\nimport angular from './angularCompatibility.js';\nimport Bridge from './Bridge.js';\nimport Connector from './Connector.js';\nimport Dispatcher from './Dispatcher.js';\nimport KeyGenerator from './KeyGenerator.js';\nimport MetaTree from './MetaTree.js';\nimport {Handle} from './Reference.js';\nimport {BaseValue} from './Modeler.js';\nimport Tree from './Tree.js';\nimport stats from './utils/stats.js';\nimport {escapeKey, unescapeKey} from './utils/paths.js';\nimport {wrapPromiseCallback, promiseCancel, promiseFinally} from './utils/promises.js';\nimport {SERVER_TIMESTAMP, copyPrototype} from './utils/utils.js';\n\n\nlet bridge, logging;\nconst workerFunctions = {};\n// This version is filled in by the build, don't reformat the line.\nconst VERSION = '3.0.3';\n\n\nexport default class Truss {\n\n  /**\n   * Create a new Truss instance, specific to a given datastore.  To avoid confusion there should be\n   * exactly one Truss per root datastore URL, so in most code this will be a singleton.\n   *\n   * @param rootUrl {String} The root URL, https://{project}.firebaseio.com.\n   */\n  constructor(rootUrl) {\n    // TODO: allow rootUrl to be a test database object for testing\n    if (!bridge) {\n      throw new Error('Truss worker not connected, please call Truss.connectWorker first');\n    }\n    this._rootUrl = rootUrl.replace(/\\/$/, '');\n    this._keyGenerator = new KeyGenerator();\n    this._dispatcher = new Dispatcher(bridge);\n    this._vue = new Vue();\n\n    bridge.trackServer(this._rootUrl);\n    this._tree = new Tree(this, this._rootUrl, bridge, this._dispatcher);\n    this._metaTree = new MetaTree(this._rootUrl, this._tree, bridge, this._dispatcher);\n\n    Object.freeze(this);\n  }\n\n  get meta() {return this._metaTree.root;}\n  get store() {return this._tree.root;}\n\n  /**\n   * Mount a set of classes against the datastore structure.  Must be called at most once, and\n   * cannot be called once any data has been loaded into the tree.\n   * @param classes {Array<Function> | Object<Function>} A list of the classes to map onto the\n   *    datastore structure.  Each class must have a static $trussMount property that is a\n   *    (wildcarded) unescaped datastore path, or an options object\n   *    {path: string, placeholder: object}, or an array of either.  If the list is an object then\n   *    the keys serve as default option-less $trussMount paths for classes that don't define an\n   *    explicit $trussMount.\n   */\n  mount(classes) {\n    this._tree.init(classes);\n  }\n\n  destroy() {\n    this._vue.$destroy();\n    this._tree.destroy();\n    this._metaTree.destroy();\n  }\n\n  get now() {return Date.now() + this.meta.timeOffset;}\n  newKey() {return this._keyGenerator.generateUniqueKey(this.now);}\n\n  authenticate(token) {\n    return this._metaTree.authenticate(token);\n  }\n\n  unauthenticate() {\n    return this._metaTree.unauthenticate();\n  }\n\n  intercept(actionType, callbacks) {\n    return this._dispatcher.intercept(actionType, callbacks);\n  }\n\n  // connections are {key: Query | Object | fn() -> (Query | Object)}\n  connect(scope, connections) {\n    if (!connections) {\n      connections = scope;\n      scope = undefined;\n    }\n    if (connections instanceof Handle) connections = {_: connections};\n    return new Connector(scope, connections, this._tree, 'connect');\n  }\n\n  // target is Reference, Query, or connection Object like above\n  peek(target, callback) {\n    callback = wrapPromiseCallback(callback || _.identity);\n    let cleanup, cancel;\n    const promise = Promise.resolve().then(() => new Promise((resolve, reject) => {\n      const scope = {};\n      let callbackPromise;\n\n      let connector = new Connector(scope, {result: target}, this._tree, 'peek');\n\n      let unintercept = this.intercept('peek', {onFailure: op => {\n        function match(descriptor) {\n          if (!descriptor) return;\n          if (descriptor instanceof Handle) return op.target.isEqual(descriptor);\n          return _.some(descriptor, value => match(value));\n        }\n        if (match(connector.at)) {\n          reject(op.error);\n          cleanup();\n        }\n      }});\n\n      let unobserve = this.observe(() => connector.ready, ready => {\n        if (!ready) return;\n        unobserve();\n        unobserve = null;\n        callbackPromise = promiseFinally(\n          callback(scope.result), () => {angular.digest(); callbackPromise = null; cleanup();}\n        ).then(result => {resolve(result);}, error => {reject(error);});\n      });\n\n      cleanup = () => {\n        if (unobserve) {unobserve(); unobserve = null;}\n        if (unintercept) {unintercept(); unintercept = null;}\n        if (connector) {connector.destroy(); connector = null;}\n        if (callbackPromise && callbackPromise.cancel) callbackPromise.cancel();\n      };\n\n      cancel = () => {\n        reject(new Error('Canceled'));\n        cleanup();\n      };\n    }));\n    return promiseCancel(promise, cancel);\n  }\n\n  observe(subjectFn, callbackFn, options) {\n    const usePreciseDefaults = _.isObject(options && options.precise);\n    let numCallbacks = 0;\n    let oldValueClone;\n    if (usePreciseDefaults) oldValueClone = _.clone(options.precise, options.deep);\n\n    const unwatch = this._vue.$watch(subjectFn, (newValue, oldValue) => {\n      if (options && options.precise) {\n        const newValueClone = usePreciseDefaults ?\n          (options.deep ?\n            _.defaultsDeep({}, newValue, options.precise) :\n            _.defaults({}, newValue, options.precise)) :\n          _.clone(newValue, options.deep);\n        if (_.isEqual(newValueClone, oldValueClone)) return;\n        oldValueClone = newValueClone;\n      }\n      numCallbacks++;\n      if (!unwatch) {\n        // Delay the immediate callback until we've had a chance to return the unwatch function.\n        Promise.resolve().then(() => {\n          if (numCallbacks > 1) return;\n          callbackFn(newValue, oldValue);\n          // No need to digest since under Angular we'll be using $q as Promise.\n        });\n      } else {\n        callbackFn(newValue, oldValue);\n        angular.digest();\n      }\n    }, {immediate: true, deep: options && options.deep});\n\n    if (options && options.scope) options.scope.$on('$destroy', unwatch);\n    return unwatch;\n  }\n\n  when(expression, options) {\n    let cleanup, timeoutHandle;\n    let promise = new Promise((resolve, reject) => {\n      let unobserve = this.observe(expression, value => {\n        if (!value) return;\n        // Wait for computed properties to settle and double-check.\n        Vue.nextTick(() => {\n          value = expression();\n          if (!value) return;\n          resolve(value);\n          cleanup();\n        });\n      });\n      if (_.has(options, 'timeout')) {\n        timeoutHandle = setTimeout(() => {\n          timeoutHandle = null;\n          reject(new Error(options.timeoutMessage || 'Timeout'));\n          cleanup();\n        }, options.timeout);\n      }\n      cleanup = () => {\n        if (unobserve) {unobserve(); unobserve = null;}\n        if (timeoutHandle) {clearTimeout(timeoutHandle); timeoutHandle = null;}\n        reject(new Error('Canceled'));\n      };\n    });\n    promise = promiseCancel(promiseFinally(promise, cleanup), cleanup);\n    if (options && options.scope) options.scope.$on('$destroy', () => {promise.cancel();});\n    return promise;\n  }\n\n  nextTick() {\n    let cleanup;\n    let promise = new Promise((resolve, reject) => {\n      Vue.nextTick(resolve);\n      cleanup = () => {\n        reject(new Error('Canceled'));\n      };\n    });\n    promise = promiseCancel(promise, cleanup);\n    return promise;\n  }\n\n  throttleRemoteDataUpdates(delay) {\n    this._tree.throttleRemoteDataUpdates(delay);\n  }\n\n  checkObjectsForRogueProperties() {\n    this._tree.checkVueObject(this._tree.root, '/');\n  }\n\n  static get computedPropertyStats() {\n    return stats;\n  }\n\n  static connectWorker(webWorker, config) {\n    if (bridge) throw new Error('Worker already connected');\n    if (_.isString(webWorker)) {\n      const Worker = window.SharedWorker || window.Worker;\n      if (!Worker) throw new Error('Browser does not implement Web Workers');\n      webWorker = new Worker(webWorker);\n    }\n    bridge = new Bridge(webWorker);\n    if (logging) bridge.enableLogging(logging);\n    return bridge.init(webWorker, config).then(\n      ({exposedFunctionNames, firebaseSdkVersion}) => {\n        Object.defineProperty(Truss, 'FIREBASE_SDK_VERSION', {value: firebaseSdkVersion});\n        for (const name of exposedFunctionNames) {\n          Truss.worker[name] = bridge.bindExposedFunction(name);\n        }\n      }\n    );\n  }\n\n  static get worker() {return workerFunctions;}\n  static preExpose(functionName) {\n    Truss.worker[functionName] = bridge.bindExposedFunction(functionName);\n  }\n\n  static bounceConnection() {return bridge.bounceConnection();}\n  static suspend() {return bridge.suspend();}\n  static debugPermissionDeniedErrors(simulatedTokenGenerator, maxSimulationDuration, callFilter) {\n    return bridge.debugPermissionDeniedErrors(\n      simulatedTokenGenerator, maxSimulationDuration, callFilter);\n  }\n\n  static debounceAngularDigest(wait) {\n    angular.debounceDigest(wait);\n  }\n\n  static escapeKey(key) {return escapeKey(key);}\n  static unescapeKey(escapedKey) {return unescapeKey(escapedKey);}\n\n  static enableLogging(fn) {\n    logging = fn;\n    if (bridge) bridge.enableLogging(fn);\n  }\n\n  // Duplicate static constants on instance for convenience.\n  get SERVER_TIMESTAMP() {return Truss.SERVER_TIMESTAMP;}\n  get VERSION() {return Truss.VERSION;}\n  get FIREBASE_SDK_VERSION() {return Truss.FIREBASE_SDK_VERSION;}\n}\n\nObject.defineProperties(Truss, {\n  SERVER_TIMESTAMP: {value: SERVER_TIMESTAMP},\n  VERSION: {value: VERSION},\n\n  ComponentPlugin: {value: {\n    install(Vue2, pluginOptions) {\n      if (Vue !== Vue2) throw new Error('Multiple versions of Vue detected');\n      if (!pluginOptions.truss) {\n        throw new Error('Need to pass `truss` instance as an option to use the ComponentPlugin');\n      }\n      const prototypeExtension = {\n        $truss: {value: pluginOptions.truss},\n        $destroyed: {get() {return this._isBeingDestroyed || this._isDestroyed;}},\n        $$touchThis: {value() {if (this.__ob__) this.__ob__.dep.depend();}}\n      };\n      const conflictingKeys = _(prototypeExtension).keys()\n        .union(_.keys(BaseValue.prototype)).intersection(_.keys(Vue.prototype)).value();\n      if (conflictingKeys.length) {\n        throw new Error(\n          'Truss extension properties conflict with Vue properties: ' + conflictingKeys.join(', '));\n      }\n      Object.defineProperties(Vue.prototype, prototypeExtension);\n      copyPrototype(BaseValue, Vue);\n      Vue.mixin({\n        destroyed() {\n          if (_.has(this, '$$finalizers')) {\n            // Some finalizers remove themselves from the array, so clone it before iterating.\n            for (const fn of _.clone(this.$$finalizers)) fn();\n          }\n        }\n      });\n    }\n  }}\n});\n\nangular.defineModule(Truss);\n\n"]}