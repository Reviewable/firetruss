{"version":3,"sources":["../src/client/utils.js","../src/client/Tree.js","../src/client/Bridge.js","../src/client/Reference.js","../node_modules/performance-now/lib/performance-now.js","../src/client/KeyGenerator.js","../src/client/angularCompatibility.js","../src/client/Truss.js"],"names":["unescapeKey","key","toString","replace","code","String","fromCharCode","parseInt","slice","throwReadOnlyError","Error","joinPath","segments","i","list","arguments","length","let","segment","charAt","splice","push","join","noop","Query","truss","path","terms","this","_truss","_path","_terms","prototypeAccessors","get","_key","parent","Reference","ready","prototype","waitUntilReady","Promise","resolve","trackSlowness","worker","once","_url","connect","disconnect","result","queryTerms","map","term","queryTerm","encodeURIComponent","x","JSON","stringify","sort","orderByChild","ref","relativePath","_","startsWith","forEach","methodName","const","Array","call","unshift","super","child","children","set","value","update","values","commit","options","updateFunction","hasOwnProperty","undefined","Truss","DefaultTransactionOptions","on","transaction","then","off","error","reject","getNanoSeconds","hrtime","loadTime","performance","now","module","exports","process","hr","Date","getTime","RESERVED_VALUE_PROPERTY_NAMES","$truss","$parent","$key","$path","computedPropertyStats","Value","$ref","$refs","$keys","keys","$values","$root","_vue","$data","$set","$update","$commit","updateFn","ComputedPropertyStats","name","extend","numRecomputes","numUpdates","runtime","Tree","classes","_firebasePropertyEditAllowed","Vue","data","_mounts","Class","_mountClass","flatten","_createObject","_completeCreateObject","root","_plantPlaceholders","prototypeAccessors$1","destroy","$destroy","_augmentClass","computedProperties","proto","constructor","Object","getOwnPropertyNames","descriptor","getOwnPropertyDescriptor","isEqual","fullName","getPrototypeOf","i$1","list$1","defineProperty","$$truss","mounts","$trussMount","isArray","mount","isString","variables","pathTemplate","match","variable","has","klass","escapedKey","placeholder","regex","RegExp","parentRegex","properties","writable","configurable","enumerable","lastIndex","exec","object","touchThis","each","prop","_buildComputedPropertyDescriptor","defineProperties","computeValue","startTime","performanceNow","stats","writeAllowed","firstCallback","__destructors__","__initializers__","this$1","$watch","bind","newValue","_isTrussEqual","immediate","a","b","fn","_destroyObject","_plantSnapshotValue","snap","_plantValue","pathFromUrl","val","isObject","_setFirebaseProperty","item","escapedChildKey","test","oldValue","_deleteObject","delete","staticAccessors","ALPHABET","KeyGenerator","_lastUniqueKeyTime","_lastRandomValues","generateUniqueKey","chars","prefix","Math","floor","random","SlownessTracker","record","counted","canceled","handle","setTimeout","handleTimeout","timeout","callback","count","handleDone","clearTimeout","Bridge","webWorker","_idCounter","_deferreds","_active","_servers","_callbacks","_errorCallbacks","_slowCallbacks","read","write","auth","_simulatedTokenGenerator","_maxSimulationDuration","_simulatedCallFilter","_inboundMessages","_outboundMessages","_flushMessageQueue","_port","port","_shared","onmessage","_receive","window","addEventListener","_send","msg","setInterval","init","items","storage","localStorage","sessionStorage","getItem","e","exposedFunctionNames","firebaseSdkVersion","FIREBASE_SDK_VERSION","bindExposedFunction","activate","enabled","_receiveMessages","setImmediate","debugPermissionDeniedErrors","simulatedTokenGenerator","maxSimulationDuration","callFilter","message","id","promise","oneWay","deferred","sent","resolveSent","postMessage","event","concat","messages","args","_hydrateError","_emitError","json","props","_errorFromJson","toLowerCase","_simulateCall","securityTrace","extra","debug","simulatedCalls","method","url","getAuth","getUrlRoot","simulationPromise","uid","token","all","securityTraces","every","trace","filter","catch","timeoutPromise","race","updateLocalStorage","removeItem","setItem","trackServer","rootUrl","server","offset","authListeners","authCallbackId","_registerCallback","_authCallback","offsetUrl","callbackId","listener","onAuth","context","offAuth","authWithCustomToken","authToken","unauth","listenerKey","eventType","snapshotCallback","cancelCallback","timeouts","_onCallback","__callbackIds","idsToDeregister","i$2","_nullifyCallback","_deregisterCallback","snapshotJson","Snapshot","tries","attemptTransaction","oldHash","Firebase","ABORT_TRANSACTION_NOW","safeAbort","committed","snapshot","stale","hash","onDisconnect","bounceConnection","apply","onError","offError","k","indexOf","onSlow","operationKind","kinds","kind","offSlow","records","opDone","propertyName","triggerAngularDigest","active","angular","run","$rootScope","$evalAsync","defineModule","constant","digest","bridge","TIMESTAMP","freeze",".sv","_rootUrl","_keyGenerator","_tree","angularCompatibility","deep","tree","newKey","user","authenticate","unauthenticate","interceptConnections","interceptWrites","pull","scope","connections","connectWorker","preExpose","functionName","goOnline","goOffline","escapeKey","seal","applyLocally","nonsequential","create","exports$1"],"mappings":"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","file":"firetruss.min.js","sourcesContent":["'use strict';\n\nexport function escapeKey(key) {\n  if (!key) return key;\n  return key.toString().replace(/[\\\\\\.\\$\\#\\[\\]\\/]/g, function(char) {\n    return '\\\\' + char.charCodeAt(0).toString(16);\n  });\n}\n\nexport function unescapeKey(key) {\n  if (!key) return key;\n  return key.toString().replace(/\\\\[0-9a-f]{2}/gi, function(code) {\n    return String.fromCharCode(parseInt(code.slice(1), 16));\n  });\n}\n","'use strict';\n\nimport Reference from './Reference.js';\nimport {unescapeKey} from './utils.js';\n\nimport _ from 'lodash';\nimport performanceNow from 'performance-now';\nimport Vue from 'vue';\n\n// These are defined separately for each object so they're not included in Value below.\nconst RESERVED_VALUE_PROPERTY_NAMES = {$truss: true, $parent: true, $key: true, $path: true};\n\nconst computedPropertyStats = {};\n\n\nclass Value {\n  get $ref() {return new Reference(this.$truss, this.$path);}\n  get $refs() {return [this.$ref];}\n  get $keys() {return _.keys(this);}\n  get $values() {return _.values(this);}\n  get $root() {return this.$truss._vue.$data.$root;}  // access via $data to leave dependency trace\n  $set(value) {return this.$ref.set(value);}\n  $update(values) {return this.$ref.update(values);}\n  $commit(options, updateFn) {return this.$ref.commit(options, updateFn);}\n  // TODO\n  // $temporarilyOverride(updateFn)\n  // $onPropertyChange(method)\n  // $freezeProperty\n}\n\n\nclass ComputedPropertyStats {\n  constructor(name) {\n    _.extend(this, {name, numRecomputes: 0, numUpdates: 0, runtime: 0});\n  }\n}\n\n\nclass Tree {\n  constructor(truss, classes) {\n    this._truss = truss;\n    this._firebasePropertyEditAllowed = false;\n    this._vue = new Vue({data: {$root: null}});\n    this._mounts = _(classes).map(Class => this._mountClass(Class)).flatten().value();\n    this._vue.$data.$root = this._createObject('/', '');\n    // console.log(this._vue.$data.$root);\n    this._completeCreateObject(this.root);\n    this._plantPlaceholders(this.root, '/');\n  }\n\n  get root() {\n    return this._vue.$data.$root;\n  }\n\n  destroy() {\n    this._vue.$destroy();\n  }\n\n  _augmentClass(Class) {\n    let computedProperties;\n    let proto = Class.prototype;\n    while (proto && proto.constructor !== Object) {\n      for (let name of Object.getOwnPropertyNames(proto)) {\n        const descriptor = Object.getOwnPropertyDescriptor(proto, name);\n        if (name.charAt(0) === '$') {\n          if (_.isEqual(descriptor, Object.getOwnPropertyDescriptor(Value.prototype, name))) {\n            continue;\n          }\n          throw new Error(`Property names starting with \"$\" are reserved: ${Class.name}.${name}`);\n        }\n        if (descriptor.set) {\n          throw new Error(`Computed properties must not have a setter: ${Class.name}.${name}`);\n        }\n        if (descriptor.get && !(computedProperties && computedProperties[name])) {\n          (computedProperties || (computedProperties = {}))[name] = {\n            name, fullName: `${proto.constructor.name}.${name}`, get: descriptor.get\n          };\n        }\n      }\n      proto = Object.getPrototypeOf(proto);\n    }\n    for (let name of Object.getOwnPropertyNames(Value.prototype)) {\n      if (name === 'constructor') continue;\n      Object.defineProperty(\n        Class.prototype, name, Object.getOwnPropertyDescriptor(Value.prototype, name));\n    }\n    return computedProperties;\n  }\n\n  _mountClass(Class) {\n    if (Class.$$truss) throw new Error(`Class ${Class.name} already mounted`);\n    Class.$$truss = true;\n    const computedProperties = this._augmentClass(Class);\n    let mounts = Class.$trussMount;\n    if (!mounts) throw new Error(`Class ${Class.name} lacks a $trussMount static property`);\n    if (!_.isArray(mounts)) mounts = [mounts];\n    return _.map(mounts, mount => {\n      if (_.isString(mount)) mount = {path: mount};\n      const variables = [];\n      const pathTemplate = mount.path.replace(/\\/\\$[^\\/]+/g, match => {\n        variables.push(match.slice(1));\n        return '\\u0001';\n      }).replace(/[$-.?[-^{|}]/g, '\\\\$&');\n      for (let variable of variables) {\n        if (variable === '$' || variable.charAt(1) === '$') {\n          throw new Error(`Invalid variable name: ${variable}`);\n        }\n        if (variable.charAt(0) === '$' && (\n            _.has(Value.prototype, variable) || RESERVED_VALUE_PROPERTY_NAMES[variable]\n        )) {\n          throw new Error(`Variable name conflicts with built-in property or method: ${variable}`);\n        }\n      }\n      return {\n        klass: Class, variables, computedProperties,\n        escapedKey: mount.path.match(/\\/([^/]*)$/)[1],\n        placeholder: mount.placeholder,\n        regex: new RegExp('^' + pathTemplate.replace(/\\u0001/g, '/([^/]+)') + '$'),\n        parentRegex: new RegExp(\n          '^' + (pathTemplate.replace(/\\/[^/]*$/, '').replace(/\\u0001/g, '/([^/]+)') || '/') + '$')\n      };\n    });\n  }\n\n  /**\n   * Creates a Truss object and sets all its basic properties: path segment variables, user-defined\n   * properties, and computed properties.  The latter two will be enumerable so that Vue will pick\n   * them up and make the reactive, so you should call _completeCreateObject once it's done so and\n   * before any Firebase properties are added.\n   */\n  _createObject(path, key, parent) {\n    if (parent && _.has(parent, key)) throw new Error(`Duplicate object created for ${path}`);\n    let properties = {\n      $truss: {value: this._truss, writable: false, configurable: false, enumerable: false},\n      // We want Vue to wrap this; we'll hide it in _completeCreateObject.\n      $parent: {value: parent, writable: false, configurable: true, enumerable: true},\n      $key: {value: key, writable: false, configurable: false, enumerable: false},\n      $path: {value: path, writable: false, configurable: false, enumerable: false}\n    };\n\n    let Class = Value;\n    let computedProperties;\n    for (let mount of this._mounts) {\n      mount.regex.lastIndex = 0;\n      var match = mount.regex.exec(path);\n      if (match) {\n        Class = mount.klass;\n        computedProperties = mount.computedProperties;\n        for (let i = 0; i < mount.variables.length; i++) {\n          properties[mount.variables[i]] = {\n            value: unescapeKey(match[i + 1]),\n            writable: false, configurable: false, enumerable: false\n          };\n        }\n        break;\n      }\n    }\n\n    const object = new Class();\n\n    if (computedProperties) {\n      const touchThis = parent ? () => parent[key] : () => this._vue.$data.$root;\n      _.each(computedProperties, prop => {\n        properties[prop.name] = this._buildComputedPropertyDescriptor(object, prop, touchThis);\n      });\n    }\n\n    Object.defineProperties(object, properties);\n    return object;\n  }\n\n  _buildComputedPropertyDescriptor(object, prop, touchThis) {\n    if (!computedPropertyStats[prop.fullName]) {\n      Object.defineProperty(computedPropertyStats, prop.fullName, {\n        value: new ComputedPropertyStats(prop.fullName), writable: false, enumerable: true,\n        configurable: false\n      });\n    }\n    const stats = computedPropertyStats[prop.fullName];\n\n    function computeValue() {\n      // Touch this object, since a failed access to a missing property doesn't get captured as a\n      // dependency.\n      touchThis();\n\n      const startTime = performanceNow();\n      // jshint validthis: true\n      const result = prop.get.call(this);\n      // jshint validthis: false\n      stats.runtime += performanceNow() - startTime;\n      stats.numRecomputes += 1;\n      return result;\n    }\n\n    let value;\n    let writeAllowed = false;\n    let firstCallback = true;\n\n    if (!object.__destructors__) {\n      Object.defineProperty(object, '__destructors__', {\n        value: [], writable: false, enumerable: false, configurable: false});\n    }\n    if (!object.__initializers__) {\n      Object.defineProperty(object, '__initializers__', {\n        value: [], writable: false, enumerable: false, configurable: false});\n    }\n    object.__initializers__.push(() => {\n      object.__destructors__.push(\n        this._vue.$watch(computeValue.bind(object), newValue => {\n          if (firstCallback) {\n            stats.numUpdates += 1;\n            value = newValue;\n            firstCallback = false;\n          } else {\n            if (_.isEqual(value, newValue, this._isTrussEqual, this)) return;\n            stats.numUpdates += 1;\n            writeAllowed = true;\n            object[prop.name] = newValue;\n            writeAllowed = false;\n          }\n        }, {immediate: true})  // use immediate:true since watcher will run computeValue anyway\n      );\n    });\n    return {\n      enumerable: true, configurable: true,\n      get: function() {return value;},\n      set: function(newValue) {\n        if (!writeAllowed) throw new Error(`You cannot set a computed property: ${prop.name}`);\n        value = newValue;\n      }\n    };\n  }\n\n  _isTrussEqual(a, b) {\n    if (a && a.$truss || b && b.$truss) return a === b;\n  }\n\n  // To be called on the result of _createObject after it's been inserted into the _vue hierarchy\n  // and Vue has had a chance to initialize it.\n  _completeCreateObject(object) {\n    for (let name of Object.getOwnPropertyNames(object)) {\n      const descriptor = Object.getOwnPropertyDescriptor(object, name);\n      if (descriptor.configurable && descriptor.enumerable) {\n        descriptor.enumerable = false;\n        if (name === '$parent') {\n          descriptor.configurable = false;\n          descriptor.set = throwReadOnlyError;\n        }\n        Object.defineProperty(object, name, descriptor);\n      }\n    }\n    if (object.__initializers__) {\n      for (let fn of object.__initializers__) fn();\n    }\n  }\n\n  _destroyObject(object) {\n    if (object.__destructors__) {\n      for (let fn of object.__destructors__) fn();\n    }\n    for (let key in object) {\n      if (!Object.hasOwnProperty(object, key)) continue;\n      const value = object[key];\n      if (value && value.$truss) this._destroyObject(value);\n    }\n  }\n\n  _plantSnapshotValue(snap, parent) {\n    return this._plantValue(\n      pathFromUrl(snap.ref().toString()), unescapeKey(snap.key()), snap.val(), parent);\n  }\n\n  _plantValue(path, key, value, parent) {\n    if (!_.isArray(value) && !_.isObject(value)) {\n      this._setFirebaseProperty(parent, key, value);\n      return;\n    }\n    const object = this._createObject(path, key, parent);\n    this._setFirebaseProperty(parent, key, object);\n    this._completeCreateObject(object);\n    _.each(value, (item, escapedChildKey) => {\n      if (item === null || item === undefined) return;\n      this._plantValue(\n        `${joinPath(path, escapedChildKey)}`, unescapeKey(escapedChildKey), item, object);\n    });\n    this._plantPlaceholders(object, path);\n    return object;\n  }\n\n  _plantPlaceholders(object, path) {\n    _.each(this._mounts, mount => {\n      const key = unescapeKey(mount.escapedKey);\n      if (!object.hasOwnProperty(key) && mount.placeholder && mount.parentRegex.test(path)) {\n        this._plantValue(`${joinPath(path, mount.escapedKey)}`, key, mount.placeholder, object);\n      }\n    });\n  }\n\n  _setFirebaseProperty(object, key, value) {\n    let descriptor = Object.getOwnPropertyDescriptor(object, key);\n    if (descriptor) {\n      if (!descriptor.enumerable) {\n        throw new Error(\n          `Key conflict between Firebase and instance or computed properties at ` +\n          `${object.$path}: ${key}`);\n      }\n      if (!descriptor.get || !descriptor.set) {\n        throw new Error(`Unbound property at ${object.$path}: ${key}`);\n      }\n    }\n    if (value === null || value === undefined) {\n      if (descriptor) {\n        const oldValue = object[key];\n        if (oldValue && oldValue.$truss) this._deleteObject(oldValue);\n        Vue.delete(object, key);\n      }\n    } else {\n      if (descriptor) {\n        this._firebasePropertyEditAllowed = true;\n        object[key] = value;\n        this._firebasePropertyEditAllowed = false;\n      } else {\n        Vue.set(object, key, value);\n        descriptor = Object.getOwnPropertyDescriptor(object, key);\n        Object.defineProperty(object, key, {\n          get: descriptor.get,\n          set: function(newValue) {\n            if (!this._firebasePropertyEditAllowed) {\n              throw new Error(`Firebase data cannot be mutated directly: ${key}`);\n            }\n            descriptor.set.call(this, newValue);\n          },\n          configurable: true, enumerable: true\n        });\n      }\n    }\n  }\n\n  static get computedPropertyStats() {\n    return computedPropertyStats;\n  }\n}\n\n\nfunction throwReadOnlyError() {throw new Error('Read-only property');}\n\nfunction joinPath() {\n  const segments = [];\n  for (let segment of arguments) {\n    if (segment.charAt(0) === '/') segments.splice(0, segments.length);\n    segments.push(segment);\n  }\n  if (segments[0] === '/') segments[0] = '';\n  return segments.join('/');\n}\n\nexport default Tree;\n","'use strict';\n\n// jshint browser:true\n\nclass SlownessTracker {\n  constructor(record) {\n    this.record = record;\n    this.counted = false;\n    this.canceled = false;\n    this.handle = setTimeout(this.handleTimeout.bind(this), record.timeout);\n  }\n\n  handleTimeout() {\n    if (this.canceled) return;\n    this.counted = true;\n    this.record.callback(++this.record.count, 1, this.record.timeout);\n  }\n\n  handleDone() {\n    this.canceled = true;\n    if (this.counted) {\n      this.record.callback(--this.record.count, -1, this.record.timeout);\n    } else {\n      clearTimeout(this.handle);\n    }\n  }\n}\n\n\nclass Bridge {\n  constructor(webWorker) {\n    this._idCounter = 0;\n    this._deferreds = {};\n    this._active = true;\n    this._servers = {};\n    this._callbacks = {};\n    this._errorCallbacks = [];\n    this._slowCallbacks = {read: [], write: [], auth: []};\n    this._simulatedTokenGenerator = null;\n    this._maxSimulationDuration = 5000;\n    this._simulatedCallFilter = null;\n    this._inboundMessages = [];\n    this._outboundMessages = [];\n    this._flushMessageQueue = this._flushMessageQueue.bind(this);\n    this._port = webWorker.port || webWorker;\n    this._shared = !!webWorker.port;\n    this._port.onmessage = this._receive.bind(this);\n    window.addEventListener('unload', () => {this._send({msg: 'destroy'});});\n    setInterval(() => {this._send({msg: 'ping'});}, 60 * 1000);\n  }\n\n  init() {\n    const items = [];\n    try {\n      const storage = window.localStorage || window.sessionStorage;\n      if (!storage) return;\n      for (let i = 0; i < storage.length; i++) {\n        const key = storage.key(i);\n        items.push({key, value: storage.getItem(key)});\n      }\n    } catch (e) {\n      // Some browsers don't like us accessing local storage -- nothing we can do.\n    }\n    return this._send({msg: 'init', storage: items}).then(\n      ({exposedFunctionNames, firebaseSdkVersion}) => {\n        Truss.FIREBASE_SDK_VERSION = firebaseSdkVersion;\n        for (let name of exposedFunctionNames) {\n          Truss.worker[name] = this.bindExposedFunction(name);\n        }\n      }\n    );\n  }\n\n  activate(enabled) {\n    if (this._active === enabled) return;\n    this._active = enabled;\n    if (enabled) {\n      this._receiveMessages(this._inboundMessages);\n      this._inboundMessages = [];\n      if (this._outboundMessages.length) setImmediate(this._flushMessageQueue);\n    }\n  }\n\n  debugPermissionDeniedErrors(simulatedTokenGenerator, maxSimulationDuration, callFilter) {\n    this._simulatedTokenGenerator = simulatedTokenGenerator;\n    if (maxSimulationDuration !== undefined) this._maxSimulationDuration = maxSimulationDuration;\n    this._simulatedCallFilter = callFilter || function() {return true;};\n  }\n\n  _send(message) {\n    message.id = ++this._idCounter;\n    let promise;\n    if (message.oneWay) {\n      promise = Promise.resolve();\n    } else {\n      promise = new Promise((resolve, reject) => {\n        this._deferreds[message.id] = {resolve, reject};\n      });\n      const deferred = this._deferreds[message.id];\n      deferred.promise = promise;\n      promise.sent = new Promise(resolve => {\n        deferred.resolveSent = resolve;\n      });\n      for (let name in message) if (message.hasOwnProperty(name)) deferred[name] = message[name];\n    }\n    if (!this._outboundMessages.length && this._active) setImmediate(this._flushMessageQueue);\n    this._outboundMessages.push(message);\n    return promise;\n  }\n\n  _flushMessageQueue() {\n    this._port.postMessage(this._outboundMessages);\n    this._outboundMessages = [];\n  }\n\n  _receive(event) {\n    if (this._active) {\n      this._receiveMessages(event.data);\n    } else {\n      this._inboundMessages = this._inboundMessages.concat(event.data);\n    }\n  }\n\n  _receiveMessages(messages) {\n    for (let message of messages) {\n      const fn = this[message.msg];\n      if (typeof fn !== 'function') throw new Error('Unknown message: ' + message.msg);\n      fn.call(this, message);\n    }\n  }\n\n  bindExposedFunction(name) {\n    return (function() {\n      return this._send({msg: 'call', name, args: Array.prototype.slice.call(arguments)});\n    }).bind(this);\n  }\n\n  resolve(message) {\n    const deferred = this._deferreds[message.id];\n    if (!deferred) throw new Error('fireworker received resolution to inexistent call');\n    delete this._deferreds[message.id];\n    deferred.resolve(message.result);\n  }\n\n  reject(message) {\n    const deferred = this._deferreds[message.id];\n    if (!deferred) throw new Error('fireworker received rejection of inexistent call');\n    delete this._deferreds[message.id];\n    this._hydrateError(message.error, deferred).then(error => {\n      deferred.reject(error);\n      this._emitError(error);\n    });\n  }\n\n  _hydrateError(json, props) {\n    const error = this._errorFromJson(json);\n    const code = json.code || json.message;\n    if (code && code.toLowerCase() === 'permission_denied') {\n      return this._simulateCall(props).then(securityTrace => {\n        if (securityTrace) {\n          error.extra = error.extra || {};\n          error.extra.debug = securityTrace;\n        }\n        return error;\n      });\n    } else {\n      return Promise.resolve(error);\n    }\n  }\n\n  _simulateCall(props) {\n    if (!(this._simulatedTokenGenerator && this._maxSimulationDuration > 0)) {\n      return Promise.resolve();\n    }\n    let simulatedCalls = [];\n    switch (props.msg) {\n      case 'set':\n        simulatedCalls.push({method: 'set', url: props.url, args: [props.value]});\n        break;\n      case 'update':\n        simulatedCalls.push({method: 'update', url: props.url, args: [props.value]});\n        break;\n      case 'on':\n      case 'once':\n        simulatedCalls.push({method: 'once', url: props.url, args: ['value']});\n        break;\n      case 'transaction':\n        simulatedCalls.push({method: 'once', url: props.url, args: ['value']});\n        simulatedCalls.push({method: 'set', url: props.url, args: [props.newValue]});\n        break;\n    }\n    if (!simulatedCalls.length || !this._simulatedCallFilter(props.msg, props.url)) {\n      return Promise.resolve();\n    }\n    const auth = this.getAuth(getUrlRoot(props.url));\n    const simulationPromise = this._simulatedTokenGenerator(auth && auth.uid).then(token => {\n      return Promise.all(simulatedCalls.map(message => {\n        message.msg = 'simulate';\n        message.token = token;\n        return this._send(message);\n      }));\n    }).then(securityTraces => {\n      if (securityTraces.every(trace => trace === null)) {\n        return 'Unable to reproduce error in simulation';\n      }\n      return securityTraces.filter(trace => trace).join('\\n\\n');\n    }).catch(e => {\n      return 'Error running simulation: ' + e;\n    });\n    const timeoutPromise = new Promise(resolve => {\n      setTimeout(resolve.bind(null, 'Simulated call timed out'), this._maxSimulationDuration);\n    });\n    return Promise.race([simulationPromise, timeoutPromise]);\n  }\n\n  updateLocalStorage(items) {\n    try {\n      const storage = window.localStorage || window.sessionStorage;\n      for (let item in items) {\n        if (item.value === null) {\n          storage.removeItem(item.key);\n        } else {\n          storage.setItem(item.key, item.value);\n        }\n      }\n    } catch (e) {\n      // If we're denied access, there's nothing we can do.\n    }\n  }\n\n  trackServer(rootUrl) {\n    if (this._servers.hasOwnProperty(rootUrl)) return;\n    const server = this._servers[rootUrl] = {offset: 0, authListeners: []};\n    const authCallbackId = this._registerCallback(this._authCallback.bind(this, server));\n    const offsetUrl = `${rootUrl}/.info/serverTimeOffset`;\n    this.on(offsetUrl, offsetUrl, [], 'value', offset => {server.offset = offset.val();});\n    this._send({msg: 'onAuth', url: rootUrl, callbackId: authCallbackId});\n  }\n\n  _authCallback(server, auth) {\n    server.auth = auth;\n    for (let listener of server.authListeners) listener(auth);\n  }\n\n  onAuth(rootUrl, callback, context) {\n    const listener = callback.bind(context);\n    listener.callback = callback;\n    listener.context = context;\n    this._servers[rootUrl].authListeners.push(listener);\n    listener(this.getAuth(rootUrl));\n  }\n\n  offAuth(rootUrl, callback, context) {\n    const authListeners = this._servers[rootUrl].authListeners;\n    for (let i = 0; i < authListeners.length; i++) {\n      const listener = authListeners[i];\n      if (listener.callback === callback && listener.context === context) {\n        authListeners.splice(i, 1);\n        break;\n      }\n    }\n  }\n\n  getAuth(rootUrl) {\n    return this._servers[rootUrl].auth;\n  }\n\n  authWithCustomToken(url, authToken, options) {\n    return this._send({msg: 'authWithCustomToken', url, authToken, options});\n  }\n\n  unauth(url) {\n    return this._send({msg: 'unauth', url});\n  }\n\n  set(url, value) {return this._send({msg: 'set', url, value});}\n  update(url, value) {return this._send({msg: 'update', url, value});}\n\n  on(listenerKey, url, terms, eventType, snapshotCallback, cancelCallback, context, options) {\n    const handle = {\n      listenerKey, eventType, snapshotCallback, cancelCallback, context, msg: 'on', url, terms,\n      timeouts: this._slowCallbacks.read.map(record => new SlownessTracker(record))\n    };\n    const callback = this._onCallback.bind(this, handle);\n    this._registerCallback(callback, handle);\n    // Keep multiple IDs to allow the same snapshotCallback to be reused.\n    snapshotCallback.__callbackIds = snapshotCallback.__callbackIds || [];\n    snapshotCallback.__callbackIds.push(handle.id);\n    this._send({\n      msg: 'on', listenerKey, url, terms, eventType, callbackId: handle.id, options\n    }).catch(error => {\n      callback(error);\n    });\n  }\n\n  off(listenerKey, url, terms, eventType, snapshotCallback, context) {\n    const idsToDeregister = [];\n    let callbackId;\n    if (snapshotCallback) {\n      if (snapshotCallback.__callbackIds) {\n        let i = 0;\n        while (i < snapshotCallback.__callbackIds.length) {\n          const id = snapshotCallback.__callbackIds[i];\n          const handle = this._callbacks[id];\n          if (!handle) {\n            snapshotCallback.__callbackIds.splice(i, 1);\n            continue;\n          }\n          if (handle.listenerKey === listenerKey && handle.eventType === eventType &&\n              handle.context === context) {\n            callbackId = id;\n            idsToDeregister.push(id);\n            snapshotCallback.__callbackIds.splice(i, 1);\n            break;\n          }\n          i += 1;\n        }\n      }\n      if (!callbackId) return;  // no-op, callback never registered or already deregistered\n    } else {\n      for (let id of Object.keys(this._callbacks)) {\n        const handle = this._callbacks[id];\n        if (handle.listenerKey === listenerKey && (!eventType || handle.eventType === eventType)) {\n          idsToDeregister.push(id);\n        }\n      }\n    }\n    // Nullify callbacks first, then deregister after off() is complete.  We don't want any\n    // callbacks in flight from the worker to be invoked while the off() is processing, but we don't\n    // want them to throw an exception either.\n    for (let id of idsToDeregister) this._nullifyCallback(id);\n    return this._send({msg: 'off', listenerKey, url, terms, eventType, callbackId}).then(() => {\n      for (let id of idsToDeregister) this._deregisterCallback(id);\n    });\n  }\n\n  _onCallback(handle, error, snapshotJson) {\n    if (handle.timeouts) {\n      for (let timeout of handle.timeouts) timeout.handleDone();\n    }\n    if (error) {\n      this._deregisterCallback(handle.id);\n      this._hydrateError(error, handle).then(error => {\n        if (handle.cancelCallback) handle.cancelCallback.call(handle.context, error);\n        this._emitError(error);\n      });\n    } else {\n      handle.snapshotCallback.call(handle.context, new Snapshot(snapshotJson));\n    }\n  }\n\n  once(url, terms, eventType, options) {\n    return this._send({msg: 'once', url, terms, eventType, options}).then(snapshotJson => {\n      return new Snapshot(snapshotJson);\n    });\n  }\n\n  transaction(url, updateFunction, options) {\n    let tries = 0;\n\n    const attemptTransaction = (oldValue, oldHash) => {\n      if (tries++ >= 25) return Promise.reject(new Error('maxretry'));\n      let newValue;\n      try {\n        newValue = updateFunction(oldValue);\n      } catch (e) {\n        return Promise.reject(e);\n      }\n      if (newValue === Firebase.ABORT_TRANSACTION_NOW ||\n          newValue === undefined && !options.safeAbort) {\n        return {committed: false, snapshot: new Snapshot({url, value: oldValue})};\n      }\n      return this._send({msg: 'transaction', url, oldHash, newValue, options}).then(result => {\n        if (result.stale) {\n          return attemptTransaction(result.value, result.hash);\n        } else {\n          return {committed: result.committed, snapshot: new Snapshot(result.snapshotJson)};\n        }\n      });\n    };\n\n    return attemptTransaction(null, null);\n  }\n\n  onDisconnect(url, method, value) {\n    return this._send({msg: 'onDisconnect', url, method, value});\n  }\n\n  bounceConnection() {\n    return this._send({msg: 'bounceConnection'});\n  }\n\n  callback({id, args}) {\n    const handle = this._callbacks[id];\n    if (!handle) throw new Error('Unregistered callback: ' + id);\n    handle.callback.apply(null, args);\n  }\n\n  _registerCallback(callback, handle) {\n    handle = handle || {};\n    handle.callback = callback;\n    handle.id = `cb${++this._idCounter}`;\n    this._callbacks[handle.id] = handle;\n    return handle.id;\n  }\n\n  _nullifyCallback(id) {\n    const handle = this._callbacks[id];\n    if (handle.timeouts) {\n      for (let timeout of handle.timeouts) timeout.handleDone();\n    }\n    this._callbacks[id].callback = noop;\n  }\n\n  _deregisterCallback(id) {\n    delete this._callbacks[id];\n  }\n\n  onError(callback) {\n    this._errorCallbacks.push(callback);\n    return callback;\n  }\n\n  offError(callback) {\n    var k = this._errorCallbacks.indexOf(callback);\n    if (k !== -1) this._errorCallbacks.splice(k, 1);\n  }\n\n  onSlow(operationKind, timeout, callback) {\n    const kinds = operationKind === 'all' ? Object.keys(this._slowCallbacks) : [operationKind];\n    for (let kind of kinds) this._slowCallbacks[kind].push({timeout, callback, count: 0});\n    return callback;\n  }\n\n  offSlow(operationKind, callback) {\n    const kinds = operationKind === 'all' ? Object.keys(this._slowCallbacks) : [operationKind];\n    for (let kind of kinds) {\n      const records = this._slowCallbacks[kind];\n      for (let i = 0; i < records.length; i++) {\n        if (records[i].callback === callback) {\n          records.splice(i, 1);\n          break;\n        }\n      }\n    }\n  }\n\n  trackSlowness(promise, operationKind) {\n    const records = this._slowCallbacks[operationKind];\n    if (!records.length) return promise;\n\n    const timeouts = records.map(record => new SlownessTracker(record));\n\n    function opDone() {\n      for (let timeout of timeouts) timeout.handleDone();\n    }\n\n    promise = promise.then(result => {\n      opDone();\n      return result;\n    }, error => {\n      opDone();\n      return Promise.reject(error);\n    });\n\n    return promise;\n  }\n\n  _errorFromJson(json) {\n    if (!json || json instanceof Error) return json;\n    const error = new Error(json.message);\n    for (let propertyName in json) {\n      if (propertyName === 'message' || !json.hasOwnProperty(propertyName)) continue;\n      try {\n        error[propertyName] = json[propertyName];\n      } catch (e) {\n        e.extra = {propertyName};\n        throw e;\n      }\n    }\n    return error;\n  }\n\n  _emitError(error) {\n    if (this._errorCallbacks.length) {\n      setTimeout(() => {\n        for (let callback of this._errorCallbacks) callback(error);\n      }, 0);\n    }\n  }\n\n}\n\n\nfunction noop() {}\n\nexport default Bridge;\n\n","'use strict';\n\nimport {unescapeKey} from './utils.js';\n\nimport _ from 'lodash';\n\n\nclass Query {\n  constructor(truss, path, terms) {\n    this._truss = truss;\n    this._path = path.replace(/^\\/?/, '/').replace(/\\/$/, '');\n    this._terms = terms;\n  }\n\n  get key() {\n    if (!this._key) this._key = unescapeKey(this._path.replace(/.*\\//, ''));\n    return this._key;\n  }\n  get path() {return this._path;}\n  get parent() {return new Reference(this._truss, this._path.replace(/\\/[^/]*$/, ''));}\n\n  get ready() {}  // TODO: implement\n  waitUntilReady() {}  // TODO: implement\n\n  get() {\n    // TODO: implement\n    if (this.ready) return Promise.resolve();\n    return trackSlowness(worker.once(this._url, this._terms, 'value'), 'read');\n  }\n\n  connect() {}  // TODO: implement\n  disconnect() {}  // TODO: implement\n\n  toString() {\n    let result = this._path;\n    if (this._terms) {\n      const queryTerms = this._terms.map(term => {\n        let queryTerm = term[0];\n        if (term.length > 1) {\n          queryTerm +=\n            '=' + encodeURIComponent(term.slice(1).map(x => JSON.stringify(x)).join(','));\n        }\n        return queryTerm;\n      });\n      queryTerms.sort();\n      result += '?' + queryTerms.join('&');\n    }\n    return result;\n  }\n\n  orderByChild(ref) {\n    if (ref._terms) {\n      throw new Error('orderByChild must be called with a reference, not a query: ' + ref);\n    }\n    let relativePath = ref.toString();\n    if (_.startsWith(relativePath, this._path)) {\n      relativePath = relativePath.slice(this._path.length);\n    }\n    const terms = this._terms ? this._terms.slice() : [];\n    terms.push(['orderByChild', relativePath]);\n    return new Query(this._truss, this._path, terms);\n  }\n}\n\n[\n  'orderByKey', 'orderByValue', 'startAt', 'endAt', 'equalTo', 'limitToFirst', 'limitToLast'\n].forEach(methodName => {\n  Query.prototype[methodName] = function() {\n    const term = Array.prototype.slice.call(arguments);\n    term.unshift(methodName);\n    const terms = this._terms ? this._terms.slice() : [];\n    terms.push(term);\n    return new Query(this._url, terms);\n  };\n});\n\n\n// jshint latedef:false\nclass Reference extends Query {\n// jshint latedef:nofunc\n\n  constructor(truss, path) {\n    super(truss, path);\n  }\n\n  child() {}  // TODO: implement\n  children() {}  // TODO: implement\n  set(value) {}  // TODO: implement\n  update(values) {}  // TODO: implement\n\n  commit(options, updateFunction) {\n    // TODO: revise\n    // const options = {\n    //   applyLocally: applyLocally === undefined ? updateFunction.applyLocally : applyLocally\n    // };\n    // ['nonsequential', 'safeAbort'].forEach(key => options[key] = updateFunction[key]);\n    for (let key in options) {\n      if (options.hasOwnProperty(key) && options[key] === undefined) {\n        options[key] = Truss.DefaultTransactionOptions[key];\n      }\n    }\n\n    // Hold the ref value live until transaction complete, otherwise it'll keep retrying on a null\n    // value.\n    this.on('value', noop);  // No error handling -- if this fails, so will the transaction.\n    return trackSlowness(\n      worker.transaction(this._url, updateFunction, options), 'write'\n    ).then(result => {\n      this.off('value', noop);\n      return result;\n    }, error => {\n      this.off('value', noop);\n      return Promise.reject(error);\n    });\n  }\n}\n\nexport default Reference;\n","// Generated by CoffeeScript 1.7.1\n(function() {\n  var getNanoSeconds, hrtime, loadTime;\n\n  if ((typeof performance !== \"undefined\" && performance !== null) && performance.now) {\n    module.exports = function() {\n      return performance.now();\n    };\n  } else if ((typeof process !== \"undefined\" && process !== null) && process.hrtime) {\n    module.exports = function() {\n      return (getNanoSeconds() - loadTime) / 1e6;\n    };\n    hrtime = process.hrtime;\n    getNanoSeconds = function() {\n      var hr;\n      hr = hrtime();\n      return hr[0] * 1e9 + hr[1];\n    };\n    loadTime = getNanoSeconds();\n  } else if (Date.now) {\n    module.exports = function() {\n      return Date.now() - loadTime;\n    };\n    loadTime = Date.now();\n  } else {\n    module.exports = function() {\n      return new Date().getTime() - loadTime;\n    };\n    loadTime = new Date().getTime();\n  }\n\n}).call(this);\n","'use strict';\n\nconst ALPHABET = '-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz';\n\nclass KeyGenerator {\n  constructor() {\n    this._lastUniqueKeyTime = 0;\n    this._lastRandomValues = [];\n  }\n\n  generateUniqueKey(now) {\n    now = now || Date.now();\n    const chars = new Array(20);\n    let prefix = now;\n    for (let i = 7; i >= 0; i--) {\n      chars[i] = ALPHABET.charAt(prefix & 0x3f);\n      prefix = Math.floor(prefix / 64);\n    }\n    if (now === this._lastUniqueKeyTime) {\n      let i = 11;\n      while (i >= 0 && this._lastRandomValues[i] === 63) {\n        this._lastRandomValues[i] = 0;\n        i -= 1;\n      }\n      if (i === -1) {\n        throw new Error('Internal assertion failure: ran out of unique IDs for this millisecond');\n      }\n      this._lastRandomValues[i] += 1;\n    } else {\n      this._lastUniqueKeyTime = now;\n      for (let i = 0; i < 12; i++) {\n        // Make sure to leave some space for incrementing in the top nibble.\n        this._lastRandomValues[i] = Math.floor(Math.random() * (i ? 64 : 16));\n      }\n    }\n    for (let i = 0; i < 12; i++) {\n      chars[i + 8] = ALPHABET[this._lastRandomValues[i]];\n    }\n    return chars.join('');\n  }\n}\n\nexport default KeyGenerator;\n","/* globals window */\n\nlet triggerAngularDigest;\n\nconst exports = {active: typeof window !== 'undefined' && window.angular};\nexport default exports;\n\nif (exports.active) {\n  window.angular.module('firetruss', []).run(\n    ['$rootScope', function($rootScope) {\n      triggerAngularDigest = $rootScope.$evalAsync.bind($rootScope);\n    }]\n  );\n  exports.defineModule = function(Truss) {\n    window.angular.module('firetruss').constant('Truss', Truss);\n  };\n} else {\n  exports.defineModule = function() {};\n}\n\nexports.digest = function() {\n  if (triggerAngularDigest) triggerAngularDigest();\n};\n","'use strict';\n\nimport Tree from './Tree.js';\nimport KeyGenerator from './KeyGenerator.js';\nimport Bridge from './Bridge.js';\nimport angularCompatibility from './angularCompatibility.js';\nimport {escapeKey, unescapeKey} from './utils.js';\n\nconst TIMESTAMP = Object.freeze({'.sv': 'timestamp'});\n\nlet bridge;\n\n\n// jshint latedef:false\nclass Truss {\n// jshint latedef:nofunc\n\n  /**\n   * Create a new Truss instance, specific to a given Firebase.  There should be exactly one Truss\n   * per root Firebase URL, so in most code this will be a singleton.\n   *\n   * @param rootUrl {String} The root URL, https://{project}.firebaseio.com.\n   * @param classes {Array<Function>} A list of the classes to map onto the datastore structure.\n   *    Each class must have a static $trussMount property that is a (wildcarded) datastore path, or\n   *    an options object {path: string, placeholder: object}, or an array of either.\n   */\n  constructor(rootUrl, classes) {\n    // TODO: allow rootUrl to be a test database object for testing\n    this._rootUrl = rootUrl.replace(/\\/$/, '');\n    this._keyGenerator = new KeyGenerator();\n    bridge.trackServer(this._rootUrl);\n    this._tree = new Tree(this, classes);\n    Object.defineProperty(this, 'root', {\n      value: this._vue.$data.$root, writable: false, configurable: false, enumerable: false\n    });\n    if (angularCompatibility.active) {\n      this._vue.$watch('$data', angularCompatibility.digest, {deep: true});\n    }\n  }\n\n  destroy() {\n    this.tree.destroy();\n  }\n\n  get now() {}\n  newKey() {return this._keyGenerator.generateUniqueKey(this.now);}\n\n  get user() {}\n  authenticate(token) {}\n  unauthenticate() {}\n\n  interceptConnections(/* {beforeConnect: beforeFn, afterDisconnect: afterFn, onError: errorFn} */) {}\n  interceptWrites(/* {beforeWrite: beforeFn, afterWrite: afterFn, onError: errorFn} */) {}\n  pull(scope, connections) {}  // returns readyPromise\n  bind(scope, connections) {}  // returns readyPromise\n  // connections are {key: Query | Array<Reference> | fn() -> (Query | Array<Reference>)}\n\n  static get computedPropertyStats() {return this._tree.computedPropertyStats;}\n\n  static connectWorker(webWorker) {\n    if (bridge) throw new Error('Worker already connected');\n    bridge = new Bridge(webWorker);\n    return bridge.init();\n  }\n\n  static preExpose(functionName) {\n    Truss.worker[functionName] = bridge.bindExposedFunction(functionName);\n  }\n\n  static goOnline() {\n    bridge.activate(true);\n  }\n\n  static goOffline() {\n    bridge.activate(false);\n  }\n\n  static escapeKey(key) {\n    return escapeKey(key);\n  }\n\n  static unescapeKey(escapedKey) {\n    return unescapeKey(escapedKey);\n  }\n\n  static get TIMESTAMP() {\n    return TIMESTAMP;\n  }\n}\n\n[\n  'onError', 'offError', 'onSlow', 'offSlow', 'bounceConnection', 'debugPermissionDeniedErrors'\n].forEach(methodName => {\n  Truss[methodName] = function() {return bridge[methodName].apply(bridge, arguments);};\n});\n\n\nTruss.DefaultTransactionOptions = Object.seal({\n  applyLocally: true, nonsequential: false, safeAbort: false\n});\nTruss.ABORT_TRANSACTION_NOW = Object.create(null);\nTruss.worker = {};\n\n\n\n\nfunction pathFromUrl(url) {\n  return url.replace(/^https?:\\/\\/[^/]+/, '');\n}\n\nfunction getUrlRoot(url) {\n  const k = url.indexOf('/', 8);\n  return k >= 8 ? url.slice(0, k) : url;\n}\n\nangularCompatibility.defineModule(Truss);\nexport default Truss;\n"]}