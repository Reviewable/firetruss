{"version":3,"sources":["../src/client/angularCompatibility.js","../src/client/utils.js","../src/client/Bridge.js","../src/client/Modeler.js","../src/client/Tree.js","../src/client/Reference.js","../src/client/Connector.js","../src/client/Dispatcher.js","../src/client/KeyGenerator.js","../src/client/MetaTree.js","../src/client/Coupler.js","../node_modules/performance-now/lib/performance-now.js","../src/client/Truss.js"],"names":["noop","escapeKey","key","toString","replace","char","charCodeAt","unescapeKey","code","String","fromCharCode","parseInt","slice","wrapPromiseCallback","callback","Promise","resolve","apply","this","arguments","e","reject","makePathMatcher","pattern","let","matcher","pathMatchers","PathMatcher","_","size","maxNumPathMatchers","keys","errorFromJson","json","params","Error","const","error","message","propertyName","hasOwnProperty","extra","getUrlRoot","url","k","indexOf","computeValue","prop","stats","$$touchThis","startTime","performanceNow","result","get","call","runtime","numRecomputes","isTrussValueEqual","a","b","$truss","throwReadOnlyError","joinPath","segments","i","list","length","segment","charAt","splice","push","join","checkUpdateHasOnlyDescendantsWithNoOverlap","rootPath","values","relativizePaths","each","path","startsWith","absolutePath","allPaths","map","sortBy","value","otherPath","toFirebaseJson","object","earlyDigestPending","bareDigest","angularProxy","active","window","angular","debounceDigest","wait","digest","debounce","forEach","method","module","run","$rootScope","$evalAsync","bind","defineModule","Truss","constant","SERVER_TIMESTAMP","Object","freeze",".sv","variables","pathTemplate","match","this$1","test","_regex","RegExp","_parentRegex","prototype","lastIndex","exec","bindings","testParent","bridge","Snapshot","ref","valueError","exists","_path","_value","_valueError","_exists","undefined","prototypeAccessors","_checkValue","_key","Bridge","webWorker","_idCounter","_deferreds","_suspended","_servers","_callbacks","_simulatedTokenGenerator","_maxSimulationDuration","_simulatedCallFilter","_inboundMessages","_outboundMessages","_flushMessageQueue","_port","port","_shared","onmessage","_receive","addEventListener","_send","msg","setInterval","init","items","storage","localStorage","sessionStorage","getItem","staticAccessors","instance","suspend","suspended","_receiveMessages","setImmediate","debugPermissionDeniedErrors","simulatedTokenGenerator","maxSimulationDuration","callFilter","id","promise","oneWay","deferred","sent","resolveSent","postMessage","event","concat","data","messages","fn","bindExposedFunction","name","args","Array","probeError","toLowerCase","_simulateCall","then","securityTrace","permissionDeniedDetails","props","simulatedCalls","spec","newValue","auth","getAuth","simulationPromise","uid","token","all","securityTraces","every","trace","filter","catch","timeoutPromise","setTimeout","race","updateLocalStorage","item","removeItem","setItem","trackServer","rootUrl","server","authListeners","authCallbackId","_registerCallback","_authCallback","callbackId","listener","onAuth","context","offAuth","authWithCustomToken","authToken","options","unauth","set","writeSerial","update","on","listenerKey","eventType","snapshotCallback","cancelCallback","handle","_onCallback","__callbackIds","off","idsToDeregister","_findAndRemoveCallbackId","i$1","list$1","_nullifyCallback","_deregisterCallback","snapshotJson","console","transaction","oldValue","relativeUpdates","onDisconnect","bounceConnection","predicate","EMPTY_ANNOTATIONS","Handle","tree","annotations","_tree","_annotations","$ref","_pathPrefix","parent","Reference","child","children","escapedKeys","arg","isArray","mapping","subPath","rest","subRef","peek","truss","isEqual","that","belongsTo","Query","super","_spec","_copyAndValidateSpec","prototypeAccessors$1","ready","isQueryReady","constraints","annotate","extend","by","JSON","stringify","some","clause","clone","childPath","_string","queryTerms","encodeURIComponent","prototypeAccessors$2","isReferenceReady","getObject","query","obj","commit","updateFunction","Connector","scope","connections","_scope","_connections","_method","_subConnectors","_currentDescriptors","_disconnects","_vue","Vue","mapValues","_linkScopeProperties","descriptor","isFunction","_bindComputedConnection","_connect","$on","$$id","destroy","_unlinkScopeProperties","_angularUnwatches","unwatch","_disconnect","duplicateKey","find","defineProperties","configurable","enumerable","$data","_updateComputedConnection","$watch","immediate","watch","newDescriptor","oldDescriptor","has","_updateConnections","updateFn","_updateScopeRef","connectReference","_updateScopeQuery","connectQuery","subScope","subConnector","subReady","delete","childKeys","changed","childKey","contains","split","root","INTERCEPT_KEYS","SlowHandle","operation","delay","_operation","_delay","_callback","_fired","initiate","cancel","elapsed","Date","now","_startTimestamp","_timeoutId","clearTimeout","Operation","type","target","_type","_target","_ready","_running","_slowHandles","running","_error","onSlow","_setRunning","_markReady","_clearReady","Dispatcher","_bridge","intercept","interceptKey","callbacks","badCallbackKeys","difference","wrappedCallbacks","onBefore","_addCallback","onAfter","onError","onFailure","_removeCallbacks","stage","_getCallbacksKey","wrappedCallback","_removeCallback","pull","_getCallbacks","operationType","execute","executor","createOperation","begin","executeWithRetries","_retryOrEnd","end","markReady","clearReady","retry","results","_afterEnd","onFailureCallbacks","ALPHABET","KeyGenerator","_lastUniqueKeyTime","_lastRandomValues","generateUniqueKey","chars","prefix","Math","floor","random","MetaTree","_rootUrl","$root","connected","timeOffset","user","userid","updateNowAtIntervals","intervalMillis","angularCompatibility","deep","trackAuth","_handleAuthChange","_connectInfoProperty","$destroy","property","attribute","propertyUrl","snap","QueryHandler","coupler","_coupler","_query","_listeners","_keys","_url","_segments","_listening","attach","keysCallback","_listen","detach","findIndex","_handleSnapshot","_handleError","sync","_decoupleSegments","updatedKeys","_updateKeys","_applySnapshot","_dispatcher","sort","_coupleSegments","hasKey","Node","operations","queryCount","listening","count","listen","skip","op","unlisten","_forAllDescendants","node","isTrunkCoupled","iteratee","collectCoupledDescendantPaths","paths","Coupler","dispatcher","applySnapshot","prunePath","_prunePath","queryHandlers","_root","_queryHandlers","queryHandler","couple","superseded","decouple","ancestors","coupledDescendantPaths","isEmpty","subscribe","unsubscribe","findCoupledDescendantPaths","isSubtreeReady","getNanoSeconds","hrtime","loadTime","performance","exports","process","hr","getTime","RESERVED_VALUE_PROPERTY_NAMES","$parent","$key","$path","computedPropertyStats","Value","defineProperty","$refs","$keys","$values","subjectFn","callbackFn","unwatchAndRemoveDestructor","$$finalizers","writable","$set","$update","$commit","ComputedPropertyStats","numUpdates","Modeler","classes","_mounts","uniq","Class","_mountClass","flatten","patterns","mount","badPaths","groupBy","group","compact","_augmentClass","computedProperties","proto","constructor","getOwnPropertyNames","getOwnPropertyDescriptor","fullName","getPrototypeOf","mounts","$trussMount","isString","variable","escapedKey","placeholder","createObject","properties","_buildComputedPropertyDescriptor","writeAllowed","firstCallback","$$initializers","vue","isPlaceholder","forEachPlaceholderChild","Transaction","currentValue","outcome","_outcome","_values","_setOutcome","abort","","Tree","_truss","_firebasePropertyEditAllowed","_writeSerial","_localWrites","_localWriteTimestamp","_integrateSnapshot","_prune","_modeler","_createObject","_completeCreateObject","_plantPlaceholders","valueCallback","_checkHandle","_disconnectReference","_disconnected","_disconnectQuery","numValues","_applyLocalWrite","_extractCommonPathPrefix","tries","attemptTransaction","txn","committed","offset","descendantPath","subValue","last","_plantValue","_scaffoldAncestors","prefixSegments","firstMismatchIndex","maxIndex","min","pathPrefix","_destroyObject","remoteWrite","dropRight","ancestorPath","isObject","_setFirebaseProperty","escapedChildKey","lockedDescendantPaths","_avoidLocalWritePaths","_pruneAncestors","_pruneDescendants","localWritePath","targetObject","deleted","ghostObjects","_holdsConcreteData","_deleteFirebaseProperty","coupledDescendantFound","valueLocked","shouldDelete","pathOrSegments","_getFirebasePropertyDescriptor","checkVueObject","workerFunctions","_keyGenerator","_metaTree","meta","newKey","authenticate","rememberMe","unauthenticate","actionType","connect","connector","numCallbacks","checkObjectsForRogueProperties","connectWorker","Worker","SharedWorker","exposedFunctionNames","firebaseSdkVersion","FIREBASE_SDK_VERSION","worker","preExpose","functionName","debounceAngularDigest"],"mappings":"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","file":"firetruss.min.js","sourcesContent":["/* globals window */\n\nimport _ from 'lodash';\n\n\nlet earlyDigestPending;\nlet bareDigest = function() {\n  earlyDigestPending = true;\n};\n\nconst angularProxy = {\n  active: typeof window !== 'undefined' && window.angular,\n  debounceDigest(wait) {\n    if (wait) {\n      angularProxy.digest = _.debounce(bareDigest, wait);\n    } else {\n      angularProxy.digest = bareDigest;\n    }\n  }\n};\n['digest', 'defineModule'].forEach(method => {angularProxy[method] = noop;});\n\nif (angularProxy.active) {\n  angularProxy.digest = bareDigest;\n  window.angular.module('firetruss', []).run(['$rootScope', function($rootScope) {\n    bareDigest = $rootScope.$evalAsync.bind($rootScope);\n    if (earlyDigestPending) bareDigest();\n  }]);\n  angularProxy.defineModule = function(Truss) {\n    window.angular.module('firetruss').constant('Truss', Truss);\n  };\n}\n\nfunction noop() {}\n\nexport default angularProxy;\n","import _ from 'lodash';\n\n\nexport const SERVER_TIMESTAMP = Object.freeze({'.sv': 'timestamp'});\n\nexport function escapeKey(key) {\n  if (!key) return key;\n  return key.toString().replace(/[\\\\\\.\\$\\#\\[\\]\\/]/g, function(char) {\n    return '\\\\' + char.charCodeAt(0).toString(16);\n  });\n}\n\nexport function unescapeKey(key) {\n  if (!key) return key;\n  return key.toString().replace(/\\\\[0-9a-f]{2}/gi, function(code) {\n    return String.fromCharCode(parseInt(code.slice(1), 16));\n  });\n}\n\nexport function wrapPromiseCallback(callback) {\n  return function() {\n    try {\n      return Promise.resolve(callback.apply(this, arguments));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n}\n\n\nconst pathMatchers = {};\nconst maxNumPathMatchers = 1000;\n\n\nclass PathMatcher {\n  constructor(pattern) {\n    this.variables = [];\n    const pathTemplate = pattern.replace(/\\/\\$[^\\/]+/g, match => {\n      this.variables.push(match.slice(1));\n      return '\\u0001';\n    });\n    Object.freeze(this.variables);\n    if (/[$-.?[-^{|}]/.test(pathTemplate)) {\n      throw new Error('Path pattern has unescaped keys: ' + pattern);\n    }\n    this._regex = new RegExp('^' + pathTemplate.replace(/\\u0001/g, '/([^/]+)') + '$');\n    this._parentRegex = new RegExp(\n      '^' + (pathTemplate.replace(/\\/[^/]*$/, '').replace(/\\u0001/g, '/([^/]+)') || '/') + '$');\n  }\n\n  match(path) {\n    this._regex.lastIndex = 0;\n    const match = this._regex.exec(path);\n    if (!match) return;\n    const bindings = {};\n    for (let i = 0; i < this.variables.length; i++) {\n      bindings[this.variables[i]] = unescapeKey(match[i + 1]);\n    }\n    return bindings;\n  }\n\n  test(path) {\n    return this._regex.test(path);\n  }\n\n  testParent(path) {\n    return this._parentRegex.test(path);\n  }\n\n  toString() {\n    return this._regex.toString();\n  }\n}\n\n\nexport function makePathMatcher(pattern) {\n  let matcher = pathMatchers[pattern];\n  if (!matcher) {\n    matcher = new PathMatcher(pattern);\n    // Minimal pseudo-LRU behavior, since we don't expect to actually fill up the cache.\n    if (_.size(pathMatchers) === maxNumPathMatchers) delete pathMatchers[_.keys(pathMatchers)[0]];\n    pathMatchers[pattern] = matcher;\n  }\n  return matcher;\n}\n","/* global setImmediate */\n\nimport {unescapeKey} from './utils.js';\n\n// jshint browser:true\n\nlet bridge;\n\n\nclass Snapshot {\n  constructor({path, value, valueError, exists}) {\n    this._path = path;\n    this._value = value;\n    this._valueError = errorFromJson(valueError);\n    this._exists = value === undefined ? exists || false : value !== null;\n  }\n\n  get path() {\n    return this._path;\n  }\n\n  get exists() {\n    return this._exists;\n  }\n\n  get value() {\n    this._checkValue();\n    return this._value;\n  }\n\n  get key() {\n    if (this._key === undefined) this._key = unescapeKey(this._path.replace(/.*\\//, ''));\n    return this._key;\n  }\n\n  _checkValue() {\n    if (this._valueError) throw this._valueError;\n    if (this._value === undefined) throw new Error('Value omitted from snapshot');\n  }\n}\n\n\nexport default class Bridge {\n  constructor(webWorker) {\n    this._idCounter = 0;\n    this._deferreds = {};\n    this._suspended = false;\n    this._servers = {};\n    this._callbacks = {};\n    this._simulatedTokenGenerator = null;\n    this._maxSimulationDuration = 5000;\n    this._simulatedCallFilter = null;\n    this._inboundMessages = [];\n    this._outboundMessages = [];\n    this._flushMessageQueue = this._flushMessageQueue.bind(this);\n    this._port = webWorker.port || webWorker;\n    this._shared = !!webWorker.port;\n    this._port.onmessage = this._receive.bind(this);\n    window.addEventListener('unload', () => {this._send({msg: 'destroy'});});\n    setInterval(() => {this._send({msg: 'ping'});}, 60 * 1000);\n  }\n\n  static init(webWorker) {\n    const items = [];\n    try {\n      const storage = window.localStorage || window.sessionStorage;\n      if (!storage) return;\n      for (let i = 0; i < storage.length; i++) {\n        const key = storage.key(i);\n        items.push({key, value: storage.getItem(key)});\n      }\n    } catch (e) {\n      // Some browsers don't like us accessing local storage -- nothing we can do.\n    }\n    return this._send({msg: 'init', storage: items});\n  }\n\n  static get instance() {\n    if (!bridge) throw new Error('No web worker connected, please call Truss.connectWorker first');\n    return bridge;\n  }\n\n  suspend(suspended) {\n    if (suspended === undefined) suspended = true;\n    if (this._suspended === suspended) return;\n    this._suspended = suspended;\n    if (!suspended) {\n      this._receiveMessages(this._inboundMessages);\n      this._inboundMessages = [];\n      if (this._outboundMessages.length) setImmediate(this._flushMessageQueue);\n    }\n  }\n\n  debugPermissionDeniedErrors(simulatedTokenGenerator, maxSimulationDuration, callFilter) {\n    this._simulatedTokenGenerator = simulatedTokenGenerator;\n    if (maxSimulationDuration !== undefined) this._maxSimulationDuration = maxSimulationDuration;\n    this._simulatedCallFilter = callFilter || function() {return true;};\n  }\n\n  _send(message) {\n    message.id = ++this._idCounter;\n    let promise;\n    if (message.oneWay) {\n      promise = Promise.resolve();\n    } else {\n      promise = new Promise((resolve, reject) => {\n        this._deferreds[message.id] = {resolve, reject};\n      });\n      const deferred = this._deferreds[message.id];\n      deferred.promise = promise;\n      promise.sent = new Promise(resolve => {\n        deferred.resolveSent = resolve;\n      });\n      deferred.params = message;\n    }\n    if (!this._outboundMessages.length && !this._suspended) setImmediate(this._flushMessageQueue);\n    this._outboundMessages.push(message);\n    return promise;\n  }\n\n  _flushMessageQueue() {\n    this._port.postMessage(this._outboundMessages);\n    this._outboundMessages = [];\n  }\n\n  _receive(event) {\n    if (this._suspended) {\n      this._inboundMessages = this._inboundMessages.concat(event.data);\n    } else {\n      this._receiveMessages(event.data);\n    }\n  }\n\n  _receiveMessages(messages) {\n    for (let message of messages) {\n      const fn = this[message.msg];\n      if (typeof fn !== 'function') throw new Error('Unknown message: ' + message.msg);\n      fn.call(this, message);\n    }\n  }\n\n  bindExposedFunction(name) {\n    return (function() {\n      return this._send({msg: 'call', name, args: Array.prototype.slice.call(arguments)});\n    }).bind(this);\n  }\n\n  resolve(message) {\n    const deferred = this._deferreds[message.id];\n    if (!deferred) throw new Error('Received resolution to inexistent Firebase call');\n    delete this._deferreds[message.id];\n    deferred.resolve(message.result);\n  }\n\n  reject(message) {\n    const deferred = this._deferreds[message.id];\n    if (!deferred) throw new Error('Received rejection of inexistent Firebase call');\n    delete this._deferreds[message.id];\n    deferred.reject(errorFromJson(message.error, deferred.params));\n  }\n\n  probeError(error) {\n    const code = error.code || error.message;\n    if (error.params && code && code.toLowerCase() === 'permission_denied') {\n      return this._simulateCall(error.params).then(securityTrace => {\n        if (securityTrace) error.permissionDeniedDetails = securityTrace;\n      });\n    } else {\n      return Promise.resolve();\n    }\n  }\n\n  _simulateCall(props) {\n    if (!(this._simulatedTokenGenerator && this._maxSimulationDuration > 0)) {\n      return Promise.resolve();\n    }\n    let simulatedCalls = [];\n    switch (props.msg) {\n      case 'set':\n        simulatedCalls.push({method: 'set', url: props.url, args: [props.value]});\n        break;\n      case 'update':\n        simulatedCalls.push({method: 'update', url: props.url, args: [props.value]});\n        break;\n      case 'on':\n        simulatedCalls.push({method: 'once', url: props.url, spec: props.spec, args: ['value']});\n        break;\n      case 'transaction':\n        simulatedCalls.push({method: 'once', url: props.url, args: ['value']});\n        simulatedCalls.push({method: 'set', url: props.url, args: [props.newValue]});\n        break;\n    }\n    if (!simulatedCalls.length || !this._simulatedCallFilter(props.msg, props.url)) {\n      return Promise.resolve();\n    }\n    const auth = this.getAuth(getUrlRoot(props.url));\n    const simulationPromise = this._simulatedTokenGenerator(auth && auth.uid).then(token => {\n      return Promise.all(simulatedCalls.map(message => {\n        message.msg = 'simulate';\n        message.token = token;\n        return this._send(message);\n      }));\n    }).then(securityTraces => {\n      if (securityTraces.every(trace => trace === null)) {\n        return 'Unable to reproduce error in simulation';\n      }\n      return securityTraces.filter(trace => trace).join('\\n\\n');\n    }).catch(e => {\n      return 'Error running simulation: ' + e;\n    });\n    const timeoutPromise = new Promise(resolve => {\n      setTimeout(resolve.bind(null, 'Simulated call timed out'), this._maxSimulationDuration);\n    });\n    return Promise.race([simulationPromise, timeoutPromise]);\n  }\n\n  updateLocalStorage(items) {\n    try {\n      const storage = window.localStorage || window.sessionStorage;\n      for (let item in items) {\n        if (item.value === null) {\n          storage.removeItem(item.key);\n        } else {\n          storage.setItem(item.key, item.value);\n        }\n      }\n    } catch (e) {\n      // If we're denied access, there's nothing we can do.\n    }\n  }\n\n  trackServer(rootUrl) {\n    if (this._servers.hasOwnProperty(rootUrl)) return;\n    const server = this._servers[rootUrl] = {authListeners: []};\n    const authCallbackId = this._registerCallback(this._authCallback.bind(this, server));\n    this._send({msg: 'onAuth', url: rootUrl, callbackId: authCallbackId});\n  }\n\n  _authCallback(server, auth) {\n    server.auth = auth;\n    for (let listener of server.authListeners) listener(auth);\n  }\n\n  onAuth(rootUrl, callback, context) {\n    const listener = callback.bind(context);\n    listener.callback = callback;\n    listener.context = context;\n    this._servers[rootUrl].authListeners.push(listener);\n    listener(this.getAuth(rootUrl));\n  }\n\n  offAuth(rootUrl, callback, context) {\n    const authListeners = this._servers[rootUrl].authListeners;\n    for (let i = 0; i < authListeners.length; i++) {\n      const listener = authListeners[i];\n      if (listener.callback === callback && listener.context === context) {\n        authListeners.splice(i, 1);\n        break;\n      }\n    }\n  }\n\n  getAuth(rootUrl) {\n    return this._servers[rootUrl].auth;\n  }\n\n  authWithCustomToken(url, authToken, options) {\n    return this._send({msg: 'authWithCustomToken', url, authToken, options});\n  }\n\n  unauth(url) {\n    return this._send({msg: 'unauth', url});\n  }\n\n  set(url, value, writeSerial) {return this._send({msg: 'set', url, value, writeSerial});}\n  update(url, value, writeSerial) {return this._send({msg: 'update', url, value, writeSerial});}\n\n  on(listenerKey, url, spec, eventType, snapshotCallback, cancelCallback, context, options) {\n    const handle = {\n      listenerKey, eventType, snapshotCallback, cancelCallback, context,\n      params: {msg: 'on', listenerKey, url, spec, eventType, options}\n    };\n    const callback = this._onCallback.bind(this, handle);\n    this._registerCallback(callback, handle);\n    // Keep multiple IDs to allow the same snapshotCallback to be reused.\n    snapshotCallback.__callbackIds = snapshotCallback.__callbackIds || [];\n    snapshotCallback.__callbackIds.push(handle.id);\n    this._send({\n      msg: 'on', listenerKey, url, spec, eventType, callbackId: handle.id, options\n    }).catch(error => {\n      callback(error);\n    });\n  }\n\n  off(listenerKey, url, spec, eventType, snapshotCallback, context) {\n    const idsToDeregister = [];\n    let callbackId;\n    if (snapshotCallback) {\n      callbackId = this._findAndRemoveCallbackId(\n        snapshotCallback,\n        handle =>\n          handle.listenerKey === listenerKey && handle.eventType === eventType &&\n          handle.context === context\n      );\n      if (!callbackId) return Promise.resolve();  // no-op, never registered or already deregistered\n      idsToDeregister.push(callbackId);\n    } else {\n      for (let id of Object.keys(this._callbacks)) {\n        const handle = this._callbacks[id];\n        if (handle.listenerKey === listenerKey && (!eventType || handle.eventType === eventType)) {\n          idsToDeregister.push(id);\n        }\n      }\n    }\n    // Nullify callbacks first, then deregister after off() is complete.  We don't want any\n    // callbacks in flight from the worker to be invoked while the off() is processing, but we don't\n    // want them to throw an exception either.\n    for (let id of idsToDeregister) this._nullifyCallback(id);\n    return this._send({msg: 'off', listenerKey, url, spec, eventType, callbackId}).then(() => {\n      for (let id of idsToDeregister) this._deregisterCallback(id);\n    });\n  }\n\n  _onCallback(handle, error, snapshotJson) {\n    if (error) {\n      this._deregisterCallback(handle.id);\n      const e = errorFromJson(error, handle.params);\n      if (handle.cancelCallback) {\n        handle.cancelCallback.call(handle.context, e);\n      } else {\n        console.error(e);\n      }\n    } else {\n      handle.snapshotCallback.call(handle.context, new Snapshot(snapshotJson));\n    }\n  }\n\n  transaction(url, oldValue, relativeUpdates) {\n    return this._send({msg: 'transaction', url, oldValue, relativeUpdates});\n  }\n\n  onDisconnect(url, method, value) {\n    return this._send({msg: 'onDisconnect', url, method, value});\n  }\n\n  bounceConnection() {\n    return this._send({msg: 'bounceConnection'});\n  }\n\n  callback({id, args}) {\n    const handle = this._callbacks[id];\n    if (!handle) throw new Error('Unregistered callback: ' + id);\n    handle.callback.apply(null, args);\n  }\n\n  _registerCallback(callback, handle) {\n    handle = handle || {};\n    handle.callback = callback;\n    handle.id = `cb${++this._idCounter}`;\n    this._callbacks[handle.id] = handle;\n    return handle.id;\n  }\n\n  _nullifyCallback(id) {\n    this._callbacks[id].callback = noop;\n  }\n\n  _deregisterCallback(id) {\n    delete this._callbacks[id];\n  }\n\n  _findAndRemoveCallbackId(callback, predicate) {\n    if (!callback.__callbackIds) return;\n    let i = 0;\n    while (i < callback.__callbackIds.length) {\n      const id = callback.__callbackIds[i];\n      const handle = this._callbacks[id];\n      if (!handle) {\n        callback.__callbackIds.splice(i, 1);\n        continue;\n      }\n      if (predicate(handle)) {\n        callback.__callbackIds.splice(i, 1);\n        return id;\n      }\n      i += 1;\n    }\n  }\n}\n\n\nfunction noop() {}\n\nfunction errorFromJson(json, params) {\n  if (!json || json instanceof Error) return json;\n  const error = new Error(json.message);\n  error.params = params;\n  for (let propertyName in json) {\n    if (propertyName === 'message' || !json.hasOwnProperty(propertyName)) continue;\n    try {\n      error[propertyName] = json[propertyName];\n    } catch (e) {\n      e.extra = {propertyName};\n      throw e;\n    }\n  }\n  return error;\n}\n\nfunction getUrlRoot(url) {\n  const k = url.indexOf('/', 8);\n  return k >= 8 ? url.slice(0, k) : url;\n}\n","import Reference from './Reference.js';\nimport {makePathMatcher} from './utils.js';\n\nimport _ from 'lodash';\nimport performanceNow from 'performance-now';\n\n// These are defined separately for each object so they're not included in Value below.\nconst RESERVED_VALUE_PROPERTY_NAMES = {$truss: true, $parent: true, $key: true, $path: true};\n\nconst computedPropertyStats = {};\n\n\nclass Value {\n  get $ref() {\n    Object.defineProperty(this, '$ref', {value: new Reference(this.$truss._tree, this.$path)});\n  }\n  get $refs() {return [this.$ref];}\n  get $keys() {return _.keys(this);}\n  get $values() {return _.values(this);}\n  get $root() {return this.$truss.root;}  // access indirectly to leave dependency trace\n\n  $watch(subjectFn, callbackFn) {\n    let unwatchAndRemoveDestructor;\n\n    const unwatch = this.$truss.watch(() => {\n      this.$$touchThis();\n      return subjectFn.call(this);\n    }, callbackFn.bind(this));\n\n    if (!this.$$finalizers) {\n      Object.defineProperty(this, '$$finalizers', {\n        value: [], writable: false, enumerable: false, configurable: false});\n    }\n    unwatchAndRemoveDestructor = () => {\n      unwatch();\n      _.pull(this.$$finalizers, unwatchAndRemoveDestructor);\n    };\n    this.$$finalizers.push(unwatchAndRemoveDestructor);\n    return unwatchAndRemoveDestructor;\n  }\n\n  $set(value) {return this.$ref.set(value);}\n  $update(values) {return this.$ref.update(values);}\n  $commit(options, updateFn) {return this.$ref.commit(options, updateFn);}\n  // TODO\n  // $temporarilyOverride(updateFn)\n  // $onPropertyChange(method)\n  // $freezeProperty\n}\n\nclass ComputedPropertyStats {\n  constructor(name) {\n    _.extend(this, {name, numRecomputes: 0, numUpdates: 0, runtime: 0});\n  }\n}\n\n\nexport default class Modeler {\n  constructor(classes) {\n    this._mounts = _(classes).uniq().map(Class => this._mountClass(Class)).flatten().value();\n    const patterns = _.map(this._mounts, mount => mount.matcher.toString());\n    if (patterns.length !== _.uniq(patterns).length) {\n      const badPaths = _(patterns)\n        .groupBy()\n        .map((group, key) =>\n          group.length === 1 ? null : key.replace(/\\(\\[\\^\\/\\]\\+\\)/g, '$').slice(1, -1))\n        .compact()\n        .value();\n      throw new Error('Paths have multiple mounted classes: ' + badPaths.join(', '));\n    }\n  }\n\n  destroy() {\n  }\n\n  _augmentClass(Class) {\n    let computedProperties;\n    let proto = Class.prototype;\n    while (proto && proto.constructor !== Object) {\n      for (let name of Object.getOwnPropertyNames(proto)) {\n        const descriptor = Object.getOwnPropertyDescriptor(proto, name);\n        if (name.charAt(0) === '$') {\n          if (_.isEqual(descriptor, Object.getOwnPropertyDescriptor(Value.prototype, name))) {\n            continue;\n          }\n          throw new Error(`Property names starting with \"$\" are reserved: ${Class.name}.${name}`);\n        }\n        if (descriptor.set) {\n          throw new Error(`Computed properties must not have a setter: ${Class.name}.${name}`);\n        }\n        if (descriptor.get && !(computedProperties && computedProperties[name])) {\n          (computedProperties || (computedProperties = {}))[name] = {\n            name, fullName: `${proto.constructor.name}.${name}`, get: descriptor.get\n          };\n        }\n      }\n      proto = Object.getPrototypeOf(proto);\n    }\n    for (let name of Object.getOwnPropertyNames(Value.prototype)) {\n      if (name === 'constructor' || Class.prototype.hasOwnProperty(name)) continue;\n      Object.defineProperty(\n        Class.prototype, name, Object.getOwnPropertyDescriptor(Value.prototype, name));\n    }\n    return computedProperties;\n  }\n\n  _mountClass(Class) {\n    const computedProperties = this._augmentClass(Class);\n    let mounts = Class.$trussMount;\n    if (!mounts) throw new Error(`Class ${Class.name} lacks a $trussMount static property`);\n    if (!_.isArray(mounts)) mounts = [mounts];\n    return _.map(mounts, mount => {\n      if (_.isString(mount)) mount = {path: mount};\n      const matcher = makePathMatcher(mount.path);\n      for (let variable of matcher.variables) {\n        if (variable === '$' || variable.charAt(1) === '$') {\n          throw new Error(`Invalid variable name: ${variable}`);\n        }\n        if (variable.charAt(0) === '$' && (\n            _.has(Value.prototype, variable) || RESERVED_VALUE_PROPERTY_NAMES[variable]\n        )) {\n          throw new Error(`Variable name conflicts with built-in property or method: ${variable}`);\n        }\n      }\n      const escapedKey = mount.path.match(/\\/([^/]*)$/)[1];\n      if (mount.placeholder && escapedKey.charAt(0) === '$') {\n        throw new Error(\n          `Class ${Class.name} mounted at wildcard ${escapedKey} cannot be a placeholder`);\n      }\n      return {Class, matcher, computedProperties, escapedKey, placeholder: mount.placeholder};\n    });\n  }\n\n  /**\n   * Creates a Truss object and sets all its basic properties: path segment variables, user-defined\n   * properties, and computed properties.  The latter two will be enumerable so that Vue will pick\n   * them up and make the reactive, so you should call _completeCreateObject once it's done so and\n   * before any Firebase properties are added.\n   */\n  createObject(path, properties) {\n    let Class = Value;\n    let computedProperties;\n    for (let mount of this._mounts) {\n      const match = mount.matcher.match(path);\n      if (match) {\n        Class = mount.Class;\n        computedProperties = mount.computedProperties;\n        for (let variable in match) {\n          properties[variable] = {\n            value: match[variable], writable: false, configurable: false, enumerable: false\n          };\n        }\n        break;\n      }\n    }\n\n    const object = new Class();\n\n    if (computedProperties) {\n      _.each(computedProperties, prop => {\n        properties[prop.name] = this._buildComputedPropertyDescriptor(object, prop);\n      });\n    }\n\n    return object;\n  }\n\n  _buildComputedPropertyDescriptor(object, prop) {\n    if (!computedPropertyStats[prop.fullName]) {\n      Object.defineProperty(computedPropertyStats, prop.fullName, {\n        value: new ComputedPropertyStats(prop.fullName), writable: false, enumerable: true,\n        configurable: false\n      });\n    }\n    const stats = computedPropertyStats[prop.fullName];\n\n    let value;\n    let writeAllowed = false;\n    let firstCallback = true;\n\n    if (!object.$$finalizers) {\n      Object.defineProperty(object, '$$finalizers', {\n        value: [], writable: false, enumerable: false, configurable: false});\n    }\n    if (!object.$$initializers) {\n      Object.defineProperty(object, '$$initializers', {\n        value: [], writable: false, enumerable: false, configurable: true});\n    }\n    object.$$initializers.push(vue => {\n      object.$$finalizers.push(\n        vue.$watch(computeValue.bind(object, prop, stats), newValue => {\n          if (firstCallback) {\n            stats.numUpdates += 1;\n            value = newValue;\n            firstCallback = false;\n          } else {\n            if (_.isEqual(value, newValue, isTrussValueEqual)) return;\n            stats.numUpdates += 1;\n            writeAllowed = true;\n            object[prop.name] = newValue;\n            writeAllowed = false;\n          }\n        }, {immediate: true})  // use immediate:true since watcher will run computeValue anyway\n      );\n    });\n    return {\n      enumerable: true, configurable: true,\n      get: function() {return value;},\n      set: function(newValue) {\n        if (!writeAllowed) throw new Error(`You cannot set a computed property: ${prop.name}`);\n        value = newValue;\n      }\n    };\n  }\n\n  isPlaceholder(path) {\n    // TODO: optimize by precomputing a single all-placeholder-paths regex\n    return _.some(this._mounts, mount => mount.placeholder && mount.matcher.test(path));\n  }\n\n  forEachPlaceholderChild(path, iteratee) {\n    _.each(this._mounts, mount => {\n      if (mount.placeholder && mount.matcher.testParent(path)) {\n        iteratee(mount.escapedKey, mount.placeholder);\n      }\n    });\n  }\n\n  static get computedPropertyStats() {\n    return computedPropertyStats;\n  }\n}\n\n\nfunction computeValue(prop, stats) {\n  // jshint validthis: true\n  // Touch this object, since a failed access to a missing property doesn't get captured as a\n  // dependency.\n  this.$$touchThis();\n\n  const startTime = performanceNow();\n  const result = prop.get.call(this);\n  stats.runtime += performanceNow() - startTime;\n  stats.numRecomputes += 1;\n  return result;\n  // jshint validthis: false\n}\n\nfunction isTrussValueEqual(a, b) {\n  if (a && a.$truss || b && b.$truss) return a === b;\n}\n","import angularCompatibility from './angularCompatibility.js';\nimport Coupler from './Coupler.js';\nimport Modeler from './Modeler.js';\nimport {escapeKey, unescapeKey, SERVER_TIMESTAMP} from './utils.js';\n\nimport _ from 'lodash';\nimport Vue from 'vue';\n\n\nclass Transaction {\n  constructor(path, tree) {\n    this._path = path;\n    this._tree = tree;\n  }\n\n  get currentValue() {return this._tree.getObject(this._path);}\n  get outcome() {return this._outcome;}\n  get values() {return this._values;}\n\n  _setOutcome(value) {\n    if (this._outcome) throw new Error('Transaction already resolved with ' + this._outcome);\n    this._outcome = value;\n  }\n\n  abort() {\n    this._setOutcome('abort');\n  }\n\n  cancel() {\n    this._setOutcome('cancel');\n  }\n\n  set(value) {\n    if (value === undefined) throw new Error('Invalid argument: undefined');\n    this._setOutcome('set');\n    this._values = {'': value};\n  }\n\n  update(values) {\n    if (values === undefined) throw new Error('Invalid argument: undefined');\n    if (_.isEmpty(values)) return this.cancel();\n    this._setOutcome('update');\n    this._values = values;\n  }\n}\n\n\nexport default class Tree {\n  constructor(truss, rootUrl, bridge, dispatcher, classes) {\n    this._truss = truss;\n    this._rootUrl = rootUrl;\n    this._bridge = bridge;\n    this._dispatcher = dispatcher;\n    this._firebasePropertyEditAllowed = false;\n    this._writeSerial = 0;\n    this._localWrites = {};\n    this._localWriteTimestamp = null;\n    this._coupler = new Coupler(\n      rootUrl, bridge, dispatcher, this._integrateSnapshot.bind(this), this._prune.bind(this));\n    this._vue = new Vue({data: {$root: undefined}});\n    if (angularCompatibility.active) {\n      this._vue.$watch('$data', angularCompatibility.digest, {deep: true});\n    }\n    this._modeler = new Modeler(classes);\n    this._vue.$data.$root = this._createObject('/', '');\n    this._completeCreateObject(this.root);\n    this._plantPlaceholders(this.root, '/');\n  }\n\n  get root() {\n    return this._vue.$data.$root;\n  }\n\n  get truss() {\n    return this._truss;\n  }\n\n  destroy() {\n    this._coupler.destroy();\n    this._modeler.destroy();\n    this._vue.$destroy();\n  }\n\n  connectReference(ref, valueCallback, method) {\n    this._checkHandle(ref);\n    const operation = this._dispatcher.createOperation('read', method, ref);\n    let unwatch;\n    if (valueCallback) {\n      const segments = _(ref.path).split('/').map(segment => unescapeKey(segment)).value();\n      unwatch = this._vue.$watch(this.getObject.bind(segments), valueCallback);\n    }\n    operation._disconnect = this._disconnectReference.bind(this, ref, operation, unwatch);\n    this._dispatcher.begin(operation).then(() => {\n      if (operation.running) this._coupler.couple(ref.path, operation);\n    }).catch(e => {});  // ignore exception, let onFailure handlers deal with it\n    return operation._disconnect;\n  }\n\n  _disconnectReference(ref, operation, unwatch, error) {\n    if (operation._disconnected) return;\n    operation._disconnected = true;\n    if (unwatch) unwatch();\n    this._coupler.decouple(ref.path, operation);  // will call back to _prune if necessary\n    this._dispatcher.end(operation, error).catch(e => {});\n  }\n\n  isReferenceReady(ref) {\n    this._checkHandle(ref);\n    return this._coupler.isSubtreeReady(ref.path);\n  }\n\n  connectQuery(query, keysCallback, method) {\n    this._checkHandle(query);\n    const operation = this._dispatcher.createOperation('read', method, query);\n    operation._disconnect = this._disconnectQuery.bind(this, query, operation);\n    this._dispatcher.begin(operation).then(() => {\n      if (operation.running) this._coupler.subscribe(query, operation, keysCallback);\n    }).catch(e => {});  // ignore exception, let onFailure handlers deal with it\n    return operation._disconnect;\n  }\n\n  _disconnectQuery(query, operation, error) {\n    if (operation._disconnected) return;\n    operation._disconnected = true;\n    this._coupler.unsubscribe(query, operation);  // will call back to _prune if necessary\n    this._dispatcher.end(operation, error).catch(e => {});\n  }\n\n  isQueryReady(query) {\n    return this._coupler.isQueryReady(query);\n  }\n\n  _checkHandle(handle) {\n    if (!handle.belongsTo(this._truss)) {\n      throw new Error('Reference belongs to another Truss instance');\n    }\n  }\n\n  update(ref, method, values) {\n    const numValues = _.size(values);\n    if (!numValues) return;\n    if (method === 'update') checkUpdateHasOnlyDescendantsWithNoOverlap(ref.path, values);\n    this._applyLocalWrite(values);\n    const url = this.rootUrl + this._extractCommonPathPrefix(values);\n    return this._dispatcher.execute('write', method, ref, () => {\n      if (numValues === 1) {\n        return this._bridge.set(url, values[''], this._writeSerial);\n      } else {\n        return this._bridge.update(url, values, this._writeSerial);\n      }\n    });\n  }\n\n  commit(ref, updateFunction) {\n    let tries = 0;\n\n    const attemptTransaction = () => {\n      if (tries++ >= 25) return Promise.reject(new Error('maxretry'));\n      const txn = new Transaction();\n      try {\n        updateFunction(txn);\n      } catch (e) {\n        return Promise.reject(e);\n      }\n      const oldValue = toFirebaseJson(this.getObject(ref.path));\n      switch (txn.outcome) {\n        case 'abort': return;\n        case 'cancel':\n          break;\n        case 'set':\n          this._applyLocalWrite({[ref.path]: txn.values['']});\n          break;\n        case 'update':\n          checkUpdateHasOnlyDescendantsWithNoOverlap(ref.path, txn.values, true);\n          this._applyLocalWrite(txn.values);\n          break;\n        default:\n          throw new Error('Invalid transaction outcome: ' + (txn.outcome || 'none'));\n      }\n      return this._bridge.transaction(\n        this._rootUrl + ref.path, oldValue, txn.values\n      ).then(committed => {\n        if (!committed) return attemptTransaction();\n        return txn;\n      });\n    };\n\n    return this._truss.peek(ref, () => {\n      return this._dispatcher.execute('write', 'commit', ref, attemptTransaction);\n    });\n  }\n\n  _applyLocalWrite(values) {\n    // TODO: correctly apply local writes that impact queries.  Currently, a local write will update\n    // any objects currently selected by a query, but won't add or remove results.\n    this._writeSerial++;\n    this._localWriteTimestamp = this._truss.now();\n    _.each(values, (value, path) => {\n      const coupledDescendantPaths = this._coupler.findCoupledDescendantPaths(path);\n      if (_.isEmpty(coupledDescendantPaths)) return;\n      const offset = (path === '/' ? 0 : path.length) + 1;\n      for (let descendantPath of coupledDescendantPaths) {\n        const subPath = descendantPath.slice(offset);\n        let subValue = value;\n        if (subPath) {\n          const segments = subPath.split('/');\n          for (let segment of segments) {\n            subValue = subValue[unescapeKey(segment)];\n            if (subValue === undefined) break;\n          }\n        }\n        if (subValue === undefined || subValue === null) {\n          this._prune(subPath);\n        } else {\n          const key = unescapeKey(_.last(descendantPath.split('/')));\n          this._plantValue(descendantPath, key, subValue, this._scaffoldAncestors(descendantPath));\n        }\n        this._localWrites[descendantPath] = this._writeSerial;\n      }\n    });\n  }\n\n  _extractCommonPathPrefix(values) {\n    let prefixSegments;\n    _.each(values, (value, path) => {\n      const segments = path === '/' ? [] : path.split('/');\n      if (prefixSegments) {\n        let firstMismatchIndex = 0;\n        const maxIndex = Math.min(prefixSegments.length, segments.length);\n        while (firstMismatchIndex < maxIndex &&\n               prefixSegments[firstMismatchIndex] === segments[firstMismatchIndex]) {\n          firstMismatchIndex++;\n        }\n        prefixSegments = prefixSegments.slice(0, firstMismatchIndex);\n        if (!prefixSegments.length) return false;\n      } else {\n        prefixSegments = segments;\n      }\n    });\n    const pathPrefix = '/' + prefixSegments.join('/');\n    _.each(_.keys(values), key => {\n      values[key.slice(pathPrefix.length + 1)] = values[key];\n      delete values[key];\n    });\n    return pathPrefix;\n  }\n\n  /**\n   * Creates a Truss object and sets all its basic properties: path segment variables, user-defined\n   * properties, and computed properties.  The latter two will be enumerable so that Vue will pick\n   * them up and make the reactive, so you should call _completeCreateObject once it's done so and\n   * before any Firebase properties are added.\n   */\n  _createObject(path, key, parent) {\n    if (parent && _.has(parent, key)) throw new Error(`Duplicate object created for ${path}`);\n    let properties = {\n      $truss: {value: this._truss, writable: false, configurable: false, enumerable: false},\n      // We want Vue to wrap this; we'll make it non-enumerable in _completeCreateObject.\n      $parent: {value: parent, writable: false, configurable: true, enumerable: true},\n      $key: {value: key, writable: false, configurable: false, enumerable: false},\n      $path: {value: path, writable: false, configurable: false, enumerable: false},\n      $$touchThis: {\n        value: parent ? () => parent[key] : () => this._vue.$data.$root,\n        writable: false, configurable: false, enumerable: false\n      }\n    };\n\n    const object = this._modeler.createObject(path, properties);\n    Object.defineProperties(object, properties);\n    return object;\n  }\n\n  // To be called on the result of _createObject after it's been inserted into the _vue hierarchy\n  // and Vue has had a chance to initialize it.\n  _completeCreateObject(object) {\n    for (let name of Object.getOwnPropertyNames(object)) {\n      const descriptor = Object.getOwnPropertyDescriptor(object, name);\n      if (descriptor.configurable && descriptor.enumerable) {\n        descriptor.enumerable = false;\n        if (name === '$parent') {\n          descriptor.configurable = false;\n          descriptor.set = throwReadOnlyError;\n        }\n        Object.defineProperty(object, name, descriptor);\n      }\n    }\n    if (object.$$initializers) {\n      for (let fn of object.$$initializers) fn(this._vue);\n      delete object.$$initializers;\n    }\n  }\n\n  _destroyObject(object) {\n    if (!(object && object.$truss)) return;\n    if (object.$$finalizers) {\n      // Some destructors remove themselves from the array, so clone it before iterating.\n      for (let fn of _.clone(object.$$finalizers)) fn();\n    }\n    for (let key in object) {\n      if (!Object.hasOwnProperty(object, key)) continue;\n      this._destroyObject(object[key]);\n    }\n  }\n\n  _integrateSnapshot(snap) {\n    _.each(_.keys(this._localWrites), (writeSerial, path) => {\n      if (snap.writeSerial >= writeSerial) delete this._localWrites[path];\n    });\n    if (snap.exists) {\n      const parent = this._scaffoldAncestors(snap.path, true);\n      if (parent) this._plantValue(snap.path, snap.key, snap.value, parent, true);\n    } else {\n      this._prune(snap.path, null, true);\n    }\n  }\n\n  _scaffoldAncestors(path, remoteWrite) {\n    let object;\n    const segments = _(path).split('/').dropRight().value();\n    _.each(segments, (segment, i) => {\n      const childKey = unescapeKey(segment);\n      let child = childKey ? object[childKey] : this.root;\n      if (!child) {\n        const ancestorPath = segments.slice(0, i + 1).join('/');\n        if (remoteWrite && this._localWrites[ancestorPath || '/']) return;\n        child = this._plantValue(ancestorPath, childKey, {}, object);\n      }\n      object = child;\n    });\n    return object;\n  }\n\n  _plantValue(path, key, value, parent, remoteWrite) {\n    if (value === null || value === undefined) {\n      throw new Error('Snapshot includes invalid value: ' + value);\n    }\n    if (remoteWrite && this._localWrites[path]) return;\n    if (value === SERVER_TIMESTAMP) value = this._localWriteTimestamp;\n    if (!_.isArray(value) && !_.isObject(value)) {\n      this._setFirebaseProperty(parent, key, value);\n      return;\n    }\n    let object = parent[key];\n    if (object === undefined) {\n      object = this._createObject(path, key, parent);\n      this._setFirebaseProperty(parent, key, object);\n      this._completeCreateObject(object);\n    }\n    _.each(value, (item, escapedChildKey) => {\n      this._plantValue(\n        joinPath(path, escapedChildKey), unescapeKey(escapedChildKey), item, object, remoteWrite);\n    });\n    _.each(object, (item, childKey) => {\n      const escapedChildKey = escapeKey(childKey);\n      if (!value.hasOwnProperty(escapedChildKey)) {\n        this._prune(joinPath(path, escapedChildKey), null, remoteWrite);\n      }\n    });\n    this._plantPlaceholders(object, path);\n    return object;\n  }\n\n  _plantPlaceholders(object, path) {\n    this._modeler.forEachPlaceholderChild(path, (escapedKey, placeholder) => {\n      const key = unescapeKey(escapedKey);\n      if (!object.hasOwnProperty(key)) {\n        this._plantValue(joinPath(path, escapedKey), key, placeholder, object);\n      }\n    });\n  }\n\n  _prune(path, lockedDescendantPaths, remoteWrite) {\n    lockedDescendantPaths = lockedDescendantPaths || {};\n    const object = this.getObject(path);\n    if (!object) return;\n    if (remoteWrite && this._avoidLocalWritePaths(path, lockedDescendantPaths)) return;\n    if (!_.isEmpty(lockedDescendantPaths) || !this._pruneAncestors(object)) {\n      // The target object is a placeholder, and all ancestors are placeholders or otherwise needed\n      // as well, so we can't delete it.  Instead, dive into its descendants to delete what we can.\n      this._pruneDescendants(object, lockedDescendantPaths);\n    }\n  }\n\n  _avoidLocalWritePaths(path, lockedDescendantPaths) {\n    for (let localWritePath in this._localWrites) {\n      if (!this._localWrites.hasOwnProperty(localWritePath)) continue;\n      if (path === localWritePath || localWritePath === '/' ||\n          _.startsWith(path, localWritePath + '/')) return true;\n      if (path === '/' || _.startsWith(localWritePath, path + '/')) {\n        const segments = localWritePath.split('/');\n        for (let i = segments.length; i > 0; i--) {\n          const subPath = segments.slice(0, i).join('/');\n          const active = i === segments.length;\n          if (lockedDescendantPaths[subPath] || lockedDescendantPaths[subPath] === active) break;\n          lockedDescendantPaths[subPath] = active;\n          if (subPath === path) break;\n        }\n      }\n    }\n  }\n\n  _pruneAncestors(targetObject) {\n    // Destroy the child (unless it's a placeholder that's still needed) and any ancestors that\n    // are no longer needed to keep this child rooted, and have no other reason to exist.\n    let deleted = false;\n    let object = targetObject;\n    while (object && object !== this.root) {\n      if (!this._modeler.isPlaceholder(object.$path)) {\n        const ghostObjects = deleted ? null : [targetObject];\n        if (!this._holdsConcreteData(object, ghostObjects)) {\n          deleted = true;\n          this._deleteFirebaseProperty(object.$parent, object.$key);\n        }\n      }\n      object = object.$parent;\n    }\n    return deleted;\n  }\n\n  _holdsConcreteData(object, ghostObjects) {\n    if (ghostObjects && _.contains(ghostObjects, object)) return false;\n    if (_.some(object, value => !value.$truss)) return true;\n    return _.some(object, value => this._holdsConcreteData(value, ghostObjects));\n  }\n\n  _pruneDescendants(object, lockedDescendantPaths) {\n    if (lockedDescendantPaths[object.$path]) return true;\n    let coupledDescendantFound = false;\n    _.each(object, (value, key) => {\n      let shouldDelete = true;\n      let valueLocked;\n      if (lockedDescendantPaths[joinPath(object.$path, escapeKey(key))]) {\n        shouldDelete = false;\n        valueLocked = true;\n      } else if (value.$truss) {\n        if (this._modeler.isPlaceholder(value.$path)) {\n          valueLocked = this._pruneDescendants(value, lockedDescendantPaths);\n          shouldDelete = false;\n        } else if (_.has(lockedDescendantPaths, value.$path)) {\n          valueLocked = this._pruneDescendants(value);\n          shouldDelete = !valueLocked;\n        }\n      }\n      if (shouldDelete) this._deleteFirebaseProperty(object, key);\n      coupledDescendantFound = coupledDescendantFound || valueLocked;\n    });\n    return coupledDescendantFound;\n  }\n\n  getObject(pathOrSegments) {\n    let object;\n    const segments = _.isString(pathOrSegments) ?\n      _(pathOrSegments).split('/').map(unescapeKey).value() : pathOrSegments;\n    for (let segment of segments) {\n      object = segment ? object[segment] : this.root;\n      if (object === undefined) return;\n    }\n    return object;\n  }\n\n  _getFirebasePropertyDescriptor(object, key) {\n    let descriptor = Object.getOwnPropertyDescriptor(object, key);\n    if (descriptor) {\n      if (!descriptor.enumerable) {\n        throw new Error(\n          `Key conflict between Firebase and instance or computed properties at ` +\n          `${object.$path}: ${key}`);\n      }\n      if (!descriptor.get || !descriptor.set) {\n        throw new Error(`Unbound property at ${object.$path}: ${key}`);\n      }\n    }\n    return descriptor;\n  }\n\n  _setFirebaseProperty(object, key, value) {\n    let descriptor = this._getFirebasePropertyDescriptor(object, key);\n    if (descriptor) {\n      this._firebasePropertyEditAllowed = true;\n      object[key] = value;\n      this._firebasePropertyEditAllowed = false;\n    } else {\n      Vue.set(object, key, value);\n      descriptor = Object.getOwnPropertyDescriptor(object, key);\n      Object.defineProperty(object, key, {\n        get: descriptor.get,\n        set: function(newValue) {\n          if (!this._firebasePropertyEditAllowed) {\n            throw new Error(`Firebase data cannot be mutated directly: ${key}`);\n          }\n          descriptor.set.call(this, newValue);\n        },\n        configurable: true, enumerable: true\n      });\n    }\n  }\n\n  _deleteFirebaseProperty(object, key) {\n    // Make sure it's actually a Firebase property.\n    this._getFirebasePropertyDescriptor(object, key);\n    this._destroyObject(object[key]);\n    Vue.delete(object, key);\n  }\n\n  checkVueObject(object, path) {\n    for (let key of Object.getOwnPropertyNames(object)) {\n      const descriptor = Object.getOwnPropertyDescriptor(object, key);\n      if ('value' in descriptor || !descriptor.get || !descriptor.set) {\n        throw new Error(`Firetruss object at ${path} has a raw property: ${key}`);\n      }\n      const value = object[key];\n      if (_.isObject(value)) this.checkVueObject(value, joinPath(path, escapeKey(key)));\n    }\n  }\n\n  static get computedPropertyStats() {\n    return Modeler.computedPropertyStats;\n  }\n}\n\n\nfunction throwReadOnlyError() {throw new Error('Read-only property');}\n\nexport function joinPath() {\n  const segments = [];\n  for (let segment of arguments) {\n    if (segment.charAt(0) === '/') segments.splice(0, segments.length);\n    segments.push(segment);\n  }\n  if (segments[0] === '/') segments[0] = '';\n  return segments.join('/');\n}\n\nexport function checkUpdateHasOnlyDescendantsWithNoOverlap(rootPath, values, relativizePaths) {\n  // First, check all paths for correctness and absolutize them, since there could be a mix of\n  // absolute paths and relative keys.\n  _.each(_.keys(values), path => {\n    if (path.charAt(0) === '/') {\n      if (!(path === rootPath || rootPath === '/' ||\n            _.startsWith(path, rootPath + '/') && path.length > rootPath.length + 1)) {\n        throw new Error(`Update item is not a descendant of target ref: ${path}`);\n      }\n    } else {\n      if (path.indexOf('/') >= 0) {\n        throw new Error(`Update item deep path must be absolute, taken from a reference: ${path}`);\n      }\n      const absolutePath = joinPath(rootPath, escapeKey(path));\n      if (values.hasOwnProperty(absolutePath)) {\n        throw new Error(`Update items overlap: ${path} and ${absolutePath}`);\n      }\n      values[absolutePath] = values[path];\n      delete values[path];\n    }\n  });\n  // Then check for overlaps and relativize if desired.\n  const allPaths = _(values).keys().map(path => joinPath(path, '')).sortBy('length').value();\n  _.each(_.keys(values), path => {\n    for (let otherPath of allPaths) {\n      if (otherPath.length > path.length) break;\n      if (path !== otherPath && _.startsWith(path, otherPath)) {\n        throw new Error(`Update items overlap: ${otherPath} and ${path}`);\n      }\n    }\n    if (relativizePaths) {\n      values[path.slice(rootPath === '/' ? 1 : rootPath.length + 1)] = values[path];\n      delete values[path];\n    }\n  });\n}\n\nexport function toFirebaseJson(object) {\n  if (typeof object === 'object') {\n    const result = {};\n    for (let key in object) {\n      if (!object.hasOwnProperty(key)) continue;\n      result[escapeKey(key)] = toFirebaseJson(object[key]);\n    }\n    return result;\n  } else {\n    return object;\n  }\n}\n\n","import {escapeKey, unescapeKey, makePathMatcher} from './utils.js';\n\nimport _ from 'lodash';\n\n\nconst EMPTY_ANNOTATIONS = {};\nObject.freeze(EMPTY_ANNOTATIONS);\n\n\nexport class Handle {\n  constructor(tree, path, annotations) {\n    this._tree = tree;\n    this._path = path.replace(/^\\/*/, '/').replace(/\\/$/, '');\n    if (annotations) {\n      this._annotations = annotations;\n      Object.freeze(annotations);\n    }\n  }\n\n  get $ref() {return this;}\n  get key() {\n    if (!this._key) this._key = unescapeKey(this._path.replace(/.*\\//, ''));\n    return this._key;\n  }\n  get path() {return this._path;}\n  get _pathPrefix() {return this._path === '/' ? '' : this._path;}\n  get parent() {\n    return new Reference(this._tree, this._path.replace(/\\/[^/]*$/, ''), this._annotations);\n  }\n\n  get annotations() {\n    return this._annotations || EMPTY_ANNOTATIONS;\n  }\n\n  child() {\n    if (!arguments.length) return this;\n    return new Reference(\n      this._tree, `${this._pathPrefix}/${_.map(arguments, key => escapeKey(key)).join('/')}`,\n      this._annotations\n    );\n  }\n\n  children() {\n    if (!arguments.length) return this;\n    const escapedKeys = [];\n    for (let i = 0; i < arguments.length; i++) {\n      const arg = arguments[i];\n      if (_.isArray(arg)) {\n        const mapping = {};\n        const subPath = `${this._pathPrefix}/${escapedKeys.join('/')}`;\n        const rest = _.slice(arguments, i + 1);\n        for (let key of arg) {\n          const subRef =\n            new Reference(this._tree, `${subPath}/${escapeKey(key)}`, this._annotations);\n          mapping[key] = subRef.children.apply(subRef, rest);\n        }\n        return mapping;\n      } else {\n        escapedKeys.push(escapeKey(arg));\n      }\n    }\n    return new Reference(\n      this._tree, `${this._pathPrefix}/${escapedKeys.join('/')}`, this._annotations);\n  }\n\n  peek(callback) {\n    return this._tree.truss.peek(this, callback);\n  }\n\n  match(pattern) {\n    return makePathMatcher(pattern).match(this.path);\n  }\n\n  isEqual(that) {\n    if (!(that instanceof Handle)) return false;\n    return this._tree === that._tree && this.toString() === that.toString();\n  }\n\n  belongsTo(truss) {\n    return this._tree.truss === truss;\n  }\n}\n\n\nexport class Query extends Handle {\n  constructor(tree, path, spec, annotations) {\n    super(tree, path, annotations);\n    this._spec = this._copyAndValidateSpec(spec);\n  }\n\n  // Vue-bound\n  get ready() {\n    return this._tree.isQueryReady(this);\n  }\n\n  get constraints() {\n    return this._spec;\n  }\n\n  annotate(annotations) {\n    return new Query(\n      this._tree, this._path, this._spec, _.extend({}, this._annotations, annotations));\n  }\n\n  _copyAndValidateSpec(spec) {\n    if (!spec.by) throw new Error('Query needs \"by\" clause: ' + JSON.stringify(spec));\n    if (('at' in spec) + ('from' in spec) + ('to' in spec) > 1) {\n      throw new Error(\n        'Query must contain at most one of \"at\", \"from\", or \"to\" clauses: ' + JSON.stringify(spec));\n    }\n    if (('first' in spec) + ('last' in spec) > 1) {\n      throw new Error(\n        'Query must contain at most one of \"first\" or \"last\" clauses: ' + JSON.stringify(spec));\n    }\n    if (!_.some(['at', 'from', 'to', 'first', 'last'], clause => clause in spec)) {\n      throw new Error(\n        'Query must contain at least one of \"at\", \"from\", \"to\", \"first\", or \"last\" clauses: ' +\n        JSON.stringify(spec));\n    }\n    spec = _.clone(spec);\n    if (spec.by !== '$key' && spec.by !== '$value') {\n      if (!(spec.by instanceof Reference)) {\n        throw new Error('Query \"by\" value must be a reference: ' + spec.by);\n      }\n      let childPath = spec.by.toString();\n      if (!_.startsWith(childPath, this._path)) {\n        throw new Error(\n          'Query \"by\" value must be a descendant of target reference: ' + spec.by);\n      }\n      childPath = childPath.slice(this._path.length).replace(/^\\/?/, '');\n      if (childPath.indexOf('/') === -1) {\n        throw new Error(\n          'Query \"by\" value must not be a direct child of target reference: ' + spec.by);\n      }\n      spec.by = childPath.replace(/.*?\\//, '');\n    }\n    Object.freeze(spec);\n    return spec;\n  }\n\n\n  toString() {\n    if (!this._string) {\n      const queryTerms = _(this._spec)\n        .map((value, key) => `${key}=${encodeURIComponent(JSON.stringify(value))}`)\n        .sortBy()\n        .join('&');\n      this._string = `${this._path}?${queryTerms}`;\n    }\n    return this._string;\n  }\n}\n\n\n// jshint latedef:false\nexport class Reference extends Handle {\n// jshint latedef:nofunc\n\n  constructor(tree, path, annotations) {\n    super(tree, path, annotations);\n  }\n\n  get ready() {return this._tree.isReferenceReady(this);}  // Vue-bound\n\n  get value() {  // Vue-bound\n    if (!this.ready) throw new Error('Reference value not currently synced');\n    return this._tree.getObject(this.path);\n  }\n\n  toString() {return this._path;}\n\n  annotate(annotations) {\n    return new Reference(this._tree, this._path, _.extend({}, this._annotations, annotations));\n  }\n\n  query(spec) {\n    return new Query(this._tree, this._path, spec);\n  }\n\n  set(value) {\n    return this._tree.update(this, 'set', {[this.path]: value});\n  }\n\n  update(values) {\n    return this._tree.update(this, 'update', values);\n  }\n\n  commit(updateFunction) {\n    return this._tree.commit(this, updateFunction);\n  }\n}\n\nexport default Reference;\n","import {Handle, Query, Reference} from './Reference.js';\nimport angular from './angularCompatibility.js';\n\nimport _ from 'lodash';\nimport Vue from 'vue';\n\n\nexport default class Connector {\n  constructor(scope, connections, tree, method) {\n    connections.freeze();\n    this._scope = scope;\n    this._connections = connections;\n    this._tree = tree;\n    this._method = method;\n    this._subConnectors = {};\n    this._currentDescriptors = {};\n    this._disconnects = {};\n    this._vue = new Vue({data: _.mapValues(connections, _.constant(undefined))});\n\n    this._linkScopeProperties();\n\n    _.each(connections, (descriptor, key) => {\n      if (_.isFunction(descriptor)) {\n        this._bindComputedConnection(key, descriptor);\n      } else {\n        this._connect(key, descriptor);\n      }\n    });\n\n    if (angular.active && scope.$on && scope.$$id) scope.$on('$destroy', () => {this.destroy();});\n  }\n\n  get ready() {\n    return _.every(this._currentDescriptors, (descriptor, key) => {\n      if (!descriptor) return false;\n      if (descriptor instanceof Handle) return descriptor.ready;\n      return this._subConnectors[key].ready;\n    });\n  }\n\n  destroy() {\n    this._unlinkScopeProperties();\n    _.each(this._angularUnwatches, unwatch => {unwatch();});\n    _.each(this._connections, (descriptor, key) => {this._disconnect(key);});\n  }\n\n  _linkScopeProperties() {\n    if (!this._scope) return;\n    const duplicateKey = _.find(this._connections, (descriptor, key) => key in this._scope);\n    if (duplicateKey) {\n      throw new Error(`Property already defined on connection target: ${duplicateKey}`);\n    }\n    Object.defineProperties(this._scope, _.mapValues(this._connections, (descriptor, key) => ({\n      configurable: true, enumerable: true, get: () => this._vue.$data[key]\n    })));\n  }\n\n  _unlinkScopeProperties() {\n    if (!this._scope) return;\n    _.each(this._connections, (descriptor, key) => {\n      delete this._scope[key];\n    });\n  }\n\n  _bindComputedConnection(key, fn) {\n    fn = fn.bind(this._scope);\n    const update = this._updateComputedConnection.bind(this, key);\n    this._vue.$watch(fn, update, {immediate: !angular.active});\n    if (angular.active) {\n      if (!this._angularUnwatches) this._angularUnwatches = [];\n      this._angularUnwatches.push(angular.watch(fn, update));\n    }\n  }\n\n  _updateComputedConnection(key, newDescriptor) {\n    const oldDescriptor = this._currentDescriptors[key];\n    if (oldDescriptor === newDescriptor ||\n        newDescriptor instanceof Handle && newDescriptor.isEqual(oldDescriptor)) return;\n    if (!newDescriptor) {\n      this._disconnect(key);\n      return;\n    }\n    if (newDescriptor instanceof Handle || !_.has(this._subConnectors, key)) {\n      this._disconnect(key);\n      this._connect(key, newDescriptor);\n    } else {\n      this._subConnectors[key]._updateConnections(newDescriptor);\n    }\n    this._currentDescriptors[key] = newDescriptor;\n  }\n\n  _updateConnections(connections) {\n    _.each(connections, (descriptor, key) => {\n      this._updateComputedConnection(key, descriptor);\n    });\n    _.each(this._connections, (descriptor, key) => {\n      if (!_.has(connections, key)) this._updateComputedConnection(key);\n    });\n    this._connections = connections;\n  }\n\n  _connect(key, descriptor) {\n    this._currentDescriptors[key] = descriptor;\n    if (!descriptor) return;\n    if (descriptor instanceof Reference) {\n      const updateFn = this._scope ? this._updateScopeRef.bind(this, key) : null;\n      this._disconnects[key] = this._tree.connectReference(descriptor, updateFn, this._method);\n    } else if (descriptor instanceof Query) {\n      const updateFn = this._scope ? this._updateScopeQuery.bind(this, key) : null;\n      this._disconnects[key] = this._tree.connectQuery(descriptor, updateFn, this._method);\n    } else {\n      const subScope = {};\n      const subConnector = this._subConnectors[key] =\n        new Connector(subScope, descriptor, this._tree, this._method);\n      if (this._scope) {\n        const unwatch = this._vue.$watch(() => subConnector.ready, subReady => {\n          if (!subReady) return;\n          unwatch();\n          Vue.set(this._scope, key, subScope);\n          angular.digest();\n        }, {immediate: true});\n      }\n    }\n  }\n\n  _disconnect(key) {\n    if (this._scope) {\n      Vue.delete(this._scope, key);\n      angular.digest();\n    }\n    if (_.has(this._subConnectors, key)) {\n      this._subConnectors[key].destroy();\n      delete this._subConnectors[key];\n    }\n    if (this._disconnects[key]) this._disconnects[key]();\n    delete this._disconnects[key];\n    delete this._currentDescriptors[key];\n  }\n\n  _updateScopeRef(key, value) {\n    if (this._scope[key] !== value) {\n      Vue.set(this._scope, key, value);\n      angular.digest();\n    }\n  }\n\n  _updateScopeQuery(key, childKeys) {\n    let changed = false;\n    if (!this._scope[key]) {\n      Vue.set(this._scope, key, {});\n      changed = true;\n    }\n    const subScope = this._scope[key];\n    for (let childKey in subScope) {\n      if (!subScope.hasOwnProperty(childKey)) continue;\n      if (!_.contains(childKeys, childKey)) {\n        Vue.delete(subScope, childKey);\n        changed = true;\n      }\n    }\n    let object;\n    for (let segment of this._currentDescriptors[key].path.split('/')) {\n      object = segment ? object[segment] : this._tree.root;\n    }\n    for (let childKey of childKeys) {\n      if (subScope.hasOwnProperty(childKey)) continue;\n      Vue.set(subScope, childKey, object[childKey]);\n      changed = true;\n    }\n    if (changed) angular.digest();\n  }\n\n}\n","import _ from 'lodash';\nimport {wrapPromiseCallback} from './utils.js';\n\n\nconst INTERCEPT_KEYS = [\n  'read', 'write', 'auth', 'set', 'update', 'commit', 'connect', 'peek', 'all'\n];\n\n\nclass SlowHandle {\n  constructor(operation, delay, callback) {\n    this._operation = operation;\n    this._delay = delay;\n    this._callback = callback;\n    this._fired = false;\n  }\n\n  initiate() {\n    this.cancel();\n    this._fired = false;\n    const elapsed = Date.now() - this._operation._startTimestamp;\n    this._timeoutId = setTimeout(this._delay - elapsed, () => {\n      this._fired = true;\n      this._callback(this._operation);\n    });\n  }\n\n  cancel() {\n    if (this._fired) this._callback(this._operation);\n    if (this._timeoutId) clearTimeout(this._timeoutId);\n  }\n}\n\n\nclass Operation {\n  constructor(type, method, target) {\n    this._type = type;\n    this._method = method;\n    this._target = target;\n    this._ready = false;\n    this._running = false;\n    this._startTimestamp = Date.now();\n    this._slowHandles = [];\n  }\n\n  get type() {return this._type;}\n  get method() {return this._method;}\n  get target() {return this._target;}\n  get ready() {return this._ready;}\n  get running() {return this._running;}\n  get error() {return this._error;}\n\n  onSlow(delay, callback) {\n    const handle = new SlowHandle(this, delay, callback);\n    this._slowHandles.push(handle);\n    handle.initiate();\n  }\n\n  _setRunning(value) {\n    this._running = value;\n  }\n\n  _markReady() {\n    this._ready = true;\n    _.each(this._slowHandles, handle => handle.cancel());\n  }\n\n  _clearReady() {\n    this._ready = false;\n    this._startTimestamp = Date.now();\n    _.each(this._slowHandles, handle => handle.initiate());\n  }\n}\n\n\nexport default class Dispatcher {\n  constructor(bridge) {\n    this._bridge = bridge;\n    this._callbacks = {};\n  }\n\n  intercept(interceptKey, callbacks) {\n    if (!_.contains(INTERCEPT_KEYS, interceptKey)) {\n      throw new Error('Unknown intercept operation type: ' + interceptKey);\n    }\n    const badCallbackKeys =\n      _.difference(_.keys(callbacks), ['onBefore', 'onAfter', 'onError', 'onFailure']);\n    if (badCallbackKeys.length) {\n      throw new Error('Unknown intercept callback types: ' + badCallbackKeys.join(', '));\n    }\n    const wrappedCallbacks = {\n      onBefore: this._addCallback('onBefore', interceptKey, callbacks.onBefore),\n      onAfter: this._addCallback('onAfter', interceptKey, callbacks.onAfter),\n      onError: this._addCallback('onError', interceptKey, callbacks.onError),\n      onFailure: this._addCallback('onFailure', interceptKey, callbacks.onFailure)\n    };\n    return this._removeCallbacks.bind(this, interceptKey, wrappedCallbacks);\n  }\n\n  _addCallback(stage, interceptKey, callback) {\n    if (!callback) return;\n    const key = this._getCallbacksKey(interceptKey, stage);\n    const wrappedCallback = wrapPromiseCallback(callback);\n    (this._callbacks[key] || (this._callbacks[key] = [])).push(wrappedCallback);\n    return wrappedCallback;\n  }\n\n  _removeCallback(stage, interceptKey, wrappedCallback) {\n    if (!wrappedCallback) return;\n    const key = this._getCallbacksKey(interceptKey, stage);\n    if (this._callbacks[key]) _.pull(this._callbacks[key], wrappedCallback);\n  }\n\n  _removeCallbacks(interceptKey, wrappedCallbacks) {\n    _.each(wrappedCallbacks, (wrappedCallback, stage) => {\n      this._removeCallback(stage, interceptKey, wrappedCallback);\n    });\n  }\n\n  _getCallbacks(stage, operationType, method) {\n    return [].concat(\n      this._callbacks[this._getCallbacksKey(stage, method)],\n      this._callbacks[this._getCallbacksKey(stage, operationType)],\n      this._callbacks[this._getCallbacksKey(stage, 'all')]\n    );\n  }\n\n  _getCallbacksKey(stage, interceptKey) {\n    return `${stage}_${interceptKey}`;\n  }\n\n  execute(operationType, method, target, executor) {\n    executor = wrapPromiseCallback(executor);\n    const operation = this.createOperation(operationType, method, target);\n    return this.begin(operation).then(() => {\n      const executeWithRetries = () => {\n        return executor().catch(e => this._retryOrEnd(operation, e).then(executeWithRetries));\n      };\n      return executeWithRetries();\n    }).then(result => this.end(operation).then(() => result));\n  }\n\n  createOperation(operationType, method, target) {\n    return new Operation(operationType, method, target);\n  }\n\n  begin(operation) {\n    return Promise.all(\n      _.map(this._getCallbacks('onBefore', operation.type), onBefore => onBefore(operation))\n    ).then(() => {operation._setRunning(true);}, e => this.end(operation, e));\n  }\n\n  markReady(operation) {\n    operation._markReady();\n  }\n\n  clearReady(operation) {\n    operation._clearReady();\n  }\n\n  retry(operation, error) {\n    return Promise.all(\n      _.map(this._getCallbacks('onError', operation.type), onError => {\n        try {\n          return Promise.resolve(onError(operation, error));\n        } catch (e) {\n          return Promise.reject(e);\n        }\n      })\n    ).then(results => _.some(results));\n  }\n\n  _retryOrEnd(operation, error) {\n    return this.retry(operation, error).then(result => {\n      if (!result) return this.end(operation, error);\n    }, e => this.end(operation, e));\n  }\n\n  end(operation, error) {\n    operation._setRunning(false);\n    if (error) operation._error = error;\n    return Promise.all(\n      _.map(this._getCallbacks('onAfter', operation.type), onAfter => onAfter(operation))\n    ).then(\n      () => this._afterEnd(operation),\n      e => {\n        operation._error = e;\n        return this._afterEnd(operation);\n      }\n    );\n  }\n\n  _afterEnd(operation) {\n    this.markReady(operation);\n    if (operation.error) {\n      const onFailureCallbacks = this._getCallbacks('onFailure', operation.type);\n      return this._bridge.probeError(operation.error).then(() => {\n        if (onFailureCallbacks) {\n          setTimeout(0, () => {\n            _.each(onFailureCallbacks, onFailure => onFailure(operation));\n          });\n        }\n        return Promise.reject(operation.error);\n      });\n    }\n  }\n}\n\n","'use strict';\n\nconst ALPHABET = '-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz';\n\nexport default class KeyGenerator {\n  constructor() {\n    this._lastUniqueKeyTime = 0;\n    this._lastRandomValues = [];\n  }\n\n  generateUniqueKey(now) {\n    now = now || Date.now();\n    const chars = new Array(20);\n    let prefix = now;\n    for (let i = 7; i >= 0; i--) {\n      chars[i] = ALPHABET.charAt(prefix & 0x3f);\n      prefix = Math.floor(prefix / 64);\n    }\n    if (now === this._lastUniqueKeyTime) {\n      let i = 11;\n      while (i >= 0 && this._lastRandomValues[i] === 63) {\n        this._lastRandomValues[i] = 0;\n        i -= 1;\n      }\n      if (i === -1) {\n        throw new Error('Internal assertion failure: ran out of unique IDs for this millisecond');\n      }\n      this._lastRandomValues[i] += 1;\n    } else {\n      this._lastUniqueKeyTime = now;\n      for (let i = 0; i < 12; i++) {\n        // Make sure to leave some space for incrementing in the top nibble.\n        this._lastRandomValues[i] = Math.floor(Math.random() * (i ? 64 : 16));\n      }\n    }\n    for (let i = 0; i < 12; i++) {\n      chars[i + 8] = ALPHABET[this._lastRandomValues[i]];\n    }\n    return chars.join('');\n  }\n}\n","import angularCompatibility from './angularCompatibility.js';\nimport Vue from 'vue';\n\nexport default class MetaTree {\n  constructor(rootUrl, bridge) {\n    this._rootUrl = rootUrl;\n    this._bridge = bridge;\n    this._vue = new Vue({data: {$root: {\n      connected: undefined, timeOffset: 0, user: undefined, userid: undefined,\n      updateNowAtIntervals(name, intervalMillis) {\n        if (this.hasOwnProperty(name)) throw new Error(`Property \"${name}\" already defined`);\n        Vue.set(this, name, Date.now() + this.timeOffset);\n        setInterval(() => {\n          this[name] = Date.now() + this.timeOffset;\n        }, intervalMillis);\n      }\n    }}});\n\n    if (angularCompatibility.active) {\n      this._vue.$watch('$data', angularCompatibility.digest, {deep: true});\n    }\n\n    bridge.trackAuth(rootUrl);\n    bridge.onAuth(rootUrl, this._handleAuthChange, this);\n\n    this._connectInfoProperty('serverTimeOffset', 'timeOffset');\n    this._connectInfoProperty('connected', 'connected');\n  }\n\n  get root() {\n    return this._vue.$data.$root;\n  }\n\n  destroy() {\n    this._bridge.offAuth(this._rootUrl, this._handleAuthChange, this);\n    this._vue.$destroy();\n  }\n\n  _handleAuthChange(user) {\n    this.root.user = user;\n    this.root.userid = user && user.uid;\n  }\n\n  _connectInfoProperty(property, attribute) {\n    const propertyUrl = `${this._rootUrl}/.info/{property}`;\n    this._bridge.on(propertyUrl, propertyUrl, null, 'value', snap => {\n      this.root[attribute] = snap.value;\n    });\n  }\n}\n","import _ from 'lodash';\nimport Vue from 'vue';\nimport angularCompatibility from './angularCompatibility.js';\n\n\nclass QueryHandler {\n  constructor(coupler, query) {\n    this._coupler = coupler;\n    this._query = query;\n    this._listeners = [];\n    this._keys = [];\n    this._url = this._coupler._rootUrl + query.path;\n    this._segments = query.path.split('/');\n    this._listening = false;\n    this.ready = false;\n  }\n\n  attach(operation, keysCallback) {\n    this._listen();\n    this._listeners.push({operation, keysCallback});\n    keysCallback(this._keys);\n  }\n\n  detach(operation) {\n    const k = _.findIndex(this._listeners, {operation});\n    if (k >= 0) this._listeners.splice(k, 1);\n    return this._listeners.length;\n  }\n\n  _listen() {\n    if (this._listening) return;\n    this._coupler._bridge.on(\n      this._query.toString(), this._url, this._query.constraints, 'value',\n      this._handleSnapshot, this._handleError.bind(this._query.path), this, {sync: true});\n    this._listening = true;\n  }\n\n  destroy() {\n    this._coupler._bridge.off(\n      this._query.toString(), this._url, this._query.constraints, 'value', this._handleSnapshot,\n      this);\n    this._listening = false;\n    this.ready = false;\n    angularCompatibility.digest();\n    for (let key of this._keys) {\n      this._coupler._decoupleSegments(this._segments.concat(key));\n    }\n  }\n\n  _handleSnapshot(snap) {\n    // Order is important here: first couple any new subpaths so _handleSnapshot will update the\n    // tree, then tell the client to update its keys, pulling values from the tree.\n    if (!this._listeners.length || !this._listening) return;\n    const updatedKeys = this._updateKeys(snap);\n    this._coupler._applySnapshot(snap);\n    if (!this.ready) {\n      this.ready = true;\n      angularCompatibility.digest();\n      for (let listener of this._listeners) this._coupler._dispatcher.markReady(listener.operation);\n    }\n    if (updatedKeys) {\n      for (let listener of this._listeners) listener.keysCallback(updatedKeys);\n    }\n  }\n\n  _updateKeys(snap) {\n    let updatedKeys;\n    if (snap.path === this._query.path) {\n      updatedKeys = _.keys(snap.value);\n      updatedKeys.sort();\n      if (_.isEqual(this._keys, updatedKeys)) {\n        updatedKeys = null;\n      } else {\n        for (let key of _.difference(updatedKeys, this._keys)) {\n          this._coupler._coupleSegments(this._segments.concat(key));\n        }\n        for (let key of _.difference(this._keys, updatedKeys)) {\n          this._coupler._decoupleSegments(this._segments.concat(key));\n        }\n        this._keys = updatedKeys;\n      }\n    } else if (snap.path.replace(/\\/[^/]+/, '') === this._query.path) {\n      const hasKey = _.contains(this._keys, snap.key);\n      if (snap.value) {\n        if (!hasKey) {\n          this._coupler._coupleSegments(this._segments.concat(snap.key));\n          this._keys.push(snap.key);\n          this._keys.sort();\n          updatedKeys = this._keys;\n        }\n      } else {\n        if (hasKey) {\n          this._coupler._decoupleSegments(this._segments.concat(snap.key));\n          _.pull(this._keys, snap.key);\n          this._keys.sort();\n          updatedKeys = this._keys;\n        }\n      }\n    }\n    return updatedKeys;\n  }\n\n  _handleError(error) {\n    if (!this._listeners.length || !this._listening) return;\n    this._listening = false;\n    Promise.all(_.map(this._listeners, listener => {\n      this._coupler._dispatcher.clearReady(listener.operation);\n      return this._coupler._dispatcher.retry(listener.operation, error).catch(e => {\n        listener.operation._disconnect(e);\n        return false;\n      });\n    })).then(results => {\n      if (_.some(results)) {\n        if (this._listeners.length) this._listen();\n      } else {\n        for (let listener of this._listeners) listener.operation._disconnect(error);\n      }\n    });\n  }\n}\n\n\nclass Node {\n  constructor(coupler, path) {\n    this._coupler = coupler;\n    this.path = path;\n    this.url = this._coupler._rootUrl + path;\n    this.operations = [];\n    this.queryCount = 0;\n    this.listening = false;\n    this.ready = false;\n    this.children = {};\n  }\n\n  get active() {\n    return this.count || this.queryCount;\n  }\n\n  get count() {\n    return this.operations.length;\n  }\n\n  listen(skip) {\n    if (!skip && this.count) {\n      if (this.listening) return;\n      _.each(this.operations, op => {this._coupler._dispatcher.clearReady(op);});\n      this._coupler._bridge.on(\n        this.url, this.url, null, 'value', this._handleSnapshot, this._handleError.bind(this),\n        this, {sync: true});\n      this.listening = true;\n    } else {\n      _.each(this.children, child => {child.listen();});\n    }\n  }\n\n  unlisten(skip) {\n    if (!skip && this.listening) {\n      this._coupler._bridge.off(this.url, this.url, null, 'value', this._handleSnapshot, this);\n      this.listening = false;\n      this._forAllDescendants(node => {\n        if (node.ready) {\n          node.ready = false;\n          angularCompatibility.digest();\n        }\n      });\n    } else {\n      _.each(this.children, child => {child.unlisten();});\n    }\n  }\n\n  _handleSnapshot(snap) {\n    if (!this.listening || !this._coupler.isTrunkCoupled(snap.path)) return;\n    this._coupler._applySnapshot(snap);\n    if (!this.ready && snap.path === this.path) {\n      this.ready = true;\n      angularCompatibility.digest();\n      this.unlisten(true);\n      this._forAllDescendants(node => {\n        for (let op of this.operations) this._coupler._dispatcher.markReady(op);\n      });\n    }\n  }\n\n  _handleError(error) {\n    if (!this.count || !this.listening) return;\n    this.listening = false;\n    this._forAllDescendants(node => {\n      if (node.ready) {\n        node.ready = false;\n        angularCompatibility.digest();\n      }\n      for (let op of this.operations) this._coupler._dispatcher.clearReady(op);\n    });\n    return Promise.all(_.map(this.operations, op => {\n      return this._coupler._dispatcher.retry(op, error).catch(e => {\n        op._disconnect(e);\n        return false;\n      });\n    })).then(results => {\n      if (_.some(results)) {\n        if (this.count) this.listen();\n      } else {\n        for (let op of this.operations) op._disconnect(error);\n        // Pulling all the operations will automatically get us listening on descendants.\n      }\n    });\n  }\n\n  _forAllDescendants(iteratee) {\n    iteratee(this);\n    _.each(this.children, child => child._forAllDescendants(iteratee));\n  }\n\n  collectCoupledDescendantPaths(paths) {\n    if (!paths) paths = {};\n    paths[this.path] = this.active;\n    if (!this.active) {\n      _.each(this.children, child => {child.collectCoupledDescendantPaths(paths);});\n    }\n    return paths;\n  }\n}\n\n\nexport default class Coupler {\n  constructor(rootUrl, bridge, dispatcher, applySnapshot, prunePath) {\n    this._rootUrl = rootUrl;\n    this._bridge = bridge;\n    this._dispatcher = dispatcher;\n    this._applySnapshot = applySnapshot;\n    this._prunePath = prunePath;\n    this._vue = new Vue({data: {root: new Node(this, '/'), queryHandlers: {}}});\n  }\n\n  get _root() {return this._vue.root;}\n  get _queryHandlers() {return this._vue.queryHandlers;}\n\n  destroy() {\n    _.each(this._queryHandlers, queryHandler => {queryHandler.destroy();});\n    this._root.unlisten();\n    this._vue.$destroy();\n  }\n\n  couple(path, operation) {\n    return this._coupleSegments(path.split('/'), operation);\n  }\n\n  _coupleSegments(segments, operation) {\n    let node;\n    let superseded = !operation;\n    let ready = false;\n    for (let segment of segments) {\n      let child = segment ? node.children && node.children[segment] : this._root;\n      if (!child) {\n        child = new Node(this, `${node.path === '/' ? '' : node.path}/${segment}`);\n        Vue.set(node.children, segment, child);\n      }\n      superseded = superseded || child.listening;\n      ready = ready || child.ready;\n      node = child;\n    }\n    if (operation) {\n      node.operations.push(operation);\n    } else {\n      node.queryCount++;\n    }\n    if (superseded) {\n      if (operation && ready) this._dispatcher.markReady(operation);\n    } else {\n      node.listen();  // node will call unlisten() on descendants when ready\n    }\n  }\n\n  decouple(path, operation) {\n    return this._decoupleSegments(path.split('/'), operation);\n  }\n\n  _decoupleSegments(segments, operation) {\n    const ancestors = [];\n    let node;\n    for (let segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) break;\n      ancestors.push(node);\n    }\n    if (!node || !(operation ? node.count : node.queryCount)) {\n      throw new Error(`Path not coupled: ${segments.join('/')}`);\n    }\n    if (operation) {\n      _.pull(node.operations, operation);\n    } else {\n      node.queryCount--;\n    }\n    if (operation && !node.count) {\n      // Ideally, we wouldn't resync the full values here since we probably already have the current\n      // value for all children.  But making sure that's true is tricky in an async system (what if\n      // the node's value changes and the update crosses the 'off' call in transit?) and this\n      // situation should be sufficiently rare that the optimization is probably not worth it right\n      // now.\n      node.listen();\n      if (node.listening) node.unlisten();\n    }\n    if (!node.active) {\n      const coupledDescendantPaths = node.collectCoupledDescendantPaths();\n      this._prunePath(segments.join('/'), coupledDescendantPaths);\n      for (let i = ancestors.length - 1; i > 0; i--) {\n        node = ancestors[i];\n        if (node === this._root || node.active || !_.isEmpty(node.children)) break;\n        Vue.delete(ancestors[i - 1].children, segments[i]);\n      }\n    }\n  }\n\n  subscribe(query, operation, keysCallback) {\n    let queryHandler = this._queryHandlers[query.toString()];\n    if (!queryHandler) {\n      queryHandler = new QueryHandler(this, query);\n      Vue.set(this._queryHandlers, query.toString(), queryHandler);\n    }\n    queryHandler.attach(operation, keysCallback);\n }\n\n  unsubscribe(query, operation) {\n    const queryHandler = this._queryHandlers[query.toString()];\n    if (queryHandler && !queryHandler.detach(operation)) {\n      queryHandler.destroy();\n      Vue.delete(this._queryHandlers, query.toString());\n    }\n  }\n\n  // Return whether the node at path or any ancestors are coupled.\n  isTrunkCoupled(path) {\n    const segments = path.split('/');\n    let node;\n    for (let segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) return false;\n      if (node.active) return true;\n    }\n    return false;\n  }\n\n  findCoupledDescendantPaths(path) {\n    const segments = path.split('/');\n    let node;\n    for (let segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) break;\n    }\n    return node ? node.collectCoupledDescendantPaths() : {};\n  }\n\n  isSubtreeReady(path) {\n    const segments = path.split('/');\n    let node;\n    for (let segment of segments) {\n      node = segment ? node.children && node.children[segment] : this._root;\n      if (!node) return false;\n      if (node.ready) return true;\n    }\n    return false;\n  }\n\n  isQueryReady(query) {\n    const queryHandler = this._queryHandlers[query.toString()];\n    return queryHandler && queryHandler.ready;\n  }\n\n}\n\n","// Generated by CoffeeScript 1.7.1\n(function() {\n  var getNanoSeconds, hrtime, loadTime;\n\n  if ((typeof performance !== \"undefined\" && performance !== null) && performance.now) {\n    module.exports = function() {\n      return performance.now();\n    };\n  } else if ((typeof process !== \"undefined\" && process !== null) && process.hrtime) {\n    module.exports = function() {\n      return (getNanoSeconds() - loadTime) / 1e6;\n    };\n    hrtime = process.hrtime;\n    getNanoSeconds = function() {\n      var hr;\n      hr = hrtime();\n      return hr[0] * 1e9 + hr[1];\n    };\n    loadTime = getNanoSeconds();\n  } else if (Date.now) {\n    module.exports = function() {\n      return Date.now() - loadTime;\n    };\n    loadTime = Date.now();\n  } else {\n    module.exports = function() {\n      return new Date().getTime() - loadTime;\n    };\n    loadTime = new Date().getTime();\n  }\n\n}).call(this);\n","import _ from 'lodash';\nimport Vue from 'vue';\nimport angularCompatibility from './angularCompatibility.js';\nimport Bridge from './Bridge.js';\nimport Connector from './Connector.js';\nimport Dispatcher from './Dispatcher.js';\nimport KeyGenerator from './KeyGenerator.js';\nimport MetaTree from './MetaTree.js';\nimport {Handle, Reference} from './Reference.js';\nimport Tree from './Tree.js';\nimport {escapeKey, unescapeKey, wrapPromiseCallback, SERVER_TIMESTAMP} from './utils.js';\n\n\nlet bridge;\nconst workerFunctions = {};\n\n\nexport default class Truss {\n\n  /**\n   * Create a new Truss instance, specific to a given datastore.  To avoid confusion there should be\n   * exactly one Truss per root datastore URL, so in most code this will be a singleton.\n   *\n   * @param rootUrl {String} The root URL, https://{project}.firebaseio.com.\n   * @param classes {Array<Function>} A list of the classes to map onto the datastore structure.\n   *    Each class must have a static $trussMount property that is a (wildcarded) datastore path, or\n   *    an options object {path: string, placeholder: object}, or an array of either.\n   */\n  constructor(rootUrl, classes) {\n    // TODO: allow rootUrl to be a test database object for testing\n    if (!bridge) {\n      throw new Error('Truss worker not connected, please call Truss.connectWorker first');\n    }\n    this._rootUrl = rootUrl.replace(/\\/$/, '');\n    this._keyGenerator = new KeyGenerator();\n    this._dispatcher = new Dispatcher(bridge);\n    this._vue = new Vue();\n\n    this._metaTree = new MetaTree(this._rootUrl, bridge);\n    Object.defineProperty(this, 'meta', {\n      value: this._metaTree.root, writable: false, configurable: false, enumerable: false\n    });\n\n    this._tree = new Tree(this, this._rootUrl, bridge, this._dispatcher, classes);\n    Object.defineProperty(this, 'root', {\n      value: this._tree.root, writable: false, configurable: false, enumerable: false\n    });\n  }\n\n  destroy() {\n    this._vue.$destroy();\n    this._tree.destroy();\n    this._metaTree.destroy();\n  }\n\n  get now() {return Date.now() + this.meta.timeOffset;}\n  newKey() {return this._keyGenerator.generateUniqueKey(this.now);}\n\n  authenticate(token) {\n    return this._dispatcher.execute('auth', new Reference(this._tree, '/'), () => {\n      return bridge.authWithCustomToken(this._rootUrl, token, {rememberMe: true});\n    });\n  }\n\n  unauthenticate() {\n    return this._dispatcher.execute('auth', new Reference(this._tree, '/'), () => {\n      return bridge.unauth(this._rootUrl);\n    });\n  }\n\n  intercept(actionType, callbacks) {\n    return this._dispatcher.intercept(actionType, callbacks);\n  }\n\n  // connections are {key: Query | Object | fn() -> (Query | Object)}\n  connect(scope, connections) {\n    if (!connections) {\n      connections = scope;\n      scope = undefined;\n      if (connections instanceof Handle) connections = {_: connections};\n    }\n    return new Connector(scope, connections, this._tree, 'connect');\n  }\n\n  // target is Reference, Query, or connection Object like above\n  peek(target, callback) {\n    callback = wrapPromiseCallback(callback);\n    return new Promise((resolve, reject) => {\n      const scope = {};\n      const connector = new Connector(scope, {result: target}, this._tree, 'peek');\n      const unwatch = this._vue.$watch(() => connector.ready, ready => {\n        if (!ready) return;\n        unwatch();\n        callback(scope.result).then(result => {\n          connector.destroy();\n          resolve(result);\n        }, error => {\n          connector.destroy();\n          reject(error);\n        });\n      });\n    });\n  }\n\n  watch(subjectFn, callbackFn) {\n    let numCallbacks = 0;\n\n    const unwatch = this._vue.$watch(subjectFn, (newValue, oldValue) => {\n      numCallbacks++;\n      if (numCallbacks === 1) {\n        // Delay the immediate callback until we've had a chance to return the unwatch function.\n        Promise.resolve().then(() => {\n          if (numCallbacks > 1) return;\n          callbackFn(newValue, oldValue);\n          angularCompatibility.digest();\n        });\n      } else {\n        callbackFn(newValue, oldValue);\n        angularCompatibility.digest();\n      }\n    }, {immediate: true});\n\n    return unwatch;\n  }\n\n  checkObjectsForRogueProperties() {\n    this._tree.checkVueObject(this._tree.root, '/');\n  }\n\n  static get computedPropertyStats() {return this._tree.computedPropertyStats;}\n\n  static connectWorker(webWorker) {\n    if (bridge) throw new Error('Worker already connected');\n    if (_.isString(webWorker)) {\n      const Worker = window.SharedWorker || window.Worker;\n      if (!Worker) throw new Error('Browser does not implement Web Workers');\n      webWorker = new Worker(webWorker);\n    }\n    bridge = new Bridge(webWorker);\n    return bridge.init(webWorker).then(\n      ({exposedFunctionNames, firebaseSdkVersion}) => {\n        Truss.FIREBASE_SDK_VERSION = firebaseSdkVersion;\n        for (let name of exposedFunctionNames) {\n          Truss.worker[name] = bridge.bindExposedFunction(name);\n        }\n      }\n    );\n  }\n\n  static get worker() {return workerFunctions;}\n\n  static preExpose(functionName) {\n    Truss.worker[functionName] = bridge.bindExposedFunction(functionName);\n  }\n\n  static bounceConnection() {return bridge.bounceConnection();}\n  static suspend() {return bridge.suspend();}\n  static debugPermissionDeniedErrors(simulatedTokenGenerator, maxSimulationDuration, callFilter) {\n    return bridge.debugPermissionDeniedErrors(\n      simulatedTokenGenerator, maxSimulationDuration, callFilter);\n  }\n\n  static debounceAngularDigest(wait) {\n    angularCompatibility.debounceDigest(wait);\n  }\n\n  static escapeKey(key) {return escapeKey(key);}\n  static unescapeKey(escapedKey) {return unescapeKey(escapedKey);}\n\n  static get SERVER_TIMESTAMP() {return SERVER_TIMESTAMP;}\n  get SERVER_TIMESTAMP() {return SERVER_TIMESTAMP;}\n}\n\nangularCompatibility.defineModule(Truss);\n"]}