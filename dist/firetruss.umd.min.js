!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("lodash"),require("vue")):"function"==typeof define&&define.amd?define(["lodash","vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).Truss=t(e._,e.Vue)}(this,function(e,M){"use strict";function I(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var _=I(e),o=I(M);let a,l=0,h=!1;function u(){a.digestRequest>l||(a.digestRequest=l+1)}const d={active:"undefined"!=typeof window&&window.angular};if(d.active){const me=window.angular.module("firetruss",[]);d.digest=u,d.watch=function(){throw new Error("Angular watch proxy not yet initialized")},d.defineModule=function(e){me.constant("Truss",e)},d.debounceDigest=function(e){if(e){const t=_.default.debounce(u,e);d.digest=function(){a.digestRequest>l||(h?u:t)()}}else d.digest=u},me.config(["$provide",function(e){e.decorator("$rootScope",["$delegate","$exceptionHandler",function(e,t){const s=e,r=(d.watch=s.$watch.bind(s),Object.getPrototypeOf(s));e=r.$digest;r.$digest=u,r.$digest.original=e,(a=new o.default({data:{digestRequest:0}})).$watch(()=>a.digestRequest,()=>{a.digestRequest>l?o.default.nextTick(()=>{a.digestRequest<=l||(h=!0,s.$digest.original.call(s),l=a.digestRequest=a.digestRequest+1)}):h=!1});const i=_.default.last(a._watchers||a._scope.effects);i.id=1/0;{const n=(e=Object.getPrototypeOf(i)).get;e.get=function(){try{return n.call(this)}catch(e){if(this.vm._watcher!==this||!o.default.config.errorHandler)throw e;o.default.config.errorHandler(e,this.vm,"uncaught render error")}}}return s}])}])}else _.default.forEach(["digest","watch","defineModule","debounceDigest"],e=>{d[e]=_.default.noop});class F{constructor(e,t){this.key=e,this.value=t,this.touch()}touch(){this.timestamp=Date.now()}}const U=new class{constructor(e,t){this._items=Object.create(null),this._size=0,this._maxSize=e,this._pruningSize=t||Math.ceil(.1*e)}has(e){return Boolean(this._items[e])}get(e){const t=this._items[e];if(t)return t.touch(),t.value}set(e,t){const s=this._items[e];s?s.value=t:(this._size>=this._maxSize&&this._prune(),this._items[e]=new F(e,t),this._size+=1)}delete(e){this._items[e]&&(delete this._items[e],--this._size)}_prune(){for(const e of _.default(this._items).toArray().sortBy("timestamp").take(this._pruningSize).value())this.delete(e.key)}}(1e3),s={};function p(e){return e&&e.toString().replace(/[\x00-\x1f\\.$#[\]\x7f/]/g,function(e){return"\\"+_.default.padStart(e.charCodeAt(0).toString(16),2,"0")})}function c(e){return e&&e.toString().replace(/\\[0-9a-f]{2}/gi,function(e){return String.fromCharCode(parseInt(e.slice(1),16))})}function f(e){if(!_.default.isObject(e)||!Object.isExtensible(e))return e;let t=e;for(const n in e){var s,r,i;e.hasOwnProperty(n)&&(s=e[n],r=p(n),i=f(s),r===n&&i===s||((t=t===e?_.default.clone(e):t)[r]=i,t[n]===s&&delete t[n]))}return t}function g(){const e=[];for(var t of arguments)"/"===(t=_.default.isString(t)?t:""+t).charAt(0)&&e.splice(0,e.length),e.push(t);return"/"===e[0]&&(e[0]=""),e.join("/")}function m(e,t){var s=(t?"esc:":"")+e;let r=U.get(s);return r||(r=e.split("/"),t||(r=_.default.map(r,c)),U.set(s,r)),r}class q{constructor(e){this.variables=[];var t=_.default.endsWith(e,"/$*");const s=(e=t?e.slice(0,-3):e).replace(/\/\$[^/]*/g,e=>(1<e.length&&this.variables.push(e.slice(1)),""));if(Object.freeze(this.variables),/[.$#[\]]|\\(?![0-9a-f][0-9a-f])/i.test(s))throw new Error("Path pattern has unescaped keys: "+e);this._regex=new RegExp("^"+s.replace(/\u0001/g,"/([^/]+)")+(t?"($|/)":"$"))}match(e){this._regex.lastIndex=0;var t=this._regex.exec(e);if(t){const s={};for(let e=0;e<this.variables.length;e++)s[this.variables[e]]=c(t[e+1]);return s}}test(e){return this._regex.test(e)}toString(){return this._regex.toString()}}function y(e){let t=s[e];return t||(t=new q(e),1e3===_.default.size(s)&&delete s[_.default.keys(s)[0]],s[e]=t),t}const V="3.0.0";class i{constructor({path:e,value:t,exists:s,writeSerial:r}){this._path=e,this._value=t,this._exists=void 0===t?s||!1:null!==t,this._writeSerial=r}get path(){return this._path}get exists(){return this._exists}get value(){if(void 0===this._value)throw new Error("Value omitted from snapshot");return this._value}get key(){return void 0===this._key&&(this._key=c(this._path.replace(/.*\//,""))),this._key}get writeSerial(){return this._writeSerial}}class W{constructor(e){this._idCounter=0,this._deferreds={},this._suspended=!1,this._servers={},this._callbacks={},this._log=_.default.noop,this._inboundMessages=[],this._outboundMessages=[],this._flushMessageQueue=this._flushMessageQueue.bind(this),this._port=e.port||e,this._shared=!!e.port,Object.seal(this),this._port.onmessage=this._receive.bind(this),window.addEventListener("unload",()=>{this._send({msg:"destroy"})})}init(e,t){const s=[];try{const i=window.localStorage||window.sessionStorage;if(!i)throw new Error("localStorage and sessionStorage not available");for(let e=0;e<i.length;e++){var r=i.key(e);s.push({key:r,value:i.getItem(r)})}}catch(e){}return this._send({msg:"init",storage:s,config:t}).then(e=>{var t=e.version.match(/^(\d+)\.(\d+)\.(\d+)(-.*)?$/);if(t){var s=V.match(/^(\d+)\.(\d+)\.(\d+)(-.*)?$/);if(!(t[1]===s[1]&&(t[2]>s[2]||t[2]===s[2]&&t[3]>=s[3])))return Promise.reject(new Error(`Incompatible Firetruss worker version: ${e.version} `+`(${V} or better required)`))}return e})}suspend(e){this._suspended===(e=void 0===e?!0:e)||(this._suspended=e)||(this._receiveMessages(this._inboundMessages),this._inboundMessages=[],this._outboundMessages.length&&Promise.resolve().then(this._flushMessageQueue))}enableLogging(e){e?(!0===e&&(e=console.log.bind(console),this._send({msg:"enableFirebaseLogging",value:!0})),this._log=e):(this._send({msg:"enableFirebaseLogging",value:!1}),this._log=_.default.noop)}_send(s){s.id=++this._idCounter;let e;if(s.oneWay)e=Promise.resolve();else{e=new Promise((e,t)=>{this._deferreds[s.id]={resolve:e,reject:t}});const t=this._deferreds[s.id];(t.promise=e).sent=new Promise(e=>{t.resolveSent=e}),t.params=s}return this._outboundMessages.length||this._suspended||Promise.resolve().then(this._flushMessageQueue),this._log("send:",s),this._outboundMessages.push(s),e}_flushMessageQueue(){try{this._port.postMessage(this._outboundMessages),this._outboundMessages=[]}catch(e){throw e.extra={messages:this._outboundMessages},e}}_receive(e){this._suspended?this._inboundMessages=this._inboundMessages.concat(e.data):this._receiveMessages(e.data)}_receiveMessages(e){for(const t of e){this._log("recv:",t);const s=this[t.msg];if(!_.default.isFunction(s))throw new Error("Unknown message: "+t.msg);s.call(this,t)}}bindExposedFunction(e){return function(){return this._send({msg:"call",name:e,args:Array.prototype.slice.call(arguments)})}.bind(this)}resolve(e){const t=this._deferreds[e.id];if(!t)throw new Error("Received resolution to inexistent Firebase call");delete this._deferreds[e.id],t.resolve(e.result)}reject(e){const t=this._deferreds[e.id];if(!t)throw new Error("Received rejection of inexistent Firebase call");delete this._deferreds[e.id],t.reject(K(e.error,t.params))}updateLocalStorage({items:e}){try{const t=window.localStorage||window.sessionStorage;for(const s of e)null===s.value?t.removeItem(s.key):t.setItem(s.key,s.value)}catch(e){}}trackServer(e){if(this._servers.hasOwnProperty(e))return Promise.resolve();var t=this._servers[e]={authListeners:[]},t=this._registerCallback(this._authCallback.bind(this,t));this._send({msg:"onAuth",url:e,callbackId:t})}_authCallback(e,t){e.auth=t;for(const s of e.authListeners)s(t)}onAuth(e,t,s){const r=t.bind(s);r.callback=t,r.context=s,this._servers[e].authListeners.push(r),r(this.getAuth(e))}offAuth(e,t,s){const r=this._servers[e].authListeners;for(let e=0;e<r.length;e++){var i=r[e];if(i.callback===t&&i.context===s){r.splice(e,1);break}}}getAuth(e){return this._servers[e].auth}authWithCustomToken(e,t){return this._send({msg:"authWithCustomToken",url:e,authToken:t})}authAnonymously(e){return this._send({msg:"authAnonymously",url:e})}unauth(e){return this._send({msg:"unauth",url:e})}set(e,t,s){return this._send({msg:"set",url:e,value:t,writeSerial:s})}update(e,t,s){return this._send({msg:"update",url:e,value:t,writeSerial:s})}once(e,t){return this._send({msg:"once",url:e,writeSerial:t}).then(e=>new i(e))}on(e,t,s,r,i,n,a,o){n={listenerKey:e,eventType:r,snapshotCallback:i,cancelCallback:n,context:a,params:{msg:"on",listenerKey:e,url:t,spec:s,eventType:r,options:o}};const l=this._onCallback.bind(this,n);this._registerCallback(l,n),i.__callbackIds=i.__callbackIds||[],i.__callbackIds.push(n.id),this._send({msg:"on",listenerKey:e,url:t,spec:s,eventType:r,callbackId:n.id,options:o}).catch(e=>{l(e)})}off(t,e,s,r,i,n){const a=[];let o;if(i){if(!(o=this._findAndRemoveCallbackId(i,e=>_.default.isMatch(e,{listenerKey:t,eventType:r,context:n}))))return Promise.resolve();a.push(o)}else for(const h of _.default.keys(this._callbacks)){var l=this._callbacks[h];l.listenerKey!==t||r&&l.eventType!==r||a.push(h)}for(const u of a)this._nullifyCallback(u);return this._send({msg:"off",listenerKey:t,url:e,spec:s,eventType:r,callbackId:o}).then(()=>{for(const e of a)this._deregisterCallback(e)})}_onCallback(e,t,s){t?(this._deregisterCallback(e.id),t=K(t,e.params),e.cancelCallback?e.cancelCallback.call(e.context,t):console.error(t)):e.snapshotCallback.call(e.context,new i(s))}transaction(e,t,s,r){return this._send({msg:"transaction",url:e,oldValue:t,relativeUpdates:s,writeSerial:r}).then(e=>(e.snapshots&&(e.snapshots=_.default.map(e.snapshots,e=>new i(e))),e))}onDisconnect(e,t,s){return this._send({msg:"onDisconnect",url:e,method:t,value:s})}bounceConnection(){return this._send({msg:"bounceConnection"})}callback({id:e,args:t}){const s=this._callbacks[e];if(!s)throw new Error("Unregistered callback: "+e);s.callback.apply(null,t)}_registerCallback(e,t){return(t=t||{}).callback=e,t.id="cb"+ ++this._idCounter,(this._callbacks[t.id]=t).id}_nullifyCallback(e){this._callbacks[e].callback=_.default.noop}_deregisterCallback(e){delete this._callbacks[e]}_findAndRemoveCallbackId(t,s){if(t.__callbackIds){let e=0;for(;e<t.__callbackIds.length;){var r=t.__callbackIds[e],i=this._callbacks[r];if(i){if(s(i))return t.__callbackIds.splice(e,1),r;e+=1}else t.__callbackIds.splice(e,1)}}}}function K(t,e){if(!t||_.default.isError(t))return t;const s=new Error(t.message);s.params=e;for(const r in t)if("message"!==r&&t.hasOwnProperty(r))try{s[r]=t[r]}catch(e){s.extra=s.extra||{},s.extra[r]=t[r]}return s}const N={};Object.freeze(N);class b{constructor(e,t,s){this._tree=e,this._path=t.replace(/^\/*/,"/").replace(/\/$/,"")||"/",s&&(this._annotations=s,Object.freeze(s))}get $ref(){return this}get key(){return this._key||(this._key=c(this._path.replace(/.*\//,""))),this._key}get path(){return this._path}get _pathPrefix(){return"/"===this._path?"":this._path}get parent(){return new w(this._tree,this._path.replace(/\/[^/]*$/,""),this._annotations)}get annotations(){return this._annotations||N}child(){if(!arguments.length)return this;const e=[];for(const t of arguments){if(_.default.isNil(t))return;e.push(p(t))}return new w(this._tree,this._pathPrefix+"/"+e.join("/"),this._annotations)}children(){if(!arguments.length)return this;const t=[];for(let e=0;e<arguments.length;e++){var s=arguments[e];if(_.default.isArray(s)){const a={};var r=this._pathPrefix+(t.length?"/"+t.join("/"):""),i=_.default.slice(arguments,e+1);for(const o of s){const l=new w(this._tree,r+"/"+p(o),this._annotations);var n=l.children.apply(l,i);n&&(a[o]=n)}return a}if(_.default.isNil(s))return;t.push(p(s))}return new w(this._tree,this._pathPrefix+"/"+t.join("/"),this._annotations)}peek(e){return this._tree.truss.peek(this,e)}match(e){return y(e).match(this.path)}test(e){return y(e).test(this.path)}isEqual(e){return e instanceof b&&(this._tree===e._tree&&this.toString()===e.toString()&&_.default.isEqual(this._annotations,e._annotations))}belongsTo(e){return this._tree.truss===e}}class v extends b{constructor(e,t,s,r){super(e,t,r),this._spec=this._copyAndValidateSpec(s);e=_.default(this._spec).map((e,t)=>t+"="+encodeURIComponent(JSON.stringify(e))).sortBy().join("&");this._string=this._path+"?"+e,Object.freeze(this)}get ready(){return this._tree.isQueryReady(this)}get constraints(){return this._spec}annotate(e){return new v(this._tree,this._path,this._spec,_.default.assign({},this._annotations,e))}_copyAndValidateSpec(t){if(!t.by)throw new Error('Query needs "by" clause: '+JSON.stringify(t));if(1<("at"in t)+("from"in t)+("to"in t))throw new Error('Query must contain at most one of "at", "from", or "to" clauses: '+JSON.stringify(t));if(1<("first"in t)+("last"in t))throw new Error('Query must contain at most one of "first" or "last" clauses: '+JSON.stringify(t));if(!_.default.some(["at","from","to","first","last"],e=>e in t))throw new Error('Query must contain at least one of "at", "from", "to", "first", or "last" clauses: '+JSON.stringify(t));if("$key"!==(t=_.default.clone(t)).by&&"$value"!==t.by){if(!(t.by instanceof w))throw new Error('Query "by" value must be a reference: '+t.by);let e=t.by.toString();if(!_.default.startsWith(e,this._path))throw new Error('Query "by" value must be a descendant of target reference: '+t.by);if(e=e.slice(this._path.length).replace(/^\/?/,""),!_.default.includes(e,"/"))throw new Error('Query "by" value must not be a direct child of target reference: '+t.by);t.by=e.replace(/.*?\//,"")}return Object.freeze(t),t}toString(){return this._string}}class w extends b{constructor(e,t,s){super(e,t,s),Object.freeze(this)}get ready(){return this._tree.isReferenceReady(this)}get value(){return this._tree.getObject(this.path)}toString(){return this._path}annotate(e){return new w(this._tree,this._path,_.default.assign({},this._annotations,e))}query(e){return new v(this._tree,this._path,e,this._annotations)}set(e){return this._checkForUndefinedPath(),this._tree.update(this,"set",{[this.path]:e})}update(e){return this._checkForUndefinedPath(),this._tree.update(this,"update",e)}override(e){return this._checkForUndefinedPath(),this._tree.update(this,"override",{[this.path]:e})}commit(e){return this._checkForUndefinedPath(),this._tree.commit(this,e)}_checkForUndefinedPath(){if("/undefined"===this.path)throw new Error("Invalid path for operation: "+this.path)}}const L=Object.freeze({".sv":"timestamp"});function $(e,t){return _.default.isEqualWith(e,t,Q)}function Q(e,t){return e===t||null==e||null==t||e.$truss||t.$truss?e===t:e.isEqual?e.isEqual(t):void 0}function H(e,t){for(const s of Object.getOwnPropertyNames(e.prototype))"constructor"!==s&&Object.defineProperty(t.prototype,s,Object.getOwnPropertyDescriptor(e.prototype,s))}e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function B(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var k={exports:{}};!function(){var e,t,s,r,i,n;"undefined"!=typeof performance&&null!==performance&&performance.now?k.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(k.exports=function(){return(e()-i)/1e6},t=process.hrtime,r=(e=function(){var e=t();return 1e9*e[0]+e[1]})(),n=1e9*process.uptime(),i=r-n):s=Date.now?(k.exports=function(){return Date.now()-s},Date.now()):(k.exports=function(){return(new Date).getTime()-s},(new Date).getTime())}.call(e);var P=B(k.exports);class E{constructor(e){_.default.assign(this,{name:e,numRecomputes:0,numUpdates:0,runtime:0})}add(e){this.runtime+=e.runtime,this.numUpdates+=e.numUpdates,this.numRecomputes+=e.numRecomputes}get runtimePerRecompute(){return this.numRecomputes?this.runtime/this.numRecomputes:0}toLogParts(e){return[this.name+":",` ${(this.runtime/1e3).toFixed(2)}s`,`(${(this.runtime/e.runtime*100).toFixed(1)}%)`,` ${this.numUpdates} upd /`,this.numRecomputes+" runs",`(${(this.numUpdates/this.numRecomputes*100).toFixed(1)}%)`,` ${this.runtimePerRecompute.toFixed(2)}ms / run`]}}var n=new class{constructor(){this._items={}}for(e){return this._items[e]||(this._items[e]=new E(e)),this._items[e]}get list(){return _.default(this._items).values().sortBy(e=>-e.runtime).value()}log(e=10){var t=this.list;if(t.length){const s=new E("=== Total"),r=(_.default.forEach(t,e=>{s.add(e)}),t=_.default.take(t,e),new E("--- Above")),i=(_.default.forEach(t,e=>{r.add(e)}),_.default.map(t,e=>e.toLogParts(s))),n=(i.push(r.toLogParts(s)),i.push(s.toLogParts(s)),_.default.map(_.default.range(i[0].length),t=>_.default(i).map(e=>e[t].length).max()));_.default.forEach(i,e=>{console.log(_.default.map(e,(e,t)=>_.default.padStart(e,n[t])).join(" "))})}}wrap(r,e,i){const n=this.for(e+"."+i);return function(){var e=P(),t=this._computedWatchers&&this._computedWatchers[i].value;try{var s=r.call(this);return $(t,s)||(n.numUpdates+=1),s}finally{n.runtime+=P()-e,n.numRecomputes+=1}}}};class O{constructor(e,t,s,r,i){Object.freeze(t),this._scope=e,this._connections=t,this._tree=s,this._method=r,this._subConnectors={},this._disconnects={},this._angularUnwatches=void 0,this._data={},this._vue=new o.default({data:{descriptors:{},refs:i||{},values:_.default.mapValues(t,_.default.constant(void 0))}}),this.destroy=this.destroy,Object.seal(this),this._linkScopeProperties(),_.default.forEach(t,(e,t)=>{_.default.isFunction(e)?this._bindComputedConnection(t,e):this._connect(t,e)}),d.active&&e&&e.$on&&e.$id&&e.$on("$destroy",()=>{this.destroy()})}get ready(){return _.default.every(this._connections,(e,t)=>{var s=this._vue.descriptors[t];return!!s&&(s instanceof b?s:this._subConnectors[t]).ready})}get at(){return this._vue.refs}get data(){return this._data}destroy(){this._unlinkScopeProperties(),_.default.forEach(this._angularUnwatches,e=>{e()}),_.default.forEach(this._connections,(e,t)=>{this._disconnect(t)}),this._vue.$destroy()}_linkScopeProperties(){var e=_.default.mapValues(this._connections,(e,t)=>({configurable:!0,enumerable:!1,get:()=>{var e=this._vue.descriptors[t];return e instanceof w?e.value:this._vue.values[t]}}));if(Object.defineProperties(this._data,e),this._scope){for(const t in this._connections)if(t in this._scope)throw new Error("Property already defined on connection target: "+t);Object.defineProperties(this._scope,e),this._scope.__ob__&&this._scope.__ob__.dep.notify()}}_unlinkScopeProperties(){this._scope&&_.default.forEach(this._connections,(e,t)=>{delete this._scope[t]})}_bindComputedConnection(e,t){var s=n.for("connection.at."+e),r=this._computeConnection.bind(this,t,s),e=this._updateComputedConnection.bind(this,e,t,s),s=d.active&&!t.angularWatchSuppressed;this._vue.$watch(r,e,{immediate:!s}),s&&(this._angularUnwatches||(this._angularUnwatches=[]),this._angularUnwatches.push(d.watch(r,e,!0)))}_computeConnection(e,t){var s=P();try{return J(e.call(this._scope))}finally{t.runtime+=P()-s,t.numRecomputes+=1}}_updateComputedConnection(e,t,s){var t=_.default.isFunction(t)?t(this._scope):t,r=!$(this._vue.descriptors[e],t);r&&(s&&r&&(s.numUpdates+=1),t?(t instanceof b||!_.default.has(this._subConnectors,e)?(this._disconnect(e),this._connect(e,t)):this._subConnectors[e]._updateConnections(t),o.default.set(this._vue.descriptors,e,t),d.digest()):this._disconnect(e))}_updateConnections(s){_.default.forEach(s,(e,t)=>{this._updateComputedConnection(t,e)}),_.default.forEach(this._connections,(e,t)=>{_.default.has(s,t)||this._updateComputedConnection(t)}),this._connections=s}_connect(t,e){if(o.default.set(this._vue.descriptors,t,e),d.digest(),e)if(o.default.set(this._vue.values,t,void 0),e instanceof w)o.default.set(this._vue.refs,t,e),this._disconnects[t]=this._tree.connectReference(e,this._method);else if(e instanceof v){o.default.set(this._vue.refs,t,e);var s=this._updateQueryValue.bind(this,t);this._disconnects[t]=this._tree.connectQuery(e,s,this._method)}else{const r={},i={},n=(o.default.set(this._vue.refs,t,i),this._subConnectors[t]=new O(r,e,this._tree,this._method,i)),a=this._disconnects[t]=this._tree.truss.observe(()=>n.ready,e=>{e&&(a(),delete this._disconnects[t],o.default.set(this._vue.values,t,r),d.digest())})}}_disconnect(e){o.default.delete(this._vue.refs,e),this._updateRefValue(e,void 0),_.default.has(this._subConnectors,e)&&(this._subConnectors[e].destroy(),delete this._subConnectors[e]),this._disconnects[e]&&this._disconnects[e](),delete this._disconnects[e],o.default.delete(this._vue.descriptors,e),d.digest()}_updateRefValue(e,t){this._vue.values[e]!==t&&(o.default.set(this._vue.values,e,t),d.digest())}_updateQueryValue(e,t){this._vue.values[e]||(o.default.set(this._vue.values,e,{}),d.digest());const s=this._vue.values[e];for(const i in s)!s.hasOwnProperty(i)||_.default.includes(t,i)||(o.default.delete(s,i),d.digest());var r=this._tree.getObject(this._vue.descriptors[e].path);for(const n of t)s.hasOwnProperty(n)||(o.default.set(s,n,r[n]),d.digest())}}function J(e){if(e)return e instanceof b?e.toString():_.default.mapValues(e,J)}function j(e){return function(){try{return Promise.resolve(e.apply(this,arguments))}catch(e){return Promise.reject(e)}}}function t(e,t){return(e=C(e,()=>{t=null})).cancel=()=>{t&&(t(),t=null)},function r(i,n){const a=i.then,s=i.catch;i.then=(e,t)=>{const s=a.call(i,e,t);return s[n]=i[n],r(s,n),s};i.catch=e=>{const t=s.call(i,e);return t[n]=i[n],r(t,n),t};return i}(e,"cancel"),e}function C(e,t){return t?(t=j(t),e.then(e=>t().then(()=>e),e=>t().then(()=>Promise.reject(e)))):e}const G=["read","write","auth","set","update","commit","connect","peek","authenticate","unathenticate","certify","all"],r=[];class Y{constructor(e,t,s){this._operation=e,this._delay=t,this._callback=s,this._fired=!1}initiate(){this.cancel(),this._fired=!1;var e=Date.now()-this._operation._startTimestamp;this._timeoutId=setTimeout(()=>{this._fired=!0,this._callback(this._operation)},this._delay-e)}cancel(){this._fired&&this._callback(this._operation),this._timeoutId&&clearTimeout(this._timeoutId)}}class X{constructor(e,t,s,r){this._type=e,this._method=t,this._target=s,this._operand=r,this._ready=!1,this._running=!1,this._ended=!1,this._tries=0,this._startTimestamp=Date.now(),this._slowHandles=[]}get type(){return this._type}get method(){return this._method}get target(){return this._target}get targets(){return"update"!==this._method?[this._target]:_.default.map(this._operand,(e,t)=>new w(this._target._tree,g(this._target.path,t),this._target._annotations))}get operand(){return this._operand}get ready(){return this._ready}get running(){return this._running}get ended(){return this._ended}get tries(){return this._tries}get error(){return this._error}onSlow(e,t){const s=new Y(this,e,t);this._slowHandles.push(s),s.initiate()}_setRunning(e){this._running=e}_setEnded(e){this._ended=e}_markReady(e){this._ready=!0,e||(this._tries=0),_.default.forEach(this._slowHandles,e=>e.cancel())}_clearReady(){this._ready=!1,this._startTimestamp=Date.now(),_.default.forEach(this._slowHandles,e=>e.initiate())}_incrementTries(){this._tries++}}class Z{constructor(e){this._bridge=e,this._callbacks={},Object.freeze(this)}intercept(e,t){if(!_.default.includes(G,e))throw new Error("Unknown intercept operation type: "+e);const s=_.default.difference(_.default.keys(t),["onBefore","onAfter","onError","onFailure"]);if(s.length)throw new Error("Unknown intercept callback types: "+s.join(", "));t={onBefore:this._addCallback("onBefore",e,t.onBefore),onAfter:this._addCallback("onAfter",e,t.onAfter),onError:this._addCallback("onError",e,t.onError),onFailure:this._addCallback("onFailure",e,t.onFailure)};return this._removeCallbacks.bind(this,e,t)}_addCallback(e,t,s){if(s)return e=this._getCallbacksKey(e,t),t=j(s),(this._callbacks[e]||(this._callbacks[e]=[])).push(t),t}_removeCallback(e,t,s){s&&(e=this._getCallbacksKey(e,t),this._callbacks[e]&&_.default.pull(this._callbacks[e],s))}_removeCallbacks(s,e){_.default.forEach(e,(e,t)=>{this._removeCallback(t,s,e)})}_getCallbacks(e,t,s){return[].concat(this._callbacks[this._getCallbacksKey(e,s)]||r,this._callbacks[this._getCallbacksKey(e,t)]||r,this._callbacks[this._getCallbacksKey(e,"all")]||r)}_getCallbacksKey(e,t){return e+"_"+t}execute(e,t,s,r,i){i=j(i);const n=this.createOperation(e,t,s,r);return this.begin(n).then(()=>{const t=()=>i().catch(e=>this._retryOrEnd(n,e).then(t));return t()}).then(e=>this.end(n).then(()=>e))}createOperation(e,t,s,r){return new X(e,t,s,r)}begin(t){return Promise.all(_.default.map(this._getCallbacks("onBefore",t.type,t.method),e=>e(t))).then(()=>{t.ended||t._setRunning(!0)},e=>this.end(t,e))}markReady(e){e._markReady()}clearReady(e){e._clearReady()}retry(t,s){return t._incrementTries(),t._error=s,Promise.all(_.default.map(this._getCallbacks("onError",t.type,t.method),e=>e(t,s))).then(e=>{if(!t.ended)return e=_.default.some(e),e&&delete t._error,e})}_retryOrEnd(t,s){return this.retry(t,s).then(e=>{if(!e)return this.end(t,s)},e=>this.end(t,e))}end(t,e){return t.ended?Promise.resolve():(t._setRunning(!1),t._setEnded(!0),e?t._error=e:delete t._error,Promise.all(_.default.map(this._getCallbacks("onAfter",t.type,t.method),e=>e(t))).then(()=>this._afterEnd(t),e=>(t._error=e,this._afterEnd(t))))}_afterEnd(t){if(t._markReady(!0),!t.error)return Promise.resolve();const e=this._getCallbacks("onFailure",t.type,t.method);return e&&setTimeout(()=>{_.default.forEach(e,e=>e(t))},0),Promise.reject(t.error)}}const ee="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",te=window.crypto&&window.crypto.getRandomValues&&window.crypto.getRandomValues.bind(window.crypto);class se{constructor(){this._lastUniqueKeyTime=0,this._lastRandomValues=[]}generateUniqueKey(e){e=e||Date.now();const t=new Array(20);let s=e;for(let e=7;0<=e;e--)t[e]=ee.charAt(63&s),s=Math.floor(s/64);if(e===this._lastUniqueKeyTime){let e=11;for(;0<=e&&63===this._lastRandomValues[e];)this._lastRandomValues[e]=0,--e;if(-1===e)throw new Error("Internal assertion failure: ran out of unique IDs for this millisecond");this._lastRandomValues[e]+=1}else if(this._lastUniqueKeyTime=e,te){var r=new Uint8Array(12);te(r);for(let e=0;e<12;e++)this._lastRandomValues[e]=r[e]&(e?63:15)}else for(let e=0;e<12;e++)this._lastRandomValues[e]=Math.floor(Math.random()*(e?64:16));for(let e=0;e<12;e++)t[e+8]=ee[this._lastRandomValues[e]];return t.join("")}}class re{constructor(e,t,s,r){this._rootUrl=e,this._tree=t,this._dispatcher=r,this._bridge=s,this._vue=new o.default({data:{$root:{connected:void 0,timeOffset:0,user:void 0,userid:void 0,nowAtInterval(e){const t="now"+e;var s;return this.hasOwnProperty(t)||((s=()=>{o.default.set(this,t,Date.now()+this.timeOffset),d.digest()})(),setInterval(s,e)),this[t]}}}}),this._auth={serial:0,initialAuthChangeReceived:!1,changePromise:Promise.resolve()},s.onAuth(e,this._handleAuthChange,this),this._connectInfoProperty("serverTimeOffset","timeOffset"),this._connectInfoProperty("connected","connected"),Object.freeze(this)}get root(){return this._vue.$data.$root}destroy(){this._bridge.offAuth(this._rootUrl,this._handleAuthChange,this),this._vue.$destroy()}authenticate(t){return this._auth.serial++,this._dispatcher.execute("auth","authenticate",new w(this._tree,"/"),t,()=>{const e=t?this._bridge.authWithCustomToken(this._rootUrl,t):this._bridge.authAnonymously(this._rootUrl);return e.then(()=>this._auth.changePromise)})}unauthenticate(){return this._auth.serial++,this._handleAuthChange(null).then(e=>{if(e)return this._dispatcher.execute("auth","unauthenticate",new w(this._tree,"/"),void 0,()=>this._bridge.unauth(this._rootUrl))})}_handleAuthChange(e){var t=!this._auth.initialAuthChangeReceived&&this._auth.serial;if(void 0!==e&&(this._auth.initialAuthChangeReceived=!0),!t){const s=this._auth.serial;if(this.root.user===e)return Promise.resolve(!1);const r=this._dispatcher.execute("auth","certify",new w(this._tree,"/"),e,()=>this.root.user!==e&&s===this._auth.serial&&(e&&Object.freeze(e),this.root.user=e,this.root.userid=e&&e.uid,d.digest(),!0));return this._auth.changePromise=this._auth.changePromise.then(()=>r).catch(),r}}_isAuthChangeStale(e){return this.root.user===e}_connectInfoProperty(e,t){const s=new URL(this._rootUrl);s.pathname=encodeURI("/.info/"+e),this._bridge.on(s.href,s.href,null,"value",e=>{this.root[t]=e.value,d.digest()})}}const ie={__ob__:!0};let S,R;class x{get $info(){return this.$truss.info}get $store(){return this.$truss.store}get $now(){return this.$truss.now}$newKey(){return this.$truss.newKey()}$intercept(e,t){if(this.$destroyed)throw new Error("Object already destroyed");const s=this.$truss.intercept(e,t),r=()=>{s(),_.default.pull(this.$$finalizers,r)};return this.$$finalizers.push(r),r}$connect(e,t){if(this.$destroyed)throw new Error("Object already destroyed");t||(t=e,e=void 0);const s=this.$truss.connect(e,function t(s,e){if(!e||e instanceof b)return e;if(_.default.isFunction(e)){const r=function(){return s.$$touchThis(),t(s,e.call(this))};return r.angularWatchSuppressed=!0,r}return _.default.mapValues(e,e=>t(s,e))}(this,t)),r=s.destroy,i=()=>(_.default.pull(this.$$finalizers,i),r.call(s));return this.$$finalizers.push(i),s.destroy=i,s}$peek(e,t){if(this.$destroyed)throw new Error("Object already destroyed");const s=C(this.$truss.peek(e,t),()=>{_.default.pull(this.$$finalizers,s.cancel)});return this.$$finalizers.push(s.cancel),s}$observe(e,t,s){if(this.$destroyed)throw new Error("Object already destroyed");let r;const i=this.$truss.observe(()=>(this.$$touchThis(),e.call(this)),t.bind(this),s);return r=()=>{i(),_.default.pull(this.$$finalizers,r)},this.$$finalizers.push(r),r}$when(e,t){if(this.$destroyed)throw new Error("Object already destroyed");const s=this.$truss.when(()=>(this.$$touchThis(),e.call(this)),t);return C(s,()=>{_.default.pull(this.$$finalizers,s.cancel)}),this.$$finalizers.push(s.cancel),s}get $$finalizers(){return Object.defineProperty(this,"$$finalizers",{value:[],writable:!1,enumerable:!1,configurable:!1}),this.$$finalizers}}class A{get $parent(){return S.$parent.value}get $path(){return S.$path.value}get $truss(){return Object.defineProperty(this,"$truss",{value:this.$parent.$truss}),this.$truss}get $ref(){return Object.defineProperty(this,"$ref",{value:new w(this.$truss._tree,this.$path)}),this.$ref}get $refs(){return this.$ref}get $key(){return Object.defineProperty(this,"$key",{value:c(this.$path.slice(this.$path.lastIndexOf("/")+1))}),this.$key}get $data(){return this}get $hidden(){return!1}get $empty(){return _.default.isEmpty(this.$data)}get $keys(){return _.default.keys(this.$data)}get $values(){return _.default.values(this.$data)}get $ready(){return this.$ref.ready}get $overridden(){return!1}$nextTick(){if(this.$destroyed)throw new Error("Object already destroyed");const e=this.$truss.nextTick();return C(e,()=>{_.default.pull(this.$$finalizers,e.cancel)}),this.$$finalizers.push(e.cancel),e}$freezeComputedProperty(){if(!_.default.isBoolean(R))throw new Error("Cannot freeze a computed property outside of its getter function");R=!0}$set(e){return this.$ref.set(e)}$update(e){return this.$ref.update(e)}$override(e){return this.$ref.override(e)}$commit(e,t){return this.$ref.commit(e,t)}$$touchThis(){this.__ob__?this.__ob__.dep.depend():this.$parent?(this.$parent.hasOwnProperty("$data")?this.$parent.$data:this.$parent)[this.$key]:this.$store}get $$initializers(){return Object.defineProperty(this,"$$initializers",{value:[],writable:!1,enumerable:!1,configurable:!0}),this.$$initializers}get $destroyed(){return!1}}H(x,A),_.default.forEach(A.prototype,(e,t)=>{Object.defineProperty(A.prototype,t,{value:e,enumerable:!1,configurable:!1,writable:!1})});class T{constructor(e){this.error=e}}class ne{constructor(e){this.value=e}}class ae{constructor(e){this._trie={Class:A},this._debug=e,Object.freeze(this)}init(e,t){_.default.isPlainObject(e)&&(_.default.forEach(e,(e,t)=>{e.$trussMount||(e.$$trussMount=e.$$trussMount||[],e.$$trussMount.push(t))}),e=_.default.values(e),_.default.forEach(e,e=>{!e.$trussMount&&e.$$trussMount&&(e.$trussMount=e.$$trussMount,delete e.$$trussMount)})),e=_.default.uniq(e),_.default.forEach(e,e=>this._mountClass(e,t)),this._decorateTrie(this._trie)}destroy(){}_getMount(e,t,s){let r;for(const i of m(e,!0)){let e=i?r.children&&(r.children[i]||!t&&r.children.$):this._trie;if(!e){if(!t)return;r.children=r.children||{},e=r.children[i]={Class:A}}if(r=e,s&&s(r))break}return r}_findMount(e,t){if(e(t=t||this._trie))return t;for(const r of _.default.keys(t.children)){var s=this._findMount(e,t.children[r]);if(s)return s}}_decorateTrie(t){_.default.forEach(t.children,e=>{this._decorateTrie(e),(e.local||e.localDescendants)&&(t.localDescendants=!0)})}_augmentClass(e){let t,s=e.prototype;for(;s&&s.constructor!==Object;){for(const i of Object.getOwnPropertyNames(s)){var r=Object.getOwnPropertyDescriptor(s,i);if("$"===i.charAt(0)){if("$finalize"===i)continue;if(_.default.isEqual(r,Object.getOwnPropertyDescriptor(A.prototype,i)))continue;throw new Error(`Property names starting with "$" are reserved: ${e.name}.`+i)}!r.get||t&&t[i]||((t=t||{})[i]={name:i,fullName:s.constructor.name+"."+i,get:r.get,set:r.set})}s=Object.getPrototypeOf(s)}for(const n of Object.getOwnPropertyNames(A.prototype))"constructor"===n||e.prototype.hasOwnProperty(n)||Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(A.prototype,n));return t}_mountClass(n,a){const o=this._augmentClass(n),l=[];let e=n.$trussMount;if(!e)throw new Error(`Class ${n.name} lacks a $trussMount static property`);_.default.isArray(e)||(e=[e]),_.default.forEach(e,e=>{if(_.default.isString(e)&&(e={path:e}),!a&&"/"===e.path)throw new Error("Data root already accessed, too late to mount class");var t=y(e.path);for(const i of t.variables){if("$"===i||"$"===i.charAt(1))throw new Error("Invalid variable name: "+i);if("$"===i.charAt(0)&&(_.default.has(A.prototype,i)||ie[i]))throw new Error("Variable name conflicts with built-in property or method: "+i);l.push(i)}const s=e.path.match(/\/([^/]*)$/)[1];if("$"===s.charAt(0)){if(e.placeholder)throw new Error(`Class ${n.name} mounted at wildcard ${s} cannot be a placeholder`)}else _.default.has(e,"placeholder")||(e.placeholder={});const r=this._getMount(e.path.replace(/\$[^/]*/g,"$"),!0);if(r.matcher&&(r.escapedKey===s||"$"===r.escapedKey.charAt(0)&&"$"===s.charAt(0)))throw new Error(`Multiple classes mounted at ${e.path}: ${r.Class.name}, `+n.name);_.default.assign(r,{Class:n,matcher:t,computedProperties:o,escapedKey:s},_.default.pick(e,"placeholder","local","keysUnsafe","hidden"))}),_.default(l).uniq().forEach(e=>{Object.defineProperty(n.prototype,e,{get(){return S?S[e]&&S[e].value:void 0}})})}createObject(e,t){const s=this._getMount(e)||{Class:A};try{if(s.matcher){var r=s.matcher.match(e);for(const n in r)t[n]={value:r[n]}}S=t;const i=new s.Class;return S=null,d.active&&this._wrapProperties(i),s.keysUnsafe&&(t.$data={value:Object.create(null),configurable:!0,enumerable:!0}),s.hidden&&(t.$hidden={value:!0}),s.computedProperties&&_.default.forEach(s.computedProperties,e=>{t[e.name]=this._buildComputedPropertyDescriptor(i,e)}),i}catch(e){throw e.extra=_.default.assign({mount:s,properties:t,className:s.Class&&s.Class.name},e.extra),e}}_wrapProperties(r){_.default.forEach(r,(e,t)=>{const s="$_"+t;Object.defineProperties(r,{[s]:{value:e,writable:!0},[t]:{get:()=>r[s],set:e=>{r[s]=e,d.digest()},enumerable:!0,configurable:!0}})})}_buildComputedPropertyDescriptor(a,o){const l=n.for(o.fullName);let h,u,c=!1;return a.$$initializers.push(e=>{let t=!1;const s=function(e,s){if(!this.$destroyed){this.$$touchThis();var r=R,i=(R=!1,P());let t;try{try{t=e.get.call(this)}catch(e){t=new T(e)}finally{s.runtime+=P()-i,s.numRecomputes+=1}return t=R?new ne(t):t}finally{R=r}}}.bind(a,o,l);this._debug&&(s.toString=()=>o.fullName);let r=()=>{t=!0};r=e.$watch(s,e=>{if(a.$destroyed)r();else if(u&&(u.cancel&&u.cancel(),u=void 0),_.default.isObject(e)&&_.default.isFunction(e.then)){const t=e.then(e=>{t===u&&n(e)},e=>{if(t===u&&n(new T(e))&&!e.trussExpectedException)throw e});u=t}else if(n(e)&&(d.digest(),e instanceof T&&!e.error.trussExpectedException))throw e.error},{immediate:!0});const i=_.default.last(e._watchers||e._scope.effects);function n(e){return e instanceof ne&&(e=e.value,r(),_.default.pull(a.$$finalizers,r)),!$(h,e)&&(l.numUpdates+=1,c=!0,a[o.name]=e,c=!1,function t(e){if(_.default.isNil(e)||!_.default.isObject(e)||Object.isFrozen(e)||e.$truss)return e;e=Object.freeze(e);if(_.default.isArray(e))return _.default.map(e,e=>t(e));return _.default.mapValues(e,e=>t(e))}(e),1)}i.id=-i.id,t?r():a.$$finalizers.push(r)}),{enumerable:!0,configurable:!0,get(){if(!c&&h instanceof T)throw h.error;return h},set(e){if(c)h=e;else{if(!o.set)throw new Error("You cannot set a computed property: "+o.name);o.set.call(this,e)}}}}destroyObject(e){if(_.default.has(e,"$$finalizers"))for(const t of _.default.clone(e.$$finalizers))t();_.default.isFunction(e.$finalize)&&e.$finalize(),Object.defineProperty(e,"$destroyed",{value:!0,enumerable:!1,configurable:!1})}isPlaceholder(e){e=this._getMount(e);return e&&e.placeholder}isLocal(e,t){e=this._getMount(e,!1,e=>e.local);if(e&&e.local)return!0;if(this._hasLocalProperties(e,t))throw new Error("Write on a mix of local and remote tree paths.");return!1}_hasLocalProperties(e,t){if(e){if(e.local)return!0;if(e.localDescendants&&_.default.isObject(t))for(const s in t)if(this._hasLocalProperties(e.children[p(s)]||e.children.$,t[s]))return!0}return!1}forEachPlaceholderChild(e,t){e=this._getMount(e);_.default.forEach(e&&e.children,e=>{e.placeholder&&t(e)})}checkVueObject(i,e,t){t||(t=new Set);const s=new Map,r=this._findMount(e=>e.Class===i.constructor);var n,a,o,l,h,u,c,d=_.default(i).thru(Object.getOwnPropertyNames).reject(e=>ie[e]||A.prototype.hasOwnProperty(e)||/^\$_/.test(e)).reject(e=>r&&r.matcher&&_.default.includes(r.matcher.variables,e)).map(e=>{let t;try{t=i[e]}catch(e){return}var s=Object.getOwnPropertyDescriptor(i,e),r=!s.enumerable&&s.set&&!Object.hasOwn(i,"$_"+e);return{key:e,value:t,descriptor:s,computed:r}}).compact().value();for({key:n,value:a,descriptor:o,computed:l}of d){if(!_.default.isArray(i)||!/\d+/.test(n)&&"length"!==n){if("value"in o||!o.get)throw new Error(`Value at ${e}, contained in a Firetruss object, has a rogue property: `+n);if(i.$truss&&o.enumerable)try{throw i[n]=a,new Error(`Firetruss object at ${e} has an enumerable non-Firebase property: `+n)}catch(e){if("firebase_overwrite"!==e.trussCode)throw e}}_.default.isObject(a)&&(t.has(a)||Object.isSealed(a)||_.default.isFunction(a)||a instanceof Promise||(t.add(a),this.checkVueObject(a,g(e,p(n)),t)),l||a.$truss||s.set(a,n))}for({key:h,value:u,computed:c}of d)if(c&&_.default.isObject(u)&&!u.$truss){var f=s.get(u);if(f)throw new Error(`Firetruss object at ${e} has properties ${h} `+`and ${f} with an aliased value`)}}}class oe{constructor(e,t){this._coupler=e,this._query=t,this._listeners=[],this._keys=[],this._coupler._url.pathname=encodeURI(t.path),this._url=this._coupler._url.toString(),this._segments=m(t.path,!0),this._listening=!1,this.ready=!1}attach(e,t){this._listen(),this._listeners.push({operation:e,keysCallback:t}),this.ready&&(this._coupler._dispatcher.markReady(e),t&&t(this._keys))}detach(e){e=_.default.findIndex(this._listeners,{operation:e});return 0<=e&&this._listeners.splice(e,1),this._listeners.length}_listen(){this._listening||(this._coupler._bridge.on(this._query.toString(),this._url,this._query.constraints,"value",this._handleSnapshot,this._handleError,this,{sync:!0}),this._listening=!0)}destroy(){this._coupler._bridge.off(this._query.toString(),this._url,this._query.constraints,"value",this._handleSnapshot,this),this._listening=!1,this.ready=!1,d.digest();for(const e of this._keys)this._coupler._decoupleSegments(this._segments.concat(e))}_handleSnapshot(r){this._coupler._queueSnapshotCallback(()=>{if(this._listeners.length&&this._listening){var e=this._updateKeysAndApplySnapshot(r);if(!this.ready){this.ready=!0,d.digest();for(const t of this._listeners)this._coupler._dispatcher.markReady(t.operation)}if(e)for(const s of this._listeners)s.keysCallback&&s.keysCallback(e)}})}_updateKeysAndApplySnapshot(e){let t;if(e.path===this._query.path){if((t=_.default.keys(e.value)).sort(),_.default.isEqual(this._keys,t))t=null;else{for(const n of _.default.difference(t,this._keys))this._coupler._coupleSegments(this._segments.concat(n));for(const a of _.default.difference(this._keys,t))this._coupler._decoupleSegments(this._segments.concat(a));this._keys=t}if(e.exists){var s=e.value,r=e.path;for(const o of this._keys)e._path=r+"/"+o,e._key=void 0,e._value=s[o],this._coupler._applySnapshot(e);e._path=r,e._key=void 0,e._value=s}}else{var i;e.path.replace(/\/[^/]+/,"")===this._query.path&&(i=_.default.includes(this._keys,e.key),e.value?i||(this._coupler._coupleSegments(this._segments.concat(e.key)),this._keys.push(e.key),this._keys.sort(),t=this._keys):i&&(this._coupler._decoupleSegments(this._segments.concat(e.key)),_.default.pull(this._keys,e.key),this._keys.sort(),t=this._keys),this._coupler._applySnapshot(e))}return t}_handleError(s){if(this._listeners.length&&this._listening){this._listening=!1,this.ready=!1;for(const e of this._keys)this._coupler._decoupleSegments(this._segments.concat(e));this._keys=[],d.digest(),Promise.all(_.default.map(this._listeners,t=>(this._coupler._dispatcher.clearReady(t.operation),this._coupler._dispatcher.retry(t.operation,s).catch(e=>(t.operation._disconnect(e),!1))))).then(e=>{if(_.default.some(e))this._listeners.length&&this._listen();else for(const t of this._listeners)t.operation._disconnect(s)})}}}class le{constructor(e,t,s){this._coupler=e,this.path=t,this.parent=s,this._coupler._url.pathname=encodeURI(t),this.url=this._coupler._url.toString(),this.operations=[],this.queryCount=0,this.listening=!1,this.ready=!1,this.children={}}get active(){return this.count||this.queryCount}get count(){return this.operations.length}listen(e){!e&&this.count?this.listening||(_.default.forEach(this.operations,e=>{this._coupler._dispatcher.clearReady(e)}),this._coupler._bridge.on(this.url,this.url,null,"value",this._handleSnapshot,this._handleError,this,{sync:!0}),this.listening=!0):_.default.forEach(this.children,e=>{e.listen()})}unlisten(e){!e&&this.listening?(this._coupler._bridge.off(this.url,this.url,null,"value",this._handleSnapshot,this),this.listening=!1,this._forAllDescendants(e=>{if(e.listening)return!1;e.ready&&(e.ready=!1,d.digest())})):_.default.forEach(this.children,e=>{e.unlisten()})}_handleSnapshot(e){this._coupler._queueSnapshotCallback(()=>{this.listening&&this._coupler.isTrunkCoupled(e.path)&&(this._coupler._applySnapshot(e),this.ready||e.path!==this.path||(this.ready=!0,d.digest(),this.unlisten(!0),this._forAllDescendants(e=>{for(const t of e.operations)this._coupler._dispatcher.markReady(t)})))})}_handleError(s){if(this.count&&this.listening)return this.listening=!1,this._forAllDescendants(e=>{if(e.listening)return!1;e.ready&&(e.ready=!1,d.digest());for(const t of e.operations)this._coupler._dispatcher.clearReady(t)}),this._coupler._prunePath(this.path),Promise.all(_.default.map(this.operations,t=>this._coupler._dispatcher.retry(t,s).catch(e=>(t._disconnect(e),!1)))).then(e=>{if(_.default.some(e))this.count&&this.listen();else for(const t of this.operations)t._disconnect(s)})}_forAllDescendants(t){!1!==t(this)&&_.default.forEach(this.children,e=>e._forAllDescendants(t))}collectCoupledDescendantPaths(t){return(t=t||{})[this.path]=this.active,this.active||_.default.forEach(this.children,e=>{e.collectCoupledDescendantPaths(t)}),t}}class he{constructor(e,t,s,r,i){this._url=new URL(e),this._bridge=t,this._dispatcher=s,this._applySnapshot=r,this._pendingSnapshotCallbacks=[],this._throttled={processPendingSnapshots:this._processPendingSnapshots},this._prunePath=i,this._vue=new o.default({data:{root:void 0,queryHandlers:{}}}),this._vue._renderProxy=this._vue,this._nodeIndex=Object.create(null),Object.freeze(this),this._vue.$data.root=new le(this,"/"),this._nodeIndex["/"]=this._root}get _root(){return this._vue.$data.root}get _queryHandlers(){return this._vue.$data.queryHandlers}destroy(){_.default.forEach(this._queryHandlers,e=>{e.destroy()}),this._root.unlisten(),this._vue.$destroy()}couple(e,t){return this._coupleSegments(m(e,!0),t)}_coupleSegments(e,t){let s,r=!t,i=!1;for(const n of e){let e=n?s.children&&s.children[n]:this._root;e||(e=new le(this,`${"/"===s.path?"":s.path}/`+n,s),o.default.set(s.children,n,e),this._nodeIndex[e.path]=e),r=r||e.listening,i=i||e.ready,s=e}t?s.operations.push(t):s.queryCount++,r?t&&i&&this._dispatcher.markReady(t):s.listen()}decouple(e,t){return this._decoupleSegments(m(e,!0),t)}_decoupleSegments(t,e){const s=[];let r;for(const i of t){if(!(r=i?r.children&&r.children[i]:this._root))break;s.push(r)}if(!r||!(e?r.count:r.queryCount))throw new Error("Path not coupled: "+(t.join("/")||"/"));if(e?_.default.pull(r.operations,e):r.queryCount--,e&&!r.count&&(r.listen(),r.listening&&r.unlisten()),!r.active){for(let e=s.length-1;0<e&&((r=s[e])!==this._root&&!r.active&&_.default.isEmpty(r.children));e--)o.default.delete(s[e-1].children,t[e]),r.ready=void 0,delete this._nodeIndex[r.path];e=t.join("/")||"/";this._prunePath(e,this.findCoupledDescendantPaths(e))}}subscribe(e,t,s){let r=this._queryHandlers[e.toString()];r||(r=new oe(this,e),o.default.set(this._queryHandlers,e.toString(),r)),r.attach(t,s)}unsubscribe(e,t){const s=this._queryHandlers[e.toString()];s&&!s.detach(t)&&(s.destroy(),o.default.delete(this._queryHandlers,e.toString()))}isTrunkCoupled(e){let t;for(const s of m(e,!0)){if(!(t=s?t.children&&t.children[s]:this._root))return!1;if(t.active)return!0}return!1}findCoupledDescendantPaths(e){let t;for(const s of m(e,!0)){if((t=s?t.children&&t.children[s]:this._root)&&t.active)return{[e]:t.active};if(!t)break}return t&&t.collectCoupledDescendantPaths()}isSubtreeReady(e){let t,s;function r(e){return s=e.slice(1),""}for(;!(t=this._nodeIndex[e]);)e=e.replace(/\/[^/]*$/,r)||"/";for(s&&t.children;t;){if(t.ready)return!0;t=t.parent}return!1}isQueryReady(e){e=this._queryHandlers[e.toString()];return e&&e.ready}_queueSnapshotCallback(e){this._pendingSnapshotCallbacks.push(e),this._throttled.processPendingSnapshots.call(this)}_processPendingSnapshots(){for(const e of this._pendingSnapshotCallbacks)e();this._pendingSnapshotCallbacks.splice(0,1/0)}throttleSnapshots(e){this._throttled.processPendingSnapshots=e?_.default.debounce(_.default.throttle(this._processPendingSnapshots,e)):this._processPendingSnapshots}}class ue{constructor(e){this._ref=e,this._outcome=void 0,this._values=void 0}get currentValue(){return this._ref.value}get outcome(){return this._outcome}get values(){return this._values}_setOutcome(e){if(this._outcome)throw new Error("Transaction already resolved with "+this._outcome);this._outcome=e}abort(){this._setOutcome("abort")}cancel(){this._setOutcome("cancel")}set(e){if(void 0===e)throw new Error("Invalid argument: undefined");this._setOutcome("set"),this._values={"":e}}update(e){if(void 0===e)throw new Error("Invalid argument: undefined");if(_.default.isEmpty(e))return this.cancel();this._setOutcome("update"),this._values=e}}class ce{constructor(e,t,s,r){this._truss=e,this._url=new URL(t),this._bridge=s,this._dispatcher=r,this._firebasePropertyEditAllowed=!1,this._writeSerial=0,this._localWrites={},this._localWriteTimestamp=null,this._initialized=!1,this._modeler=new ae("dev"===e.constructor.VERSION),this._coupler=new he(t,s,r,this._integrateSnapshot.bind(this),this._prune.bind(this)),this._vue=new o.default({data:{$root:void 0}}),Object.seal(this)}get root(){return this._vue.$data.$root||(this._vue.$data.$root=this._createObject("/"),this._fixObject(this._vue.$data.$root),this._completeCreateObject(this._vue.$data.$root),d.digest()),this._vue.$data.$root}get truss(){return this._truss}init(e){if(this._initialized)throw new Error("Data objects already created, too late to mount classes");this._initialized=!0,this._modeler.init(e,!this._vue.$data.$root);e=[];this._plantPlaceholders(this.root,"/",void 0,e);for(const t of e)this._completeCreateObject(t)}destroy(){this._coupler.destroy(),this._modeler&&this._modeler.destroy(),this._vue.$destroy()}connectReference(e,t){this._checkHandle(e);const s=this._dispatcher.createOperation("read",t,e);return s._disconnect=this._disconnectReference.bind(this,e,s,void 0),this._dispatcher.begin(s).then(()=>{s.running&&!s._disconnected&&(this._coupler.couple(e.path,s),s._coupled=!0)}).catch(_.default.noop),s._disconnect}_disconnectReference(e,t,s,r){t._disconnected||(t._disconnected=!0,s&&s(),t._coupled&&(this._coupler.decouple(e.path,t),t._coupled=!1),this._dispatcher.end(t,r).catch(_.default.noop))}isReferenceReady(e){return this._checkHandle(e),this._coupler.isSubtreeReady(e.path)}connectQuery(e,t,s){this._checkHandle(e);const r=this._dispatcher.createOperation("read",s,e);return r._disconnect=this._disconnectQuery.bind(this,e,r),this._dispatcher.begin(r).then(()=>{r.running&&!r._disconnected&&(this._coupler.subscribe(e,r,t),r._coupled=!0)}).catch(_.default.noop),r._disconnect}_disconnectQuery(e,t,s){t._disconnected||(t._disconnected=!0,t._coupled&&(this._coupler.unsubscribe(e,t),t._coupled=!1),this._dispatcher.end(t,s).catch(_.default.noop))}isQueryReady(e){return this._coupler.isQueryReady(e)}_checkHandle(e){if(!e.belongsTo(this._truss))throw new Error("Reference belongs to another Truss instance")}throttleRemoteDataUpdates(e){this._coupler.throttleSnapshots(e)}update(t,e,s){s=_.default.mapValues(s,e=>f(e));var r=_.default.size(s);if(!r)return Promise.resolve();if("update"!==e&&"override"!==e||de(t.path,s),this._applyLocalWrite(s,"override"===e))return Promise.resolve();e=function(e){let i;return _.default.forEach(e,(e,t)=>{var s="/"===t?[""]:m(t,!0);if(i){let e=0;for(var r=Math.min(i.length,s.length);e<r&&i[e]===s[e];)e++;if(!(i=i.slice(0,e)).length)return!1}else i=s}),1===i.length?"/":i.join("/")}(s);fe(e,s),e!==t.path&&(t=new w(t._tree,e,t._annotations)),this._url.pathname=encodeURI(e);const i=this._url.toString(),n=this._writeSerial,a=1===r,o=a?s[""]:s;return this._dispatcher.execute("write",a?"set":"update",t,o,()=>{const e=this._bridge[a?"set":"update"](i,o,n);return e.catch(e=>e.immediateFailure?C(this._repair(t,s),()=>Promise.reject(e)):Promise.reject(e))})}commit(r,t){let i=0;t=j(t);const n=()=>{if(25<=i++)return Promise.reject(new Error("Transaction needed too many retries, giving up"));const s=new ue(r);let e;return o.default.nextTick().then(()=>(e=_e(s.currentValue),t(s))).then(()=>{if(!_.default.isEqual(e,_e(s.currentValue)))return n();if("abort"===s.outcome)return s;const t=_.default.mapValues(s.values,e=>f(e));switch(s.outcome){case"cancel":break;case"set":if(this._applyLocalWrite({[r.path]:t[""]}))return Promise.resolve();break;case"update":if(de(r.path,t),this._applyLocalWrite(t))return Promise.resolve();fe(r.path,t);break;default:throw new Error("Invalid transaction outcome: "+(s.outcome||"none"))}return this._url.pathname=r.path,this._bridge.transaction(this._url.toString(),e,t,this._writeSerial).then(e=>(_.default.forEach(e.snapshots,e=>this._integrateSnapshot(e)),e.committed?s:n()),e=>!e.immediateFailure||"set"!==s.outcome&&"update"!==s.outcome?Promise.reject(e):C(this._repair(r,t),()=>Promise.reject(e)))})};return this._truss.peek(r,()=>this._dispatcher.execute("write","commit",r,void 0,n))}_repair(e,t){const s=e.path;e=_.default(t).keys().flatMap(e=>{let t=s;return e&&(t=g(t,e)),_.default.keys(this._coupler.findCoupledDescendantPaths(t))}).value();return Promise.all(_.default.map(e,e=>(this._url.pathname=encodeURI(e),this._bridge.once(this._url.toString()).then(e=>{this._integrateSnapshot(e)}))))}_applyLocalWrite(e,l){this._writeSerial++,this._localWriteTimestamp=this._truss.now;const h=[];let u=0;_.default.forEach(e,(t,e)=>{var s=this._modeler.isLocal(e,t),r=(s&&u++,s?{[e]:!0}:this._coupler.findCoupledDescendantPaths(e));if(!_.default.isEmpty(r)){var i=("/"===e?0:e.length)+1;for(const a in r){var n=a.slice(i);let e=t;if(n&&null!=t)for(const o of m(n))if(void 0===(e=e.$data[o]))break;_.default.isNil(e)?this._prune(a):(n=_.default.last(m(a)),this._plantValue(a,n,e,this._scaffoldAncestors(a,!1,h),!1,l,s,h)),l||s||(this._localWrites[a]=this._writeSerial)}}});for(const t of h)this._completeCreateObject(t);if(u&&u<_.default.size(e))throw new Error("Write on a mix of local and remote tree paths.");return l||!!u}_createObject(e,t){this._initialized||"/"===e||this.init();const s={$parent:{value:t,configurable:!0,enumerable:!0},$path:{value:e}};"/"===e&&(s.$truss={value:this._truss});t=this._modeler.createObject(e,s);return Object.defineProperties(t,s),t}_fixObject(e){for(const t of Object.getOwnPropertyNames(e)){const s=Object.getOwnPropertyDescriptor(e,t);s.configurable&&s.enumerable&&(s.enumerable=!1,_.default.startsWith(t,"$")&&(s.configurable=!1),Object.defineProperty(e,t,s))}}_completeCreateObject(e){if(e.hasOwnProperty("$$initializers")){for(const t of e.$$initializers)t(this._vue);delete e.$$initializers}}_destroyObject(e){if(e&&e.$truss&&!e.$destroyed){this._modeler.destroyObject(e);for(const s of Object.getOwnPropertyNames(e.$data)){var t=e.$data[s];t&&t.$parent===e&&this._destroyObject(t)}}}_integrateSnapshot(s){if(_.default.forEach(this._localWrites,(e,t)=>{s.writeSerial>=e&&delete this._localWrites[t]}),s.exists){var e=[],t=this._scaffoldAncestors(s.path,!0,e);t&&this._plantValue(s.path,s.key,s.value,t,!0,!1,!1,e);for(const r of e)this._completeCreateObject(r)}else this._prune(s.path,null,!0)}_scaffoldAncestors(e,s,r){let i;var n=_.default.dropRight(m(e,!0));let a="/";for(let t=0;t<n.length;t++){var o=n[t],l=c(o);let e=o?i.$data[l]:this.root;if(o&&(a+=("/"===a?"":"/")+o),e){if(s&&this._localWrites[a])return}else if(!(e=this._plantValue(a,l,{},i,s,!1,!1,r)))return;i=e}return i}_plantValue(r,t,i,n,a,o,l,h){if(a&&_.default.isNil(i))throw new Error(`Snapshot includes invalid value at ${r}: `+i);if(!a||!this._localWrites[r||"/"]){_.default.isEqual(i,L)&&(i=this._localWriteTimestamp);let s=n.$data[t];if(_.default.isArray(i)||(l?_.default.isPlainObject(i):_.default.isObject(i))){let e=!1;return _.default.isObject(s)||(this._setFirebaseProperty(n,t,null),s=this._createObject(r,n),this._setFirebaseProperty(n,t,s,s.$hidden),this._fixObject(s),h.push(s),e=!0),o?Object.defineProperty(s,"$overridden",{get:_.default.constant(!0),configurable:!0}):s.$overridden&&delete s.$overridden,e&&this._plantPlaceholders(s,r,!0,h),_.default.forEach(i,(e,t)=>{this._plantValue(g(r,t),c(t),e,s,a,o,l,h)}),e?this._plantPlaceholders(s,r,!1,h):_.default.forEach(s.$data,(e,t)=>{t=p(t);i.hasOwnProperty(t)||this._prune(g(r,t),null,a)}),s}this._destroyObject(s),!l&&_.default.isNil(i)?this._deleteFirebaseProperty(n,t):this._setFirebaseProperty(n,t,i)}}_plantPlaceholders(s,r,i,n){this._modeler.forEachPlaceholderChild(r,e=>{var t;void 0!==i&&i!==!!e.hidden||(t=c(e.escapedKey),s.$data.hasOwnProperty(t)||this._plantValue(g(r,e.escapedKey),t,e.placeholder,s,!1,!1,!1,n))})}_prune(e,t,s){t=t||{};var r=this.getObject(e);void 0===r||s&&this._avoidLocalWritePaths(e,t)||_.default.isEmpty(t)&&this._pruneAncestors(e,r)||!_.default.isObject(r)||this._pruneDescendants(r,t)}_avoidLocalWritePaths(t,s){for(const e in this._localWrites)if(this._localWrites.hasOwnProperty(e)){if(t===e||"/"===e||_.default.startsWith(t,e+"/"))return!0;if("/"===t||_.default.startsWith(e,t+"/")){const n=m(e,!0);for(let e=n.length;0<e;e--){var r=n.slice(0,e).join("/"),i=e===n.length;if(s[r]||s[r]===i)break;if(s[r]=i,r===t)break}}}}_pruneAncestors(e,t){let s=!1,r=t,i;for(var n=e.replace(/\/[^/]+$/,e=>(i=c(e.slice(1)),""));void 0!==r&&r!==this.root;){var a,o=r&&r.$parent||r===t&&this.getObject(n);this._modeler.isPlaceholder(r&&r.$path||e)||(a=s?null:[t],this._holdsConcreteData(r,a)||(s=!0,this._deleteFirebaseProperty(o,r&&r.$key||r===t&&i))),r=o}return s}_holdsConcreteData(e,t){return!_.default.isNil(e)&&((!t||!_.default.includes(t,e))&&(!_.default.isObject(e)||!e.$truss||_.default.some(e.$data,e=>this._holdsConcreteData(e,t))))}_pruneDescendants(n,a){if(a[n.$path])return!0;n.$overridden&&delete n.$overridden;let o=!1;return _.default.forEach(n.$data,(e,t)=>{let s=!0,r;var i;a[g(n.$path,p(t))]?(s=!1,r=!0):!_.default.isNil(e)&&e.$truss&&((i=this._modeler.isPlaceholder(e.$path))||_.default.has(a,e.$path))&&(r=this._pruneDescendants(e,a),s=!i&&!r),s&&this._deleteFirebaseProperty(n,t),o=o||r}),o}getObject(e){let t;for(const s of m(e))if(void 0===(t=s?t.$data[s]:this.root))return;return t}_getFirebasePropertyDescriptor(e,t,s){var r=Object.getOwnPropertyDescriptor(t,s);if(r){if(!r.enumerable){var i=t[s];if(!i||i.$parent!==e)throw new Error("Key conflict between Firebase and instance or computed properties at "+e.$path+": "+s)}if(!r.get||!r.set)throw new Error(`Unbound property at ${e.$path}: `+s)}else if(s in t)throw new Error(`Key conflict between Firebase and inherited property at ${e.$path}: `+s);return r}_setFirebaseProperty(e,t,s,r){const i=e.hasOwnProperty("$data")?e.$data:e;let n=this._getFirebasePropertyDescriptor(e,i,t);if(n){if(r&&Object.defineProperty(i,t,{get:n.get,set:n.set,configurable:!0,enumerable:!1}),i[t]===s)return;this._firebasePropertyEditAllowed=!0,i[t]=s,this._firebasePropertyEditAllowed=!1}else o.default.set(i,t,s),n=Object.getOwnPropertyDescriptor(i,t),Object.defineProperty(i,t,{get:n.get,set:this._overwriteFirebaseProperty.bind(this,n,t),configurable:!0,enumerable:!r});d.digest()}_overwriteFirebaseProperty(e,t,s){if(!this._firebasePropertyEditAllowed){const r=new Error("Firebase data cannot be mutated directly: "+t);throw r.trussCode="firebase_overwrite",r}e.set.call(this,s)}_deleteFirebaseProperty(e,t){var s=e.hasOwnProperty("$data")?e.$data:e;this._getFirebasePropertyDescriptor(e,s,t),this._destroyObject(s[t]),o.default.delete(s,t),d.digest()}checkVueObject(e,t){this._modeler.checkVueObject(e,t)}}function de(s,r){_.default.forEach(_.default.keys(r),e=>{if("/"===e.charAt(0)){if(!(e===s||"/"===s||_.default.startsWith(e,s+"/")&&e.length>s.length+1))throw new Error("Update item is not a descendant of target ref: "+e)}else{if(_.default.includes(e,"/"))throw new Error("Update item deep path must be absolute, taken from a reference: "+e);var t=g(s,p(e));if(r.hasOwnProperty(t))throw new Error(`Update items overlap: ${e} and `+t);r[t]=r[e],delete r[e]}});const i=_.default(r).keys().map(e=>g(e,"")).sortBy("length").value();_.default.forEach(r,(e,t)=>{for(const s of i){if(s.length>t.length)break;if(t!==s&&_.default.startsWith(t,s))throw new Error(`Update items overlap: ${s} and `+t)}})}function fe(e,t){const s="/"===e?1:e.length+1;_.default.forEach(_.default.keys(t),e=>{t[e.slice(s)]=t[e],delete t[e]})}function _e(e){if(!_.default.isObject(e))return e;const t={},s=e.$data;for(const r in s)s.hasOwnProperty(r)&&(t[p(r)]=_e(s[r]));return t}let D,pe;const ge={};class z{constructor(e){if(!D)throw new Error("Truss worker not connected, please call Truss.connectWorker first");this._rootUrl=e.replace(/\/$/,""),this._keyGenerator=new se,this._dispatcher=new Z(D),this._vue=new o.default,D.trackServer(this._rootUrl),this._tree=new ce(this,this._rootUrl,D,this._dispatcher),this._metaTree=new re(this._rootUrl,this._tree,D,this._dispatcher),Object.freeze(this)}get info(){return this._metaTree.root}get store(){return this._tree.root}mount(e){this._tree.init(e)}destroy(){this._vue.$destroy(),this._tree.destroy(),this._metaTree.destroy()}get now(){return Date.now()+this.info.timeOffset}newKey(){return this._keyGenerator.generateUniqueKey(this.now)}authenticate(e){return this._metaTree.authenticate(e)}unauthenticate(){return this._metaTree.unauthenticate()}intercept(e,t){return this._dispatcher.intercept(e,t)}connect(e,t){return t||(t=e,e=void 0),(t instanceof b||_.default.isFunction(t))&&(t={_:t}),new O(e,t,this._tree,"connect")}peek(o,l){l=j(l||_.default.identity);let h,u;return t(Promise.resolve().then(()=>new Promise((t,r)=>{const s={};let i,e=new O(s,{result:o},this._tree,"peek"),n=this.intercept("peek",{onFailure:s=>{!function t(e){if(e)return e instanceof b?s.target.isEqual(e):_.default.some(e,e=>t(e))}(e.at)||(r(s.error),h())}}),a=this.observe(()=>e.ready,e=>{e&&(a(),a=null,i=C(l(s.result),()=>{d.digest(),i=null,h()}).then(e=>{t(e)},e=>{r(e)}))});h=()=>{a&&(a(),a=null),n&&(n(),n=null),e&&(e.destroy(),e=null),i&&i.cancel&&i.cancel()},u=()=>{r(new Error("Canceled")),h()}})),u)}observe(e,r,i){const n=_.default.isObject(i&&i.precise);let a=0,o;n&&(o=i.deep?_.default.cloneDeep(i.precise):_.default.clone(i.precise));let l;return l=this._vue.$watch(e,(e,t)=>{if(i&&i.precise){var s=n?i.deep?_.default.defaultsDeep({},e,i.precise):_.default.defaults({},e,i.precise):i.deep?_.default.cloneDeep(e):_.default.clone(e);if(_.default.isEqual(s,o))return;o=s}a++,l?(r(e,t),d.digest()):Promise.resolve().then(()=>{1<a||r(e,t)})},{immediate:!0,deep:i&&i.deep}),i&&i.scope&&i.scope.$on("$destroy",l),l}when(r,i){let n,a,e=new Promise((t,e)=>{let s=this.observe(r,e=>{e&&o.default.nextTick(()=>{(e=r())&&(t(e),n())})});_.default.has(i,"timeout")&&(a=setTimeout(()=>{a=null,e(new Error(i.timeoutMessage||"Timeout")),n()},i.timeout)),n=()=>{s&&(s(),s=null),a&&(clearTimeout(a),a=null),e(new Error("Canceled"))}});return e=t(C(e,n),n),i&&i.scope&&i.scope.$on("$destroy",()=>{e.cancel()}),e}nextTick(){let s;return t(new Promise((e,t)=>{o.default.nextTick(e),s=()=>{t(new Error("Canceled"))}}),s)}throttleRemoteDataUpdates(e){this._tree.throttleRemoteDataUpdates(e)}checkObjectsForRogueProperties(){this._tree.checkVueObject(this._tree.root,"/")}static get computedPropertyStats(){return n}static connectWorker(e,t){if(D)throw new Error("Worker already connected");if(_.default.isString(e)){const s=window.SharedWorker||window.Worker;if(!s)throw new Error("Browser does not implement Web Workers");e=new s(e)}return D=new W(e),pe&&D.enableLogging(pe),D.init(e,t).then(({exposedFunctionNames:e,firebaseSdkVersion:t})=>{Object.defineProperty(z,"FIREBASE_SDK_VERSION",{value:t});for(const s of e)z.preExpose(s)})}static get worker(){return ge}static preExpose(e){const t=e.split(".");let s=z.worker;for(const r of t.slice(0,-1))Object.hasOwnProperty.call(s,r)||(s[r]={}),s=s[r];s[t[t.length-1]]=D.bindExposedFunction(e)}static bounceConnection(){return D.bounceConnection()}static suspend(){return D.suspend()}static debugPermissionDeniedErrors(e,t,s){return D.debugPermissionDeniedErrors(e,t,s)}static debounceAngularDigest(e){d.debounceDigest(e)}static escapeKey(e){return p(e)}static unescapeKey(e){return c(e)}static enableLogging(e){pe=e,D&&D.enableLogging(e)}get SERVER_TIMESTAMP(){return z.SERVER_TIMESTAMP}get VERSION(){return z.VERSION}get FIREBASE_SDK_VERSION(){return z.FIREBASE_SDK_VERSION}}return Object.defineProperties(z,{SERVER_TIMESTAMP:{value:L},VERSION:{value:"5.2.18"},Model:{value:Object},ComponentPlugin:{value:{install(e,t){if(o.default!==e)throw new Error("Multiple versions of Vue detected");if(!t.truss)throw new Error("Need to pass `truss` instance as an option to use the ComponentPlugin");e={$truss:{value:t.truss},$destroyed:{get(){return this._isBeingDestroyed||this._isDestroyed}},$$touchThis:{value(){this.__ob__&&this.__ob__.dep.depend()}}};const s=_.default(e).keys().union(_.default.keys(x.prototype)).intersection(_.default.keys(o.default.prototype)).value();if(s.length)throw new Error("Truss extension properties conflict with Vue properties: "+s.join(", "));Object.defineProperties(o.default.prototype,e),H(x,o.default),o.default.mixin({destroyed(){if(_.default.has(this,"$$finalizers"))for(const e of _.default.clone(this.$$finalizers))e()}})}}}}),d.defineModule(z),z});
//# sourceMappingURL=firetruss.umd.min.js.map