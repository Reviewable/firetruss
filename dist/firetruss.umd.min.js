!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("lodash"),require("vue")):"function"==typeof define&&define.amd?define(["lodash","vue"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).Truss=e(t._,t.Vue)}(this,function(t,e){"use strict";function M(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function o(){s.digestRequest>a||(s.digestRequest=a+1)}var s,I,y=M(t),c=M(e),a=0,V=!1,f={active:"undefined"!=typeof window&&window.angular};f.active?(I=window.angular.module("firetruss",[]),f.digest=o,f.watch=function(){throw new Error("Angular watch proxy not yet initialized")},f.defineModule=function(t){I.constant("Truss",t)},f.debounceDigest=function(t){var e;t?(e=y.default.debounce(o,t),f.digest=function(){s.digestRequest>a||(V?o:e)()}):f.digest=o},I.config(["$provide",function(t){t.decorator("$rootScope",["$delegate","$exceptionHandler",function(t,e){var r,n=t,t=(f.watch=n.$watch.bind(n),Object.getPrototypeOf(n)),i=t.$digest,t=(t.$digest=o,t.$digest.original=i,(s=new c.default({data:{digestRequest:0}})).$watch(function(){return s.digestRequest},function(){s.digestRequest>a?c.default.nextTick(function(){s.digestRequest<=a||(V=!0,n.$digest.original.call(n),a=s.digestRequest=s.digestRequest+1)}):V=!1}),y.default.last(s._watchers||s._scope.effects));return t.id=1/0,i=Object.getPrototypeOf(t),r=i.get,i.get=function(){try{return r.call(this)}catch(t){if(this.vm._watcher!==this||!c.default.config.errorHandler)throw t;c.default.config.errorHandler(t,this.vm,"uncaught render error")}},n}])}])):y.default.forEach(["digest","watch","defineModule","debounceDigest"],function(t){f[t]=y.default.noop});function q(t,e){this.key=t,this.value=e,this.touch()}function r(t,e){this._items=Object.create(null),this._size=0,this._maxSize=t,this._pruningSize=e||Math.ceil(.1*t)}q.prototype.touch=function(){this.timestamp=Date.now()};r.prototype.has=function(t){return Boolean(this._items[t])},r.prototype.get=function(t){t=this._items[t];if(t)return t.touch(),t.value},r.prototype.set=function(t,e){var r=this._items[t];r?r.value=e:(this._size>=this._maxSize&&this._prune(),this._items[t]=new q(t,e),this._size+=1)},r.prototype.delete=function(t){this._items[t]&&(delete this._items[t],--this._size)},r.prototype._prune=function(){for(var t=0,e=y.default(this._items).toArray().sortBy("timestamp").take(this._pruningSize).value();t<e.length;t+=1){var r=e[t];this.delete(r.key)}};var F=new r(1e3),n={};function d(t){return t&&t.toString().replace(/[\x00-\x1f\\.$#[\]\x7f/]/g,function(t){return"\\"+y.default.padStart(t.charCodeAt(0).toString(16),2,"0")})}function h(t){return t&&t.toString().replace(/\\[0-9a-f]{2}/gi,function(t){return String.fromCharCode(parseInt(t.slice(1),16))})}function U(t){if(!y.default.isObject(t)||!Object.isExtensible(t))return t;var e,r,n,i,o=t;for(e in t)t.hasOwnProperty(e)&&(r=t[e],n=d(e),i=U(r),n===e&&i===r||((o=o===t?y.default.clone(t):o)[n]=i,o[e]===r&&delete o[e]));return o}function p(){for(var t=[],e=0,r=arguments;e<r.length;e+=1){var n=r[e];"/"===(n=y.default.isString(n)?n:""+n).charAt(0)&&t.splice(0,t.length),t.push(n)}return"/"===t[0]&&(t[0]=""),t.join("/")}function _(t,e){var r=(e?"esc:":"")+t,n=F.get(r);return n||(n=t.split("/"),e||(n=y.default.map(n,h)),F.set(r,n)),n}function W(t){var e=this,r=(this.variables=[],y.default.endsWith(t,"/$*")),n=(t=r?t.slice(0,-3):t).replace(/\/\$[^/]*/g,function(t){return 1<t.length&&e.variables.push(t.slice(1)),""});if(Object.freeze(this.variables),/[.$#[\]]|\\(?![0-9a-f][0-9a-f])/i.test(n))throw new Error("Path pattern has unescaped keys: "+t);this._regex=new RegExp("^"+n.replace(/\u0001/g,"/([^/]+)")+(r?"($|/)":"$"))}function K(t){var e=n[t];return e||(e=new W(t),1e3===y.default.size(n)&&delete n[y.default.keys(n)[0]],n[t]=e),e}W.prototype.match=function(t){var e;if(this._regex.lastIndex=0,e=this._regex.exec(t)){for(var r={},n=0;n<this.variables.length;n++)r[this.variables[n]]=h(e[n+1]);return r}},W.prototype.test=function(t){return this._regex.test(t)},W.prototype.toString=function(){return this._regex.toString()};function N(t){var e=t.path,r=t.value,n=t.exists,t=t.writeSerial;this._path=e,this._value=r,this._exists=void 0===r?n||!1:null!==r,this._writeSerial=t}function i(t){var e=this;this._idCounter=0,this._deferreds={},this._suspended=!1,this._servers={},this._callbacks={},this._log=y.default.noop,this._inboundMessages=[],this._outboundMessages=[],this._flushMessageQueue=this._flushMessageQueue.bind(this),this._port=t.port||t,this._shared=!!t.port,Object.seal(this),this._port.onmessage=this._receive.bind(this),window.addEventListener("unload",function(){e._send({msg:"destroy"})})}var L="2.3.0",t={path:{configurable:!0},exists:{configurable:!0},value:{configurable:!0},key:{configurable:!0},writeSerial:{configurable:!0}};t.path.get=function(){return this._path},t.exists.get=function(){return this._exists},t.value.get=function(){if(void 0===this._value)throw new Error("Value omitted from snapshot");return this._value},t.key.get=function(){return void 0===this._key&&(this._key=h(this._path.replace(/.*\//,""))),this._key},t.writeSerial.get=function(){return this._writeSerial},Object.defineProperties(N.prototype,t);function Q(e,t){if(!e||y.default.isError(e))return e;var r,n=new Error(e.message);for(r in n.params=t,e)if("message"!==r&&e.hasOwnProperty(r))try{n[r]=e[r]}catch(t){n.extra=n.extra||{},n.extra[r]=e[r]}return n}i.prototype.init=function(t,e){var r=[];try{var n=window.localStorage||window.sessionStorage;if(!n)throw new Error("localStorage and sessionStorage not available");for(var i=0;i<n.length;i++){var o=n.key(i);r.push({key:o,value:n.getItem(o)})}}catch(t){}return this._send({msg:"init",storage:r,config:e}).then(function(t){var e=t.version.match(/^(\d+)\.(\d+)\.(\d+)(-.*)?$/);if(e){var r=L.match(/^(\d+)\.(\d+)\.(\d+)(-.*)?$/);if(!(e[1]===r[1]&&(e[2]>r[2]||e[2]===r[2]&&e[3]>=r[3])))return Promise.reject(new Error("Incompatible Firetruss worker version: "+t.version+" ("+L+" or better required)"))}return t})},i.prototype.suspend=function(t){this._suspended===(t=void 0===t?!0:t)||(this._suspended=t)||(this._receiveMessages(this._inboundMessages),this._inboundMessages=[],this._outboundMessages.length&&Promise.resolve().then(this._flushMessageQueue))},i.prototype.enableLogging=function(t){t?(!0===t&&(t=console.log.bind(console),this._send({msg:"enableFirebaseLogging",value:!0})),this._log=t):(this._send({msg:"enableFirebaseLogging",value:!1}),this._log=y.default.noop)},i.prototype._send=function(r){var t,e,n=this;return r.id=++this._idCounter,r.oneWay?t=Promise.resolve():(t=new Promise(function(t,e){n._deferreds[r.id]={resolve:t,reject:e}}),((e=this._deferreds[r.id]).promise=t).sent=new Promise(function(t){e.resolveSent=t}),e.params=r),this._outboundMessages.length||this._suspended||Promise.resolve().then(this._flushMessageQueue),this._log("send:",r),this._outboundMessages.push(r),t},i.prototype._flushMessageQueue=function(){try{this._port.postMessage(this._outboundMessages),this._outboundMessages=[]}catch(t){throw t.extra={messages:this._outboundMessages},t}},i.prototype._receive=function(t){this._suspended?this._inboundMessages=this._inboundMessages.concat(t.data):this._receiveMessages(t.data)},i.prototype._receiveMessages=function(t){for(var e=0,r=t;e<r.length;e+=1){var n=r[e],i=(this._log("recv:",n),this[n.msg]);if(!y.default.isFunction(i))throw new Error("Unknown message: "+n.msg);i.call(this,n)}},i.prototype.bindExposedFunction=function(t){return function(){return this._send({msg:"call",name:t,args:Array.prototype.slice.call(arguments)})}.bind(this)},i.prototype.resolve=function(t){var e=this._deferreds[t.id];if(!e)throw new Error("Received resolution to inexistent Firebase call");delete this._deferreds[t.id],e.resolve(t.result)},i.prototype.reject=function(t){var e=this._deferreds[t.id];if(!e)throw new Error("Received rejection of inexistent Firebase call");delete this._deferreds[t.id],e.reject(Q(t.error,e.params))},i.prototype.updateLocalStorage=function(t){t=t.items;try{for(var e=window.localStorage||window.sessionStorage,r=0,n=t;r<n.length;r+=1){var i=n[r];null===i.value?e.removeItem(i.key):e.setItem(i.key,i.value)}}catch(t){}},i.prototype.trackServer=function(t){if(this._servers.hasOwnProperty(t))return Promise.resolve();var e=this._servers[t]={authListeners:[]},e=this._registerCallback(this._authCallback.bind(this,e));this._send({msg:"onAuth",url:t,callbackId:e})},i.prototype._authCallback=function(t,e){t.auth=e;for(var r=0,n=t.authListeners;r<n.length;r+=1)(0,n[r])(e)},i.prototype.onAuth=function(t,e,r){var n=e.bind(r);n.callback=e,n.context=r,this._servers[t].authListeners.push(n),n(this.getAuth(t))},i.prototype.offAuth=function(t,e,r){for(var n=this._servers[t].authListeners,i=0;i<n.length;i++){var o=n[i];if(o.callback===e&&o.context===r){n.splice(i,1);break}}},i.prototype.getAuth=function(t){return this._servers[t].auth},i.prototype.authWithCustomToken=function(t,e){return this._send({msg:"authWithCustomToken",url:t,authToken:e})},i.prototype.authAnonymously=function(t){return this._send({msg:"authAnonymously",url:t})},i.prototype.unauth=function(t){return this._send({msg:"unauth",url:t})},i.prototype.set=function(t,e,r){return this._send({msg:"set",url:t,value:e,writeSerial:r})},i.prototype.update=function(t,e,r){return this._send({msg:"update",url:t,value:e,writeSerial:r})},i.prototype.once=function(t,e){return this._send({msg:"once",url:t,writeSerial:e}).then(function(t){return new N(t)})},i.prototype.on=function(t,e,r,n,i,o,s,a){var o={listenerKey:t,eventType:n,snapshotCallback:i,cancelCallback:o,context:s,params:{msg:"on",listenerKey:t,url:e,spec:r,eventType:n,options:a}},u=this._onCallback.bind(this,o);this._registerCallback(u,o),i.__callbackIds=i.__callbackIds||[],i.__callbackIds.push(o.id),this._send({msg:"on",listenerKey:t,url:e,spec:r,eventType:n,callbackId:o.id,options:a}).catch(function(t){u(t)})},i.prototype.off=function(e,t,r,n,i,o){var s,a=this,u=[];if(i){if(!(s=this._findAndRemoveCallbackId(i,function(t){return y.default.isMatch(t,{listenerKey:e,eventType:n,context:o})})))return Promise.resolve();u.push(s)}else for(var c=0,l=y.default.keys(this._callbacks);c<l.length;c+=1){var h=l[c],f=this._callbacks[h];f.listenerKey!==e||n&&f.eventType!==n||u.push(h)}for(var d=0,p=u;d<p.length;d+=1){var _=p[d];this._nullifyCallback(_)}return this._send({msg:"off",listenerKey:e,url:t,spec:r,eventType:n,callbackId:s}).then(function(){for(var t=0,e=u;t<e.length;t+=1){var r=e[t];a._deregisterCallback(r)}})},i.prototype._onCallback=function(t,e,r){e?(this._deregisterCallback(t.id),e=Q(e,t.params),t.cancelCallback?t.cancelCallback.call(t.context,e):console.error(e)):t.snapshotCallback.call(t.context,new N(r))},i.prototype.transaction=function(t,e,r,n){return this._send({msg:"transaction",url:t,oldValue:e,relativeUpdates:r,writeSerial:n}).then(function(t){return t.snapshots&&(t.snapshots=y.default.map(t.snapshots,function(t){return new N(t)})),t})},i.prototype.onDisconnect=function(t,e,r){return this._send({msg:"onDisconnect",url:t,method:e,value:r})},i.prototype.bounceConnection=function(){return this._send({msg:"bounceConnection"})},i.prototype.callback=function(t){var e=t.id,t=t.args,r=this._callbacks[e];if(!r)throw new Error("Unregistered callback: "+e);r.callback.apply(null,t)},i.prototype._registerCallback=function(t,e){return(e=e||{}).callback=t,e.id="cb"+ ++this._idCounter,(this._callbacks[e.id]=e).id},i.prototype._nullifyCallback=function(t){this._callbacks[t].callback=y.default.noop},i.prototype._deregisterCallback=function(t){delete this._callbacks[t]},i.prototype._findAndRemoveCallbackId=function(t,e){if(t.__callbackIds)for(var r=0;r<t.__callbackIds.length;){var n=t.__callbackIds[r],i=this._callbacks[n];if(i){if(e(i))return t.__callbackIds.splice(r,1),n;r+=1}else t.__callbackIds.splice(r,1)}};function g(t,e,r){this._tree=t,this._path=e.replace(/^\/*/,"/").replace(/\/$/,"")||"/",r&&(this._annotations=r,Object.freeze(r))}var H={},e=(Object.freeze(H),{$ref:{configurable:!0},key:{configurable:!0},path:{configurable:!0},_pathPrefix:{configurable:!0},parent:{configurable:!0},annotations:{configurable:!0}}),B=(e.$ref.get=function(){return this},e.key.get=function(){return this._key||(this._key=h(this._path.replace(/.*\//,""))),this._key},e.path.get=function(){return this._path},e._pathPrefix.get=function(){return"/"===this._path?"":this._path},e.parent.get=function(){return new v(this._tree,this._path.replace(/\/[^/]*$/,""),this._annotations)},e.annotations.get=function(){return this._annotations||H},g.prototype.child=function(){if(!arguments.length)return this;for(var t=[],e=0,r=arguments;e<r.length;e+=1){var n=r[e];if(y.default.isNil(n))return;t.push(d(n))}return new v(this._tree,this._pathPrefix+"/"+t.join("/"),this._annotations)},g.prototype.children=function(){var t=arguments;if(!arguments.length)return this;for(var e=[],r=0;r<arguments.length;r++){var n=t[r];if(y.default.isArray(n)){for(var i={},o=this._pathPrefix+(e.length?"/"+e.join("/"):""),s=y.default.slice(t,r+1),a=0,u=n;a<u.length;a+=1){var c=u[a],l=new v(this._tree,o+"/"+d(c),this._annotations),l=l.children.apply(l,s);l&&(i[c]=l)}return i}if(y.default.isNil(n))return;e.push(d(n))}return new v(this._tree,this._pathPrefix+"/"+e.join("/"),this._annotations)},g.prototype.peek=function(t){return this._tree.truss.peek(this,t)},g.prototype.match=function(t){return K(t).match(this.path)},g.prototype.test=function(t){return K(t).test(this.path)},g.prototype.isEqual=function(t){return t instanceof g&&(this._tree===t._tree&&this.toString()===t.toString()&&y.default.isEqual(this._annotations,t._annotations))},g.prototype.belongsTo=function(t){return this._tree.truss===t},Object.defineProperties(g.prototype,e),function(i){function e(t,e,r,n){i.call(this,t,e,n),this._spec=this._copyAndValidateSpec(r);t=y.default(this._spec).map(function(t,e){return e+"="+encodeURIComponent(JSON.stringify(t))}).sortBy().join("&");this._string=this._path+"?"+t,Object.freeze(this)}i&&(e.__proto__=i),(e.prototype=Object.create(i&&i.prototype)).constructor=e;var t={ready:{configurable:!0},constraints:{configurable:!0}};return t.ready.get=function(){return this._tree.isQueryReady(this)},t.constraints.get=function(){return this._spec},e.prototype.annotate=function(t){return new e(this._tree,this._path,this._spec,y.default.assign({},this._annotations,t))},e.prototype._copyAndValidateSpec=function(e){if(!e.by)throw new Error('Query needs "by" clause: '+JSON.stringify(e));if(1<("at"in e)+("from"in e)+("to"in e))throw new Error('Query must contain at most one of "at", "from", or "to" clauses: '+JSON.stringify(e));if(1<("first"in e)+("last"in e))throw new Error('Query must contain at most one of "first" or "last" clauses: '+JSON.stringify(e));if(!y.default.some(["at","from","to","first","last"],function(t){return t in e}))throw new Error('Query must contain at least one of "at", "from", "to", "first", or "last" clauses: '+JSON.stringify(e));if("$key"!==(e=y.default.clone(e)).by&&"$value"!==e.by){if(!(e.by instanceof v))throw new Error('Query "by" value must be a reference: '+e.by);var t=e.by.toString();if(!y.default.startsWith(t,this._path))throw new Error('Query "by" value must be a descendant of target reference: '+e.by);if(t=t.slice(this._path.length).replace(/^\/?/,""),!y.default.includes(t,"/"))throw new Error('Query "by" value must not be a direct child of target reference: '+e.by);e.by=t.replace(/.*?\//,"")}return Object.freeze(e),e},e.prototype.toString=function(){return this._string},Object.defineProperties(e.prototype,t),e}(g)),v=function(n){function e(t,e,r){n.call(this,t,e,r),Object.freeze(this)}n&&(e.__proto__=n),(e.prototype=Object.create(n&&n.prototype)).constructor=e;var t={ready:{configurable:!0},value:{configurable:!0}};return t.ready.get=function(){return this._tree.isReferenceReady(this)},t.value.get=function(){return this._tree.getObject(this.path)},e.prototype.toString=function(){return this._path},e.prototype.annotate=function(t){return new e(this._tree,this._path,y.default.assign({},this._annotations,t))},e.prototype.query=function(t){return new B(this._tree,this._path,t,this._annotations)},e.prototype.set=function(t){var e;return this._checkForUndefinedPath(),this._tree.update(this,"set",((e={})[this.path]=t,e))},e.prototype.update=function(t){return this._checkForUndefinedPath(),this._tree.update(this,"update",t)},e.prototype.override=function(t){var e;return this._checkForUndefinedPath(),this._tree.update(this,"override",((e={})[this.path]=t,e))},e.prototype.commit=function(t){return this._checkForUndefinedPath(),this._tree.commit(this,t)},e.prototype._checkForUndefinedPath=function(){if("/undefined"===this.path)throw new Error("Invalid path for operation: "+this.path)},Object.defineProperties(e.prototype,t),e}(g),J=Object.freeze({".sv":"timestamp"});function G(t,e){return y.default.isEqualWith(t,e,Y)}function Y(t,e){return t===e||null==t||null==e||t.$truss||e.$truss?t===e:t.isEqual?t.isEqual(e):void 0}function X(t,e){for(var r=0,n=Object.getOwnPropertyNames(t.prototype);r<n.length;r+=1){var i=n[r];"constructor"!==i&&Object.defineProperty(e.prototype,i,Object.getOwnPropertyDescriptor(t.prototype,i))}}function u(t){y.default.assign(this,{name:t,numRecomputes:0,numUpdates:0,runtime:0})}function Z(){this._items={}}function b(t,e,r,n,i){var o=this;Object.freeze(e),this._scope=t,this._connections=e,this._tree=r,this._method=n,this._subConnectors={},this._disconnects={},this._angularUnwatches=void 0,this._data={},this._vue=new c.default({data:{descriptors:{},refs:i||{},values:y.default.mapValues(e,y.default.constant(void 0))}}),this.destroy=this.destroy,Object.seal(this),this._linkScopeProperties(),y.default.forEach(e,function(t,e){y.default.isFunction(t)?o._bindComputedConnection(e,t):o._connect(e,t)}),f.active&&t&&t.$on&&t.$id&&t.$on("$destroy",function(){o.destroy()})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},m={exports:{}},e=(!function(){var t,e,r,n,i,o;"undefined"!=typeof performance&&null!==performance&&performance.now?m.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(m.exports=function(){return(t()-i)/1e6},e=process.hrtime,n=(t=function(){var t=e();return 1e9*t[0]+t[1]})(),o=1e9*process.uptime(),i=n-o):r=Date.now?(m.exports=function(){return Date.now()-r},Date.now()):(m.exports=function(){return(new Date).getTime()-r},(new Date).getTime())}.call(t),{runtimePerRecompute:{configurable:!0}}),t=(u.prototype.add=function(t){this.runtime+=t.runtime,this.numUpdates+=t.numUpdates,this.numRecomputes+=t.numRecomputes},e.runtimePerRecompute.get=function(){return this.numRecomputes?this.runtime/this.numRecomputes:0},u.prototype.toLogParts=function(t){return[this.name+":"," "+(this.runtime/1e3).toFixed(2)+"s","("+(this.runtime/t.runtime*100).toFixed(1)+"%)"," "+this.numUpdates+" upd /",this.numRecomputes+" runs","("+(this.numUpdates/this.numRecomputes*100).toFixed(1)+"%)"," "+this.runtimePerRecompute.toFixed(2)+"ms / run"]},Object.defineProperties(u.prototype,e),{list:{configurable:!0}}),tt=(Z.prototype.for=function(t){return this._items[t]||(this._items[t]=new u(t)),this._items[t]},t.list.get=function(){return y.default(this._items).values().sortBy(function(t){return-t.runtime}).value()},Z.prototype.log=function(t){void 0===t&&(t=10);var e,r,n,i,o=this.list;o.length&&(e=new u("=== Total"),y.default.forEach(o,function(t){e.add(t)}),o=y.default.take(o,t),r=new u("--- Above"),y.default.forEach(o,function(t){r.add(t)}),(n=y.default.map(o,function(t){return t.toLogParts(e)})).push(r.toLogParts(e)),n.push(e.toLogParts(e)),i=y.default.map(y.default.range(n[0].length),function(e){return y.default(n).map(function(t){return t[e].length}).max()}),y.default.forEach(n,function(t){console.log(y.default.map(t,function(t,e){return y.default.padStart(t,i[e])}).join(" "))}))},Z.prototype.wrap=function(n,t,i){var o=this.for(t+"."+i);return function(){var t=m.exports(),e=this._computedWatchers&&this._computedWatchers[i].value;try{var r=n.call(this);return G(e,r)||(o.numUpdates+=1),r}finally{o.runtime+=m.exports()-t,o.numRecomputes+=1}}},Object.defineProperties(Z.prototype,t),new Z),e={ready:{configurable:!0},at:{configurable:!0},data:{configurable:!0}};function et(t){if(t)return t instanceof g?t.toString():y.default.mapValues(t,et)}function rt(t){return function(){try{return Promise.resolve(t.apply(this,arguments))}catch(t){return Promise.reject(t)}}}function nt(t,e){return(t=w(t,function(){e=null})).cancel=function(){e&&(e(),e=null)},function r(n,i){var o=n.then,e=n.catch;n.then=function(t,e){t=o.call(n,t,e);return t[i]=n[i],r(t,i),t};n.catch=function(t){t=e.call(n,t);return t[i]=n[i],r(t,i),t};return n}(t,"cancel"),t}function w(t,e){return e?(e=rt(e),t.then(function(t){return e().then(function(){return t})},function(t){return e().then(function(){return Promise.reject(t)})})):t}e.ready.get=function(){var n=this;return y.default.every(this._connections,function(t,e){var r=n._vue.descriptors[e];return!!r&&(r instanceof g?r:n._subConnectors[e]).ready})},e.at.get=function(){return this._vue.refs},e.data.get=function(){return this._data},b.prototype.destroy=function(){var r=this;this._unlinkScopeProperties(),y.default.forEach(this._angularUnwatches,function(t){t()}),y.default.forEach(this._connections,function(t,e){r._disconnect(e)}),this._vue.$destroy()},b.prototype._linkScopeProperties=function(){var r=this,t=y.default.mapValues(this._connections,function(t,e){return{configurable:!0,enumerable:!1,get:function(){var t=r._vue.descriptors[e];return t instanceof v?t.value:r._vue.values[e]}}});if(Object.defineProperties(this._data,t),this._scope){for(var e in this._connections)if(e in this._scope)throw new Error("Property already defined on connection target: "+e);Object.defineProperties(this._scope,t),this._scope.__ob__&&this._scope.__ob__.dep.notify()}},b.prototype._unlinkScopeProperties=function(){var r=this;this._scope&&y.default.forEach(this._connections,function(t,e){delete r._scope[e]})},b.prototype._bindComputedConnection=function(t,e){var r=tt.for("connection.at."+t),n=this._computeConnection.bind(this,e,r),t=this._updateComputedConnection.bind(this,t,e,r),r=f.active&&!e.angularWatchSuppressed;this._vue.$watch(n,t,{immediate:!r}),r&&(this._angularUnwatches||(this._angularUnwatches=[]),this._angularUnwatches.push(f.watch(n,t,!0)))},b.prototype._computeConnection=function(t,e){var r=m.exports();try{return et(t.call(this._scope))}finally{e.runtime+=m.exports()-r,e.numRecomputes+=1}},b.prototype._updateComputedConnection=function(t,e,r){var e=y.default.isFunction(e)?e(this._scope):e,n=!G(this._vue.descriptors[t],e);n&&(r&&n&&(r.numUpdates+=1),e?(e instanceof g||!y.default.has(this._subConnectors,t)?(this._disconnect(t),this._connect(t,e)):this._subConnectors[t]._updateConnections(e),c.default.set(this._vue.descriptors,t,e),f.digest()):this._disconnect(t))},b.prototype._updateConnections=function(r){var n=this;y.default.forEach(r,function(t,e){n._updateComputedConnection(e,t)}),y.default.forEach(this._connections,function(t,e){y.default.has(r,e)||n._updateComputedConnection(e)}),this._connections=r},b.prototype._connect=function(e,t){var r,n,i,o,s=this;c.default.set(this._vue.descriptors,e,t),f.digest(),t&&(c.default.set(this._vue.values,e,void 0),t instanceof v?(c.default.set(this._vue.refs,e,t),this._disconnects[e]=this._tree.connectReference(t,this._method)):t instanceof B?(c.default.set(this._vue.refs,e,t),n=this._updateQueryValue.bind(this,e),this._disconnects[e]=this._tree.connectQuery(t,n,this._method)):(r={},c.default.set(this._vue.refs,e,n={}),i=this._subConnectors[e]=new b(r,t,this._tree,this._method,n),o=this._disconnects[e]=this._tree.truss.observe(function(){return i.ready},function(t){t&&(o(),delete s._disconnects[e],c.default.set(s._vue.values,e,r),f.digest())})))},b.prototype._disconnect=function(t){c.default.delete(this._vue.refs,t),this._updateRefValue(t,void 0),y.default.has(this._subConnectors,t)&&(this._subConnectors[t].destroy(),delete this._subConnectors[t]),this._disconnects[t]&&this._disconnects[t](),delete this._disconnects[t],c.default.delete(this._vue.descriptors,t),f.digest()},b.prototype._updateRefValue=function(t,e){this._vue.values[t]!==e&&(c.default.set(this._vue.values,t,e),f.digest())},b.prototype._updateQueryValue=function(t,e){this._vue.values[t]||(c.default.set(this._vue.values,t,{}),f.digest());var r,n=this._vue.values[t];for(r in n)!n.hasOwnProperty(r)||y.default.includes(e,r)||(c.default.delete(n,r),f.digest());for(var i=this._tree.getObject(this._vue.descriptors[t].path),o=0,s=e;o<s.length;o+=1){var a=s[o];n.hasOwnProperty(a)||(c.default.set(n,a,i[a]),f.digest())}},Object.defineProperties(b.prototype,e);function it(t,e,r){this._operation=t,this._delay=e,this._callback=r,this._fired=!1}function l(t,e,r,n){this._type=t,this._method=e,this._target=r,this._operand=n,this._ready=!1,this._running=!1,this._ended=!1,this._tries=0,this._startTimestamp=Date.now(),this._slowHandles=[]}function $(t){this._bridge=t,this._callbacks={},Object.freeze(this)}function ot(){this._lastUniqueKeyTime=0,this._lastRandomValues=[]}function k(t,e,r,n){this._rootUrl=t,this._tree=e,this._dispatcher=n,this._bridge=r,this._vue=new c.default({data:{$root:{connected:void 0,timeOffset:0,user:void 0,userid:void 0,nowAtInterval:function(t){var e,r=this,n="now"+t;return this.hasOwnProperty(n)||((e=function(){c.default.set(r,n,Date.now()+r.timeOffset),f.digest()})(),setInterval(e,t)),this[n]}}}}),this._auth={serial:0,initialAuthChangeReceived:!1,changePromise:Promise.resolve()},r.onAuth(t,this._handleAuthChange,this),this._connectInfoProperty("serverTimeOffset","timeOffset"),this._connectInfoProperty("connected","connected"),Object.freeze(this)}function P(){}function O(){}function st(t){this.error=t}function at(t){this.value=t}function E(t){this._trie={Class:O},this._debug=t,Object.freeze(this)}var j,C,ut=["read","write","auth","set","update","commit","connect","peek","authenticate","unathenticate","certify","all"],ct=[],t=(it.prototype.initiate=function(){var t=this,e=(this.cancel(),this._fired=!1,Date.now()-this._operation._startTimestamp);this._timeoutId=setTimeout(function(){t._fired=!0,t._callback(t._operation)},this._delay-e)},it.prototype.cancel=function(){this._fired&&this._callback(this._operation),this._timeoutId&&clearTimeout(this._timeoutId)},{type:{configurable:!0},method:{configurable:!0},target:{configurable:!0},targets:{configurable:!0},operand:{configurable:!0},ready:{configurable:!0},running:{configurable:!0},ended:{configurable:!0},tries:{configurable:!0},error:{configurable:!0}}),lt=(t.type.get=function(){return this._type},t.method.get=function(){return this._method},t.target.get=function(){return this._target},t.targets.get=function(){var r=this;return"update"!==this._method?[this._target]:y.default.map(this._operand,function(t,e){return new v(r._target._tree,p(r._target.path,e),r._target._annotations)})},t.operand.get=function(){return this._operand},t.ready.get=function(){return this._ready},t.running.get=function(){return this._running},t.ended.get=function(){return this._ended},t.tries.get=function(){return this._tries},t.error.get=function(){return this._error},l.prototype.onSlow=function(t,e){t=new it(this,t,e);this._slowHandles.push(t),t.initiate()},l.prototype._setRunning=function(t){this._running=t},l.prototype._setEnded=function(t){this._ended=t},l.prototype._markReady=function(t){this._ready=!0,t||(this._tries=0),y.default.forEach(this._slowHandles,function(t){return t.cancel()})},l.prototype._clearReady=function(){this._ready=!1,this._startTimestamp=Date.now(),y.default.forEach(this._slowHandles,function(t){return t.initiate()})},l.prototype._incrementTries=function(){this._tries++},Object.defineProperties(l.prototype,t),$.prototype.intercept=function(t,e){if(!y.default.includes(ut,t))throw new Error("Unknown intercept operation type: "+t);var r=y.default.difference(y.default.keys(e),["onBefore","onAfter","onError","onFailure"]);if(r.length)throw new Error("Unknown intercept callback types: "+r.join(", "));r={onBefore:this._addCallback("onBefore",t,e.onBefore),onAfter:this._addCallback("onAfter",t,e.onAfter),onError:this._addCallback("onError",t,e.onError),onFailure:this._addCallback("onFailure",t,e.onFailure)};return this._removeCallbacks.bind(this,t,r)},$.prototype._addCallback=function(t,e,r){if(r)return t=this._getCallbacksKey(t,e),e=rt(r),(this._callbacks[t]||(this._callbacks[t]=[])).push(e),e},$.prototype._removeCallback=function(t,e,r){r&&(t=this._getCallbacksKey(t,e),this._callbacks[t]&&y.default.pull(this._callbacks[t],r))},$.prototype._removeCallbacks=function(r,t){var n=this;y.default.forEach(t,function(t,e){n._removeCallback(e,r,t)})},$.prototype._getCallbacks=function(t,e,r){return[].concat(this._callbacks[this._getCallbacksKey(t,r)]||ct,this._callbacks[this._getCallbacksKey(t,e)]||ct,this._callbacks[this._getCallbacksKey(t,"all")]||ct)},$.prototype._getCallbacksKey=function(t,e){return t+"_"+e},$.prototype.execute=function(t,e,r,n,i){var o=this,s=(i=rt(i),this.createOperation(t,e,r,n));return this.begin(s).then(function(){function e(){return i().catch(function(t){return o._retryOrEnd(s,t).then(e)})}return e()}).then(function(t){return o.end(s).then(function(){return t})})},$.prototype.createOperation=function(t,e,r,n){return new l(t,e,r,n)},$.prototype.begin=function(e){var r=this;return Promise.all(y.default.map(this._getCallbacks("onBefore",e.type,e.method),function(t){return t(e)})).then(function(){e.ended||e._setRunning(!0)},function(t){return r.end(e,t)})},$.prototype.markReady=function(t){t._markReady()},$.prototype.clearReady=function(t){t._clearReady()},$.prototype.retry=function(e,r){return e._incrementTries(),e._error=r,Promise.all(y.default.map(this._getCallbacks("onError",e.type,e.method),function(t){return t(e,r)})).then(function(t){if(!e.ended)return t=y.default.some(t),t&&delete e._error,t})},$.prototype._retryOrEnd=function(e,r){var n=this;return this.retry(e,r).then(function(t){if(!t)return n.end(e,r)},function(t){return n.end(e,t)})},$.prototype.end=function(e,t){var r=this;return e.ended?Promise.resolve():(e._setRunning(!1),e._setEnded(!0),t?e._error=t:delete e._error,Promise.all(y.default.map(this._getCallbacks("onAfter",e.type,e.method),function(t){return t(e)})).then(function(){return r._afterEnd(e)},function(t){return e._error=t,r._afterEnd(e)}))},$.prototype._afterEnd=function(e){if(e._markReady(!0),!e.error)return Promise.resolve();var t=this._getCallbacks("onFailure",e.type,e.method);return t&&setTimeout(function(){y.default.forEach(t,function(t){return t(e)})},0),Promise.reject(e.error)},"-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz"),ht=window.crypto&&window.crypto.getRandomValues&&window.crypto.getRandomValues.bind(window.crypto),e=(ot.prototype.generateUniqueKey=function(t){t=t||Date.now();for(var e=new Array(20),r=t,n=7;0<=n;n--)e[n]=lt.charAt(63&r),r=Math.floor(r/64);if(t===this._lastUniqueKeyTime){for(var i=11;0<=i&&63===this._lastRandomValues[i];)this._lastRandomValues[i]=0,--i;if(-1===i)throw new Error("Internal assertion failure: ran out of unique IDs for this millisecond");this._lastRandomValues[i]+=1}else if(this._lastUniqueKeyTime=t,ht){var o=new Uint8Array(12);ht(o);for(var s=0;s<12;s++)this._lastRandomValues[s]=o[s]&(s?63:15)}else for(var a=0;a<12;a++)this._lastRandomValues[a]=Math.floor(Math.random()*(a?64:16));for(var u=0;u<12;u++)e[u+8]=lt[this._lastRandomValues[u]];return e.join("")},{root:{configurable:!0}}),ft=(e.root.get=function(){return this._vue.$data.$root},k.prototype.destroy=function(){this._bridge.offAuth(this._rootUrl,this._handleAuthChange,this),this._vue.$destroy()},k.prototype.authenticate=function(t){var e=this;return this._auth.serial++,this._dispatcher.execute("auth","authenticate",new v(this._tree,"/"),t,function(){return(t?e._bridge.authWithCustomToken(e._rootUrl,t):e._bridge.authAnonymously(e._rootUrl)).then(function(){return e._auth.changePromise})})},k.prototype.unauthenticate=function(){var e=this;return this._auth.serial++,this._handleAuthChange(null).then(function(t){if(t)return e._dispatcher.execute("auth","unauthenticate",new v(e._tree,"/"),void 0,function(){return e._bridge.unauth(e._rootUrl)})})},k.prototype._handleAuthChange=function(t){var e=this,r=!this._auth.initialAuthChangeReceived&&this._auth.serial;if(void 0!==t&&(this._auth.initialAuthChangeReceived=!0),!r){var n=this._auth.serial;if(this.root.user===t)return Promise.resolve(!1);var i=this._dispatcher.execute("auth","certify",new v(this._tree,"/"),t,function(){return e.root.user!==t&&n===e._auth.serial&&(t&&Object.freeze(t),e.root.user=t,e.root.userid=t&&t.uid,f.digest(),!0)});return this._auth.changePromise=this._auth.changePromise.then(function(){return i}).catch(),i}},k.prototype._isAuthChangeStale=function(t){return this.root.user===t},k.prototype._connectInfoProperty=function(t,e){var r=this,t=this._rootUrl+"/.info/"+t;this._bridge.on(t,t,null,"value",function(t){r.root[e]=t.value,f.digest()})},Object.defineProperties(k.prototype,e),{$$$trussCheck:!0,__ob__:!0}),t={$info:{configurable:!0},$store:{configurable:!0},$now:{configurable:!0},$$finalizers:{configurable:!0}},e=(t.$info.get=function(){return this.$truss.meta},t.$store.get=function(){return this.$truss.store},t.$now.get=function(){return this.$truss.now},P.prototype.$newKey=function(){return this.$truss.newKey()},P.prototype.$intercept=function(t,e){var r=this;if(this.$destroyed)throw new Error("Object already destroyed");var n=this.$truss.intercept(t,e),i=function(){n(),y.default.pull(r.$$finalizers,i)};return this.$$finalizers.push(i),i},P.prototype.$connect=function(t,e){var r=this;if(this.$destroyed)throw new Error("Object already destroyed");e||(e=t,t=void 0);var n=this.$truss.connect(t,function r(n,t){if(!t||t instanceof g)return t;return y.default.mapValues(t,function(t){return t instanceof g?t:y.default.isFunction(t)?((e=function(){return n.$$touchThis(),r(n,t.call(this))}).angularWatchSuppressed=!0,e):r(n,t);var e})}(this,e)),i=n.destroy,o=function(){return y.default.pull(r.$$finalizers,o),i.call(n)};return this.$$finalizers.push(o),n.destroy=o,n},P.prototype.$peek=function(t,e){var r=this;if(this.$destroyed)throw new Error("Object already destroyed");var n=w(this.$truss.peek(t,e),function(){y.default.pull(r.$$finalizers,n.cancel)});return this.$$finalizers.push(n.cancel),n},P.prototype.$observe=function(t,e,r){var n=this;if(this.$destroyed)throw new Error("Object already destroyed");var i=this.$truss.observe(function(){return n.$$touchThis(),t.call(n)},e.bind(this),r),o=function(){i(),y.default.pull(n.$$finalizers,o)};return this.$$finalizers.push(o),o},P.prototype.$when=function(t,e){var r=this;if(this.$destroyed)throw new Error("Object already destroyed");var n=this.$truss.when(function(){return r.$$touchThis(),t.call(r)},e);return w(n,function(){y.default.pull(r.$$finalizers,n.cancel)}),this.$$finalizers.push(n.cancel),n},t.$$finalizers.get=function(){return Object.defineProperty(this,"$$finalizers",{value:[],writable:!1,enumerable:!1,configurable:!1}),this.$$finalizers},Object.defineProperties(P.prototype,t),{$parent:{configurable:!0},$path:{configurable:!0},$truss:{configurable:!0},$ref:{configurable:!0},$refs:{configurable:!0},$key:{configurable:!0},$data:{configurable:!0},$hidden:{configurable:!0},$empty:{configurable:!0},$keys:{configurable:!0},$values:{configurable:!0},$ready:{configurable:!0},$overridden:{configurable:!0},$$initializers:{configurable:!0},$destroyed:{configurable:!0}});e.$parent.get=function(){return j.$parent.value},e.$path.get=function(){return j.$path.value},e.$truss.get=function(){return Object.defineProperty(this,"$truss",{value:this.$parent.$truss}),this.$truss},e.$ref.get=function(){return Object.defineProperty(this,"$ref",{value:new v(this.$truss._tree,this.$path)}),this.$ref},e.$refs.get=function(){return this.$ref},e.$key.get=function(){return Object.defineProperty(this,"$key",{value:h(this.$path.slice(this.$path.lastIndexOf("/")+1))}),this.$key},e.$data.get=function(){return this},e.$hidden.get=function(){return!1},e.$empty.get=function(){return y.default.isEmpty(this.$data)},e.$keys.get=function(){return y.default.keys(this.$data)},e.$values.get=function(){return y.default.values(this.$data)},e.$ready.get=function(){return this.$ref.ready},e.$overridden.get=function(){return!1},O.prototype.$nextTick=function(){var t=this;if(this.$destroyed)throw new Error("Object already destroyed");var e=this.$truss.nextTick();return w(e,function(){y.default.pull(t.$$finalizers,e.cancel)}),this.$$finalizers.push(e.cancel),e},O.prototype.$freezeComputedProperty=function(){if(!y.default.isBoolean(C))throw new Error("Cannot freeze a computed property outside of its getter function");C=!0},O.prototype.$set=function(t){return this.$ref.set(t)},O.prototype.$update=function(t){return this.$ref.update(t)},O.prototype.$override=function(t){return this.$ref.override(t)},O.prototype.$commit=function(t,e){return this.$ref.commit(t,e)},O.prototype.$$touchThis=function(){this.__ob__?this.__ob__.dep.depend():this.$parent?(this.$parent.hasOwnProperty("$data")?this.$parent.$data:this.$parent)[this.$key]:this.$store},e.$$initializers.get=function(){return Object.defineProperty(this,"$$initializers",{value:[],writable:!1,enumerable:!1,configurable:!0}),this.$$initializers},e.$destroyed.get=function(){return!1},Object.defineProperties(O.prototype,e),X(P,O),y.default.forEach(O.prototype,function(t,e){Object.defineProperty(O.prototype,e,{value:t,enumerable:!1,configurable:!1,writable:!1})});E.prototype.init=function(t,e){var r=this;y.default.isPlainObject(t)&&(y.default.forEach(t,function(t,e){t.$trussMount||(t.$$trussMount=t.$$trussMount||[],t.$$trussMount.push(e))}),t=y.default.values(t),y.default.forEach(t,function(t){!t.$trussMount&&t.$$trussMount&&(t.$trussMount=t.$$trussMount,delete t.$$trussMount)})),t=y.default.uniq(t),y.default.forEach(t,function(t){return r._mountClass(t,e)}),this._decorateTrie(this._trie)},E.prototype.destroy=function(){},E.prototype._getMount=function(t,e,r){for(var n,i=0,o=_(t,!0);i<o.length;i+=1){var s=o[i],a=s?n.children&&(n.children[s]||!e&&n.children.$):this._trie;if(!a){if(!e)return;n.children=n.children||{},a=n.children[s]={Class:O}}if(n=a,r&&r(n))break}return n},E.prototype._findMount=function(t,e){if(t(e=e||this._trie))return e;for(var r=0,n=y.default.keys(e.children);r<n.length;r+=1){var i=n[r],i=this._findMount(t,e.children[i]);if(i)return i}},E.prototype._decorateTrie=function(e){var r=this;y.default.forEach(e.children,function(t){r._decorateTrie(t),(t.local||t.localDescendants)&&(e.localDescendants=!0)})},E.prototype._augmentClass=function(t){for(var e,r=t.prototype;r&&r.constructor!==Object;){for(var n=0,i=Object.getOwnPropertyNames(r);n<i.length;n+=1){var o=i[n],s=Object.getOwnPropertyDescriptor(r,o);if("$"===o.charAt(0)){if("$finalize"===o)continue;if(y.default.isEqual(s,Object.getOwnPropertyDescriptor(O.prototype,o)))continue;throw new Error('Property names starting with "$" are reserved: '+t.name+"."+o)}!s.get||e&&e[o]||((e=e||{})[o]={name:o,fullName:r.constructor.name+"."+o,get:s.get,set:s.set})}r=Object.getPrototypeOf(r)}for(var a=0,u=Object.getOwnPropertyNames(O.prototype);a<u.length;a+=1){var c=u[a];"constructor"===c||t.prototype.hasOwnProperty(c)||Object.defineProperty(t.prototype,c,Object.getOwnPropertyDescriptor(O.prototype,c))}return e},E.prototype._mountClass=function(a,u){var c=this,l=this._augmentClass(a),h=[],t=a.$trussMount;if(!t)throw new Error("Class "+a.name+" lacks a $trussMount static property");y.default.isArray(t)||(t=[t]),y.default.forEach(t,function(t){if(y.default.isString(t)&&(t={path:t}),!u&&"/"===t.path)throw new Error("Data root already accessed, too late to mount class");for(var e=K(t.path),r=0,n=e.variables;r<n.length;r+=1){var i=n[r];if("$"===i||"$"===i.charAt(1))throw new Error("Invalid variable name: "+i);if("$"===i.charAt(0)&&(y.default.has(O.prototype,i)||ft[i]))throw new Error("Variable name conflicts with built-in property or method: "+i);h.push(i)}var o=t.path.match(/\/([^/]*)$/)[1];if("$"===o.charAt(0)){if(t.placeholder)throw new Error("Class "+a.name+" mounted at wildcard "+o+" cannot be a placeholder")}else y.default.has(t,"placeholder")||(t.placeholder={});var s=c._getMount(t.path.replace(/\$[^/]*/g,"$"),!0);if(s.matcher&&(s.escapedKey===o||"$"===s.escapedKey.charAt(0)&&"$"===o.charAt(0)))throw new Error("Multiple classes mounted at "+t.path+": "+s.Class.name+", "+a.name);y.default.assign(s,{Class:a,matcher:e,computedProperties:l,escapedKey:o},y.default.pick(t,"placeholder","local","keysUnsafe","hidden"))}),y.default(h).uniq().forEach(function(t){Object.defineProperty(a.prototype,t,{get:function(){return j?j[t]&&j[t].value:void 0}})})},E.prototype.createObject=function(t,e){var r=this,n=this._getMount(t)||{Class:O};try{if(n.matcher){var i,o=n.matcher.match(t);for(i in o)e[i]={value:o[i]}}j=e;var s=new n.Class;return j=null,f.active&&this._wrapProperties(s),n.keysUnsafe&&(e.$data={value:Object.create(null),configurable:!0,enumerable:!0}),n.hidden&&(e.$hidden={value:!0}),n.computedProperties&&y.default.forEach(n.computedProperties,function(t){e[t.name]=r._buildComputedPropertyDescriptor(s,t)}),s}catch(t){throw t.extra=y.default.assign({mount:n,properties:e,className:n.Class&&n.Class.name},t.extra),t}},E.prototype._wrapProperties=function(i){y.default.forEach(i,function(t,e){var r,n="$_"+e;Object.defineProperties(i,((r={})[n]={value:t,writable:!0},r[e]={get:function(){return i[n]},set:function(t){i[n]=t,f.digest()},enumerable:!0,configurable:!0},r))})},E.prototype._buildComputedPropertyDescriptor=function(o,s){var a,u,c=this,l=tt.for(s.fullName),h=!1;return o.$$initializers.push(function(t){var e=!1,r=function(t,e){if(!this.$destroyed){this.$$touchThis();var r,n=C,i=(C=!1,m.exports());try{try{r=t.get.call(this)}catch(t){r=new st(t)}finally{e.runtime+=m.exports()-i,e.numRecomputes+=1}return r=C?new at(r):r}finally{C=n}}}.bind(o,s,l),n=(c._debug&&(r.toString=function(){return s.fullName}),function(){e=!0}),n=t.$watch(r,function(t){if(o.$destroyed)n();else if(u&&(u.cancel&&u.cancel(),u=void 0),y.default.isObject(t)&&y.default.isFunction(t.then)){var e=t.then(function(t){e===u&&i(t)},function(t){if(e===u&&i(new st(t))&&!t.trussExpectedException)throw t});u=e}else if(i(t)&&(f.digest(),t instanceof st&&!t.error.trussExpectedException))throw t.error},{immediate:!0}),r=y.default.last(t._watchers||t._scope.effects);function i(t){return t instanceof at&&(t=t.value,n(),y.default.pull(o.$$finalizers,n)),!G(a,t)&&(l.numUpdates+=1,h=!0,o[s.name]=t,h=!1,function e(t){if(y.default.isNil(t)||!y.default.isObject(t)||Object.isFrozen(t)||t.$truss)return t;t=Object.freeze(t);if(y.default.isArray(t))return y.default.map(t,function(t){return e(t)});return y.default.mapValues(t,function(t){return e(t)})}(t),1)}r.id=-r.id,e?n():o.$$finalizers.push(n)}),{enumerable:!0,configurable:!0,get:function(){if(!h&&a instanceof st)throw a.error;return a},set:function(t){if(h)a=t;else{if(!s.set)throw new Error("You cannot set a computed property: "+s.name);s.set.call(this,t)}}}},E.prototype.destroyObject=function(t){if(y.default.has(t,"$$finalizers"))for(var e=0,r=y.default.clone(t.$$finalizers);e<r.length;e+=1)(0,r[e])();y.default.isFunction(t.$finalize)&&t.$finalize(),Object.defineProperty(t,"$destroyed",{value:!0,enumerable:!1,configurable:!1})},E.prototype.isPlaceholder=function(t){t=this._getMount(t);return t&&t.placeholder},E.prototype.isLocal=function(t,e){t=this._getMount(t,!1,function(t){return t.local});if(t&&t.local)return!0;if(this._hasLocalProperties(t,e))throw new Error("Write on a mix of local and remote tree paths.");return!1},E.prototype._hasLocalProperties=function(t,e){if(t){if(t.local)return!0;if(t.localDescendants&&y.default.isObject(e))for(var r in e)if(this._hasLocalProperties(t.children[d(r)]||t.children.$,e[r]))return!0}return!1},E.prototype.forEachPlaceholderChild=function(t,e){t=this._getMount(t);y.default.forEach(t&&t.children,function(t){t.placeholder&&e(t)})},E.prototype.checkVueObject=function(e,t,r){var n=!r;n&&(r=[]);try{for(var i=0,o=Object.getOwnPropertyNames(e);i<o.length;i+=1){var s=o[i];if(!(ft[s]||O.prototype.hasOwnProperty(s)||/^\$_/.test(s))){var a=this._findMount(function(t){return t.Class===e.constructor});if(!(a&&a.matcher&&y.default.includes(a.matcher.variables,s))){var u=void 0;try{u=e[s]}catch(t){continue}if(!y.default.isArray(e)||!/\d+/.test(s)&&"length"!==s){var c=Object.getOwnPropertyDescriptor(e,s);if("value"in c||!c.get)throw new Error("Value at "+t+", contained in a Firetruss object, has a rogue property: "+s);if(e.$truss&&c.enumerable)try{throw e[s]=u,new Error("Firetruss object at "+t+" has an enumerable non-Firebase property: "+s)}catch(t){if("firebase_overwrite"!==t.trussCode)throw t}}y.default.isObject(u)&&!u.$$$trussCheck&&Object.isExtensible(u)&&!(y.default.isFunction(u)||u instanceof Promise)&&(u.$$$trussCheck=!0,r.push(u),this.checkVueObject(u,p(t,d(s)),r))}}}}finally{if(n)for(var l=0,h=r;l<h.length;l+=1)delete h[l].$$$trussCheck}};function S(t,e){this._coupler=t,this._query=e,this._listeners=[],this._keys=[],this._url=this._coupler._rootUrl+e.path,this._segments=_(e.path,!0),this._listening=!1,this.ready=!1}function R(t,e,r){this._coupler=t,this.path=e,this.parent=r,this.url=this._coupler._rootUrl+e,this.operations=[],this.queryCount=0,this.listening=!1,this.ready=!1,this.children={}}S.prototype.attach=function(t,e){this._listen(),this._listeners.push({operation:t,keysCallback:e}),this.ready&&(this._coupler._dispatcher.markReady(t),e&&e(this._keys))},S.prototype.detach=function(t){t=y.default.findIndex(this._listeners,{operation:t});return 0<=t&&this._listeners.splice(t,1),this._listeners.length},S.prototype._listen=function(){this._listening||(this._coupler._bridge.on(this._query.toString(),this._url,this._query.constraints,"value",this._handleSnapshot,this._handleError,this,{sync:!0}),this._listening=!0)},S.prototype.destroy=function(){this._coupler._bridge.off(this._query.toString(),this._url,this._query.constraints,"value",this._handleSnapshot,this),this._listening=!1,this.ready=!1,f.digest();for(var t=0,e=this._keys;t<e.length;t+=1){var r=e[t];this._coupler._decoupleSegments(this._segments.concat(r))}},S.prototype._handleSnapshot=function(a){var u=this;this._coupler._queueSnapshotCallback(function(){if(u._listeners.length&&u._listening){var t=u._updateKeysAndApplySnapshot(a);if(!u.ready){u.ready=!0,f.digest();for(var e=0,r=u._listeners;e<r.length;e+=1){var n=r[e];u._coupler._dispatcher.markReady(n.operation)}}if(t)for(var i=0,o=u._listeners;i<o.length;i+=1){var s=o[i];s.keysCallback&&s.keysCallback(t)}}})},S.prototype._updateKeysAndApplySnapshot=function(t){var e,r;if(t.path===this._query.path){if((e=y.default.keys(t.value)).sort(),y.default.isEqual(this._keys,e))e=null;else{for(var n=0,i=y.default.difference(e,this._keys);n<i.length;n+=1){var o=i[n];this._coupler._coupleSegments(this._segments.concat(o))}for(var s=0,a=y.default.difference(this._keys,e);s<a.length;s+=1){var u=a[s];this._coupler._decoupleSegments(this._segments.concat(u))}this._keys=e}if(t.exists){for(var c=t.value,l=t.path,h=0,f=this._keys;h<f.length;h+=1){var d=f[h];t._path=l+"/"+d,t._key=void 0,t._value=c[d],this._coupler._applySnapshot(t)}t._path=l,t._key=void 0,t._value=c}}else t.path.replace(/\/[^/]+/,"")===this._query.path&&(r=y.default.includes(this._keys,t.key),t.value?r||(this._coupler._coupleSegments(this._segments.concat(t.key)),this._keys.push(t.key),this._keys.sort(),e=this._keys):r&&(this._coupler._decoupleSegments(this._segments.concat(t.key)),y.default.pull(this._keys,t.key),this._keys.sort(),e=this._keys),this._coupler._applySnapshot(t));return e},S.prototype._handleError=function(n){var i=this;this._listeners.length&&this._listening&&(this._listening=!1,this.ready=!1,f.digest(),Promise.all(y.default.map(this._listeners,function(e){return i._coupler._dispatcher.clearReady(e.operation),i._coupler._dispatcher.retry(e.operation,n).catch(function(t){return e.operation._disconnect(t),!1})})).then(function(t){if(y.default.some(t))i._listeners.length&&i._listen();else for(var e=0,r=i._listeners;e<r.length;e+=1)r[e].operation._disconnect(n)}))};function x(t,e,r,n,i){this._rootUrl=t,this._bridge=e,this._dispatcher=r,this._applySnapshot=n,this._pendingSnapshotCallbacks=[],this._throttled={processPendingSnapshots:this._processPendingSnapshots},this._prunePath=i,this._vue=new c.default({data:{root:void 0,queryHandlers:{}}}),this._vue._renderProxy=this._vue,this._nodeIndex=Object.create(null),Object.freeze(this),this._vue.$data.root=new R(this,"/"),this._nodeIndex["/"]=this._root}function A(t){this._ref=t,this._outcome=void 0,this._values=void 0}function T(t,e,r,n){this._truss=t,this._rootUrl=e,this._bridge=r,this._dispatcher=n,this._firebasePropertyEditAllowed=!1,this._writeSerial=0,this._localWrites={},this._localWriteTimestamp=null,this._initialized=!1,this._modeler=new E("dev"===t.constructor.VERSION),this._coupler=new x(e,r,n,this._integrateSnapshot.bind(this),this._prune.bind(this)),this._vue=new c.default({data:{$root:void 0}}),Object.seal(this)}var D,dt,t={active:{configurable:!0},count:{configurable:!0}},e=(t.active.get=function(){return this.count||this.queryCount},t.count.get=function(){return this.operations.length},R.prototype.listen=function(t){var e=this;!t&&this.count?this.listening||(y.default.forEach(this.operations,function(t){e._coupler._dispatcher.clearReady(t)}),this._coupler._bridge.on(this.url,this.url,null,"value",this._handleSnapshot,this._handleError,this,{sync:!0}),this.listening=!0):y.default.forEach(this.children,function(t){t.listen()})},R.prototype.unlisten=function(t){!t&&this.listening?(this._coupler._bridge.off(this.url,this.url,null,"value",this._handleSnapshot,this),this.listening=!1,this._forAllDescendants(function(t){if(t.listening)return!1;t.ready&&(t.ready=!1,f.digest())})):y.default.forEach(this.children,function(t){t.unlisten()})},R.prototype._handleSnapshot=function(t){var i=this;this._coupler._queueSnapshotCallback(function(){i.listening&&i._coupler.isTrunkCoupled(t.path)&&(i._coupler._applySnapshot(t),i.ready||t.path!==i.path||(i.ready=!0,f.digest(),i.unlisten(!0),i._forAllDescendants(function(t){for(var e=0,r=t.operations;e<r.length;e+=1){var n=r[e];i._coupler._dispatcher.markReady(n)}})))})},R.prototype._handleError=function(n){var i=this;if(this.count&&this.listening)return this.listening=!1,this._forAllDescendants(function(t){if(t.listening)return!1;t.ready&&(t.ready=!1,f.digest());for(var e=0,r=t.operations;e<r.length;e+=1){var n=r[e];i._coupler._dispatcher.clearReady(n)}}),Promise.all(y.default.map(this.operations,function(e){return i._coupler._dispatcher.retry(e,n).catch(function(t){return e._disconnect(t),!1})})).then(function(t){if(y.default.some(t))i.count&&i.listen();else for(var e=0,r=i.operations;e<r.length;e+=1)r[e]._disconnect(n)})},R.prototype._forAllDescendants=function(e){!1!==e(this)&&y.default.forEach(this.children,function(t){return t._forAllDescendants(e)})},R.prototype.collectCoupledDescendantPaths=function(e){return(e=e||{})[this.path]=this.active,this.active||y.default.forEach(this.children,function(t){t.collectCoupledDescendantPaths(e)}),e},Object.defineProperties(R.prototype,t),{_root:{configurable:!0},_queryHandlers:{configurable:!0}}),t=(e._root.get=function(){return this._vue.$data.root},e._queryHandlers.get=function(){return this._vue.$data.queryHandlers},x.prototype.destroy=function(){y.default.forEach(this._queryHandlers,function(t){t.destroy()}),this._root.unlisten(),this._vue.$destroy()},x.prototype.couple=function(t,e){return this._coupleSegments(_(t,!0),e)},x.prototype._coupleSegments=function(t,e){for(var r,n=!e,i=!1,o=0,s=t;o<s.length;o+=1){var a=s[o],u=a?r.children&&r.children[a]:this._root;u||(u=new R(this,("/"===r.path?"":r.path)+"/"+a,r),c.default.set(r.children,a,u),this._nodeIndex[u.path]=u),n=n||u.listening,i=i||u.ready,r=u}e?r.operations.push(e):r.queryCount++,n?e&&i&&this._dispatcher.markReady(e):r.listen()},x.prototype.decouple=function(t,e){return this._decoupleSegments(_(t,!0),e)},x.prototype._decoupleSegments=function(t,e){for(var r=[],n=0,i=t;n<i.length;n+=1){var o,s=i[n];if(!(o=s?o.children&&o.children[s]:this._root))break;r.push(o)}if(!o||!(e?o.count:o.queryCount))throw new Error("Path not coupled: "+(t.join("/")||"/"));if(e?y.default.pull(o.operations,e):o.queryCount--,e&&!o.count&&(o.listen(),o.listening&&o.unlisten()),!o.active){for(var a=r.length-1;0<a&&((o=r[a])!==this._root&&!o.active&&y.default.isEmpty(o.children));a--)c.default.delete(r[a-1].children,t[a]),o.ready=void 0,delete this._nodeIndex[o.path];e=t.join("/")||"/";this._prunePath(e,this.findCoupledDescendantPaths(e))}},x.prototype.subscribe=function(t,e,r){var n=this._queryHandlers[t.toString()];n||(n=new S(this,t),c.default.set(this._queryHandlers,t.toString(),n)),n.attach(e,r)},x.prototype.unsubscribe=function(t,e){var r=this._queryHandlers[t.toString()];r&&!r.detach(e)&&(r.destroy(),c.default.delete(this._queryHandlers,t.toString()))},x.prototype.isTrunkCoupled=function(t){for(var e=0,r=_(t,!0);e<r.length;e+=1){var n,i=r[e];if(!(n=i?n.children&&n.children[i]:this._root))return!1;if(n.active)return!0}return!1},x.prototype.findCoupledDescendantPaths=function(t){for(var e=0,r=_(t,!0);e<r.length;e+=1){var n,i=r[e];if((n=i?n.children&&n.children[i]:this._root)&&n.active)return(i={})[t]=n.active,i;if(!n)break}return n&&n.collectCoupledDescendantPaths()},x.prototype.isSubtreeReady=function(t){var e,r;function n(t){return r=t.slice(1),""}for(;!(e=this._nodeIndex[t]);)t=t.replace(/\/[^/]*$/,n)||"/";for(r&&e.children;e;){if(e.ready)return!0;e=e.parent}return!1},x.prototype.isQueryReady=function(t){t=this._queryHandlers[t.toString()];return t&&t.ready},x.prototype._queueSnapshotCallback=function(t){this._pendingSnapshotCallbacks.push(t),this._throttled.processPendingSnapshots.call(this)},x.prototype._processPendingSnapshots=function(){for(var t=0,e=this._pendingSnapshotCallbacks;t<e.length;t+=1)(0,e[t])();this._pendingSnapshotCallbacks.splice(0,1/0)},x.prototype.throttleSnapshots=function(t){this._throttled.processPendingSnapshots=t?y.default.debounce(y.default.throttle(this._processPendingSnapshots,t)):this._processPendingSnapshots},Object.defineProperties(x.prototype,e),{currentValue:{configurable:!0},outcome:{configurable:!0},values:{configurable:!0}}),e=(t.currentValue.get=function(){return this._ref.value},t.outcome.get=function(){return this._outcome},t.values.get=function(){return this._values},A.prototype._setOutcome=function(t){if(this._outcome)throw new Error("Transaction already resolved with "+this._outcome);this._outcome=t},A.prototype.abort=function(){this._setOutcome("abort")},A.prototype.cancel=function(){this._setOutcome("cancel")},A.prototype.set=function(t){if(void 0===t)throw new Error("Invalid argument: undefined");this._setOutcome("set"),this._values={"":t}},A.prototype.update=function(t){if(void 0===t)throw new Error("Invalid argument: undefined");if(y.default.isEmpty(t))return this.cancel();this._setOutcome("update"),this._values=t},Object.defineProperties(A.prototype,t),{root:{configurable:!0},truss:{configurable:!0}});function pt(r,n){y.default.forEach(y.default.keys(n),function(t){if("/"===t.charAt(0)){if(!(t===r||"/"===r||y.default.startsWith(t,r+"/")&&t.length>r.length+1))throw new Error("Update item is not a descendant of target ref: "+t)}else{if(y.default.includes(t,"/"))throw new Error("Update item deep path must be absolute, taken from a reference: "+t);var e=p(r,d(t));if(n.hasOwnProperty(e))throw new Error("Update items overlap: "+t+" and "+e);n[e]=n[t],delete n[t]}});var o=y.default(n).keys().map(function(t){return p(t,"")}).sortBy("length").value();y.default.forEach(n,function(t,e){for(var r=0,n=o;r<n.length;r+=1){var i=n[r];if(i.length>e.length)break;if(e!==i&&y.default.startsWith(e,i))throw new Error("Update items overlap: "+i+" and "+e)}})}function _t(t,e){var r="/"===t?1:t.length+1;y.default.forEach(y.default.keys(e),function(t){e[t.slice(r)]=e[t],delete e[t]})}function yt(t){if(!y.default.isObject(t))return t;var e,r={},n=t.$data;for(e in n)n.hasOwnProperty(e)&&(r[d(e)]=yt(n[e]));return r}e.root.get=function(){return this._vue.$data.$root||(this._vue.$data.$root=this._createObject("/"),this._fixObject(this._vue.$data.$root),this._completeCreateObject(this._vue.$data.$root),f.digest()),this._vue.$data.$root},e.truss.get=function(){return this._truss},T.prototype.init=function(t){if(this._initialized)throw new Error("Data objects already created, too late to mount classes");this._initialized=!0,this._modeler.init(t,!this._vue.$data.$root);t=[];this._plantPlaceholders(this.root,"/",void 0,t);for(var e=0,r=t;e<r.length;e+=1)this._completeCreateObject(r[e])},T.prototype.destroy=function(){this._coupler.destroy(),this._modeler&&this._modeler.destroy(),this._vue.$destroy()},T.prototype.connectReference=function(t,e){var r=this,n=(this._checkHandle(t),this._dispatcher.createOperation("read",e,t));return n._disconnect=this._disconnectReference.bind(this,t,n,void 0),this._dispatcher.begin(n).then(function(){n.running&&!n._disconnected&&(r._coupler.couple(t.path,n),n._coupled=!0)}).catch(y.default.noop),n._disconnect},T.prototype._disconnectReference=function(t,e,r,n){e._disconnected||(e._disconnected=!0,r&&r(),e._coupled&&(this._coupler.decouple(t.path,e),e._coupled=!1),this._dispatcher.end(e,n).catch(y.default.noop))},T.prototype.isReferenceReady=function(t){return this._checkHandle(t),this._coupler.isSubtreeReady(t.path)},T.prototype.connectQuery=function(t,e,r){var n=this,i=(this._checkHandle(t),this._dispatcher.createOperation("read",r,t));return i._disconnect=this._disconnectQuery.bind(this,t,i),this._dispatcher.begin(i).then(function(){i.running&&!i._disconnected&&(n._coupler.subscribe(t,i,e),i._coupled=!0)}).catch(y.default.noop),i._disconnect},T.prototype._disconnectQuery=function(t,e,r){e._disconnected||(e._disconnected=!0,e._coupled&&(this._coupler.unsubscribe(t,e),e._coupled=!1),this._dispatcher.end(e,r).catch(y.default.noop))},T.prototype.isQueryReady=function(t){return this._coupler.isQueryReady(t)},T.prototype._checkHandle=function(t){if(!t.belongsTo(this._truss))throw new Error("Reference belongs to another Truss instance")},T.prototype.throttleRemoteDataUpdates=function(t){this._coupler.throttleSnapshots(t)},T.prototype.update=function(e,t,r){var n=this,i=(r=y.default.mapValues(r,U),y.default.size(r));if(!i)return Promise.resolve();if("update"!==t&&"override"!==t||pt(e.path,r),this._applyLocalWrite(r,"override"===t))return Promise.resolve();t=r,y.default.forEach(t,function(t,e){var r="/"===e?[""]:_(e,!0);if(o){for(var n=0,i=Math.min(o.length,r.length);n<i&&o[n]===r[n];)n++;if(!(o=o.slice(0,n)).length)return!1}else o=r});var o,t=1===o.length?"/":o.join("/"),s=(_t(t,r),t!==e.path&&(e=new v(e._tree,t,e._annotations)),this._rootUrl+t),a=this._writeSerial,u=1===i,c=u?r[""]:r;return this._dispatcher.execute("write",u?"set":"update",e,c,function(){return n._bridge[u?"set":"update"](s,c,a).catch(function(t){return t.immediateFailure?w(n._repair(e,r),function(){return Promise.reject(t)}):Promise.reject(t)})})},T.prototype.commit=function(i,t){function o(){if(25<=e++)return Promise.reject(new Error("Transaction needed too many retries, giving up"));var r,n=new A(i);return c.default.nextTick().then(function(){return r=yt(n.currentValue),t(n)}).then(function(){var t;if(!y.default.isEqual(r,yt(n.currentValue)))return o();if("abort"===n.outcome)return n;var e=y.default.mapValues(n.values,U);switch(n.outcome){case"cancel":break;case"set":if(s._applyLocalWrite(((t={})[i.path]=e[""],t)))return Promise.resolve();break;case"update":if(pt(i.path,e),s._applyLocalWrite(e))return Promise.resolve();_t(i.path,e);break;default:throw new Error("Invalid transaction outcome: "+(n.outcome||"none"))}return s._bridge.transaction(s._rootUrl+i.path,r,e,s._writeSerial).then(function(t){return y.default.forEach(t.snapshots,function(t){return s._integrateSnapshot(t)}),t.committed?n:o()},function(t){return!t.immediateFailure||"set"!==n.outcome&&"update"!==n.outcome?Promise.reject(t):w(s._repair(i,e),function(){return Promise.reject(t)})})})}var s=this,e=0;t=rt(t);return this._truss.peek(i,function(){return s._dispatcher.execute("write","commit",i,void 0,o)})},T.prototype._repair=function(t,e){var r=this,n=t.path,t=y.default(e).keys().flatMap(function(t){var e=n;return t&&(e=p(n,t)),y.default.keys(r._coupler.findCoupledDescendantPaths(e))}).value();return Promise.all(y.default.map(t,function(t){return r._bridge.once(r._rootUrl+t).then(function(t){r._integrateSnapshot(t)})}))},T.prototype._applyLocalWrite=function(t,h){var f=this,d=(this._writeSerial++,this._localWriteTimestamp=this._truss.now,[]),p=0;y.default.forEach(t,function(t,e){var r=f._modeler.isLocal(e,t),n=(r&&p++,r?((n={})[e]=!0,n):f._coupler.findCoupledDescendantPaths(e));if(!y.default.isEmpty(n)){var i,o=("/"===e?0:e.length)+1;for(i in n){var s=i.slice(o),a=t;if(s&&null!=t)for(var u=0,c=_(s);u<c.length;u+=1){var l=c[u];if(void 0===(a=a.$data[l]))break}y.default.isNil(a)?f._prune(i):(s=y.default.last(_(i)),f._plantValue(i,s,a,f._scaffoldAncestors(i,!1,d),!1,h,r,d)),h||r||(f._localWrites[i]=f._writeSerial)}}});for(var e=0,r=d;e<r.length;e+=1)this._completeCreateObject(r[e]);if(p&&p<y.default.size(t))throw new Error("Write on a mix of local and remote tree paths.");return h||!!p},T.prototype._createObject=function(t,e){this._initialized||"/"===t||this.init();e={$parent:{value:e,configurable:!0,enumerable:!0},$path:{value:t}},"/"===t&&(e.$truss={value:this._truss}),t=this._modeler.createObject(t,e);return Object.defineProperties(t,e),t},T.prototype._fixObject=function(t){for(var e=0,r=Object.getOwnPropertyNames(t);e<r.length;e+=1){var n=r[e],i=Object.getOwnPropertyDescriptor(t,n);i.configurable&&i.enumerable&&(i.enumerable=!1,y.default.startsWith(n,"$")&&(i.configurable=!1),Object.defineProperty(t,n,i))}},T.prototype._completeCreateObject=function(t){if(t.hasOwnProperty("$$initializers")){for(var e=0,r=t.$$initializers;e<r.length;e+=1)(0,r[e])(this._vue);delete t.$$initializers}},T.prototype._destroyObject=function(t){if(t&&t.$truss&&!t.$destroyed){this._modeler.destroyObject(t);for(var e=0,r=Object.getOwnPropertyNames(t.$data);e<r.length;e+=1){var n=r[e],n=t.$data[n];n&&n.$parent===t&&this._destroyObject(n)}}},T.prototype._integrateSnapshot=function(r){var n=this;if(y.default.forEach(this._localWrites,function(t,e){r.writeSerial>=t&&delete n._localWrites[e]}),r.exists){var t=[],e=this._scaffoldAncestors(r.path,!0,t);e&&this._plantValue(r.path,r.key,r.value,e,!0,!1,!1,t);for(var i=0,o=t;i<o.length;i+=1)this._completeCreateObject(o[i])}else this._prune(r.path,null,!0)},T.prototype._scaffoldAncestors=function(t,e,r){for(var n,i=y.default.dropRight(_(t,!0)),o="/",s=0;s<i.length;s++){var a=i[s],u=h(a),c=a?n.$data[u]:this.root;if(a&&(o+=("/"===o?"":"/")+a),c){if(e&&this._localWrites[o])return}else if(!(c=this._plantValue(o,u,{},n,e,!1,!1,r)))return;n=c}return n},T.prototype._plantValue=function(r,t,n,e,i,o,s,a){var u=this;if(i&&y.default.isNil(n))throw new Error("Snapshot includes invalid value at "+r+": "+n);if(!i||!this._localWrites[r||"/"]){y.default.isEqual(n,J)&&(n=this._localWriteTimestamp);var c,l=e.$data[t];if(y.default.isArray(n)||(s?y.default.isPlainObject(n):y.default.isObject(n)))return c=!1,y.default.isObject(l)||(this._setFirebaseProperty(e,t,null),l=this._createObject(r,e),this._setFirebaseProperty(e,t,l,l.$hidden),this._fixObject(l),a.push(l),c=!0),o?Object.defineProperty(l,"$overridden",{get:y.default.constant(!0),configurable:!0}):l.$overridden&&delete l.$overridden,c&&this._plantPlaceholders(l,r,!0,a),y.default.forEach(n,function(t,e){u._plantValue(p(r,e),h(e),t,l,i,o,s,a)}),c?this._plantPlaceholders(l,r,!1,a):y.default.forEach(l.$data,function(t,e){e=d(e);n.hasOwnProperty(e)||u._prune(p(r,e),null,i)}),l;this._destroyObject(l),!s&&y.default.isNil(n)?this._deleteFirebaseProperty(e,t):this._setFirebaseProperty(e,t,n)}},T.prototype._plantPlaceholders=function(r,n,i,o){var s=this;this._modeler.forEachPlaceholderChild(n,function(t){var e;void 0!==i&&i!==!!t.hidden||(e=h(t.escapedKey),r.$data.hasOwnProperty(e)||s._plantValue(p(n,t.escapedKey),e,t.placeholder,r,!1,!1,!1,o))})},T.prototype._prune=function(t,e,r){e=e||{};var n=this.getObject(t);void 0===n||r&&this._avoidLocalWritePaths(t,e)||y.default.isEmpty(e)&&this._pruneAncestors(t,n)||!y.default.isObject(n)||this._pruneDescendants(n,e)},T.prototype._avoidLocalWritePaths=function(t,e){for(var r in this._localWrites)if(this._localWrites.hasOwnProperty(r)){if(t===r||"/"===r||y.default.startsWith(t,r+"/"))return!0;if("/"===t||y.default.startsWith(r,t+"/"))for(var n=_(r,!0),i=n.length;0<i;i--){var o=n.slice(0,i).join("/"),s=i===n.length;if(e[o]||e[o]===s)break;if(e[o]=s,o===t)break}}},T.prototype._pruneAncestors=function(t,e){for(var r,n=!1,i=e,o=t.replace(/\/[^/]+$/,function(t){return r=h(t.slice(1)),""});void 0!==i&&i!==this.root;){var s=i&&i.$parent||i===e&&this.getObject(o);this._modeler.isPlaceholder(i&&i.$path||t)||this._holdsConcreteData(i,n?null:[e])||(n=!0,this._deleteFirebaseProperty(s,i&&i.$key||i===e&&r)),i=s}return n},T.prototype._holdsConcreteData=function(t,e){var r=this;return!y.default.isNil(t)&&((!e||!y.default.includes(e,t))&&(!y.default.isObject(t)||!t.$truss||y.default.some(t.$data,function(t){return r._holdsConcreteData(t,e)})))},T.prototype._pruneDescendants=function(o,s){var a=this;if(s[o.$path])return!0;o.$overridden&&delete o.$overridden;var u=!1;return y.default.forEach(o.$data,function(t,e){var r,n,i=!0;s[p(o.$path,d(e))]?r=!(i=!1):!y.default.isNil(t)&&t.$truss&&((n=a._modeler.isPlaceholder(t.$path))||y.default.has(s,t.$path))&&(r=a._pruneDescendants(t,s),i=!n&&!r),i&&a._deleteFirebaseProperty(o,e),u=u||r}),u},T.prototype.getObject=function(t){for(var e=0,r=_(t);e<r.length;e+=1){var n,i=r[e];if(void 0===(n=i?n.$data[i]:this.root))return}return n},T.prototype._getFirebasePropertyDescriptor=function(t,e,r){var n=Object.getOwnPropertyDescriptor(e,r);if(n){if(!n.enumerable){var i=e[r];if(!i||i.$parent!==t)throw new Error("Key conflict between Firebase and instance or computed properties at "+t.$path+": "+r)}if(!n.get||!n.set)throw new Error("Unbound property at "+t.$path+": "+r)}else if(r in e)throw new Error("Key conflict between Firebase and inherited property at "+t.$path+": "+r);return n},T.prototype._setFirebaseProperty=function(t,e,r,n){var i=t.hasOwnProperty("$data")?t.$data:t,t=this._getFirebasePropertyDescriptor(t,i,e);if(t){if(n&&Object.defineProperty(i,e,{get:t.get,set:t.set,configurable:!0,enumerable:!1}),i[e]===r)return;this._firebasePropertyEditAllowed=!0,i[e]=r,this._firebasePropertyEditAllowed=!1}else c.default.set(i,e,r),t=Object.getOwnPropertyDescriptor(i,e),Object.defineProperty(i,e,{get:t.get,set:this._overwriteFirebaseProperty.bind(this,t,e),configurable:!0,enumerable:!n});f.digest()},T.prototype._overwriteFirebaseProperty=function(t,e,r){if(!this._firebasePropertyEditAllowed)throw(e=new Error("Firebase data cannot be mutated directly: "+e)).trussCode="firebase_overwrite",e;t.set.call(this,r)},T.prototype._deleteFirebaseProperty=function(t,e){var r=t.hasOwnProperty("$data")?t.$data:t;this._getFirebasePropertyDescriptor(t,r,e),this._destroyObject(r[e]),c.default.delete(r,e),f.digest()},T.prototype.checkVueObject=function(t,e){this._modeler.checkVueObject(t,e)},Object.defineProperties(T.prototype,e);function z(t){if(!D)throw new Error("Truss worker not connected, please call Truss.connectWorker first");this._rootUrl=t.replace(/\/$/,""),this._keyGenerator=new ot,this._dispatcher=new $(D),this._vue=new c.default,D.trackServer(this._rootUrl),this._tree=new T(this,this._rootUrl,D,this._dispatcher),this._metaTree=new k(this._rootUrl,this._tree,D,this._dispatcher),Object.freeze(this)}var gt={},t={meta:{configurable:!0},store:{configurable:!0},now:{configurable:!0},SERVER_TIMESTAMP:{configurable:!0},VERSION:{configurable:!0},FIREBASE_SDK_VERSION:{configurable:!0}},e={computedPropertyStats:{configurable:!0},worker:{configurable:!0}};return t.meta.get=function(){return this._metaTree.root},t.store.get=function(){return this._tree.root},z.prototype.mount=function(t){this._tree.init(t)},z.prototype.destroy=function(){this._vue.$destroy(),this._tree.destroy(),this._metaTree.destroy()},t.now.get=function(){return Date.now()+this.meta.timeOffset},z.prototype.newKey=function(){return this._keyGenerator.generateUniqueKey(this.now)},z.prototype.authenticate=function(t){return this._metaTree.authenticate(t)},z.prototype.unauthenticate=function(){return this._metaTree.unauthenticate()},z.prototype.intercept=function(t,e){return this._dispatcher.intercept(t,e)},z.prototype.connect=function(t,e){return e||(e=t,t=void 0),new b(t,e=e instanceof g?{_:e}:e,this._tree,"connect")},z.prototype.peek=function(a,u){var c,l,h=this;return u=rt(u||y.default.identity),nt(Promise.resolve().then(function(){return new Promise(function(e,n){var r,i={},t=new b(i,{result:a},h._tree,"peek"),o=h.intercept("peek",{onFailure:function(r){!function t(e){if(e)return e instanceof g?r.target.isEqual(e):y.default.some(e,t)}(t.at)||(n(r.error),c())}}),s=h.observe(function(){return t.ready},function(t){t&&(s(),s=null,r=w(u(i.result),function(){f.digest(),r=null,c()}).then(function(t){e(t)},function(t){n(t)}))});c=function(){s&&(s(),s=null),o&&(o(),o=null),t&&(t.destroy(),t=null),r&&r.cancel&&r.cancel()},l=function(){n(new Error("Canceled")),c()}})}),l)},z.prototype.observe=function(t,n,i){var o,s=y.default.isObject(i&&i.precise),a=0,u=(s&&(o=i.deep?y.default.cloneDeep(i.precise):y.default.clone(i.precise)),this._vue.$watch(t,function(t,e){if(i&&i.precise){var r=s?i.deep?y.default.defaultsDeep({},t,i.precise):y.default.defaults({},t,i.precise):i.deep?y.default.cloneDeep(t):y.default.clone(t);if(y.default.isEqual(r,o))return;o=r}a++,u?(n(t,e),f.digest()):Promise.resolve().then(function(){1<a||n(t,e)})},{immediate:!0,deep:i&&i.deep}));return i&&i.scope&&i.scope.$on("$destroy",u),u},z.prototype.when=function(n,i){var o,s,a=this,t=nt(w(t=new Promise(function(e,t){var r=a.observe(n,function(t){t&&c.default.nextTick(function(){(t=n())&&(e(t),o())})});y.default.has(i,"timeout")&&(s=setTimeout(function(){s=null,t(new Error(i.timeoutMessage||"Timeout")),o()},i.timeout)),o=function(){r&&(r(),r=null),s&&(clearTimeout(s),s=null),t(new Error("Canceled"))}}),o),o);return i&&i.scope&&i.scope.$on("$destroy",function(){t.cancel()}),t},z.prototype.nextTick=function(){var r;return nt(new Promise(function(t,e){c.default.nextTick(t),r=function(){e(new Error("Canceled"))}}),r)},z.prototype.throttleRemoteDataUpdates=function(t){this._tree.throttleRemoteDataUpdates(t)},z.prototype.checkObjectsForRogueProperties=function(){this._tree.checkVueObject(this._tree.root,"/")},e.computedPropertyStats.get=function(){return tt},z.connectWorker=function(t,e){if(D)throw new Error("Worker already connected");if(y.default.isString(t)){var r=window.SharedWorker||window.Worker;if(!r)throw new Error("Browser does not implement Web Workers");t=new r(t)}return D=new i(t),dt&&D.enableLogging(dt),D.init(t,e).then(function(t){var e=t.exposedFunctionNames,t=t.firebaseSdkVersion;Object.defineProperty(z,"FIREBASE_SDK_VERSION",{value:t});for(var r=0,n=e;r<n.length;r+=1){var i=n[r];z.preExpose(i)}})},e.worker.get=function(){return gt},z.preExpose=function(t){for(var e=t.split("."),r=z.worker,n=0,i=e.slice(0,-1);n<i.length;n+=1){var o=i[n];Object.hasOwnProperty.call(r,o)||(r[o]={}),r=r[o]}r[e[e.length-1]]=D.bindExposedFunction(t)},z.bounceConnection=function(){return D.bounceConnection()},z.suspend=function(){return D.suspend()},z.debugPermissionDeniedErrors=function(t,e,r){return D.debugPermissionDeniedErrors(t,e,r)},z.debounceAngularDigest=function(t){f.debounceDigest(t)},z.escapeKey=d,z.unescapeKey=h,z.enableLogging=function(t){dt=t,D&&D.enableLogging(t)},t.SERVER_TIMESTAMP.get=function(){return z.SERVER_TIMESTAMP},t.VERSION.get=function(){return z.VERSION},t.FIREBASE_SDK_VERSION.get=function(){return z.FIREBASE_SDK_VERSION},Object.defineProperties(z.prototype,t),Object.defineProperties(z,e),Object.defineProperties(z,{SERVER_TIMESTAMP:{value:J},VERSION:{value:"dev"},ComponentPlugin:{value:{install:function(t,e){if(c.default!==t)throw new Error("Multiple versions of Vue detected");if(!e.truss)throw new Error("Need to pass `truss` instance as an option to use the ComponentPlugin");t={$truss:{value:e.truss},$destroyed:{get:function(){return this._isBeingDestroyed||this._isDestroyed}},$$touchThis:{value:function(){this.__ob__&&this.__ob__.dep.depend()}}},e=y.default(t).keys().union(y.default.keys(P.prototype)).intersection(y.default.keys(c.default.prototype)).value();if(e.length)throw new Error("Truss extension properties conflict with Vue properties: "+e.join(", "));Object.defineProperties(c.default.prototype,t),X(P,c.default),c.default.mixin({destroyed:function(){if(y.default.has(this,"$$finalizers"))for(var t=0,e=y.default.clone(this.$$finalizers);t<e.length;t+=1)(0,e[t])()}})}}}}),f.defineModule(z),z});
//# sourceMappingURL=firetruss.umd.min.js.map