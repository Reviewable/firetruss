!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("lodash"),require("vue")):"function"==typeof define&&define.amd?define(["lodash","vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).Truss=t(e._,e.Vue)}(this,function(e,M){"use strict";function I(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var _=I(e),o=I(M);let n,a=0,l=!1;function h(){n.digestRequest>a||(n.digestRequest=a+1)}const c={active:"undefined"!=typeof window&&window.angular};if(c.active){const me=window.angular.module("firetruss",[]);c.digest=h,c.watch=function(){throw new Error("Angular watch proxy not yet initialized")},c.defineModule=function(e){me.constant("Truss",e)},c.debounceDigest=function(e){if(e){const t=_.default.debounce(h,e);c.digest=function(){n.digestRequest>a||(l?h:t)()}}else c.digest=h},me.config(["$provide",function(e){e.decorator("$rootScope",["$delegate","$exceptionHandler",function(e,t){const r=e;c.watch=r.$watch.bind(r);var e=Object.getPrototypeOf(r),s=e.$digest,e=(e.$digest=h,e.$digest.original=s,(n=new o.default({data:{digestRequest:0}})).$watch(()=>n.digestRequest,()=>{n.digestRequest>a?o.default.nextTick(()=>{n.digestRequest<=a||(l=!0,r.$digest.original.call(r),a=n.digestRequest=n.digestRequest+1)}):l=!1}),_.default.last(n._watchers||n._scope.effects));e.id=1/0;{const i=(s=Object.getPrototypeOf(e)).get;s.get=function(){try{return i.call(this)}catch(e){if(this.vm._watcher!==this||!o.default.config.errorHandler)throw e;o.default.config.errorHandler(e,this.vm,"uncaught render error")}}}return r}])}])}else _.default.forEach(["digest","watch","defineModule","debounceDigest"],e=>{c[e]=_.default.noop});class F{constructor(e,t){this.key=e,this.value=t,this.touch()}touch(){this.timestamp=Date.now()}}const U=new class{constructor(e,t){this._items=Object.create(null),this._size=0,this._maxSize=e,this._pruningSize=t||Math.ceil(.1*e)}has(e){return Boolean(this._items[e])}get(e){e=this._items[e];if(e)return e.touch(),e.value}set(e,t){var r=this._items[e];r?r.value=t:(this._size>=this._maxSize&&this._prune(),this._items[e]=new F(e,t),this._size+=1)}delete(e){this._items[e]&&(delete this._items[e],--this._size)}_prune(){for(const e of _.default(this._items).toArray().sortBy("timestamp").take(this._pruningSize).value())this.delete(e.key)}}(1e3),r={};function p(e){return e&&e.toString().replace(/[\x00-\x1f\\.$#[\]\x7f/]/g,function(e){return"\\"+_.default.padStart(e.charCodeAt(0).toString(16),2,"0")})}function u(e){return e&&e.toString().replace(/\\[0-9a-f]{2}/gi,function(e){return String.fromCharCode(parseInt(e.slice(1),16))})}function d(e){if(!_.default.isObject(e)||!Object.isExtensible(e))return e;let t=e;for(const n in e){var r,s,i;e.hasOwnProperty(n)&&(r=e[n],s=p(n),i=d(r),s===n&&i===r||((t=t===e?_.default.clone(e):t)[s]=i,t[n]===r&&delete t[n]))}return t}function g(){var e,t=[];for(e of arguments)"/"===(e=_.default.isString(e)?e:""+e).charAt(0)&&t.splice(0,t.length),t.push(e);return"/"===t[0]&&(t[0]=""),t.join("/")}function f(e,t){var r=(t?"esc:":"")+e;let s=U.get(r);return s||(s=e.split("/"),t||(s=_.default.map(s,u)),U.set(r,s)),s}class q{constructor(e){this.variables=[];var t=_.default.endsWith(e,"/$*"),r=(e=t?e.slice(0,-3):e).replace(/\/\$[^/]*/g,e=>(1<e.length&&this.variables.push(e.slice(1)),""));if(Object.freeze(this.variables),/[.$#[\]]|\\(?![0-9a-f][0-9a-f])/i.test(r))throw new Error("Path pattern has unescaped keys: "+e);this._regex=new RegExp("^"+r.replace(/\u0001/g,"/([^/]+)")+(t?"($|/)":"$"))}match(e){this._regex.lastIndex=0;var t=this._regex.exec(e);if(t){var r={};for(let e=0;e<this.variables.length;e++)r[this.variables[e]]=u(t[e+1]);return r}}test(e){return this._regex.test(e)}toString(){return this._regex.toString()}}function m(e){let t=r[e];return t||(t=new q(e),1e3===_.default.size(r)&&delete r[_.default.keys(r)[0]],r[e]=t),t}const V="3.0.0";class i{constructor({path:e,value:t,exists:r,writeSerial:s}){this._path=e,this._value=t,this._exists=void 0===t?r||!1:null!==t,this._writeSerial=s}get path(){return this._path}get exists(){return this._exists}get value(){if(void 0===this._value)throw new Error("Value omitted from snapshot");return this._value}get key(){return void 0===this._key&&(this._key=u(this._path.replace(/.*\//,""))),this._key}get writeSerial(){return this._writeSerial}}class W{constructor(e){this._idCounter=0,this._deferreds={},this._suspended=!1,this._servers={},this._callbacks={},this._log=_.default.noop,this._inboundMessages=[],this._outboundMessages=[],this._flushMessageQueue=this._flushMessageQueue.bind(this),this._port=e.port||e,this._shared=!!e.port,Object.seal(this),this._port.onmessage=this._receive.bind(this),window.addEventListener("unload",()=>{this._send({msg:"destroy"})})}init(e,t){var r=[];try{var s=window.localStorage||window.sessionStorage;if(!s)throw new Error("localStorage and sessionStorage not available");for(let e=0;e<s.length;e++){var i=s.key(e);r.push({key:i,value:s.getItem(i)})}}catch(e){}return this._send({msg:"init",storage:r,config:t}).then(e=>{var t=e.version.match(/^(\d+)\.(\d+)\.(\d+)(-.*)?$/);if(t){var r=V.match(/^(\d+)\.(\d+)\.(\d+)(-.*)?$/);if(!(t[1]===r[1]&&(t[2]>r[2]||t[2]===r[2]&&t[3]>=r[3])))return Promise.reject(new Error(`Incompatible Firetruss worker version: ${e.version} `+`(${V} or better required)`))}return e})}suspend(e){this._suspended===(e=void 0===e?!0:e)||(this._suspended=e)||(this._receiveMessages(this._inboundMessages),this._inboundMessages=[],this._outboundMessages.length&&Promise.resolve().then(this._flushMessageQueue))}enableLogging(e){e?(!0===e&&(e=console.log.bind(console),this._send({msg:"enableFirebaseLogging",value:!0})),this._log=e):(this._send({msg:"enableFirebaseLogging",value:!1}),this._log=_.default.noop)}_send(r){r.id=++this._idCounter;let e;if(r.oneWay)e=Promise.resolve();else{e=new Promise((e,t)=>{this._deferreds[r.id]={resolve:e,reject:t}});const t=this._deferreds[r.id];(t.promise=e).sent=new Promise(e=>{t.resolveSent=e}),t.params=r}return this._outboundMessages.length||this._suspended||Promise.resolve().then(this._flushMessageQueue),this._log("send:",r),this._outboundMessages.push(r),e}_flushMessageQueue(){try{this._port.postMessage(this._outboundMessages),this._outboundMessages=[]}catch(e){throw e.extra={messages:this._outboundMessages},e}}_receive(e){this._suspended?this._inboundMessages=this._inboundMessages.concat(e.data):this._receiveMessages(e.data)}_receiveMessages(e){for(const r of e){this._log("recv:",r);var t=this[r.msg];if(!_.default.isFunction(t))throw new Error("Unknown message: "+r.msg);t.call(this,r)}}bindExposedFunction(e){return function(){return this._send({msg:"call",name:e,args:Array.prototype.slice.call(arguments)})}.bind(this)}resolve(e){var t=this._deferreds[e.id];if(!t)throw new Error("Received resolution to inexistent Firebase call");delete this._deferreds[e.id],t.resolve(e.result)}reject(e){var t=this._deferreds[e.id];if(!t)throw new Error("Received rejection of inexistent Firebase call");delete this._deferreds[e.id],t.reject(K(e.error,t.params))}updateLocalStorage({items:e}){try{var t=window.localStorage||window.sessionStorage;for(const r of e)null===r.value?t.removeItem(r.key):t.setItem(r.key,r.value)}catch(e){}}trackServer(e){if(this._servers.hasOwnProperty(e))return Promise.resolve();var t=this._servers[e]={authListeners:[]},t=this._registerCallback(this._authCallback.bind(this,t));this._send({msg:"onAuth",url:e,callbackId:t})}_authCallback(e,t){e.auth=t;for(const r of e.authListeners)r(t)}onAuth(e,t,r){var s=t.bind(r);s.callback=t,s.context=r,this._servers[e].authListeners.push(s),s(this.getAuth(e))}offAuth(e,t,r){var s=this._servers[e].authListeners;for(let e=0;e<s.length;e++){var i=s[e];if(i.callback===t&&i.context===r){s.splice(e,1);break}}}getAuth(e){return this._servers[e].auth}authWithCustomToken(e,t){return this._send({msg:"authWithCustomToken",url:e,authToken:t})}authAnonymously(e){return this._send({msg:"authAnonymously",url:e})}unauth(e){return this._send({msg:"unauth",url:e})}set(e,t,r){return this._send({msg:"set",url:e,value:t,writeSerial:r})}update(e,t,r){return this._send({msg:"update",url:e,value:t,writeSerial:r})}once(e,t){return this._send({msg:"once",url:e,writeSerial:t}).then(e=>new i(e))}on(e,t,r,s,i,n,a,o){n={listenerKey:e,eventType:s,snapshotCallback:i,cancelCallback:n,context:a,params:{msg:"on",listenerKey:e,url:t,spec:r,eventType:s,options:o}};const l=this._onCallback.bind(this,n);this._registerCallback(l,n),i.__callbackIds=i.__callbackIds||[],i.__callbackIds.push(n.id),this._send({msg:"on",listenerKey:e,url:t,spec:r,eventType:s,callbackId:n.id,options:o}).catch(e=>{l(e)})}off(t,e,r,s,i,n){const a=[];let o;if(i){if(!(o=this._findAndRemoveCallbackId(i,e=>_.default.isMatch(e,{listenerKey:t,eventType:s,context:n}))))return Promise.resolve();a.push(o)}else for(const h of _.default.keys(this._callbacks)){var l=this._callbacks[h];l.listenerKey!==t||s&&l.eventType!==s||a.push(h)}for(const u of a)this._nullifyCallback(u);return this._send({msg:"off",listenerKey:t,url:e,spec:r,eventType:s,callbackId:o}).then(()=>{for(const e of a)this._deregisterCallback(e)})}_onCallback(e,t,r){t?(this._deregisterCallback(e.id),t=K(t,e.params),e.cancelCallback?e.cancelCallback.call(e.context,t):console.error(t)):e.snapshotCallback.call(e.context,new i(r))}transaction(e,t,r,s){return this._send({msg:"transaction",url:e,oldValue:t,relativeUpdates:r,writeSerial:s}).then(e=>(e.snapshots&&(e.snapshots=_.default.map(e.snapshots,e=>new i(e))),e))}onDisconnect(e,t,r){return this._send({msg:"onDisconnect",url:e,method:t,value:r})}bounceConnection(){return this._send({msg:"bounceConnection"})}callback({id:e,args:t}){var r=this._callbacks[e];if(!r)throw new Error("Unregistered callback: "+e);r.callback.apply(null,t)}_registerCallback(e,t){return(t=t||{}).callback=e,t.id="cb"+ ++this._idCounter,(this._callbacks[t.id]=t).id}_nullifyCallback(e){this._callbacks[e].callback=_.default.noop}_deregisterCallback(e){delete this._callbacks[e]}_findAndRemoveCallbackId(t,r){if(t.__callbackIds){let e=0;for(;e<t.__callbackIds.length;){var s=t.__callbackIds[e],i=this._callbacks[s];if(i){if(r(i))return t.__callbackIds.splice(e,1),s;e+=1}else t.__callbackIds.splice(e,1)}}}}function K(t,e){if(!t||_.default.isError(t))return t;var r=new Error(t.message);r.params=e;for(const s in t)if("message"!==s&&t.hasOwnProperty(s))try{r[s]=t[s]}catch(e){r.extra=r.extra||{},r.extra[s]=t[s]}return r}const N={};Object.freeze(N);class y{constructor(e,t,r){this._tree=e,this._path=t.replace(/^\/*/,"/").replace(/\/$/,"")||"/",r&&(this._annotations=r,Object.freeze(r))}get $ref(){return this}get key(){return this._key||(this._key=u(this._path.replace(/.*\//,""))),this._key}get path(){return this._path}get _pathPrefix(){return"/"===this._path?"":this._path}get parent(){return new v(this._tree,this._path.replace(/\/[^/]*$/,""),this._annotations)}get annotations(){return this._annotations||N}child(){if(!arguments.length)return this;var e=[];for(const t of arguments){if(_.default.isNil(t))return;e.push(p(t))}return new v(this._tree,this._pathPrefix+"/"+e.join("/"),this._annotations)}children(){if(!arguments.length)return this;var t=[];for(let e=0;e<arguments.length;e++){var r=arguments[e];if(_.default.isArray(r)){var s={},i=this._pathPrefix+(t.length?"/"+t.join("/"):""),n=_.default.slice(arguments,e+1);for(const o of r){var a=new v(this._tree,i+"/"+p(o),this._annotations),a=a.children.apply(a,n);a&&(s[o]=a)}return s}if(_.default.isNil(r))return;t.push(p(r))}return new v(this._tree,this._pathPrefix+"/"+t.join("/"),this._annotations)}peek(e){return this._tree.truss.peek(this,e)}match(e){return m(e).match(this.path)}test(e){return m(e).test(this.path)}isEqual(e){return e instanceof y&&this._tree===e._tree&&this.toString()===e.toString()&&_.default.isEqual(this._annotations,e._annotations)}belongsTo(e){return this._tree.truss===e}}class b extends y{constructor(e,t,r,s){super(e,t,s),this._spec=this._copyAndValidateSpec(r);e=_.default(this._spec).map((e,t)=>t+"="+encodeURIComponent(JSON.stringify(e))).sortBy().join("&");this._string=this._path+"?"+e,Object.freeze(this)}get ready(){return this._tree.isQueryReady(this)}get constraints(){return this._spec}annotate(e){return new b(this._tree,this._path,this._spec,_.default.assign({},this._annotations,e))}_copyAndValidateSpec(t){if(!t.by)throw new Error('Query needs "by" clause: '+JSON.stringify(t));if(1<("at"in t)+("from"in t)+("to"in t))throw new Error('Query must contain at most one of "at", "from", or "to" clauses: '+JSON.stringify(t));if(1<("first"in t)+("last"in t))throw new Error('Query must contain at most one of "first" or "last" clauses: '+JSON.stringify(t));if(!_.default.some(["at","from","to","first","last"],e=>e in t))throw new Error('Query must contain at least one of "at", "from", "to", "first", or "last" clauses: '+JSON.stringify(t));if("$key"!==(t=_.default.clone(t)).by&&"$value"!==t.by){if(!(t.by instanceof v))throw new Error('Query "by" value must be a reference: '+t.by);let e=t.by.toString();if(!_.default.startsWith(e,this._path))throw new Error('Query "by" value must be a descendant of target reference: '+t.by);if(e=e.slice(this._path.length).replace(/^\/?/,""),!_.default.includes(e,"/"))throw new Error('Query "by" value must not be a direct child of target reference: '+t.by);t.by=e.replace(/.*?\//,"")}return Object.freeze(t),t}toString(){return this._string}}class v extends y{constructor(e,t,r){super(e,t,r),Object.freeze(this)}get ready(){return this._tree.isReferenceReady(this)}get value(){return this._tree.getObject(this.path)}toString(){return this._path}annotate(e){return new v(this._tree,this._path,_.default.assign({},this._annotations,e))}query(e){return new b(this._tree,this._path,e,this._annotations)}set(e){return this._checkForUndefinedPath(),this._tree.update(this,"set",{[this.path]:e})}update(e){return this._checkForUndefinedPath(),this._tree.update(this,"update",e)}override(e){return this._checkForUndefinedPath(),this._tree.update(this,"override",{[this.path]:e})}commit(e){return this._checkForUndefinedPath(),this._tree.commit(this,e)}_checkForUndefinedPath(){if("/undefined"===this.path)throw new Error("Invalid path for operation: "+this.path)}}const L=Object.freeze({".sv":"timestamp"});function w(e,t){return _.default.isEqualWith(e,t,Q)}function Q(e,t){return e===t||null==e||null==t||e.$truss||t.$truss?e===t:e.isEqual?e.isEqual(t):void 0}function H(e,t){for(const r of Object.getOwnPropertyNames(e.prototype))"constructor"!==r&&Object.defineProperty(t.prototype,r,Object.getOwnPropertyDescriptor(e.prototype,r))}e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function B(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var $={exports:{}};!function(){var e,t,r,s,i,n;"undefined"!=typeof performance&&null!==performance&&performance.now?$.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?($.exports=function(){return(e()-i)/1e6},t=process.hrtime,s=(e=function(){var e=t();return 1e9*e[0]+e[1]})(),n=1e9*process.uptime(),i=s-n):r=Date.now?($.exports=function(){return Date.now()-r},Date.now()):($.exports=function(){return(new Date).getTime()-r},(new Date).getTime())}.call(e);var k=B($.exports);class P{constructor(e){_.default.assign(this,{name:e,numRecomputes:0,numUpdates:0,runtime:0})}add(e){this.runtime+=e.runtime,this.numUpdates+=e.numUpdates,this.numRecomputes+=e.numRecomputes}get runtimePerRecompute(){return this.numRecomputes?this.runtime/this.numRecomputes:0}toLogParts(e){return[this.name+":",` ${(this.runtime/1e3).toFixed(2)}s`,`(${(this.runtime/e.runtime*100).toFixed(1)}%)`,` ${this.numUpdates} upd /`,this.numRecomputes+" runs",`(${(this.numUpdates/this.numRecomputes*100).toFixed(1)}%)`,` ${this.runtimePerRecompute.toFixed(2)}ms / run`]}}var E=new class{constructor(){this._items={}}for(e){return this._items[e]||(this._items[e]=new P(e)),this._items[e]}get list(){return _.default(this._items).values().sortBy(e=>-e.runtime).value()}log(e=10){var t=this.list;if(t.length){const r=new P("=== Total"),s=(_.default.forEach(t,e=>{r.add(e)}),t=_.default.take(t,e),new P("--- Above")),i=(_.default.forEach(t,e=>{s.add(e)}),_.default.map(t,e=>e.toLogParts(r))),n=(i.push(s.toLogParts(r)),i.push(r.toLogParts(r)),_.default.map(_.default.range(i[0].length),t=>_.default(i).map(e=>e[t].length).max()));_.default.forEach(i,e=>{console.log(_.default.map(e,(e,t)=>_.default.padStart(e,n[t])).join(" "))})}}wrap(s,e,i){const n=this.for(e+"."+i);return function(){var e=k(),t=this._computedWatchers&&this._computedWatchers[i].value;try{var r=s.call(this);return w(t,r)||(n.numUpdates+=1),r}finally{n.runtime+=k()-e,n.numRecomputes+=1}}}};class O{constructor(e,t,r,s,i){Object.freeze(t),this._scope=e,this._connections=t,this._tree=r,this._method=s,this._subConnectors={},this._disconnects={},this._angularUnwatches=void 0,this._data={},this._vue=new o.default({data:{descriptors:{},refs:i||{},values:_.default.mapValues(t,_.default.constant(void 0))}}),this.destroy=this.destroy,Object.seal(this),this._linkScopeProperties(),_.default.forEach(t,(e,t)=>{_.default.isFunction(e)?this._bindComputedConnection(t,e):this._connect(t,e)}),c.active&&e&&e.$on&&e.$id&&e.$on("$destroy",()=>{this.destroy()})}get ready(){return _.default.every(this._connections,(e,t)=>{var r=this._vue.descriptors[t];return!!r&&(r instanceof y?r:this._subConnectors[t]).ready})}get at(){return this._vue.refs}get data(){return this._data}destroy(){this._unlinkScopeProperties(),_.default.forEach(this._angularUnwatches,e=>{e()}),_.default.forEach(this._connections,(e,t)=>{this._disconnect(t)}),this._vue.$destroy()}_linkScopeProperties(){var e=_.default.mapValues(this._connections,(e,t)=>({configurable:!0,enumerable:!1,get:()=>{var e=this._vue.descriptors[t];return e instanceof v?e.value:this._vue.values[t]}}));if(Object.defineProperties(this._data,e),this._scope){for(const t in this._connections)if(t in this._scope)throw new Error("Property already defined on connection target: "+t);Object.defineProperties(this._scope,e),this._scope.__ob__&&this._scope.__ob__.dep.notify()}}_unlinkScopeProperties(){this._scope&&_.default.forEach(this._connections,(e,t)=>{delete this._scope[t]})}_bindComputedConnection(e,t){var r=E.for("connection.at."+e),s=this._computeConnection.bind(this,t,r),e=this._updateComputedConnection.bind(this,e,t,r),r=c.active&&!t.angularWatchSuppressed;this._vue.$watch(s,e,{immediate:!r}),r&&(this._angularUnwatches||(this._angularUnwatches=[]),this._angularUnwatches.push(c.watch(s,e,!0)))}_computeConnection(e,t){var r=k();try{return J(e.call(this._scope))}finally{t.runtime+=k()-r,t.numRecomputes+=1}}_updateComputedConnection(e,t,r){var t=_.default.isFunction(t)?t(this._scope):t,s=!w(this._vue.descriptors[e],t);s&&(r&&s&&(r.numUpdates+=1),t?(t instanceof y||!_.default.has(this._subConnectors,e)?(this._disconnect(e),this._connect(e,t)):this._subConnectors[e]._updateConnections(t),o.default.set(this._vue.descriptors,e,t),c.digest()):this._disconnect(e))}_updateConnections(r){_.default.forEach(r,(e,t)=>{this._updateComputedConnection(t,e)}),_.default.forEach(this._connections,(e,t)=>{_.default.has(r,t)||this._updateComputedConnection(t)}),this._connections=r}_connect(t,e){if(o.default.set(this._vue.descriptors,t,e),c.digest(),e)if(o.default.set(this._vue.values,t,void 0),e instanceof v)o.default.set(this._vue.refs,t,e),this._disconnects[t]=this._tree.connectReference(e,this._method);else if(e instanceof b){o.default.set(this._vue.refs,t,e);var r=this._updateQueryValue.bind(this,t);this._disconnects[t]=this._tree.connectQuery(e,r,this._method)}else{const s={},i={},n=(o.default.set(this._vue.refs,t,i),this._subConnectors[t]=new O(s,e,this._tree,this._method,i)),a=this._disconnects[t]=this._tree.truss.observe(()=>n.ready,e=>{e&&(a(),delete this._disconnects[t],o.default.set(this._vue.values,t,s),c.digest())})}}_disconnect(e){o.default.delete(this._vue.refs,e),this._updateRefValue(e,void 0),_.default.has(this._subConnectors,e)&&(this._subConnectors[e].destroy(),delete this._subConnectors[e]),this._disconnects[e]&&this._disconnects[e](),delete this._disconnects[e],o.default.delete(this._vue.descriptors,e),c.digest()}_updateRefValue(e,t){this._vue.values[e]!==t&&(o.default.set(this._vue.values,e,t),c.digest())}_updateQueryValue(e,t){this._vue.values[e]||(o.default.set(this._vue.values,e,{}),c.digest());var r=this._vue.values[e];for(const i in r)!r.hasOwnProperty(i)||_.default.includes(t,i)||(o.default.delete(r,i),c.digest());var s=this._tree.getObject(this._vue.descriptors[e].path);for(const n of t)r.hasOwnProperty(n)||(o.default.set(r,n,s[n]),c.digest())}}function J(e){if(e)return e instanceof y?e.toString():_.default.mapValues(e,J)}function j(e){return function(){try{return Promise.resolve(e.apply(this,arguments))}catch(e){return Promise.reject(e)}}}function t(e,t){return(e=C(e,()=>{t=null})).cancel=()=>{t&&(t(),t=null)},function s(i,n){const a=i.then,r=i.catch;i.then=(e,t)=>{const r=a.call(i,e,t);return r[n]=i[n],s(r,n),r};i.catch=e=>{const t=r.call(i,e);return t[n]=i[n],s(t,n),t};return i}(e,"cancel"),e}function C(e,t){return t?(t=j(t),e.then(e=>t().then(()=>e),e=>t().then(()=>Promise.reject(e)))):e}const G=["read","write","auth","set","update","commit","connect","peek","authenticate","unathenticate","certify","all"],s=[];class Y{constructor(e,t,r){this._operation=e,this._delay=t,this._callback=r,this._fired=!1}initiate(){this.cancel(),this._fired=!1;var e=Date.now()-this._operation._startTimestamp;this._timeoutId=setTimeout(()=>{this._fired=!0,this._callback(this._operation)},this._delay-e)}cancel(){this._fired&&this._callback(this._operation),this._timeoutId&&clearTimeout(this._timeoutId)}}class X{constructor(e,t,r,s){this._type=e,this._method=t,this._target=r,this._operand=s,this._ready=!1,this._running=!1,this._ended=!1,this._tries=0,this._startTimestamp=Date.now(),this._slowHandles=[]}get type(){return this._type}get method(){return this._method}get target(){return this._target}get targets(){return"update"!==this._method?[this._target]:_.default.map(this._operand,(e,t)=>new v(this._target._tree,g(this._target.path,t),this._target._annotations))}get operand(){return this._operand}get ready(){return this._ready}get running(){return this._running}get ended(){return this._ended}get tries(){return this._tries}get error(){return this._error}onSlow(e,t){e=new Y(this,e,t);this._slowHandles.push(e),e.initiate()}_setRunning(e){this._running=e}_setEnded(e){this._ended=e}_markReady(e){this._ready=!0,e||(this._tries=0),_.default.forEach(this._slowHandles,e=>e.cancel())}_clearReady(){this._ready=!1,this._startTimestamp=Date.now(),_.default.forEach(this._slowHandles,e=>e.initiate())}_incrementTries(){this._tries++}}class Z{constructor(e){this._bridge=e,this._callbacks={},Object.freeze(this)}intercept(e,t){if(!_.default.includes(G,e))throw new Error("Unknown intercept operation type: "+e);var r=_.default.difference(_.default.keys(t),["onBefore","onAfter","onError","onFailure"]);if(r.length)throw new Error("Unknown intercept callback types: "+r.join(", "));r={onBefore:this._addCallback("onBefore",e,t.onBefore),onAfter:this._addCallback("onAfter",e,t.onAfter),onError:this._addCallback("onError",e,t.onError),onFailure:this._addCallback("onFailure",e,t.onFailure)};return this._removeCallbacks.bind(this,e,r)}_addCallback(e,t,r){if(r)return e=this._getCallbacksKey(e,t),t=j(r),(this._callbacks[e]||(this._callbacks[e]=[])).push(t),t}_removeCallback(e,t,r){r&&(e=this._getCallbacksKey(e,t),this._callbacks[e])&&_.default.pull(this._callbacks[e],r)}_removeCallbacks(r,e){_.default.forEach(e,(e,t)=>{this._removeCallback(t,r,e)})}_getCallbacks(e,t,r){return[].concat(this._callbacks[this._getCallbacksKey(e,r)]||s,this._callbacks[this._getCallbacksKey(e,t)]||s,this._callbacks[this._getCallbacksKey(e,"all")]||s)}_getCallbacksKey(e,t){return e+"_"+t}execute(e,t,r,s,i){i=j(i);const n=this.createOperation(e,t,r,s);return this.begin(n).then(()=>{const t=()=>i().catch(e=>this._retryOrEnd(n,e).then(t));return t()}).then(e=>this.end(n).then(()=>e))}createOperation(e,t,r,s){return new X(e,t,r,s)}begin(t){return Promise.all(_.default.map(this._getCallbacks("onBefore",t.type,t.method),e=>e(t))).then(()=>{t.ended||t._setRunning(!0)},e=>this.end(t,e))}markReady(e){e._markReady()}clearReady(e){e._clearReady()}retry(t,r){return t._incrementTries(),t._error=r,Promise.all(_.default.map(this._getCallbacks("onError",t.type,t.method),e=>e(t,r))).then(e=>{if(!t.ended)return(e=_.default.some(e))&&delete t._error,e})}_retryOrEnd(t,r){return this.retry(t,r).then(e=>{if(!e)return this.end(t,r)},e=>this.end(t,e))}end(t,e){return t.ended?Promise.resolve():(t._setRunning(!1),t._setEnded(!0),e?t._error=e:delete t._error,Promise.all(_.default.map(this._getCallbacks("onAfter",t.type,t.method),e=>e(t))).then(()=>this._afterEnd(t),e=>(t._error=e,this._afterEnd(t))))}_afterEnd(t){if(t._markReady(!0),!t.error)return Promise.resolve();const e=this._getCallbacks("onFailure",t.type,t.method);return e&&setTimeout(()=>{_.default.forEach(e,e=>e(t))},0),Promise.reject(t.error)}}const ee="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",te=window.crypto&&window.crypto.getRandomValues&&window.crypto.getRandomValues.bind(window.crypto);class re{constructor(){this._lastUniqueKeyTime=0,this._lastRandomValues=[]}generateUniqueKey(e){e=e||Date.now();var t=new Array(20);let r=e;for(let e=7;0<=e;e--)t[e]=ee.charAt(63&r),r=Math.floor(r/64);if(e===this._lastUniqueKeyTime){let e=11;for(;0<=e&&63===this._lastRandomValues[e];)this._lastRandomValues[e]=0,--e;if(-1===e)throw new Error("Internal assertion failure: ran out of unique IDs for this millisecond");this._lastRandomValues[e]+=1}else if(this._lastUniqueKeyTime=e,te){var s=new Uint8Array(12);te(s);for(let e=0;e<12;e++)this._lastRandomValues[e]=s[e]&(e?63:15)}else for(let e=0;e<12;e++)this._lastRandomValues[e]=Math.floor(Math.random()*(e?64:16));for(let e=0;e<12;e++)t[e+8]=ee[this._lastRandomValues[e]];return t.join("")}}class se{constructor(e,t,r,s){this._rootUrl=e,this._tree=t,this._dispatcher=s,this._bridge=r,this._vue=new o.default({data:{$root:{connected:void 0,timeOffset:0,user:void 0,userid:void 0,nowAtInterval(e){const t="now"+e;var r;return this.hasOwnProperty(t)||((r=()=>{o.default.set(this,t,Date.now()+this.timeOffset),c.digest()})(),setInterval(r,e)),this[t]}}}}),this._auth={serial:0,initialAuthChangeReceived:!1,changePromise:Promise.resolve()},r.onAuth(e,this._handleAuthChange,this),this._connectInfoProperty("serverTimeOffset","timeOffset"),this._connectInfoProperty("connected","connected"),Object.freeze(this)}get root(){return this._vue.$data.$root}destroy(){this._bridge.offAuth(this._rootUrl,this._handleAuthChange,this),this._vue.$destroy()}authenticate(e){return this._auth.serial++,this._dispatcher.execute("auth","authenticate",new v(this._tree,"/"),e,()=>{return(e?this._bridge.authWithCustomToken(this._rootUrl,e):this._bridge.authAnonymously(this._rootUrl)).then(()=>this._auth.changePromise)})}unauthenticate(){return this._auth.serial++,this._handleAuthChange(null).then(e=>{if(e)return this._dispatcher.execute("auth","unauthenticate",new v(this._tree,"/"),void 0,()=>this._bridge.unauth(this._rootUrl))})}_handleAuthChange(e){var t=!this._auth.initialAuthChangeReceived&&this._auth.serial;if(void 0!==e&&(this._auth.initialAuthChangeReceived=!0),!t){const r=this._auth.serial;if(this.root.user===e)return Promise.resolve(!1);const s=this._dispatcher.execute("auth","certify",new v(this._tree,"/"),e,()=>this.root.user!==e&&r===this._auth.serial&&(e&&Object.freeze(e),this.root.user=e,this.root.userid=e&&e.uid,c.digest(),!0));return this._auth.changePromise=this._auth.changePromise.then(()=>s).catch(),s}}_isAuthChangeStale(e){return this.root.user===e}_connectInfoProperty(e,t){var r=new URL(this._rootUrl);r.pathname=encodeURI("/.info/"+e),this._bridge.on(r.href,r.href,null,"value",e=>{this.root[t]=e.value,c.digest()})}}const ie={__ob__:!0};let S,R;class x{get $info(){return this.$truss.info}get $store(){return this.$truss.store}get $now(){return this.$truss.now}$newKey(){return this.$truss.newKey()}$intercept(e,t){if(this.$destroyed)throw new Error("Object already destroyed");const r=this.$truss.intercept(e,t),s=()=>{r(),_.default.pull(this.$$finalizers,s)};return this.$$finalizers.push(s),s}$connect(e,t){if(this.$destroyed)throw new Error("Object already destroyed");t||(t=e,e=void 0);const r=this.$truss.connect(e,function t(r,e){if(!e||e instanceof y)return e;if(_.default.isFunction(e)){const s=function(){return r.$$touchThis(),t(r,e.call(this))};return s.angularWatchSuppressed=!0,s}return _.default.mapValues(e,e=>t(r,e))}(this,t)),s=r.destroy,i=()=>(_.default.pull(this.$$finalizers,i),s.call(r));return this.$$finalizers.push(i),r.destroy=i,r}$peek(e,t){if(this.$destroyed)throw new Error("Object already destroyed");const r=C(this.$truss.peek(e,t),()=>{_.default.pull(this.$$finalizers,r.cancel)});return this.$$finalizers.push(r.cancel),r}$observe(e,t,r){if(this.$destroyed)throw new Error("Object already destroyed");let s;const i=this.$truss.observe(()=>(this.$$touchThis(),e.call(this)),t.bind(this),r);return s=()=>{i(),_.default.pull(this.$$finalizers,s)},this.$$finalizers.push(s),s}$when(e,t){if(this.$destroyed)throw new Error("Object already destroyed");const r=this.$truss.when(()=>(this.$$touchThis(),e.call(this)),t);return C(r,()=>{_.default.pull(this.$$finalizers,r.cancel)}),this.$$finalizers.push(r.cancel),r}get $$finalizers(){return Object.defineProperty(this,"$$finalizers",{value:[],writable:!1,enumerable:!1,configurable:!1}),this.$$finalizers}}class A{get $parent(){return S.$parent.value}get $path(){return S.$path.value}get $truss(){return Object.defineProperty(this,"$truss",{value:this.$parent.$truss}),this.$truss}get $ref(){return Object.defineProperty(this,"$ref",{value:new v(this.$truss._tree,this.$path)}),this.$ref}get $refs(){return this.$ref}get $key(){return Object.defineProperty(this,"$key",{value:u(this.$path.slice(this.$path.lastIndexOf("/")+1))}),this.$key}get $data(){return this}get $hidden(){return!1}get $empty(){return _.default.isEmpty(this.$data)}get $keys(){return _.default.keys(this.$data)}get $values(){return _.default.values(this.$data)}get $ready(){return this.$ref.ready}get $overridden(){return!1}$nextTick(){if(this.$destroyed)throw new Error("Object already destroyed");const e=this.$truss.nextTick();return C(e,()=>{_.default.pull(this.$$finalizers,e.cancel)}),this.$$finalizers.push(e.cancel),e}$freezeComputedProperty(){if(!_.default.isBoolean(R))throw new Error("Cannot freeze a computed property outside of its getter function");R=!0}$set(e){return this.$ref.set(e)}$update(e){return this.$ref.update(e)}$override(e){return this.$ref.override(e)}$commit(e,t){return this.$ref.commit(e,t)}$$touchThis(){this.__ob__?this.__ob__.dep.depend():this.$parent?(this.$parent.hasOwnProperty("$data")?this.$parent.$data:this.$parent)[this.$key]:this.$store}get $$initializers(){return Object.defineProperty(this,"$$initializers",{value:[],writable:!1,enumerable:!1,configurable:!0}),this.$$initializers}get $destroyed(){return!1}}H(x,A),_.default.forEach(A.prototype,(e,t)=>{Object.defineProperty(A.prototype,t,{value:e,enumerable:!1,configurable:!1,writable:!1})});class T{constructor(e){this.error=e}}class ne{constructor(e){this.value=e}}class ae{constructor(e){this._trie={Class:A},this._debug=e,Object.freeze(this)}init(e,t){_.default.isPlainObject(e)&&(_.default.forEach(e,(e,t)=>{e.$trussMount||(e.$$trussMount=e.$$trussMount||[],e.$$trussMount.push(t))}),e=_.default.values(e),_.default.forEach(e,e=>{!e.$trussMount&&e.$$trussMount&&(e.$trussMount=e.$$trussMount,delete e.$$trussMount)})),e=_.default.uniq(e),_.default.forEach(e,e=>this._mountClass(e,t)),this._decorateTrie(this._trie)}destroy(){}_getMount(e,t,r){let s;for(const i of f(e,!0)){let e=i?s.children&&(s.children[i]||!t&&s.children.$):this._trie;if(!e){if(!t)return;s.children=s.children||{},e=s.children[i]={Class:A}}if(s=e,r&&r(s))break}return s}_findMount(e,t){if(e(t=t||this._trie))return t;for(const s of _.default.keys(t.children)){var r=this._findMount(e,t.children[s]);if(r)return r}}_decorateTrie(t){_.default.forEach(t.children,e=>{this._decorateTrie(e),(e.local||e.localDescendants)&&(t.localDescendants=!0)})}_augmentClass(e){let t,r=e.prototype;for(;r&&r.constructor!==Object;){for(const i of Object.getOwnPropertyNames(r)){var s=Object.getOwnPropertyDescriptor(r,i);if("$"===i.charAt(0)){if("$finalize"===i)continue;if(_.default.isEqual(s,Object.getOwnPropertyDescriptor(A.prototype,i)))continue;throw new Error(`Property names starting with "$" are reserved: ${e.name}.`+i)}!s.get||t&&t[i]||((t=t||{})[i]={name:i,fullName:r.constructor.name+"."+i,get:s.get,set:s.set})}r=Object.getPrototypeOf(r)}for(const n of Object.getOwnPropertyNames(A.prototype))"constructor"===n||e.prototype.hasOwnProperty(n)||Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(A.prototype,n));return t}_mountClass(n,a){const o=this._augmentClass(n),l=[];let e=n.$trussMount;if(!e)throw new Error(`Class ${n.name} lacks a $trussMount static property`);_.default.isArray(e)||(e=[e]),_.default.forEach(e,e=>{if(_.default.isString(e)&&(e={path:e}),!a&&"/"===e.path)throw new Error("Data root already accessed, too late to mount class");var t=m(e.path);for(const i of t.variables){if("$"===i||"$"===i.charAt(1))throw new Error("Invalid variable name: "+i);if("$"===i.charAt(0)&&(_.default.has(A.prototype,i)||ie[i]))throw new Error("Variable name conflicts with built-in property or method: "+i);l.push(i)}var r=e.path.match(/\/([^/]*)$/)[1];if("$"===r.charAt(0)){if(e.placeholder)throw new Error(`Class ${n.name} mounted at wildcard ${r} cannot be a placeholder`)}else _.default.has(e,"placeholder")||(e.placeholder={});var s=this._getMount(e.path.replace(/\$[^/]*/g,"$"),!0);if(s.matcher&&(s.escapedKey===r||"$"===s.escapedKey.charAt(0)&&"$"===r.charAt(0)))throw new Error(`Multiple classes mounted at ${e.path}: ${s.Class.name}, `+n.name);_.default.assign(s,{Class:n,matcher:t,computedProperties:o,escapedKey:r},_.default.pick(e,"placeholder","local","keysUnsafe","hidden"))}),_.default(l).uniq().forEach(e=>{Object.defineProperty(n.prototype,e,{get(){return S?S[e]&&S[e].value:void 0}})})}createObject(e,t){var r=this._getMount(e)||{Class:A};try{if(r.matcher){var s=r.matcher.match(e);for(const n in s)t[n]={value:s[n]}}S=t;const i=new r.Class;return S=null,c.active&&this._wrapProperties(i),r.keysUnsafe&&(t.$data={value:Object.create(null),configurable:!0,enumerable:!0}),r.hidden&&(t.$hidden={value:!0}),r.computedProperties&&_.default.forEach(r.computedProperties,e=>{t[e.name]=this._buildComputedPropertyDescriptor(i,e)}),i}catch(e){throw e.extra=_.default.assign({mount:r,properties:t,className:r.Class&&r.Class.name},e.extra),e}}_wrapProperties(s){_.default.forEach(s,(e,t)=>{const r="$_"+t;Object.defineProperties(s,{[r]:{value:e,writable:!0},[t]:{get:()=>s[r],set:e=>{s[r]=e,c.digest()},enumerable:!0,configurable:!0}})})}_buildComputedPropertyDescriptor(n,a){const o=E.for(a.fullName);let l,h,u=!1;return n.$$initializers.push(e=>{let t=!1;var r=function(e,r){if(!this.$destroyed){this.$$touchThis();var s=R,i=(R=!1,k());let t;try{try{t=e.get.call(this)}catch(e){t=new T(e)}finally{r.runtime+=k()-i,r.numRecomputes+=1}return t=R?new ne(t):t}finally{R=s}}}.bind(n,a,o);this._debug&&(r.toString=()=>a.fullName);let s=()=>{t=!0};s=e.$watch(r,e=>{if(n.$destroyed)s();else if(h&&(h.cancel&&h.cancel(),h=void 0),_.default.isObject(e)&&_.default.isFunction(e.then)){const t=e.then(e=>{t===h&&i(e)},e=>{if(t===h&&i(new T(e))&&!e.trussExpectedException)throw e});h=t}else if(i(e)&&(c.digest(),e instanceof T)&&!e.error.trussExpectedException)throw e.error},{immediate:!0});r=_.default.last(e._watchers||e._scope.effects);function i(e){return e instanceof ne&&(e=e.value,s(),_.default.pull(n.$$finalizers,s)),!w(l,e)&&(o.numUpdates+=1,u=!0,n[a.name]=e,u=!1,function t(e){if(_.default.isNil(e)||!_.default.isObject(e)||Object.isFrozen(e)||e.$truss)return e;e=Object.freeze(e);if(_.default.isArray(e))return _.default.map(e,e=>t(e));return _.default.mapValues(e,e=>t(e))}(e),1)}r.id=-r.id,t?s():n.$$finalizers.push(s)}),{enumerable:!0,configurable:!0,get(){if(!u&&l instanceof T)throw l.error;return l},set(e){if(u)l=e;else{if(!a.set)throw new Error("You cannot set a computed property: "+a.name);a.set.call(this,e)}}}}destroyObject(e){if(_.default.has(e,"$$finalizers"))for(const t of _.default.clone(e.$$finalizers))t();_.default.isFunction(e.$finalize)&&e.$finalize(),Object.defineProperty(e,"$destroyed",{value:!0,enumerable:!1,configurable:!1})}isPlaceholder(e){e=this._getMount(e);return e&&e.placeholder}isLocal(e,t){e=this._getMount(e,!1,e=>e.local);if(e&&e.local)return!0;if(this._hasLocalProperties(e,t))throw new Error("Write on a mix of local and remote tree paths.");return!1}_hasLocalProperties(e,t){if(e){if(e.local)return!0;if(e.localDescendants&&_.default.isObject(t))for(const r in t)if(this._hasLocalProperties(e.children[p(r)]||e.children.$,t[r]))return!0}return!1}forEachPlaceholderChild(e,t){e=this._getMount(e);_.default.forEach(e&&e.children,e=>{e.placeholder&&t(e)})}checkVueObject(i,e,t){t||(t=new Set);var r=new Map;const s=this._findMount(e=>e.Class===i.constructor);var n,a,o,l,h,u,c,d=_.default(i).thru(Object.getOwnPropertyNames).reject(e=>ie[e]||A.prototype.hasOwnProperty(e)||/^\$_/.test(e)).reject(e=>s&&s.matcher&&_.default.includes(s.matcher.variables,e)).map(e=>{let t;try{t=i[e]}catch(e){return}var r=Object.getOwnPropertyDescriptor(i,e),s=!r.enumerable&&r.set&&!Object.hasOwn(i,"$_"+e);return{key:e,value:t,descriptor:r,computed:s}}).compact().value();for({key:n,value:a,descriptor:o,computed:l}of d){if(!_.default.isArray(i)||!/\d+/.test(n)&&"length"!==n){if("value"in o||!o.get)throw new Error(`Value at ${e}, contained in a Firetruss object, has a rogue property: `+n);if(i.$truss&&o.enumerable)try{throw i[n]=a,new Error(`Firetruss object at ${e} has an enumerable non-Firebase property: `+n)}catch(e){if("firebase_overwrite"!==e.trussCode)throw e}}_.default.isObject(a)&&(t.has(a)||Object.isSealed(a)||_.default.isFunction(a)||a instanceof Promise||(t.add(a),this.checkVueObject(a,g(e,p(n)),t)),l||a.$truss||r.set(a,n))}for({key:h,value:u,computed:c}of d)if(c&&_.default.isObject(u)&&!u.$truss){var f=r.get(u);if(f)throw new Error(`Firetruss object at ${e} has properties ${h} `+`and ${f} with an aliased value`)}}}class oe{constructor(e,t){this._coupler=e,this._query=t,this._listeners=[],this._keys=[],this._coupler._url.pathname=encodeURI(t.path),this._url=this._coupler._url.toString(),this._segments=f(t.path,!0),this._listening=!1,this.ready=!1}attach(e,t){this._listen(),this._listeners.push({operation:e,keysCallback:t}),this.ready&&(this._coupler._dispatcher.markReady(e),t)&&t(this._keys)}detach(e){e=_.default.findIndex(this._listeners,{operation:e});return 0<=e&&this._listeners.splice(e,1),this._listeners.length}_listen(){this._listening||(this._coupler._bridge.on(this._query.toString(),this._url,this._query.constraints,"value",this._handleSnapshot,this._handleError,this,{sync:!0}),this._listening=!0)}destroy(){this._coupler._bridge.off(this._query.toString(),this._url,this._query.constraints,"value",this._handleSnapshot,this),this._listening=!1,this.ready=!1,c.digest();for(const e of this._keys)this._coupler._decoupleSegments(this._segments.concat(e))}_handleSnapshot(s){this._coupler._queueSnapshotCallback(()=>{if(this._listeners.length&&this._listening){var e=this._updateKeysAndApplySnapshot(s);if(!this.ready){this.ready=!0,c.digest();for(const t of this._listeners)this._coupler._dispatcher.markReady(t.operation)}if(e)for(const r of this._listeners)r.keysCallback&&r.keysCallback(e)}})}_updateKeysAndApplySnapshot(e){let t;if(e.path===this._query.path){if((t=_.default.keys(e.value)).sort(),_.default.isEqual(this._keys,t))t=null;else{for(const n of _.default.difference(t,this._keys))this._coupler._coupleSegments(this._segments.concat(n));for(const a of _.default.difference(this._keys,t))this._coupler._decoupleSegments(this._segments.concat(a));this._keys=t}if(e.exists){var r=e.value,s=e.path;for(const o of this._keys)e._path=s+"/"+o,e._key=void 0,e._value=r[o],this._coupler._applySnapshot(e);e._path=s,e._key=void 0,e._value=r}}else{var i;e.path.replace(/\/[^/]+/,"")===this._query.path&&(i=_.default.includes(this._keys,e.key),e.value?i||(this._coupler._coupleSegments(this._segments.concat(e.key)),this._keys.push(e.key),this._keys.sort(),t=this._keys):i&&(this._coupler._decoupleSegments(this._segments.concat(e.key)),_.default.pull(this._keys,e.key),this._keys.sort(),t=this._keys),this._coupler._applySnapshot(e))}return t}_handleError(r){if(this._listeners.length&&this._listening){this._listening=!1,this.ready=!1;for(const e of this._keys)this._coupler._decoupleSegments(this._segments.concat(e));this._keys=[],c.digest(),Promise.all(_.default.map(this._listeners,t=>(this._coupler._dispatcher.clearReady(t.operation),this._coupler._dispatcher.retry(t.operation,r).catch(e=>(t.operation._disconnect(e),!1))))).then(e=>{if(_.default.some(e))this._listeners.length&&this._listen();else for(const t of this._listeners)t.operation._disconnect(r)})}}}class le{constructor(e,t,r){this._coupler=e,this.path=t,this.parent=r,this._coupler._url.pathname=encodeURI(t),this.url=this._coupler._url.toString(),this.operations=[],this.queryCount=0,this.listening=!1,this.ready=!1,this.children={}}get active(){return this.count||this.queryCount}get count(){return this.operations.length}listen(e){!e&&this.count?this.listening||(_.default.forEach(this.operations,e=>{this._coupler._dispatcher.clearReady(e)}),this._coupler._bridge.on(this.url,this.url,null,"value",this._handleSnapshot,this._handleError,this,{sync:!0}),this.listening=!0):_.default.forEach(this.children,e=>{e.listen()})}unlisten(e){!e&&this.listening?(this._coupler._bridge.off(this.url,this.url,null,"value",this._handleSnapshot,this),this.listening=!1,this._forAllDescendants(e=>{if(e.listening)return!1;e.ready&&(e.ready=!1,c.digest())})):_.default.forEach(this.children,e=>{e.unlisten()})}_handleSnapshot(e){this._coupler._queueSnapshotCallback(()=>{this.listening&&this._coupler.isTrunkCoupled(e.path)&&(this._coupler._applySnapshot(e),this.ready||e.path!==this.path||(this.ready=!0,c.digest(),this.unlisten(!0),this._forAllDescendants(e=>{for(const t of e.operations)this._coupler._dispatcher.markReady(t)})))})}_handleError(r){if(this.count&&this.listening)return this.listening=!1,this._forAllDescendants(e=>{if(e.listening)return!1;e.ready&&(e.ready=!1,c.digest());for(const t of e.operations)this._coupler._dispatcher.clearReady(t)}),this._coupler._prunePath(this.path),Promise.all(_.default.map(this.operations,t=>this._coupler._dispatcher.retry(t,r).catch(e=>(t._disconnect(e),!1)))).then(e=>{if(_.default.some(e))this.count&&this.listen();else for(const t of this.operations)t._disconnect(r)})}_forAllDescendants(t){!1!==t(this)&&_.default.forEach(this.children,e=>e._forAllDescendants(t))}collectCoupledDescendantPaths(t){return(t=t||{})[this.path]=this.active,this.active||_.default.forEach(this.children,e=>{e.collectCoupledDescendantPaths(t)}),t}}class he{constructor(e,t,r,s,i){this._url=new URL(e),this._bridge=t,this._dispatcher=r,this._applySnapshot=s,this._pendingSnapshotCallbacks=[],this._throttled={processPendingSnapshots:this._processPendingSnapshots},this._prunePath=i,this._vue=new o.default({data:{root:void 0,queryHandlers:{}}}),this._vue._renderProxy=this._vue,this._nodeIndex=Object.create(null),Object.freeze(this),this._vue.$data.root=new le(this,"/"),this._nodeIndex["/"]=this._root}get _root(){return this._vue.$data.root}get _queryHandlers(){return this._vue.$data.queryHandlers}destroy(){_.default.forEach(this._queryHandlers,e=>{e.destroy()}),this._root.unlisten(),this._vue.$destroy()}couple(e,t){return this._coupleSegments(f(e,!0),t)}_coupleSegments(e,t){let r,s=!t,i=!1;for(const n of e){let e=n?r.children&&r.children[n]:this._root;e||(e=new le(this,`${"/"===r.path?"":r.path}/`+n,r),o.default.set(r.children,n,e),this._nodeIndex[e.path]=e),s=s||e.listening,i=i||e.ready,r=e}t?r.operations.push(t):r.queryCount++,s?t&&i&&this._dispatcher.markReady(t):r.listen()}decouple(e,t){return this._decoupleSegments(f(e,!0),t)}_decoupleSegments(t,e){var r=[];let s;for(const i of t){if(!(s=i?s.children&&s.children[i]:this._root))break;r.push(s)}if(!s||!(e?s.count:s.queryCount))throw new Error("Path not coupled: "+(t.join("/")||"/"));if(e?_.default.pull(s.operations,e):s.queryCount--,e&&!s.count&&(s.listen(),s.listening)&&s.unlisten(),!s.active){for(let e=r.length-1;0<e&&((s=r[e])!==this._root&&!s.active&&_.default.isEmpty(s.children));e--)o.default.delete(r[e-1].children,t[e]),s.ready=void 0,delete this._nodeIndex[s.path];e=t.join("/")||"/";this._prunePath(e,this.findCoupledDescendantPaths(e))}}subscribe(e,t,r){let s=this._queryHandlers[e.toString()];s||(s=new oe(this,e),o.default.set(this._queryHandlers,e.toString(),s)),s.attach(t,r)}unsubscribe(e,t){var r=this._queryHandlers[e.toString()];r&&!r.detach(t)&&(r.destroy(),o.default.delete(this._queryHandlers,e.toString()))}isTrunkCoupled(e){let t;for(const r of f(e,!0)){if(!(t=r?t.children&&t.children[r]:this._root))return!1;if(t.active)return!0}return!1}findCoupledDescendantPaths(e){let t;for(const r of f(e,!0)){if((t=r?t.children&&t.children[r]:this._root)&&t.active)return{[e]:t.active};if(!t)break}return t&&t.collectCoupledDescendantPaths()}isSubtreeReady(e){let t,r;function s(e){return r=e.slice(1),""}for(;!(t=this._nodeIndex[e]);)e=e.replace(/\/[^/]*$/,s)||"/";for(r&&t.children;t;){if(t.ready)return!0;t=t.parent}return!1}isQueryReady(e){e=this._queryHandlers[e.toString()];return e&&e.ready}_queueSnapshotCallback(e){this._pendingSnapshotCallbacks.push(e),this._throttled.processPendingSnapshots.call(this)}_processPendingSnapshots(){for(const e of this._pendingSnapshotCallbacks)e();this._pendingSnapshotCallbacks.splice(0,1/0)}throttleSnapshots(e){this._throttled.processPendingSnapshots=e?_.default.debounce(_.default.throttle(this._processPendingSnapshots,e)):this._processPendingSnapshots}}class ue{constructor(e){this._ref=e,this._outcome=void 0,this._values=void 0}get currentValue(){return this._ref.value}get outcome(){return this._outcome}get values(){return this._values}_setOutcome(e){if(this._outcome)throw new Error("Transaction already resolved with "+this._outcome);this._outcome=e}abort(){this._setOutcome("abort")}cancel(){this._setOutcome("cancel")}set(e){if(void 0===e)throw new Error("Invalid argument: undefined");this._setOutcome("set"),this._values={"":e}}update(e){if(void 0===e)throw new Error("Invalid argument: undefined");if(_.default.isEmpty(e))return this.cancel();this._setOutcome("update"),this._values=e}}class ce{constructor(e,t,r,s){this._truss=e,this._url=new URL(t),this._bridge=r,this._dispatcher=s,this._firebasePropertyEditAllowed=!1,this._writeSerial=0,this._localWrites={},this._localWriteTimestamp=null,this._initialized=!1,this._modeler=new ae("dev"===e.constructor.VERSION),this._coupler=new he(t,r,s,this._integrateSnapshot.bind(this),this._prune.bind(this)),this._vue=new o.default({data:{$root:void 0}}),Object.seal(this)}get root(){return this._vue.$data.$root||(this._vue.$data.$root=this._createObject("/"),this._fixObject(this._vue.$data.$root),this._completeCreateObject(this._vue.$data.$root),c.digest()),this._vue.$data.$root}get truss(){return this._truss}init(e){if(this._initialized)throw new Error("Data objects already created, too late to mount classes");this._initialized=!0,this._modeler.init(e,!this._vue.$data.$root);e=[];this._plantPlaceholders(this.root,"/",void 0,e);for(const t of e)this._completeCreateObject(t)}destroy(){this._coupler.destroy(),this._modeler&&this._modeler.destroy(),this._vue.$destroy()}connectReference(e,t){this._checkHandle(e);const r=this._dispatcher.createOperation("read",t,e);return r._disconnect=this._disconnectReference.bind(this,e,r,void 0),this._dispatcher.begin(r).then(()=>{r.running&&!r._disconnected&&(this._coupler.couple(e.path,r),r._coupled=!0)}).catch(_.default.noop),r._disconnect}_disconnectReference(e,t,r,s){t._disconnected||(t._disconnected=!0,r&&r(),t._coupled&&(this._coupler.decouple(e.path,t),t._coupled=!1),this._dispatcher.end(t,s).catch(_.default.noop))}isReferenceReady(e){return this._checkHandle(e),this._coupler.isSubtreeReady(e.path)}connectQuery(e,t,r){this._checkHandle(e);const s=this._dispatcher.createOperation("read",r,e);return s._disconnect=this._disconnectQuery.bind(this,e,s),this._dispatcher.begin(s).then(()=>{s.running&&!s._disconnected&&(this._coupler.subscribe(e,s,t),s._coupled=!0)}).catch(_.default.noop),s._disconnect}_disconnectQuery(e,t,r){t._disconnected||(t._disconnected=!0,t._coupled&&(this._coupler.unsubscribe(e,t),t._coupled=!1),this._dispatcher.end(t,r).catch(_.default.noop))}isQueryReady(e){return this._coupler.isQueryReady(e)}_checkHandle(e){if(!e.belongsTo(this._truss))throw new Error("Reference belongs to another Truss instance")}throttleRemoteDataUpdates(e){this._coupler.throttleSnapshots(e)}update(t,e,r){r=_.default.mapValues(r,e=>d(e));var s=_.default.size(r);if(!s)return Promise.resolve();if("update"!==e&&"override"!==e||de(t.path,r),this._applyLocalWrite(r,"override"===e))return Promise.resolve();e=function(e){let i;return _.default.forEach(e,(e,t)=>{var r="/"===t?[""]:f(t,!0);if(i){let e=0;for(var s=Math.min(i.length,r.length);e<s&&i[e]===r[e];)e++;if(!(i=i.slice(0,e)).length)return!1}else i=r}),1===i.length?"/":i.join("/")}(r);fe(e,r),e!==t.path&&(t=new v(t._tree,e,t._annotations)),this._url.pathname=encodeURI(e);const i=this._url.toString(),n=this._writeSerial,a=1===s,o=a?r[""]:r;return this._dispatcher.execute("write",a?"set":"update",t,o,()=>{return this._bridge[a?"set":"update"](i,o,n).catch(e=>e.immediateFailure?C(this._repair(t,r),()=>Promise.reject(e)):Promise.reject(e))})}commit(s,t){let i=0;t=j(t);const n=()=>{if(25<=i++)return Promise.reject(new Error("Transaction needed too many retries, giving up"));const r=new ue(s);let e;return o.default.nextTick().then(()=>(e=_e(r.currentValue),t(r))).then(()=>{if(!_.default.isEqual(e,_e(r.currentValue)))return n();if("abort"===r.outcome)return r;const t=_.default.mapValues(r.values,e=>d(e));switch(r.outcome){case"cancel":break;case"set":if(this._applyLocalWrite({[s.path]:t[""]}))return Promise.resolve();break;case"update":if(de(s.path,t),this._applyLocalWrite(t))return Promise.resolve();fe(s.path,t);break;default:throw new Error("Invalid transaction outcome: "+(r.outcome||"none"))}return this._url.pathname=s.path,this._bridge.transaction(this._url.toString(),e,t,this._writeSerial).then(e=>(_.default.forEach(e.snapshots,e=>this._integrateSnapshot(e)),e.committed?r:n()),e=>!e.immediateFailure||"set"!==r.outcome&&"update"!==r.outcome?Promise.reject(e):C(this._repair(s,t),()=>Promise.reject(e)))})};return this._truss.peek(s,()=>this._dispatcher.execute("write","commit",s,void 0,n))}_repair(e,t){const r=e.path;e=_.default(t).keys().flatMap(e=>{let t=r;return e&&(t=g(t,e)),_.default.keys(this._coupler.findCoupledDescendantPaths(t))}).value();return Promise.all(_.default.map(e,e=>(this._url.pathname=encodeURI(e),this._bridge.once(this._url.toString()).then(e=>{this._integrateSnapshot(e)}))))}_applyLocalWrite(e,l){this._writeSerial++,this._localWriteTimestamp=this._truss.now;const h=[];let u=0;_.default.forEach(e,(t,e)=>{var r=this._modeler.isLocal(e,t),s=(r&&u++,r?{[e]:!0}:this._coupler.findCoupledDescendantPaths(e));if(!_.default.isEmpty(s)){var i=("/"===e?0:e.length)+1;for(const a in s){var n=a.slice(i);let e=t;if(n&&null!=t)for(const o of f(n))if(void 0===(e=e.$data[o]))break;_.default.isNil(e)?this._prune(a):(n=_.default.last(f(a)),this._plantValue(a,n,e,this._scaffoldAncestors(a,!1,h),!1,l,r,h)),l||r||(this._localWrites[a]=this._writeSerial)}}});for(const t of h)this._completeCreateObject(t);if(u&&u<_.default.size(e))throw new Error("Write on a mix of local and remote tree paths.");return l||!!u}_createObject(e,t){this._initialized||"/"===e||this.init();t={$parent:{value:t,configurable:!0,enumerable:!0},$path:{value:e}},"/"===e&&(t.$truss={value:this._truss}),e=this._modeler.createObject(e,t);return Object.defineProperties(e,t),e}_fixObject(e){for(const r of Object.getOwnPropertyNames(e)){var t=Object.getOwnPropertyDescriptor(e,r);t.configurable&&t.enumerable&&(t.enumerable=!1,_.default.startsWith(r,"$")&&(t.configurable=!1),Object.defineProperty(e,r,t))}}_completeCreateObject(e){if(e.hasOwnProperty("$$initializers")){for(const t of e.$$initializers)t(this._vue);delete e.$$initializers}}_destroyObject(e){if(e&&e.$truss&&!e.$destroyed){this._modeler.destroyObject(e);for(const r of Object.getOwnPropertyNames(e.$data)){var t=e.$data[r];t&&t.$parent===e&&this._destroyObject(t)}}}_integrateSnapshot(r){if(_.default.forEach(this._localWrites,(e,t)=>{r.writeSerial>=e&&delete this._localWrites[t]}),r.exists){var e=[],t=this._scaffoldAncestors(r.path,!0,e);t&&this._plantValue(r.path,r.key,r.value,t,!0,!1,!1,e);for(const s of e)this._completeCreateObject(s)}else this._prune(r.path,null,!0)}_scaffoldAncestors(e,r,s){let i;var n=_.default.dropRight(f(e,!0));let a="/";for(let t=0;t<n.length;t++){var o=n[t],l=u(o);let e=o?i.$data[l]:this.root;if(o&&(a+=("/"===a?"":"/")+o),e){if(r&&this._localWrites[a])return}else if(!(e=this._plantValue(a,l,{},i,r,!1,!1,s)))return;i=e}return i}_plantValue(s,t,i,n,a,o,l,h){if(a&&_.default.isNil(i))throw new Error(`Snapshot includes invalid value at ${s}: `+i);if(!a||!this._localWrites[s||"/"]){_.default.isEqual(i,L)&&(i=this._localWriteTimestamp);let r=n.$data[t];if(_.default.isArray(i)||(l?_.default.isPlainObject(i):_.default.isObject(i))){let e=!1;return _.default.isObject(r)||(this._setFirebaseProperty(n,t,null),r=this._createObject(s,n),this._setFirebaseProperty(n,t,r,r.$hidden),this._fixObject(r),h.push(r),e=!0),o?Object.defineProperty(r,"$overridden",{get:_.default.constant(!0),configurable:!0}):r.$overridden&&delete r.$overridden,e&&this._plantPlaceholders(r,s,!0,h),_.default.forEach(i,(e,t)=>{this._plantValue(g(s,t),u(t),e,r,a,o,l,h)}),e?this._plantPlaceholders(r,s,!1,h):_.default.forEach(r.$data,(e,t)=>{t=p(t);i.hasOwnProperty(t)||this._prune(g(s,t),null,a)}),r}this._destroyObject(r),!l&&_.default.isNil(i)?this._deleteFirebaseProperty(n,t):this._setFirebaseProperty(n,t,i)}}_plantPlaceholders(r,s,i,n){this._modeler.forEachPlaceholderChild(s,e=>{var t;void 0!==i&&i!==!!e.hidden||(t=u(e.escapedKey),r.$data.hasOwnProperty(t))||this._plantValue(g(s,e.escapedKey),t,e.placeholder,r,!1,!1,!1,n)})}_prune(e,t,r){t=t||{};var s=this.getObject(e);void 0===s||r&&this._avoidLocalWritePaths(e,t)||_.default.isEmpty(t)&&this._pruneAncestors(e,s)||!_.default.isObject(s)||this._pruneDescendants(s,t)}_avoidLocalWritePaths(t,r){for(const e in this._localWrites)if(this._localWrites.hasOwnProperty(e)){if(t===e||"/"===e||_.default.startsWith(t,e+"/"))return!0;if("/"===t||_.default.startsWith(e,t+"/")){var s=f(e,!0);for(let e=s.length;0<e;e--){var i=s.slice(0,e).join("/"),n=e===s.length;if(r[i]||r[i]===n)break;if(r[i]=n,i===t)break}}}}_pruneAncestors(e,t){let r=!1,s=t,i;for(var n=e.replace(/\/[^/]+$/,e=>(i=u(e.slice(1)),""));void 0!==s&&s!==this.root;){var a,o=s&&s.$parent||s===t&&this.getObject(n);this._modeler.isPlaceholder(s&&s.$path||e)||(a=r?null:[t],this._holdsConcreteData(s,a))||(r=!0,this._deleteFirebaseProperty(o,s&&s.$key||s===t&&i)),s=o}return r}_holdsConcreteData(e,t){return!(_.default.isNil(e)||t&&_.default.includes(t,e))&&(!_.default.isObject(e)||!e.$truss||_.default.some(e.$data,e=>this._holdsConcreteData(e,t)))}_pruneDescendants(n,a){if(a[n.$path])return!0;n.$overridden&&delete n.$overridden;let o=!1;return _.default.forEach(n.$data,(e,t)=>{let r=!0,s;var i;a[g(n.$path,p(t))]?(r=!1,s=!0):!_.default.isNil(e)&&e.$truss&&((i=this._modeler.isPlaceholder(e.$path))||_.default.has(a,e.$path))&&(s=this._pruneDescendants(e,a),r=!i&&!s),r&&this._deleteFirebaseProperty(n,t),o=o||s}),o}getObject(e){let t;for(const r of f(e))if(void 0===(t=r?t.$data[r]:this.root))return;return t}_getFirebasePropertyDescriptor(e,t,r){var s=Object.getOwnPropertyDescriptor(t,r);if(s){if(!s.enumerable){var i=t[r];if(!i||i.$parent!==e)throw new Error("Key conflict between Firebase and instance or computed properties at "+e.$path+": "+r)}if(!s.get||!s.set)throw new Error(`Unbound property at ${e.$path}: `+r)}else if(r in t)throw new Error(`Key conflict between Firebase and inherited property at ${e.$path}: `+r);return s}_setFirebaseProperty(e,t,r,s){var i=e.hasOwnProperty("$data")?e.$data:e,e=this._getFirebasePropertyDescriptor(e,i,t);if(e){if(s&&Object.defineProperty(i,t,{get:e.get,set:e.set,configurable:!0,enumerable:!1}),i[t]===r)return;this._firebasePropertyEditAllowed=!0,i[t]=r,this._firebasePropertyEditAllowed=!1}else o.default.set(i,t,r),e=Object.getOwnPropertyDescriptor(i,t),Object.defineProperty(i,t,{get:e.get,set:this._overwriteFirebaseProperty.bind(this,e,t),configurable:!0,enumerable:!s});c.digest()}_overwriteFirebaseProperty(e,t,r){if(!this._firebasePropertyEditAllowed)throw(t=new Error("Firebase data cannot be mutated directly: "+t)).trussCode="firebase_overwrite",t;e.set.call(this,r)}_deleteFirebaseProperty(e,t){var r=e.hasOwnProperty("$data")?e.$data:e;this._getFirebasePropertyDescriptor(e,r,t),this._destroyObject(r[t]),o.default.delete(r,t),c.digest()}checkVueObject(e,t){this._modeler.checkVueObject(e,t)}}function de(r,s){_.default.forEach(_.default.keys(s),e=>{if("/"===e.charAt(0)){if(!(e===r||"/"===r||_.default.startsWith(e,r+"/")&&e.length>r.length+1))throw new Error("Update item is not a descendant of target ref: "+e)}else{if(_.default.includes(e,"/"))throw new Error("Update item deep path must be absolute, taken from a reference: "+e);var t=g(r,p(e));if(s.hasOwnProperty(t))throw new Error(`Update items overlap: ${e} and `+t);s[t]=s[e],delete s[e]}});const i=_.default(s).keys().map(e=>g(e,"")).sortBy("length").value();_.default.forEach(s,(e,t)=>{for(const r of i){if(r.length>t.length)break;if(t!==r&&_.default.startsWith(t,r))throw new Error(`Update items overlap: ${r} and `+t)}})}function fe(e,t){const r="/"===e?1:e.length+1;_.default.forEach(_.default.keys(t),e=>{t[e.slice(r)]=t[e],delete t[e]})}function _e(e){if(!_.default.isObject(e))return e;var t={},r=e.$data;for(const s in r)r.hasOwnProperty(s)&&(t[p(s)]=_e(r[s]));return t}let D,pe;const ge={};class z{constructor(e){if(!D)throw new Error("Truss worker not connected, please call Truss.connectWorker first");this._rootUrl=e.replace(/\/$/,""),this._keyGenerator=new re,this._dispatcher=new Z(D),this._vue=new o.default,D.trackServer(this._rootUrl),this._tree=new ce(this,this._rootUrl,D,this._dispatcher),this._metaTree=new se(this._rootUrl,this._tree,D,this._dispatcher),Object.freeze(this)}get info(){return this._metaTree.root}get store(){return this._tree.root}mount(e){this._tree.init(e)}destroy(){this._vue.$destroy(),this._tree.destroy(),this._metaTree.destroy()}get now(){return Date.now()+this.info.timeOffset}newKey(){return this._keyGenerator.generateUniqueKey(this.now)}authenticate(e){return this._metaTree.authenticate(e)}unauthenticate(){return this._metaTree.unauthenticate()}intercept(e,t){return this._dispatcher.intercept(e,t)}connect(e,t){return t||(t=e,e=void 0),(t instanceof y||_.default.isFunction(t))&&(t={_:t}),new O(e,t,this._tree,"connect")}peek(o,l){l=j(l||_.default.identity);let h,u;return t(Promise.resolve().then(()=>new Promise((t,s)=>{const r={};let i,e=new O(r,{result:o},this._tree,"peek"),n=this.intercept("peek",{onFailure:r=>{!function t(e){if(e)return e instanceof y?r.target.isEqual(e):_.default.some(e,e=>t(e))}(e.at)||(s(r.error),h())}}),a=this.observe(()=>e.ready,e=>{e&&(a(),a=null,i=C(l(r.result),()=>{c.digest(),i=null,h()}).then(e=>{t(e)},e=>{s(e)}))});h=()=>{a&&(a(),a=null),n&&(n(),n=null),e&&(e.destroy(),e=null),i&&i.cancel&&i.cancel()},u=()=>{s(new Error("Canceled")),h()}})),u)}observe(e,s,i){const n=_.default.isObject(i&&i.precise);let a=0,o;n&&(o=i.deep?_.default.cloneDeep(i.precise):_.default.clone(i.precise));let l;return l=this._vue.$watch(e,(e,t)=>{if(i&&i.precise){var r=n?i.deep?_.default.defaultsDeep({},e,i.precise):_.default.defaults({},e,i.precise):i.deep?_.default.cloneDeep(e):_.default.clone(e);if(_.default.isEqual(r,o))return;o=r}a++,l?(s(e,t),c.digest()):Promise.resolve().then(()=>{1<a||s(e,t)})},{immediate:!0,deep:i&&i.deep}),i&&i.scope&&i.scope.$on("$destroy",l),l}when(s,i){let n,a,e=new Promise((t,e)=>{let r=this.observe(s,e=>{e&&o.default.nextTick(()=>{(e=s())&&(t(e),n())})});_.default.has(i,"timeout")&&(a=setTimeout(()=>{a=null,e(new Error(i.timeoutMessage||"Timeout")),n()},i.timeout)),n=()=>{r&&(r(),r=null),a&&(clearTimeout(a),a=null),e(new Error("Canceled"))}});return e=t(C(e,n),n),i&&i.scope&&i.scope.$on("$destroy",()=>{e.cancel()}),e}nextTick(){let r;return t(new Promise((e,t)=>{o.default.nextTick(e),r=()=>{t(new Error("Canceled"))}}),r)}throttleRemoteDataUpdates(e){this._tree.throttleRemoteDataUpdates(e)}checkObjectsForRogueProperties(){this._tree.checkVueObject(this._tree.root,"/")}static get computedPropertyStats(){return E}static connectWorker(e,t){if(D)throw new Error("Worker already connected");if(_.default.isString(e)){var r=window.SharedWorker||window.Worker;if(!r)throw new Error("Browser does not implement Web Workers");e=new r(e)}return D=new W(e),pe&&D.enableLogging(pe),D.init(e,t).then(({exposedFunctionNames:e,firebaseSdkVersion:t})=>{Object.defineProperty(z,"FIREBASE_SDK_VERSION",{value:t});for(const r of e)z.preExpose(r)})}static get worker(){return ge}static preExpose(e){var t=e.split(".");let r=z.worker;for(const s of t.slice(0,-1))Object.hasOwnProperty.call(r,s)||(r[s]={}),r=r[s];r[t[t.length-1]]=D.bindExposedFunction(e)}static bounceConnection(){return D.bounceConnection()}static suspend(){return D.suspend()}static debugPermissionDeniedErrors(e,t,r){return D.debugPermissionDeniedErrors(e,t,r)}static debounceAngularDigest(e){c.debounceDigest(e)}static escapeKey(e){return p(e)}static unescapeKey(e){return u(e)}static enableLogging(e){pe=e,D&&D.enableLogging(e)}get SERVER_TIMESTAMP(){return z.SERVER_TIMESTAMP}get VERSION(){return z.VERSION}get FIREBASE_SDK_VERSION(){return z.FIREBASE_SDK_VERSION}}return Object.defineProperties(z,{SERVER_TIMESTAMP:{value:L},VERSION:{value:"6.0.0"},Model:{value:Object},ComponentPlugin:{value:{install(e,t){if(o.default!==e)throw new Error("Multiple versions of Vue detected");if(!t.truss)throw new Error("Need to pass `truss` instance as an option to use the ComponentPlugin");e={$truss:{value:t.truss},$destroyed:{get(){return this._isBeingDestroyed||this._isDestroyed}},$$touchThis:{value(){this.__ob__&&this.__ob__.dep.depend()}}},t=_.default(e).keys().union(_.default.keys(x.prototype)).intersection(_.default.keys(o.default.prototype)).value();if(t.length)throw new Error("Truss extension properties conflict with Vue properties: "+t.join(", "));Object.defineProperties(o.default.prototype,e),H(x,o.default),o.default.mixin({destroyed(){if(_.default.has(this,"$$finalizers"))for(const e of _.default.clone(this.$$finalizers))e()}})}}}}),c.defineModule(z),z});
//# sourceMappingURL=firetruss.umd.min.js.map