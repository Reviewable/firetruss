!function(){"use strict";function a(a){for(var b={name:a.name},c=Object.getOwnPropertyNames(a),d=0,e=c;d<e.length;d+=1){var f=e[d];b[f]=a[f]}return b}function b(a,b){var c=a.ref().toString();if(b&&b.omitValue)return{url:c,exists:a.exists(),hasChildren:a.hasChildren()};var d,e=a.val();if(b&&b.orderChildren&&"object"==typeof e){for(var f in e)e.hasOwnProperty(f)&&Object.defineProperty(e[f],"$key",{value:f});d=[],a.forEach(function(a){d.push(a.$key)})}return{url:c,value:e,childrenKeys:d}}function c(a,b){try{var c=new Firebase(a);if(b)for(var d=0,e=b;d<e.length;d+=1){var f=e[d];c=c[f[0]].apply(c,f.slice(1))}return c}catch(c){throw console.error(a,b,c),c}}function d(a){if(null===a)return null;var b=CryptoJS.algo.SHA1.create();return e(a,b),"sha1:"+b.finalize().toString()}function e(a,b){var c=typeof a;switch("object"===c&&(null===a?c="null":Array.isArray(a)?c="array":a instanceof Boolean?c="boolean":a instanceof Number?c="number":a instanceof String&&(c="string")),c){case"undefined":b.update("u");break;case"null":b.update("n");break;case"boolean":b.update(a?"t":"f");break;case"number":b.update("x"+a);break;case"string":b.update("s"+a);break;case"array":b.update("[");for(var d=0;d<a.length;d++)e(a[d],b);b.update("]");break;case"object":b.update("{");var f=Object.keys(a);f.sort();for(var g=0;g<f.length;g++)e(a[f[g]],b);b.update("}");break;default:throw new Error("Unable to hash non-JSON data: "+c)}}function f(){"undefined"!=typeof onconnect?self.onconnect=function(a){g.push(new j(a.ports[0]))}:g.push(new j(self)),self.localStorage.flushPending()}var g=[],h=function(){this._items=[],this._pendingItems=[],this._initialized=!1,this._flushPending=this.flushPending.bind(this)},i={length:{}};h.prototype.init=function(a){this._initialized||(this._items=a,this._initialized=!0)},h.prototype._update=function(a){this._pendingItems.length||setImmediate(this._flushPending),this._pendingItems.push(a)},h.prototype.flushPending=function(){g.length&&(g[0]._send({msg:"updateLocalStorage",items:this._pendingItems}),this._pendingItems=[])},i.length.get=function(){return this._items.length},h.prototype.key=function(a){return this._items[a].key},h.prototype.getItem=function(a){for(var b=0,c=this._items;b<c.length;b+=1){var d=c[b];if(d.key===a)return d.value}return null},h.prototype.setItem=function(a,b){for(var c,d=0,e=this._items;d<e.length;d+=1){var f=e[d];if(f.key===a){c=f,f.value=b;break}}c||(c={key:a,value:b},this._items.push(c)),this._update(c)},h.prototype.removeItem=function(a){for(var b=this,c=0;c<this._items.length;c++)if(b._items[c].key===a){b._items.splice(c,1),b._update({key:a,value:null});break}},h.prototype.clear=function(){var a=this;for(var b in this._items)a._update({key:b.key,value:null});this._items=[]},Object.defineProperties(h.prototype,i),self.localStorage=new h;var j=function(a){this.ping(),this._port=a,this._callbacks={},this._messages=[],this._flushMessageQueue=this._flushMessageQueue.bind(this),a.onmessage=this._receive.bind(this)};j.prototype.init=function(a){var b=a.storage,c=a.url;return b&&self.localStorage.init(b),c&&new Firebase(c),{exposedFunctionNames:Object.keys(j._exposed),firebaseSdkVersion:Firebase.SDK_VERSION}},j.prototype.destroy=function(){var a=this;for(var b in this._callbacks){var c=a._callbacks[b];c.cancel&&c.cancel()}this._callbacks={},this._port.onmessage=null,this._messages=[];var d=g.indexOf(this);d>=0&&(g[d]=null)},j.prototype.ping=function(){this.lastTouched=Date.now()},j.prototype._receive=function(a){var b=this;j._firstMessageReceived=!0,this.lastTouched=Date.now();for(var c=0,d=a.data;c<d.length;c+=1){var e=d[c];b._receiveMessage(e)}},j.prototype._receiveMessage=function(b){var c,d=this;try{var e=this[b.msg];if("function"!=typeof e)throw new Error("Unknown message: "+b.msg);c=Promise.resolve(e.call(this,b))}catch(a){c=Promise.reject(a)}b.oneWay||c.then(function(a){d._send({msg:"resolve",id:b.id,result:a})},function(c){d._send({msg:"reject",id:b.id,error:a(c)})})},j.prototype._send=function(a){this._messages.length||setImmediate(this._flushMessageQueue),this._messages.push(a)},j.prototype._flushMessageQueue=function(){this._port.postMessage(this._messages),this._messages=[]},j.prototype.call=function(a){var b=a.name,c=a.args;try{return Promise.resolve(this._exposed[b].apply(null,c))}catch(a){return Promise.reject(a)}},j.prototype.authWithCustomToken=function(a){var b=a.url,d=a.authToken,e=a.options;return c(b).authWithCustomToken(d,e)},j.prototype.authAnonymously=function(a){var b=a.url,d=a.options;return c(b).authAnonymously(d)},j.prototype.authWithOAuthToken=function(a){var b=a.url,d=a.provider,e=a.credentials,f=a.options;return c(b).authWithOAuthToken(d,e,f)},j.prototype.unauth=function(a){var b=a.url;return c(b).unauth()},j.prototype.onAuth=function(a){var b=a.url,d=a.callbackId,e=this._callbacks[d]=this._onAuthCallback.bind(this,d);e.cancel=this._offAuth.bind(this,b,e),c(b).onAuth(e)},j.prototype._offAuth=function(a,b){c(a).offAuth(b)},j.prototype._onAuthCallback=function(a,b){this._send({msg:"callback",id:a,args:[b]})},j.prototype.set=function(a){var b=a.url,d=a.value;return c(b).set(d)},j.prototype.update=function(a){var b=a.url,d=a.value;return c(b).update(d)},j.prototype.on=function(a){var b=a.listenerKey,d=a.url,e=a.terms,f=a.eventType,g=a.callbackId,h=a.options;if(h=h||{},h.orderChildren=!1,e)for(var i=0,j=e;i<j.length;i+=1){var k=j[i];if("orderByChild"===k[0]||"orderByValue"===k[0]){h.orderChildren=!0;break}}var l=this._callbacks[g]=this._onSnapshotCallback.bind(this,g,h);l.listenerKey=b,l.eventType=f,l.cancel=this.off.bind({listenerKey:b,url:d,terms:e,eventType:f,callbackId:g});var m=this._onCancelCallback.bind(this,g);c(d,e).on(f,l,m)},j.prototype.off=function(a){var b,d=this,e=a.listenerKey,f=a.url,g=a.terms,h=a.eventType,i=a.callbackId;if(i)b=this._callbacks[i],delete this._callbacks[i];else for(var j=0,k=Object.keys(this._callbacks);j<k.length;j+=1){var l=k[j];if(d._callbacks.hasOwnProperty(l)){var m=d._callbacks[l];m.listenerKey!==e||h&&m.eventType!==h||delete d._callbacks[l]}}c(f,g).off(h,b)},j.prototype._onSnapshotCallback=function(a,c,d){this._send({msg:"callback",id:a,args:[null,b(d,c)]})},j.prototype._onCancelCallback=function(b,c){delete this._callbacks[b],this._send({msg:"callback",id:b,args:[a(c)]})},j.prototype.once=function(a){var d=a.url,e=a.terms,f=a.eventType,g=a.options;return c(d,e).once(f).then(function(a){return b(a,g)})},j.prototype.transaction=function(a){var e,f,g,h=a.url,i=a.oldHash,j=a.newValue,k=a.options,l=c(h);return l.transaction(function(a){if(f=a,g=d(a),e=i!==g,!e)return void 0===j&&k.safeAbort?a:j},void 0,k.applyLocally).then(function(a){return e?{stale:e,value:f,hash:g}:{stale:!1,committed:a.committed,snapshotJson:b(a.snapshot)}},function(a){return k.nonsequential&&"set"===a.message?l.once("value").then(function(a){return{stale:!0,value:a,hash:d(a)}}):Promise.reject(a)})},j.expose=function(a){if(j._exposed.hasOwnProperty(a.name))throw new Error("Function "+a.name+"() already exposed");if(j._firstMessageReceived)throw new Error("Too late to expose function, worker in use");j._exposed[a.name]=a},j._exposed={},j._firstMessageReceived=!1;var k=6e4,l=Date.now();setInterval(function(){var a=Date.now(),b=a-l-k;l=a,g.forEach(function(c){c&&(b>=1e3&&c.lastTouched<=a-b&&(c.lastTouched+=b),a-c.lastTouched>=3*k&&c.destroy())});for(var c;(c=g.indexOf(null))>=0;)g.splice(c,1)},k),self.Fireworker=j,self.window=self,f()}();
//# sourceMappingURL=worker.min.js.map