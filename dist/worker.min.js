!function(){"use strict";function a(a){for(var b={name:a.name},c=Object.getOwnPropertyNames(a),d=0,e=c;d<e.length;d+=1){var f=e[d];b[f]=a[f]}return b}function b(a,b){var c=new Firebase(a);if(b)for(var d=0,e=b;d<e.length;d+=1){var f=e[d];c=c[f[0]].apply(c,f.slice(1))}return c}function c(){"undefined"!=typeof onconnect?self.onconnect=function(a){e.push(new d(a.ports[0]))}:e.push(new d(self))}var d=function(a){this._port=a,this._callbacks={},a.onmessage=this._receive.bind(this)};d.prototype.destroy=function(){var a=this;for(var b in this._callbacks){var c=a._callbacks[b];c.cancel&&c.cancel()}this._callbacks={},this._port.onmessage=null},d.prototype._receive=function(b){var c=this;d._firstMessageReceived=!0;var e;try{e=Promise.resolve(this[b.data.msg](b.data))}catch(a){e=Promise.reject(a)}e.then(function(a){c._send({msg:"resolve",id:b.data.id,result:a})},function(c){this._send({msg:"reject",id:b.data.id,error:a(c)})})},d.prototype._send=function(a){this._port.postMessage(a)},d.prototype.init=function(){return Object.keys(d._exposed)},d.prototype.call=function(a){var b=a.name,c=a.args;try{return Promise.resolve(this._exposed[b].apply(null,c))}catch(a){return Promise.reject(a)}},d.prototype.authWithCustomToken=function(a){var c=a.url,d=a.authToken,e=a.options;return b(c).authWithCustomToken(d,e)},d.prototype.authAnonymously=function(a){var c=a.url,d=a.options;return b(c).authAnonymously(d)},d.prototype.authWithOAuthToken=function(a){var c=a.url,d=a.provider,e=a.credentials,f=a.options;return b(c).authWithOAuthToken(d,e,f)},d.prototype.unauth=function(a){return b(a).unauth()},d.prototype.onAuth=function(a){var c=a.url,d=a.callbackId,e=this._callbacks[d]=this._onAuthCallback.bind(this,d);e.cancel=this._offAuth.bind(this,c,e),b(c).onAuth(e)},d.prototype._offAuth=function(a,c){b(a).offAuth(c)},d.prototype.set=function(a){var c=a.url,d=a.value;return b(c).set(d)},d.prototype.update=function(a){var c=a.url,d=a.value;return b(c).update(d)},d.prototype.on=function(a){var c=a.listenerKey,d=a.url,e=a.terms,f=a.eventType,g=a.callbackId,h=a.options;h.orderChildren=!1;for(var i=0,j=e;i<j.length;i+=1){var k=j[i];if("orderByChild"===k[0]||"orderByValue"===k[0]){h.orderChildren=!0;break}}var l=this._callbacks[g]=this._onSnapshotCallback.bind(this,g,h);l.listenerKey=c,l.eventType=f,l.cancel=this.off.bind({listenerKey:c,url:d,terms:e,eventType:f,callbackId:g});var m=this._onCancelCallback.bind(this,g);b(d,e).on(f,l,m)},d.prototype.off=function(a){var c,d=this,e=a.listenerKey,f=a.url,g=a.terms,h=a.eventType,i=a.callbackId;if(i)c=this._callbacks[i],delete this._callbacks[i];else for(var j=0,k=Object.keys(this._callbacks);j<k.length;j+=1){var l=k[j];if(d._callbacks.hasOwnProperty(l)){var m=d._callbacks[l];m.listenerKey!==e||h&&m.eventType!==h||delete d._callbacks[l]}}b(f,g).off(h,c)},d.prototype._onSnapshotCallback=function(a,b,c){var d,e=b.omitValue?void 0:c.val(),f=c.exists(),g=c.hasChildren();!b.omitValue&&b.orderChildren&&g&&(d=[],c.forEach(function(a){for(var b in e)e[b]===a&&d.push(b)})),this._send({msg:"callback",id:a,args:[null,{url:c.ref().toString(),childrenKeys:d,value:e,exists:f,hasChildren:g}]})},d.prototype._onCancelCallback=function(b,c){delete this._callbacks[b],this._send({msg:"callback",id:b,args:[a(c)]})},d.expose=function(a){if(d._exposed.hasOwnProperty(a.name))throw new Error("Function "+a.name+"() already exposed");if(d._firstMessageReceived)throw new Error("Too late to expose function, worker in use");d._exposed[a.name]=a},d._exposed={},d._firstMessageReceived=!1;var e=[];self.Fireworker=d,c()}();
//# sourceMappingURL=worker.min.js.map