!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("lodash"),require("vue")):"function"==typeof define&&define.amd?define(["lodash","vue"],b):a.Truss=b(a._,a.Vue)}(this,function(a,b){"use strict";function c(a){return a?a.toString().replace(/\\[0-9a-f]{2}/gi,function(a){return String.fromCharCode(parseInt(a.slice(1),16))}):a}function d(a,b){return b={exports:{}},a(b,b.exports),b.exports}function e(){throw new Error("Read-only property")}function f(){for(var a=[],b=0,c=arguments;b<c.length;b+=1){var d=c[b];"/"===d.charAt(0)&&a.splice(0,a.length),a.push(d)}return"/"===a[0]&&(a[0]=""),a.join("/")}function g(){}a="default"in a?a.default:a,b="default"in b?b.default:b;var h=function(a,b,c){this._truss=a,this._path=b.replace(/^\/?/,"/").replace(/\/$/,""),this._terms=c},i={key:{},path:{},parent:{},ready:{}};i.key.get=function(){return this._key||(this._key=c(this._path.replace(/.*\//,""))),this._key},i.path.get=function(){return this._path},i.parent.get=function(){return new j(this._truss,this._path.replace(/\/[^\/]*$/,""))},i.ready.get=function(){},h.prototype.waitUntilReady=function(){},h.prototype.get=function(){return this.ready?Promise.resolve():trackSlowness(worker.once(this._url,this._terms,"value"),"read")},h.prototype.connect=function(){},h.prototype.disconnect=function(){},h.prototype.toString=function(){var a=this._path;if(this._terms){var b=this._terms.map(function(a){var b=a[0];return a.length>1&&(b+="="+encodeURIComponent(a.slice(1).map(function(a){return JSON.stringify(a)}).join(","))),b});b.sort(),a+="?"+b.join("&")}return a},h.prototype.orderByChild=function(b){if(b._terms)throw new Error("orderByChild must be called with a reference, not a query: "+b);var c=b.toString();a.startsWith(c,this._path)&&(c=c.slice(this._path.length));var d=this._terms?this._terms.slice():[];return d.push(["orderByChild",c]),new h(this._truss,this._path,d)},Object.defineProperties(h.prototype,i),["orderByKey","orderByValue","startAt","endAt","equalTo","limitToFirst","limitToLast"].forEach(function(a){h.prototype[a]=function(){var b=Array.prototype.slice.call(arguments);b.unshift(a);var c=this._terms?this._terms.slice():[];return c.push(b),new h(this._url,c)}});var j=function(a){function b(b,c){a.call(this,b,c)}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.child=function(){},b.prototype.children=function(){},b.prototype.set=function(a){},b.prototype.update=function(a){},b.prototype.commit=function(a,b){var c=this;for(var d in a)a.hasOwnProperty(d)&&void 0===a[d]&&(a[d]=Truss.DefaultTransactionOptions[d]);return this.on("value",noop),trackSlowness(worker.transaction(this._url,b,a),"write").then(function(a){return c.off("value",noop),a},function(a){return c.off("value",noop),Promise.reject(a)})},b}(h),k="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},l=d(function(a){(function(){var b,c,d;"undefined"!=typeof performance&&null!==performance&&performance.now?a.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(a.exports=function(){return(b()-d)/1e6},c=process.hrtime,b=function(){var a;return a=c(),1e9*a[0]+a[1]},d=b()):Date.now?(a.exports=function(){return Date.now()-d},d=Date.now()):(a.exports=function(){return(new Date).getTime()-d},d=(new Date).getTime())}).call(k)}),m={$truss:!0,$parent:!0,$key:!0,$path:!0},n={},o=function(){},p={$ref:{},$refs:{},$keys:{},$values:{},$root:{}};p.$ref.get=function(){return new j(this.$truss,this.$path)},p.$refs.get=function(){return[this.$ref]},p.$keys.get=function(){return a.keys(this)},p.$values.get=function(){return a.values(this)},p.$root.get=function(){return this.$truss._vue.$data.$root},o.prototype.$set=function(a){return this.$ref.set(a)},o.prototype.$update=function(a){return this.$ref.update(a)},o.prototype.$commit=function(a,b){return this.$ref.commit(a,b)},Object.defineProperties(o.prototype,p);var q=function(b){a.extend(this,{name:b,numRecomputes:0,numUpdates:0,runtime:0})},r=function(c,d){var e=this;this._truss=c,this._firebasePropertyEditAllowed=!1,this._vue=new b({data:{$root:null}}),this._mounts=a(d).map(function(a){return e._mountClass(a)}).flatten().value(),this._vue.$data.$root=this._createObject("/",""),this._completeCreateObject(this.root),this._plantPlaceholders(this.root,"/")},s={root:{}},t={computedPropertyStats:{}};s.root.get=function(){return this._vue.$data.$root},r.prototype.destroy=function(){this._vue.$destroy()},r.prototype._augmentClass=function(b){for(var c,d=b.prototype;d&&d.constructor!==Object;){for(var e=0,f=Object.getOwnPropertyNames(d);e<f.length;e+=1){var g=f[e],h=Object.getOwnPropertyDescriptor(d,g);if("$"===g.charAt(0)){if(a.isEqual(h,Object.getOwnPropertyDescriptor(o.prototype,g)))continue;throw new Error('Property names starting with "$" are reserved: '+b.name+"."+g)}if(h.set)throw new Error("Computed properties must not have a setter: "+b.name+"."+g);!h.get||c&&c[g]||((c||(c={}))[g]={name:g,fullName:d.constructor.name+"."+g,get:h.get})}d=Object.getPrototypeOf(d)}for(var i=0,j=Object.getOwnPropertyNames(o.prototype);i<j.length;i+=1){var k=j[i];"constructor"!==k&&Object.defineProperty(b.prototype,k,Object.getOwnPropertyDescriptor(o.prototype,k))}return c},r.prototype._mountClass=function(b){if(b.$$truss)throw new Error("Class "+b.name+" already mounted");b.$$truss=!0;var c=this._augmentClass(b),d=b.$trussMount;if(!d)throw new Error("Class "+b.name+" lacks a $trussMount static property");return a.isArray(d)||(d=[d]),a.map(d,function(d){a.isString(d)&&(d={path:d});for(var e=[],f=d.path.replace(/\/\$[^\/]+/g,function(a){return e.push(a.slice(1)),""}).replace(/[$-.?[-^{|}]/g,"\\$&"),g=0,h=e;g<h.length;g+=1){var i=h[g];if("$"===i||"$"===i.charAt(1))throw new Error("Invalid variable name: "+i);if("$"===i.charAt(0)&&(a.has(o.prototype,i)||m[i]))throw new Error("Variable name conflicts with built-in property or method: "+i)}return{klass:b,variables:e,computedProperties:c,escapedKey:d.path.match(/\/([^\/]*)$/)[1],placeholder:d.placeholder,regex:new RegExp("^"+f.replace(/\u0001/g,"/([^/]+)")+"$"),parentRegex:new RegExp("^"+(f.replace(/\/[^\/]*$/,"").replace(/\u0001/g,"/([^/]+)")||"/")+"$")}})},r.prototype._createObject=function(b,d,e){var f=this;if(e&&a.has(e,d))throw new Error("Duplicate object created for "+b);for(var g,h={$truss:{value:this._truss,writable:!1,configurable:!1,enumerable:!1},$parent:{value:e,writable:!1,configurable:!0,enumerable:!0},$key:{value:d,writable:!1,configurable:!1,enumerable:!1},$path:{value:b,writable:!1,configurable:!1,enumerable:!1}},i=o,j=0,k=this._mounts;j<k.length;j+=1){var l=k[j];l.regex.lastIndex=0;var m=l.regex.exec(b);if(m){i=l.klass,g=l.computedProperties;for(var n=0;n<l.variables.length;n++)h[l.variables[n]]={value:c(m[n+1]),writable:!1,configurable:!1,enumerable:!1};break}}var p=new i;if(g){var q=e?function(){return e[d]}:function(){return f._vue.$data.$root};a.each(g,function(a){h[a.name]=f._buildComputedPropertyDescriptor(p,a,q)})}return Object.defineProperties(p,h),p},r.prototype._buildComputedPropertyDescriptor=function(b,c,d){function e(){d();var a=l(),b=c.get.call(this);return h.runtime+=l()-a,h.numRecomputes+=1,b}var f=this;n[c.fullName]||Object.defineProperty(n,c.fullName,{value:new q(c.fullName),writable:!1,enumerable:!0,configurable:!1});var g,h=n[c.fullName],i=!1,j=!0;return b.__destructors__||Object.defineProperty(b,"__destructors__",{value:[],writable:!1,enumerable:!1,configurable:!1}),b.__initializers__||Object.defineProperty(b,"__initializers__",{value:[],writable:!1,enumerable:!1,configurable:!1}),b.__initializers__.push(function(){b.__destructors__.push(f._vue.$watch(e.bind(b),function(d){if(j)h.numUpdates+=1,g=d,j=!1;else{if(a.isEqual(g,d,f._isTrussEqual,f))return;h.numUpdates+=1,i=!0,b[c.name]=d,i=!1}},{immediate:!0}))}),{enumerable:!0,configurable:!0,get:function(){return g},set:function(a){if(!i)throw new Error("You cannot set a computed property: "+c.name);g=a}}},r.prototype._isTrussEqual=function(a,b){if(a&&a.$truss||b&&b.$truss)return a===b},r.prototype._completeCreateObject=function(a){for(var b=0,c=Object.getOwnPropertyNames(a);b<c.length;b+=1){var d=c[b],f=Object.getOwnPropertyDescriptor(a,d);f.configurable&&f.enumerable&&(f.enumerable=!1,"$parent"===d&&(f.configurable=!1,f.set=e),Object.defineProperty(a,d,f))}if(a.__initializers__)for(var g=0,h=a.__initializers__;g<h.length;g+=1){var i=h[g];i()}},r.prototype._destroyObject=function(a){var b=this;if(a.__destructors__)for(var c=0,d=a.__destructors__;c<d.length;c+=1){var e=d[c];e()}for(var f in a)if(Object.hasOwnProperty(a,f)){var g=a[f];g&&g.$truss&&b._destroyObject(g)}},r.prototype._plantSnapshotValue=function(a,b){return this._plantValue(pathFromUrl(a.ref().toString()),c(a.key()),a.val(),b)},r.prototype._plantValue=function(b,d,e,g){var h=this;if(!a.isArray(e)&&!a.isObject(e))return void this._setFirebaseProperty(g,d,e);var i=this._createObject(b,d,g);return this._setFirebaseProperty(g,d,i),this._completeCreateObject(i),a.each(e,function(a,d){null!==a&&void 0!==a&&h._plantValue(""+f(b,d),c(d),a,i)}),this._plantPlaceholders(i,b),i},r.prototype._plantPlaceholders=function(b,d){var e=this;a.each(this._mounts,function(a){var g=c(a.escapedKey);!b.hasOwnProperty(g)&&a.placeholder&&a.parentRegex.test(d)&&e._plantValue(""+f(d,a.escapedKey),g,a.placeholder,b)})},r.prototype._setFirebaseProperty=function(a,c,d){var e=Object.getOwnPropertyDescriptor(a,c);if(e){if(!e.enumerable)throw new Error("Key conflict between Firebase and instance or computed properties at "+a.$path+": "+c);if(!e.get||!e.set)throw new Error("Unbound property at "+a.$path+": "+c)}if(null===d||void 0===d){if(e){var f=a[c];f&&f.$truss&&this._deleteObject(f),b.delete(a,c)}}else e?(this._firebasePropertyEditAllowed=!0,a[c]=d,this._firebasePropertyEditAllowed=!1):(b.set(a,c,d),e=Object.getOwnPropertyDescriptor(a,c),Object.defineProperty(a,c,{get:e.get,set:function(a){if(!this._firebasePropertyEditAllowed)throw new Error("Firebase data cannot be mutated directly: "+c);e.set.call(this,a)},configurable:!0,enumerable:!0}))},t.computedPropertyStats.get=function(){return n},Object.defineProperties(r.prototype,s),Object.defineProperties(r,t);var u="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",v=function(){this._lastUniqueKeyTime=0,this._lastRandomValues=[]};v.prototype.generateUniqueKey=function(a){var b=this;a=a||Date.now();for(var c=new Array(20),d=a,e=7;e>=0;e--)c[e]=u.charAt(63&d),d=Math.floor(d/64);if(a===this._lastUniqueKeyTime){for(var f=11;f>=0&&63===this._lastRandomValues[f];)b._lastRandomValues[f]=0,f-=1;if(f===-1)throw new Error("Internal assertion failure: ran out of unique IDs for this millisecond");this._lastRandomValues[f]+=1}else{this._lastUniqueKeyTime=a;for(var g=0;g<12;g++)b._lastRandomValues[g]=Math.floor(Math.random()*(g?64:16))}for(var h=0;h<12;h++)c[h+8]=u[b._lastRandomValues[h]];return c.join("")};var w=function(a){this.record=a,this.counted=!1,this.canceled=!1,this.handle=setTimeout(this.handleTimeout.bind(this),a.timeout)};w.prototype.handleTimeout=function(){this.canceled||(this.counted=!0,this.record.callback(++this.record.count,1,this.record.timeout))},w.prototype.handleDone=function(){this.canceled=!0,this.counted?this.record.callback(--this.record.count,-1,this.record.timeout):clearTimeout(this.handle)};var x=function(a){var b=this;this._idCounter=0,this._deferreds={},this._active=!0,this._servers={},this._callbacks={},this._errorCallbacks=[],this._slowCallbacks={read:[],write:[],auth:[]},this._simulatedTokenGenerator=null,this._maxSimulationDuration=5e3,this._simulatedCallFilter=null,this._inboundMessages=[],this._outboundMessages=[],this._flushMessageQueue=this._flushMessageQueue.bind(this),this._port=a.port||a,this._shared=!!a.port,this._port.onmessage=this._receive.bind(this),window.addEventListener("unload",function(){b._send({msg:"destroy"})}),setInterval(function(){b._send({msg:"ping"})},6e4)};x.prototype.init=function(){var a=this,b=[];try{var c=window.localStorage||window.sessionStorage;if(!c)return;for(var d=0;d<c.length;d++){var e=c.key(d);b.push({key:e,value:c.getItem(e)})}}catch(a){}return this._send({msg:"init",storage:b}).then(function(b){var c=b.exposedFunctionNames,d=b.firebaseSdkVersion;Truss.FIREBASE_SDK_VERSION=d;for(var e=0,f=c;e<f.length;e+=1){var g=f[e];Truss.worker[g]=a.bindExposedFunction(g)}})},x.prototype.activate=function(a){this._active!==a&&(this._active=a,a&&(this._receiveMessages(this._inboundMessages),this._inboundMessages=[],this._outboundMessages.length&&setImmediate(this._flushMessageQueue)))},x.prototype.debugPermissionDeniedErrors=function(a,b,c){this._simulatedTokenGenerator=a,void 0!==b&&(this._maxSimulationDuration=b),this._simulatedCallFilter=c||function(){return!0}},x.prototype._send=function(a){var b=this;a.id=++this._idCounter;var c;if(a.oneWay)c=Promise.resolve();else{c=new Promise(function(c,d){b._deferreds[a.id]={resolve:c,reject:d}});var d=this._deferreds[a.id];d.promise=c,c.sent=new Promise(function(a){d.resolveSent=a});for(var e in a)a.hasOwnProperty(e)&&(d[e]=a[e])}return!this._outboundMessages.length&&this._active&&setImmediate(this._flushMessageQueue),this._outboundMessages.push(a),c},x.prototype._flushMessageQueue=function(){this._port.postMessage(this._outboundMessages),this._outboundMessages=[]},x.prototype._receive=function(a){this._active?this._receiveMessages(a.data):this._inboundMessages=this._inboundMessages.concat(a.data)},x.prototype._receiveMessages=function(a){for(var b=this,c=0,d=a;c<d.length;c+=1){var e=d[c],f=b[e.msg];if("function"!=typeof f)throw new Error("Unknown message: "+e.msg);f.call(b,e)}},x.prototype.bindExposedFunction=function(a){return function(){return this._send({msg:"call",name:a,args:Array.prototype.slice.call(arguments)})}.bind(this)},x.prototype.resolve=function(a){var b=this._deferreds[a.id];if(!b)throw new Error("fireworker received resolution to inexistent call");delete this._deferreds[a.id],b.resolve(a.result)},x.prototype.reject=function(a){var b=this,c=this._deferreds[a.id];if(!c)throw new Error("fireworker received rejection of inexistent call");delete this._deferreds[a.id],this._hydrateError(a.error,c).then(function(a){c.reject(a),b._emitError(a)})},x.prototype._hydrateError=function(a,b){var c=this._errorFromJson(a),d=a.code||a.message;return d&&"permission_denied"===d.toLowerCase()?this._simulateCall(b).then(function(a){return a&&(c.extra=c.extra||{},c.extra.debug=a),c}):Promise.resolve(c)},x.prototype._simulateCall=function(a){var b=this;if(!(this._simulatedTokenGenerator&&this._maxSimulationDuration>0))return Promise.resolve();var c=[];switch(a.msg){case"set":c.push({method:"set",url:a.url,args:[a.value]});break;case"update":c.push({method:"update",url:a.url,args:[a.value]});break;case"on":case"once":c.push({method:"once",url:a.url,args:["value"]});break;case"transaction":c.push({method:"once",url:a.url,args:["value"]}),c.push({method:"set",url:a.url,args:[a.newValue]})}if(!c.length||!this._simulatedCallFilter(a.msg,a.url))return Promise.resolve();var d=this.getAuth(getUrlRoot(a.url)),e=this._simulatedTokenGenerator(d&&d.uid).then(function(a){return Promise.all(c.map(function(c){return c.msg="simulate",c.token=a,b._send(c)}))}).then(function(a){return a.every(function(a){return null===a})?"Unable to reproduce error in simulation":a.filter(function(a){return a}).join("\n\n")}).catch(function(a){return"Error running simulation: "+a}),f=new Promise(function(a){setTimeout(a.bind(null,"Simulated call timed out"),b._maxSimulationDuration)});return Promise.race([e,f])},x.prototype.updateLocalStorage=function(a){try{var b=window.localStorage||window.sessionStorage;for(var c in a)null===c.value?b.removeItem(c.key):b.setItem(c.key,c.value)}catch(a){}},x.prototype.trackServer=function(a){if(!this._servers.hasOwnProperty(a)){var b=this._servers[a]={offset:0,authListeners:[]},c=this._registerCallback(this._authCallback.bind(this,b)),d=a+"/.info/serverTimeOffset";this.on(d,d,[],"value",function(a){b.offset=a.val()}),this._send({msg:"onAuth",url:a,callbackId:c})}},x.prototype._authCallback=function(a,b){a.auth=b;for(var c=0,d=a.authListeners;c<d.length;c+=1){var e=d[c];e(b)}},x.prototype.onAuth=function(a,b,c){var d=b.bind(c);d.callback=b,d.context=c,this._servers[a].authListeners.push(d),d(this.getAuth(a))},x.prototype.offAuth=function(a,b,c){for(var d=this._servers[a].authListeners,e=0;e<d.length;e++){var f=d[e];if(f.callback===b&&f.context===c){d.splice(e,1);break}}},x.prototype.getAuth=function(a){return this._servers[a].auth},x.prototype.authWithCustomToken=function(a,b,c){return this._send({msg:"authWithCustomToken",url:a,authToken:b,options:c})},x.prototype.unauth=function(a){return this._send({msg:"unauth",url:a})},x.prototype.set=function(a,b){return this._send({msg:"set",url:a,value:b})},x.prototype.update=function(a,b){return this._send({msg:"update",url:a,value:b})},x.prototype.on=function(a,b,c,d,e,f,g,h){var i={listenerKey:a,eventType:d,snapshotCallback:e,cancelCallback:f,context:g,msg:"on",url:b,terms:c,timeouts:this._slowCallbacks.read.map(function(a){return new w(a)})},j=this._onCallback.bind(this,i);this._registerCallback(j,i),e.__callbackIds=e.__callbackIds||[],e.__callbackIds.push(i.id),this._send({msg:"on",listenerKey:a,url:b,terms:c,eventType:d,callbackId:i.id,options:h}).catch(function(a){j(a)})},x.prototype.off=function(a,b,c,d,e,f){var g,h=this,i=[];if(e){if(e.__callbackIds)for(var j=0;j<e.__callbackIds.length;){var k=e.__callbackIds[j],l=h._callbacks[k];if(l){if(l.listenerKey===a&&l.eventType===d&&l.context===f){g=k,i.push(k),e.__callbackIds.splice(j,1);break}j+=1}else e.__callbackIds.splice(j,1)}if(!g)return}else for(var m=0,n=Object.keys(this._callbacks);m<n.length;m+=1){var o=n[m],p=h._callbacks[o];p.listenerKey!==a||d&&p.eventType!==d||i.push(o)}for(var q=0,r=i;q<r.length;q+=1){var s=r[q];h._nullifyCallback(s)}return this._send({msg:"off",listenerKey:a,url:b,terms:c,eventType:d,callbackId:g}).then(function(){for(var a=0,b=i;a<b.length;a+=1){var c=b[a];h._deregisterCallback(c)}})},x.prototype._onCallback=function(a,b,c){var d=this;if(a.timeouts)for(var e=0,f=a.timeouts;e<f.length;e+=1){var g=f[e];g.handleDone()}b?(this._deregisterCallback(a.id),this._hydrateError(b,a).then(function(b){a.cancelCallback&&a.cancelCallback.call(a.context,b),d._emitError(b)})):a.snapshotCallback.call(a.context,new Snapshot(c))},x.prototype.once=function(a,b,c,d){return this._send({msg:"once",url:a,terms:b,eventType:c,options:d}).then(function(a){return new Snapshot(a)})},x.prototype.transaction=function(a,b,c){var d=this,e=0,f=function(g,h){if(e++>=25)return Promise.reject(new Error("maxretry"));var i;try{i=b(g)}catch(a){return Promise.reject(a)}return i===Firebase.ABORT_TRANSACTION_NOW||void 0===i&&!c.safeAbort?{committed:!1,snapshot:new Snapshot({url:a,value:g})}:d._send({msg:"transaction",url:a,oldHash:h,newValue:i,options:c}).then(function(a){return a.stale?f(a.value,a.hash):{committed:a.committed,snapshot:new Snapshot(a.snapshotJson)}})};return f(null,null)},x.prototype.onDisconnect=function(a,b,c){return this._send({msg:"onDisconnect",url:a,method:b,value:c})},x.prototype.bounceConnection=function(){return this._send({msg:"bounceConnection"})},x.prototype.callback=function(a){var b=a.id,c=a.args,d=this._callbacks[b];if(!d)throw new Error("Unregistered callback: "+b);d.callback.apply(null,c)},x.prototype._registerCallback=function(a,b){return b=b||{},b.callback=a,b.id="cb"+ ++this._idCounter,this._callbacks[b.id]=b,b.id},x.prototype._nullifyCallback=function(a){var b=this._callbacks[a];if(b.timeouts)for(var c=0,d=b.timeouts;c<d.length;c+=1){var e=d[c];e.handleDone()}this._callbacks[a].callback=g},x.prototype._deregisterCallback=function(a){delete this._callbacks[a]},x.prototype.onError=function(a){return this._errorCallbacks.push(a),a},x.prototype.offError=function(a){var b=this._errorCallbacks.indexOf(a);b!==-1&&this._errorCallbacks.splice(b,1)},x.prototype.onSlow=function(a,b,c){for(var d=this,e="all"===a?Object.keys(this._slowCallbacks):[a],f=0,g=e;f<g.length;f+=1){var h=g[f];d._slowCallbacks[h].push({timeout:b,callback:c,count:0})}return c},x.prototype.offSlow=function(a,b){for(var c=this,d="all"===a?Object.keys(this._slowCallbacks):[a],e=0,f=d;e<f.length;e+=1)for(var g=f[e],h=c._slowCallbacks[g],i=0;i<h.length;i++)if(h[i].callback===b){h.splice(i,1);break}},x.prototype.trackSlowness=function(a,b){function c(){for(var a=0,b=e;a<b.length;a+=1){var c=b[a];c.handleDone()}}var d=this._slowCallbacks[b];if(!d.length)return a;var e=d.map(function(a){return new w(a)});return a=a.then(function(a){return c(),a},function(a){return c(),Promise.reject(a)})},x.prototype._errorFromJson=function(a){if(!a||a instanceof Error)return a;var b=new Error(a.message);for(var c in a)if("message"!==c&&a.hasOwnProperty(c))try{b[c]=a[c]}catch(a){throw a.extra={propertyName:c},a}return b},x.prototype._emitError=function(a){var b=this;this._errorCallbacks.length&&setTimeout(function(){for(var c=0,d=b._errorCallbacks;c<d.length;c+=1){var e=d[c];e(a)}},0)};var y,z={active:"undefined"!=typeof window&&window.angular};z.active?(window.angular.module("firetruss",[]).run(["$rootScope",function(a){y=a.$evalAsync.bind(a)}]),z.defineModule=function(a){window.angular.module("firetruss").constant("Truss",a)}):z.defineModule=function(){},z.digest=function(){y&&y()};var A,B=Object.freeze({".sv":"timestamp"}),C=function(a,b){this._rootUrl=a.replace(/\/$/,""),this._keyGenerator=new v,A.trackServer(this._rootUrl),this._tree=new r(this,b),Object.defineProperty(this,"root",{value:this._vue.$data.$root,writable:!1,configurable:!1,enumerable:!1}),z.active&&this._vue.$watch("$data",z.digest,{deep:!0})},D={now:{},user:{}},E={computedPropertyStats:{},TIMESTAMP:{}};return C.prototype.destroy=function(){this.tree.destroy()},D.now.get=function(){},C.prototype.newKey=function(){return this._keyGenerator.generateUniqueKey(this.now)},D.user.get=function(){},C.prototype.authenticate=function(a){},C.prototype.unauthenticate=function(){},C.prototype.interceptConnections=function(){},C.prototype.interceptWrites=function(){},C.prototype.pull=function(a,b){},C.prototype.bind=function(a,b){},E.computedPropertyStats.get=function(){return this._tree.computedPropertyStats},C.connectWorker=function(a){if(A)throw new Error("Worker already connected");return A=new x(a),A.init()},C.preExpose=function(a){C.worker[a]=A.bindExposedFunction(a)},C.goOnline=function(){A.activate(!0)},C.goOffline=function(){A.activate(!1)},C.escapeKey=function a(b){return a(b)},C.unescapeKey=function a(b){return a(b)},E.TIMESTAMP.get=function(){return B},Object.defineProperties(C.prototype,D),Object.defineProperties(C,E),["onError","offError","onSlow","offSlow","bounceConnection","debugPermissionDeniedErrors"].forEach(function(a){C[a]=function(){return A[a].apply(A,arguments)}}),C.DefaultTransactionOptions=Object.seal({applyLocally:!0,nonsequential:!1,safeAbort:!1}),C.ABORT_TRANSACTION_NOW=Object.create(null),C.worker={},z.defineModule(C),C});
//# sourceMappingURL=firetruss.min.js.map